<!doctype html><html class=h-100 dir=ltr lang=ru-RU prefix="og: http://ogp.me/ns#
      article: http://ogp.me/ns/article#
      profile: http://ogp.me/ns/profile#
      fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Сеть / Library Online</title>
<meta name=title content="Сеть / Library Online"><meta name=description content="Работа с сетью. Статьи и инструкции по сетевому администрированию."><meta name=keywords content="powershell,forum,ipb,ips,debian,linux,cmd,cmf,cms,vbulletin,bash,cloudflare,fedora,git,php,systemd,terminal,dhcp,find,gdm"><link rel=preconnect href=https://fonts.googleapis.com crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link rel=preconnect href=https://gravatar.com crossorigin=anonymous><link rel=preconnect href=https://images.unsplash.com crossorigin=anonymous><link rel=preload href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href=/css/vendor.bundle.css as=style><link rel=stylesheet href=/css/vendor.bundle.css><link rel=preload href=/ru/css/system.bundle.min.css as=style><link rel=stylesheet href=/ru/css/system.bundle.min.css><link rel=icon type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel="shortcut icon" type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=apple-touch-icon sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=icon type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel="shortcut icon" type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=apple-touch-icon sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=icon type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel="shortcut icon" type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=apple-touch-icon sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=icon type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel="shortcut icon" type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=apple-touch-icon sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=icon type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel="shortcut icon" type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=apple-touch-icon sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=icon type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel="shortcut icon" type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=apple-touch-icon sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=icon type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel="shortcut icon" type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=apple-touch-icon sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=icon type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel="shortcut icon" type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=apple-touch-icon sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=icon type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel="shortcut icon" type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=apple-touch-icon sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=icon type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel="shortcut icon" type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=apple-touch-icon sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=icon type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel="shortcut icon" type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=apple-touch-icon sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=icon type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel="shortcut icon" type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=apple-touch-icon sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=icon type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel="shortcut icon" type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=apple-touch-icon sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=icon type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel="shortcut icon" type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=apple-touch-icon sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=icon type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel="shortcut icon" type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=apple-touch-icon sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=icon type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel="shortcut icon" type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=apple-touch-icon sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=icon type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel="shortcut icon" type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=apple-touch-icon sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=icon type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel="shortcut icon" type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=apple-touch-icon sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=icon type=image/svg+xml sizes=any href=https://lib.onl/favicon.svg><link rel="shortcut icon" type=image/x-icon href=https://lib.onl/favicon.ico><link rel="shortcut icon" type=image/vnd.microsoft.icon href=https://lib.onl/favicon.ico><link rel=first href=https://lib.onl/ru/categories/network/><link rel=last href=https://lib.onl/ru/categories/network/><link rel=canonical href=https://lib.onl/ru/categories/network/><link rel=alternate href=https://lib.onl/ hreflang=x-default><link rel=alternate href=https://lib.onl/ru/categories/network/ hreflang=ru><link rel=manifest type=application/manifest+json href=https://lib.onl/ru/manifest.json title="Library Online"><link rel=search type=application/opensearchdescription+xml href=https://lib.onl/ru/opensearch.xml title="Library Online"><link rel=alternate type=application/rss+xml href=https://lib.onl/ru/categories/network/index.xml title="Library Online"><meta name=application-name content="Library Online"><meta name=theme-color content="#f8f9fa" media="(prefers-color-scheme: light)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lib.onl/favicon-512.png"><meta name=twitter:title content="Сеть"><meta name=twitter:description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:title" content="Сеть"><meta property="og:description" content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:type" content="website"><meta property="og:url" content="https://lib.onl/ru/categories/network/"><meta property="og:image" content="https://lib.onl/favicon-512.png"><meta property="twitter:domain" content="lib.onl"><meta property="twitter:url" content="https://lib.onl/ru/categories/network/"><meta property="og:locale" content="ru_RU"><meta property="og:site_name" content="Library Online"><meta name=DC.Title content="Сеть"><meta name=DC.Subject content="Работа с сетью. Статьи и инструкции по сетевому администрированию."><meta name=DC.Description content="Работа с сетью. Статьи и инструкции по сетевому администрированию."><meta name=DC.Type content="Text"><meta name=DC.Source content="https://lib.onl/ru/categories/network/"><meta name=DC.Relation content="https://lib.onl/ru/categories/network/"><meta name=DC.Coverage content="World"><meta name=DC.Creator content="Library Online"><meta name=DC.Publisher content="Library Online"><meta name=DC.Contributor content="Library Online"><meta name=DC.Rights content="Library Online"><meta name=DC.Format content="Digital"><meta name=DC.Identifier content="https://lib.onl/ru/categories/network/"><meta name=DC.Language content="ru-RU"><meta name=DC.Provenance content="Library Online"><meta name=DC.RightsHolder content="Library Online"><meta name=DC.AccrualPeriodicity content="Weekly"><meta name=DC.AccrualPolicy content="Active"></head><body class="d-flex flex-column h-100 is-node type-categories"><header id=site-header><nav class="navbar navbar-expand-lg navbar-light fixed-top border-bottom shadow-sm text-lg-center bg-light"><div class=container-fluid><a class=navbar-brand href=/ru/><img src=https://lib.onl/img/logo.min.svg alt=Логотип width=30 height=24 class="d-inline-block align-text-top"><h1 class="d-inline-block h5 m-0 ms-1">Library Online</h1></a><button type=button class=navbar-toggler data-bs-toggle=collapse data-bs-target=#navTopBar aria-controls=navTopBar aria-expanded=false aria-label='Переключить навигацию'>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navTopBar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/ru/articles/><i class="fas fa-book fa-fw"></i>
<span>Статьи</span></a></li><li class=nav-item><a class=nav-link href=/ru/faq/><i class="fas fa-circle-question fa-fw"></i>
<span>Q&amp;A</span></a></li><li class=nav-item><a class=nav-link href=/ru/archive/><i class="fas fa-archive fa-fw"></i>
<span>Архив</span></a></li><li class=nav-item><a class=nav-link href=/ru/about/><i class="fas fa-info-circle fa-fw"></i>
<span>О проекте</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-list fa-fw"></i>
<span>META</span></a><div class="dropdown-menu shadow"><a class=dropdown-item href=/ru/authors/><i class="fas fa-user-circle fa-fw"></i>
<span>Авторы</span>
</a><a class="dropdown-item active" href=/ru/categories/><i class="fas fa-folder-open fa-fw"></i>
<span>Категории</span>
</a><a class=dropdown-item href=/ru/tags/><i class="fas fa-tags fa-fw"></i>
<span>Теги</span>
</a><a class=dropdown-item href=/ru/drafts/><i class="fas fa-file-pen fa-fw"></i>
<span>Черновики</span></a></div></li></ul><ul class=navbar-nav><li class=nav-item><a class="nav-link d-lg-none" href=# data-bs-toggle=modal data-bs-target=#search-modal aria-label=Поиск><i class="fas fa-search fa-fw"></i>
<span>Поиск</span>
</a><a class="nav-link d-none d-lg-block" href=# data-bs-toggle=modal data-bs-target=#search-modal data-bs-tooltip data-bs-title=Поиск aria-label=Поиск><i class="fas fa-search fa-fw"></i></a></li></ul></div></div></nav></header><main class="wrapper flex-shrink-0" id=site-main><div class="section py-3"><div class=container><nav style="--bs-breadcrumb-divider:'\2f '" class=small aria-label=breadcrumb><ol class="breadcrumb bg-light p-2 rounded"><li class=breadcrumb-item><a href=/ru/ aria-label=Главная><i class="fas fa-home fa-fw"></i></a></li><li class=breadcrumb-item><a href=/ru/categories/ aria-label=Категории>Категории</a></li><li class="breadcrumb-item active">Сеть</li></ol></nav><div class="row row-cols-1 row-cols-xl-2 g-3"><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Работа с сетевыми интерфейсами в PowerShell" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b><picture><source srcset='https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Работа с сетевыми интерфейсами в PowerShell" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b>Работа с сетевыми интерфейсами в PowerShell</a></h2></div></header><div class=node-body><p>Разберём основные команды, которые пригодятся нам при настройке сети в ОС Windows через PowerShell.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Работа с сетевыми интерфейсами в PowerShell" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b><img class=img-fluid src="https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Работа с сетевыми интерфейсами в PowerShell" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b>Работа с сетевыми интерфейсами в PowerShell</a></h2></div></header><div class=node-body><p>Разберём основные команды, которые пригодятся нам при настройке сети в ОС Windows через PowerShell.</p></div></div></article></div><div class="modal fade" id=modal-f342f3f897a95eca91790f040272db0b tabindex=-1 aria-labelledby=modal-f342f3f897a95eca91790f040272db0b-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-f342f3f897a95eca91790f040272db0b-label><a href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/>Работа с сетевыми интерфейсами в PowerShell</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Разберём основные команды, которые пригодятся нам при настройке сети в ОС Windows через PowerShell.</p><h2 id=1956441408-сетевые-адаптеры><a class=link-body-emphasis href=#1956441408-%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d1%8b%d0%b5-%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%d1%8b>Сетевые адаптеры</a></h2><p>Получить список сетевых адаптеров и их интерфейсов:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-408608297a1ef45ef92580343c5a0f55><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-408608297a1ef45ef92580343c5a0f55 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить список обычных и скрытых сетевых адаптеров:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-7194191908a7b6ea3c9a560cb3b0cf6f><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=err>–</span><span class=n>IncludeHidden</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7194191908a7b6ea3c9a560cb3b0cf6f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить конфигурацию по интерфейсу <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1e2f186bb3529042b86e27fe9fa39bfb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Get-NetIPConfiguration</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1e2f186bb3529042b86e27fe9fa39bfb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить детальную конфигурацию по интерфейсу <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-d1a3e7c5dc43431a72a69d4579efbd24><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Get-NetIPConfiguration</span> <span class=n>-Detailed</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d1a3e7c5dc43431a72a69d4579efbd24 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Отключить адаптер с интерфейсом <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e787554b3a5a56c3bc88792f9d9bd573><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Disable-NetAdapter</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e787554b3a5a56c3bc88792f9d9bd573 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-сетевые-профили><a class=link-body-emphasis href=#1956441408-%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d1%8b%d0%b5-%d0%bf%d1%80%d0%be%d1%84%d0%b8%d0%bb%d0%b8>Сетевые профили</a></h2><p>Вывести информацию по текущим сетевым профилям:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ad0b934d1c612b0e27de2e910fc27a1d><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetConnectionProfile</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ad0b934d1c612b0e27de2e910fc27a1d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить информацию только по профилю сети интерфейса <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9c8096644a123e225e93caa453ddd2cb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Get-NetConnectionProfile</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9c8096644a123e225e93caa453ddd2cb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить профиль сети интерфейса <code>5</code> на публичный (<code>Public</code>).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-88ffe6be56ce9d9fe18f4fe0fbb3a3a0><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetConnectionProfile</span> <span class=n>-NetworkCategory</span> <span class=s1>&#39;Public&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-88ffe6be56ce9d9fe18f4fe0fbb3a3a0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить профиль сети интерфейса <code>5</code> на приватный (<code>Private</code>).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-8 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-82bd6797e27980d2e3deb19fb0f5bd98><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetConnectionProfile</span> <span class=n>-NetworkCategory</span> <span class=s1>&#39;Private&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-82bd6797e27980d2e3deb19fb0f5bd98 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить профиль сети интерфейса <code>5</code> на доменный (<code>DomainAuthenticated</code>).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-9 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-04e0e9797fd095e79ff7a9e97d41bc22><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetConnectionProfile</span> <span class=n>-NetworkCategory</span> <span class=s1>&#39;DomainAuthenticated&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-04e0e9797fd095e79ff7a9e97d41bc22 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-настройка-ip-адреса><a class=link-body-emphasis href=#1956441408-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-ip-%d0%b0%d0%b4%d1%80%d0%b5%d1%81%d0%b0>Настройка IP-адреса</a></h2><p>Отключить DHCP на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-10 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e98a175c9a001157d78130a376a5fc89><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetIPInterface</span> <span class=n>-Dhcp</span> <span class=s1>&#39;Disabled&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e98a175c9a001157d78130a376a5fc89 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Установить новый IP-адрес и шлюз на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-11 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-3e593e12eca09040ed563657bf85b0d3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>New-NetIPAddress</span> <span class=err>–</span><span class=n>IPAddress</span> <span class=s1>&#39;192.168.0.10&#39;</span> <span class=n>-PrefixLength</span> <span class=s1>&#39;24&#39;</span> <span class=n>-DefaultGateway</span> <span class=s1>&#39;192.168.0.1&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3e593e12eca09040ed563657bf85b0d3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить IP-адрес на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-12 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-83cb8a736c1bfde6001d2c301201cfeb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetIPAddress</span> <span class=n>-IPAddress</span> <span class=s1>&#39;192.168.0.12&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-83cb8a736c1bfde6001d2c301201cfeb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Удалить IP-адрес на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-13 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e90ec039af35047a2256fda936b4791a><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Remove-NetIPAddress</span> <span class=n>-Confirm:</span><span class=vm>$false</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e90ec039af35047a2256fda936b4791a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Удаление шлюза на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-14 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-8b2880f7b23a6ccc782ca234d5b90e5b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Remove-NetRoute</span> <span class=n>-Confirm:</span><span class=vm>$false</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8b2880f7b23a6ccc782ca234d5b90e5b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-настройка-dns><a class=link-body-emphasis href=#1956441408-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-dns>Настройка DNS</a></h2><p>Установить IP-адреса серверов DNS на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-15 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-77d39e6d0ebcc90114e5cd41dc2da2c9><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-DNSClientServerAddress</span> <span class=err>–</span><span class=n>ServerAddresses</span> <span class=p>(</span><span class=s1>&#39;192.168.0.2&#39;</span><span class=p>,</span><span class=s1>&#39;192.168.1.2&#39;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-77d39e6d0ebcc90114e5cd41dc2da2c9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Сбросить IP-адреса серверов DNS на параметры по умолчанию на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-16 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-dd83ca4c015e81dc9bcd7c553bd8a506><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-DnsClientServerAddress</span> <span class=n>-ResetServerAddresses</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-dd83ca4c015e81dc9bcd7c553bd8a506 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Очистить кэш DNS:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-17 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-342494bb2f62a1fd1bf2f9aa557f8148><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Clear-DnsClientCache</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-342494bb2f62a1fd1bf2f9aa557f8148 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-настройка-dhcp><a class=link-body-emphasis href=#1956441408-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-dhcp>Настройка DHCP</a></h2><p>Включить DHCP на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-18 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1f1089343e1554cedf7589cbae3bbc31><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetIPInterface</span> <span class=n>-Dhcp</span> <span class=s1>&#39;Enabled&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1f1089343e1554cedf7589cbae3bbc31 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Перезапустить интерфейс с именем <code>Ethernet</code> для получения параметров от DHCP:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-19 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-5b43424af89de60fb2d4420ee6e48dac><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Restart-NetAdapter</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5b43424af89de60fb2d4420ee6e48dac role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-автоматизация><a class=link-body-emphasis href=#1956441408-%d0%b0%d0%b2%d1%82%d0%be%d0%bc%d0%b0%d1%82%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f>Автоматизация</a></h2><p>Скрипт не имеет вводных параметров. Все параметры настраиваются вручную через редактирование скрипта. Далее, скрипт запускается и применяет указанные параметры.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.ip.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7eec23f6d52aebdab548dbe8dd9ae89d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.ip.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.ip.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-7eec23f6d52aebdab548dbe8dd9ae89d><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         b42524a4-c0d0-4402-951c-e97aa140698e
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$Adapter</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># Interface index.</span>
</span></span><span class=line><span class=cl>  <span class=n>InterfaceIndex</span> <span class=p>=</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$IP</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># IP address.</span>
</span></span><span class=line><span class=cl>  <span class=n>IPAddress</span> <span class=p>=</span> <span class=s1>&#39;192.168.0.10&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c># Subnet mask.</span>
</span></span><span class=line><span class=cl>  <span class=n>PrefixLength</span> <span class=p>=</span> <span class=s1>&#39;24&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c># Gateway.</span>
</span></span><span class=line><span class=cl>  <span class=n>DefaultGateway</span> <span class=p>=</span> <span class=s1>&#39;192.168.0.1&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$DNS</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># DNS servers.</span>
</span></span><span class=line><span class=cl>  <span class=n>ServerAddresses</span> <span class=p>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;192.168.0.2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;192.168.1.2&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>Remove-NetIPAddress</span> <span class=n>-Confirm:</span><span class=vm>$false</span>   <span class=c># Removing current IP address.</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>Remove-NetRoute</span> <span class=n>-Confirm:</span><span class=vm>$false</span>       <span class=c># Removing current gateway.</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>New-NetIPAddress</span> <span class=nv>@IP</span>                  <span class=c># Setting new IP address.</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>Set-DNSClientServerAddress</span> <span class=nv>@DNS</span>       <span class=c># Setting new DNS servers.</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-31T17:16:31Z data-fn=date-local>2023/10/31 17:16:31 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Работа с правилами CloudFlare" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/e191797e-d558-5017-8ac4-c28c6e0871ff/ data-bs-toggle=modal data-bs-target=#modal-43af3c7b299583dd88c22fdb98b17719><picture><source srcset='https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Работа с правилами CloudFlare" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/e191797e-d558-5017-8ac4-c28c6e0871ff/ data-bs-toggle=modal data-bs-target=#modal-43af3c7b299583dd88c22fdb98b17719>Работа с правилами CloudFlare</a></h2></div></header><div class=node-body><p>CloudFlare предоставляет мощный инструмент по работе с различными правилами, зависящими от запросов клиентов. Разберём составление этих правил и приведём несколько примеров.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Работа с правилами CloudFlare" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/e191797e-d558-5017-8ac4-c28c6e0871ff/ data-bs-toggle=modal data-bs-target=#modal-43af3c7b299583dd88c22fdb98b17719><img class=img-fluid src="https://images.unsplash.com/photo-1687488802693-db85cc7783e4?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Работа с правилами CloudFlare" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/e191797e-d558-5017-8ac4-c28c6e0871ff/ data-bs-toggle=modal data-bs-target=#modal-43af3c7b299583dd88c22fdb98b17719>Работа с правилами CloudFlare</a></h2></div></header><div class=node-body><p>CloudFlare предоставляет мощный инструмент по работе с различными правилами, зависящими от запросов клиентов. Разберём составление этих правил и приведём несколько примеров.</p></div></div></article></div><div class="modal fade" id=modal-43af3c7b299583dd88c22fdb98b17719 tabindex=-1 aria-labelledby=modal-43af3c7b299583dd88c22fdb98b17719-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-43af3c7b299583dd88c22fdb98b17719-label><a href=/ru/articles/2023/10/e191797e-d558-5017-8ac4-c28c6e0871ff/>Работа с правилами CloudFlare</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>CloudFlare предоставляет мощный инструмент по работе с различными правилами, зависящими от запросов клиентов. Разберём составление этих правил и приведём несколько примеров.</p><h2 id=2015111895-настройки-правила><a class=link-body-emphasis href=#2015111895-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b8-%d0%bf%d1%80%d0%b0%d0%b2%d0%b8%d0%bb%d0%b0>Настройки правила</a></h2><p>Правила работаю на, так называемом, <a title href=https://developers.cloudflare.com/ruleset-engine/ target=_blank rel="noopener noreferrer nofollow">Cloudflare Ruleset Engine</a> и позволяют максимально гибко себя конфигурировать при помощи специальных полей, условий и переменных.</p><p>Каждое правило состоит из двух этапов:</p><ol><li>If&mldr; - если.</li><li>Then&mldr; - тогда.</li></ol><p>Рассмотрим всё это дело подробнее&mldr;</p><h3 id=2015111895-if><a class=link-body-emphasis href=#2015111895-if>If&mldr;</a></h3><p>Этап &ldquo;Если&rdquo; означает условие, по которому будут фильтроваться клиенты. Этап состоит из поля, оператора сравнения и значения, которое будет участвовать в составленном условии.</p><h4 id=2015111895-поля><a class=link-body-emphasis href=#2015111895-%d0%bf%d0%be%d0%bb%d1%8f>Поля</a></h4><p>Поля это переменные, значения которых вычисляются из запроса, инициируемого клиентом. Ниже приведён частичный список полей, которые доступны из графического интерфейса. Полный список полей находится в <a title href=https://developers.cloudflare.com/ruleset-engine/rules-language/fields/ target=_blank rel="noopener noreferrer nofollow">документации CloudFlare</a>.</p><ul><li>AS Num <code>ip.src.asnum</code>.<br>16- или 32-разрядное целое число, представляющее номер автономной системы (AS), связанной с IP-адресом клиента. Это поле эквивалентно устаревшему <code>ip.geoip.asnum</code>.</li><li>Cookie <code>http.cookie</code>.<br>Файл cookie в строке. Пример: <code>session=8521F670545D7865F79C3D7BEDC29CCE;-background=light</code>.</li><li>Country <code>ip.src.country</code>.<br>Двухбуквенный код страны в формате ISO 3166-1 Alpha 2. Пример: GB. Это поле эквивалентно устаревшему <code>ip.geoip.country</code>.</li><li>Continent <code>ip.src.continent</code>.<br>Код континента, связанный с IP-адресом клиента. Это поле эквивалентно устаревшему <code>ip.geoip.continent</code>.<ul><li><code>AF</code> - Africa.</li><li><code>AN</code> - Antarctica.</li><li><code>AS</code> - Asia.</li><li><code>EU</code> - Europe.</li><li><code>NA</code> - North America.</li><li><code>OC</code> - Oceania.</li><li><code>SA</code> - South America.</li><li><code>T1</code> - Tor network.</li></ul></li><li>Hostname <code>http.host</code>.<br>Имя хоста. Пример: <code>www.example.org</code>.</li><li>IP Source Address <code>ip.src</code>.<br>IP-адрес клиента. Пример: <code>93.184.216.34</code>.</li><li>Referer <code>http.referer</code>.<br>Заголовок запроса HTTP Referer, который содержит адрес веб-страницы, с которой пришёл запрос. Пример: <code>Referer: htt­ps://developer.example.org/en-US/docs/Web/JavaScript</code>.</li><li>Request Method <code>http.request.method</code>.<br>Метод HTTP-запроса. Пример: <code>GET</code>.</li><li>SSL/HTTPS <code>ssl</code>.<br>Возвращает <code>true</code>, когда используется зашифрованное соединение с клиентом.</li><li>URI Full <code>http.request.full_uri</code>.<br>Весь URI, полученный сервером. Пример: <code>htt­ps://www.example.org/articles/index?section=539061&amp;expand=comments</code>.</li><li>URI <code>http.request.uri</code>.<br>Путь URI и строка запроса. Пример: <code>/articles/index?section=539061&amp;expand=comments</code>.</li><li>URI Path <code>http.request.uri.path</code>.<br>Путь URI. Пример: <code>/articles/index</code>.</li><li>URI Query String <code>http.request.uri.query</code>.<br>Строка запроса без разделителя <code>?</code>. Пример: <code>section=539061&amp;expand=comments</code>.</li><li>HTTP Version <code>http.request.version</code>.<br>Версия используемого протокола HTTP. Пример: <code>HTTP/1.1</code> или <code>HTTP/3</code>.</li><li>User Agent <code>http.user_agent</code>.<br>User Agent клиента, строка, позволяющая идентифицировать клиентскую операционную систему и веб-браузер. Пример: <code>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36</code>.</li><li>X-Forward-For <code>http.x_forwarded_for</code>.<br>Заголовок X-Forwarded-For. Пример: <code>203.0.113.195, 70.41.3.18</code>.</li><li>Client Certificate Verified <code>cf.tls_client_auth.cert_verified</code>.<br>Возвращает <code>true</code>, когда запрос предоставляет действительный сертификат клиента.</li></ul><h4 id=2015111895-операторы><a class=link-body-emphasis href=#2015111895-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b>Операторы</a></h4><p>Операторы сравнения возвращают true, когда значение запроса клиента совпадает со значением в выражении. Подробнее в <a title href=https://developers.cloudflare.com/ruleset-engine/rules-language/operators/ target=_blank rel="noopener noreferrer nofollow">документации</a>.</p><ul><li>equals <code>eq</code> - равно.</li><li>does not equal <code>ne</code> - не равно.</li><li>greater than <code>gt</code> - больше чем.</li><li>less than <code>lt</code> - меньше чем.</li><li>greater than or equal to <code>ge</code> - больше или равно.</li><li>less than or equal to <code>le</code> - меньше или равно.</li><li>is in <code>in {}</code> - значение находится в массиве.</li><li>is not in <code>not &lt;field> in {}</code> - значение не находится в массиве.</li></ul><h3 id=2015111895-then><a class=link-body-emphasis href=#2015111895-then>Then&mldr;</a></h3><p>Этап &ldquo;Тогда&rdquo; подразумевает под собой действие, которое будет применено к отфильтрованному клиенту.</p><h4 id=2015111895-тип-поля-url><a class=link-body-emphasis href=#2015111895-%d1%82%d0%b8%d0%bf-%d0%bf%d0%be%d0%bb%d1%8f-url>Тип поля URL</a></h4><ul><li>Dynamic - в поле URL содержит динамические параметры (переменные полей) и их необходимо вычислять и обрабатывать.</li><li>Static - в поле URL содержится обычные статические параметры.</li></ul><h4 id=2015111895-коды-статуса><a class=link-body-emphasis href=#2015111895-%d0%ba%d0%be%d0%b4%d1%8b-%d1%81%d1%82%d0%b0%d1%82%d1%83%d1%81%d0%b0>Коды статуса</a></h4><ul><li>301 (Moved Permanently).<br>Запрошенный ресурс был окончательно перемещён в URL, указанный в заголовке <code>Location</code>. Браузер в случае такого ответа перенаправляется на эту страницу, а поисковые системы обновляют свои ссылки на ресурс (говоря языком SEO, вес страницы переносится на новый URL-адрес).</li><li>302 (Moved Temporarily).<br>Запрошенный ресурс был временно перемещён по адресу, указанному в заголовке <code>Location</code>. Получив такой ответ браузер перенаправляется на новую страницу, но поисковые системы не обновляют свои ссылки на ресурс (в жаргоне SEO говорят, что вес ссылки (link-juice) не меняется и не отправляется на новый URL-адрес).</li><li>303 (See Other).<br>Перенаправление производится не на новый (только что загруженный) ресурс, а на другую страницу, например, страницу подтверждения или страницу с результатами загрузки.</li><li>307 (Temporary Redirect).<br>Запрошенный ресурс был временно перемещён в URL-адрес, указанный в заголовке <code>Location</code>. Единственное различие между 307 и 302 состоит в том, что 307 гарантирует, что метод и тело не будут изменены при выполнении перенаправленного запроса. В случае с кодом 302 некоторые старые клиенты неправильно меняли метод на <code>GET</code>, из-за чего поведение запросов с методом отличным от <code>GET</code> и ответа с кодом 302 непредсказуемо, тогда как поведение в случае ответа с кодом 307 предсказуемо. Для запросов <code>GET</code> поведение идентично.</li><li>308 (Permanent Redirect).<br>Запрошенный ресурс был окончательно перемещён в URL-адрес, указанный в <code>Location</code>. Браузер перенаправляется на эту страницу, а поисковые системы обновляют свои ссылки на ресурс (в SEO-speak говорится, что link-juice отправляется на новый URL-адрес). Метод запроса и тело не будут изменены, тогда как 301 иногда может быть неправильно заменён на <code>GET</code> метод.</li></ul><p>В примерах я буду приводить шаблон, который вписывается в редактор выражения. Поэтому, можно не щёлкать по удобным кнопочкам, а сразу нажимать <span class="shortcode shortcode-btn d-inline-block"><kbd class=bg-primary>Edit expression</kbd></span> и вписывать нужный шаблон.</p><h2 id=2015111895-переадресация><a class=link-body-emphasis href=#2015111895-%d0%bf%d0%b5%d1%80%d0%b5%d0%b0%d0%b4%d1%80%d0%b5%d1%81%d0%b0%d1%86%d0%b8%d1%8f>Переадресация</a></h2><p>Самый часто используемый тип правил, это правила по работе с переадресацией. Привожу несколько примеров. Их можно брать готовыми и вставлять в редактор выражения, не забыв отредактировать под себя некоторые входные параметры, например, название домена или адрес куда переадресовывать клиентов.</p><h3 id=2015111895-примеры><a class=link-body-emphasis href=#2015111895-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h3><p>Ниже я привёл примеры, которые позволяют реализовать наиболее популярные правила переадресации запросов.</p><h4 id=2015111895-пути><a class=link-body-emphasis href=#2015111895-%d0%bf%d1%83%d1%82%d0%b8>Пути</a></h4><p>Переадресация запроса с одного ресурса (или страницы) на другой ресурс (или страницу).</p><div class="accordion mb-3" id=sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-04f5059d2272f119fffc6f565237fc6f aria-expanded=false aria-controls=sc-04f5059d2272f119fffc6f565237fc6f aria-label="example.com | www.example.com">example.com | www.example.com</a></div><div class="accordion-collapse collapse" id=sc-04f5059d2272f119fffc6f565237fc6f data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://example.com</code> <code>-></code> <code>https://www.example.com</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-14d78e55868a6a36ec7dc613d07bff6e><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>http.host</span> <span class=n>eq</span> <span class=s2>&#34;example.com&#34;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-14d78e55868a6a36ec7dc613d07bff6e role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-17d5b04cdc79c45ce7b57a81650bbc06><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://www.&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-17d5b04cdc79c45ce7b57a81650bbc06 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-884f57c89c1775b915bdddf81955de3d aria-expanded=false aria-controls=sc-884f57c89c1775b915bdddf81955de3d aria-label="www.example.com | example.com">www.example.com | example.com</a></div><div class="accordion-collapse collapse" id=sc-884f57c89c1775b915bdddf81955de3d data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://www.example.com</code> <code>-></code> <code>https://example.com</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1cc942c570a2a4bb715aa52d20641674><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>http.host</span> <span class=n>eq</span> <span class=s2>&#34;www.example.com&#34;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1cc942c570a2a4bb715aa52d20641674 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-6c358a32a08d79841f534783e951382a><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6c358a32a08d79841f534783e951382a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-3b2a260488517fd4597f5596a1690801 aria-expanded=false aria-controls=sc-3b2a260488517fd4597f5596a1690801 aria-label="example.com/path | example.org/path">example.com/path | example.org/path</a></div><div class="accordion-collapse collapse" id=sc-3b2a260488517fd4597f5596a1690801 data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://example.com/path</code> <code>-></code> <code>https://example.org/path</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-6a1fabfdc49571563cdb8789ab4dc0d2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>http.host</span> <span class=n>eq</span> <span class=s2>&#34;example.com&#34;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6a1fabfdc49571563cdb8789ab4dc0d2 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-6e8f247cf99a09a9abec447177a4b3dc><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://example.org&#34;</span><span class=p>,</span> <span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6e8f247cf99a09a9abec447177a4b3dc role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-b6a7b36fbb9026f7c12fc820f5ef2113 aria-expanded=false aria-controls=sc-b6a7b36fbb9026f7c12fc820f5ef2113 aria-label="example.com | example.org">example.com | example.org</a></div><div class="accordion-collapse collapse" id=sc-b6a7b36fbb9026f7c12fc820f5ef2113 data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://example.com</code> <code>-></code> <code>https://example.org</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ce93aacd820ae509126b375105d67b5d><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>http.host</span> <span class=n>contains</span> <span class=s2>&#34;example.com&#34;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ce93aacd820ae509126b375105d67b5d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Static</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-b9dacec13adfa0f1946158a3297e2974><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>example.org</span><span class=o>/</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b9dacec13adfa0f1946158a3297e2974 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-3bf38f231fa0bdb486075f2e743339f2 aria-expanded=false aria-controls=sc-3bf38f231fa0bdb486075f2e743339f2 aria-label="sub.example.com | example.com/sub">sub.example.com | example.com/sub</a></div><div class="accordion-collapse collapse" id=sc-3bf38f231fa0bdb486075f2e743339f2 data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://sub.example.com</code> <code>-></code> <code>https://example.com/sub</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-92dd11cd6e4776cd8bd6a6637370788b><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>http.host</span> <span class=n>eq</span> <span class=s2>&#34;sub.example.com&#34;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-92dd11cd6e4776cd8bd6a6637370788b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-908e06f8a508fac5b29e3d669060fa8f><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=s2>&#34;/sub&#34;</span><span class=p>,</span> <span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-908e06f8a508fac5b29e3d669060fa8f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-5a6a546138b2404a78bbc9cecfb94081 aria-expanded=false aria-controls=sc-5a6a546138b2404a78bbc9cecfb94081 aria-label="example.com/sub | sub.example.com">example.com/sub | sub.example.com</a></div><div class="accordion-collapse collapse" id=sc-5a6a546138b2404a78bbc9cecfb94081 data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://example.com/sub</code> <code>-></code> <code>https://sub.example.com</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-541f9708d81a3a802f566ed3f60502e0><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>starts_with</span><span class=p>(</span><span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>,</span> <span class=s2>&#34;/sub/&#34;</span><span class=p>))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-541f9708d81a3a802f566ed3f60502e0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-292b79c505aae5903763532ed01e3821><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://sub.&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=n>substring</span><span class=p>(</span><span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-292b79c505aae5903763532ed01e3821 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Число в функции <code>substring()</code> - это количество символов в названии директории <code>sub</code> + 1 символ.</p></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-c9773453e09c838dd28c378c8ed9c220 aria-expanded=false aria-controls=sc-c9773453e09c838dd28c378c8ed9c220 aria-label="example.com/contact-us/ | example.com/contact/">example.com/contact-us/ | example.com/contact/</a></div><div class="accordion-collapse collapse" id=sc-c9773453e09c838dd28c378c8ed9c220 data-bs-parent=#sc-8ab4d9b981d509c170043eaf3e33169d><div class=accordion-body><p><code>https://example.com/contact-us/</code> <code>-></code> <code>https://example.com/contact/</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-4fef0d16f52b1c4eb23f7c3ffdaea567><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span> <span class=n>eq</span> <span class=s2>&#34;/contact-us/&#34;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4fef0d16f52b1c4eb23f7c3ffdaea567 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Static</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ac1a16d333fdad6d3c0b1c00383f3030><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=o>/</span><span class=n>contacts</span><span class=o>/</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ac1a16d333fdad6d3c0b1c00383f3030 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div></div><h4 id=2015111895-порты><a class=link-body-emphasis href=#2015111895-%d0%bf%d0%be%d1%80%d1%82%d1%8b>Порты</a></h4><p>Переадресация в зависимости от запроса, пришедшего на определённый порт.</p><div class="accordion mb-3" id=sc-1e7f43633b262a099fa6041cc87f0e59><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-df52a210c2dd120104824b2828de2273 aria-expanded=false aria-controls=sc-df52a210c2dd120104824b2828de2273 aria-label="Переадресовать запрос к любым портам (кроме '80' и '443') на порт '443' (HTTPS)">Переадресовать запрос к любым портам (кроме '80' и '443') на порт '443' (HTTPS)</a></div><div class="accordion-collapse collapse" id=sc-df52a210c2dd120104824b2828de2273 data-bs-parent=#sc-1e7f43633b262a099fa6041cc87f0e59><div class=accordion-body><p><code>https://example.com:1212</code> <code>-></code> <code>https://example.com</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-dcdc7a00536bde29d7915ab43fe838e5><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(</span><span class=ow>not</span> <span class=p>(</span><span class=n>cf.edge</span><span class=p>.</span><span class=n>server_port</span> <span class=kr>in</span> <span class=p>{</span><span class=mi>80</span> <span class=mi>443</span><span class=p>}))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-dcdc7a00536bde29d7915ab43fe838e5 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-5f7cc8df1bfd22659bb1a76125c20493><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5f7cc8df1bfd22659bb1a76125c20493 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div></div><h4 id=2015111895-страны><a class=link-body-emphasis href=#2015111895-%d1%81%d1%82%d1%80%d0%b0%d0%bd%d1%8b>Страны</a></h4><p>Переадресация в зависимости от страны клиента.</p><div class="accordion mb-3" id=sc-117cb8f310c5421d8a243a7237cd0a3d><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-94d57841815753af75f98a2acfb100e4 aria-expanded=false aria-controls=sc-94d57841815753af75f98a2acfb100e4 aria-label="Переадресовать пользователей из стран RU/BY/UA в директорию '/ru'">Переадресовать пользователей из стран RU/BY/UA в директорию '/ru'</a></div><div class="accordion-collapse collapse" id=sc-94d57841815753af75f98a2acfb100e4 data-bs-parent=#sc-117cb8f310c5421d8a243a7237cd0a3d><div class=accordion-body><p><code>https://example.com</code> <code>-></code> <code>https://example.com/ru/</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-62c0df439746a0b9945cae14054726ac><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(((</span><span class=n>ip.src</span><span class=p>.</span><span class=n>country</span> <span class=n>eq</span> <span class=s2>&#34;RU&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>ip.src</span><span class=p>.</span><span class=n>country</span> <span class=n>eq</span> <span class=s2>&#34;BY&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>ip.src</span><span class=p>.</span><span class=n>country</span> <span class=n>eq</span> <span class=s2>&#34;UA&#34;</span><span class=p>))</span> <span class=ow>and</span> <span class=p>(</span><span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span> <span class=n>eq</span> <span class=s2>&#34;/&#34;</span><span class=p>))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-62c0df439746a0b9945cae14054726ac role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9cbfbfab1e56bea59d7c937e70932d44><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>lower</span><span class=p>(</span><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=s2>&#34;/ru/&#34;</span><span class=p>))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9cbfbfab1e56bea59d7c937e70932d44 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=accordion-item><div class=accordion-header><a class="accordion-button collapsed" href=# role=button tabindex=0 data-bs-toggle=collapse data-bs-target=#sc-d2e09b12563dc17cc6447371d7dc4a96 aria-expanded=false aria-controls=sc-d2e09b12563dc17cc6447371d7dc4a96 aria-label="Переадресовать пользователей НЕ из стран RU/BY/UA в директорию '/en'">Переадресовать пользователей НЕ из стран RU/BY/UA в директорию '/en'</a></div><div class="accordion-collapse collapse" id=sc-d2e09b12563dc17cc6447371d7dc4a96 data-bs-parent=#sc-117cb8f310c5421d8a243a7237cd0a3d><div class=accordion-body><p><code>https://example.com</code> <code>-></code> <code>https://example.com/en/</code></p><p><strong>When incoming requests match:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-acc0f0c8e06ac0632898363e85fc9ff8><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=p>(((</span><span class=n>ip.src</span><span class=p>.</span><span class=n>country</span> <span class=n>ne</span> <span class=s2>&#34;RU&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>ip.src</span><span class=p>.</span><span class=n>country</span> <span class=n>ne</span> <span class=s2>&#34;BY&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>ip.src</span><span class=p>.</span><span class=n>country</span> <span class=n>ne</span> <span class=s2>&#34;UA&#34;</span><span class=p>))</span> <span class=ow>and</span> <span class=p>(</span><span class=n>http.request</span><span class=p>.</span><span class=n>uri.path</span> <span class=n>eq</span> <span class=s2>&#34;/&#34;</span><span class=p>))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-acc0f0c8e06ac0632898363e85fc9ff8 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p><strong>Then&mldr;</strong></p><ul><li>Type: <code>Dynamic</code></li><li>Status code: <code>301</code></li></ul><p><strong>URL:</strong></p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-lua"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-30888626420d1b8939920f4f250d7e0e><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>lower</span><span class=p>(</span><span class=n>concat</span><span class=p>(</span><span class=s2>&#34;https://&#34;</span><span class=p>,</span> <span class=n>http.host</span><span class=p>,</span> <span class=s2>&#34;/en/&#34;</span><span class=p>))</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-30888626420d1b8939920f4f250d7e0e role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/rule/>#rule</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/cloudflare/>#cloudflare</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-29T06:55:05Z data-fn=date-local>2023/10/29 06:55:05 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Добавление корневых сертификатов в RouterOS" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/cc13623b-970c-5950-867e-168f9ba9025a/ data-bs-toggle=modal data-bs-target=#modal-9084f2b8a6fa0dbfc07679c96d824f3f><picture><source srcset='https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Добавление корневых сертификатов в RouterOS" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/cc13623b-970c-5950-867e-168f9ba9025a/ data-bs-toggle=modal data-bs-target=#modal-9084f2b8a6fa0dbfc07679c96d824f3f>Добавление корневых сертификатов в RouterOS</a></h2></div></header><div class=node-body><p>Репозиторий корневых сертификатов необходим для того, чтобы RouterOS имела представление какие вообще центры сертификации существуют.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Добавление корневых сертификатов в RouterOS" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/cc13623b-970c-5950-867e-168f9ba9025a/ data-bs-toggle=modal data-bs-target=#modal-9084f2b8a6fa0dbfc07679c96d824f3f><img class=img-fluid src="https://images.unsplash.com/photo-1554098415-4052459dc340?crop=bottom&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Добавление корневых сертификатов в RouterOS" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/cc13623b-970c-5950-867e-168f9ba9025a/ data-bs-toggle=modal data-bs-target=#modal-9084f2b8a6fa0dbfc07679c96d824f3f>Добавление корневых сертификатов в RouterOS</a></h2></div></header><div class=node-body><p>Репозиторий корневых сертификатов необходим для того, чтобы RouterOS имела представление какие вообще центры сертификации существуют.</p></div></div></article></div><div class="modal fade" id=modal-9084f2b8a6fa0dbfc07679c96d824f3f tabindex=-1 aria-labelledby=modal-9084f2b8a6fa0dbfc07679c96d824f3f-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-9084f2b8a6fa0dbfc07679c96d824f3f-label><a href=/ru/articles/2023/10/cc13623b-970c-5950-867e-168f9ba9025a/>Добавление корневых сертификатов в RouterOS</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Репозиторий корневых сертификатов необходим для того, чтобы RouterOS имела представление какие вообще центры сертификации существуют.</p><p>Если репозиторий заполнен корневыми сертификатами центров сертификации, RouterOS сможет проверять подлинность выданных этими центрами сертификатов, работать с DNS over HTTPS (DoH) и делать другую работу, связанную с шифрованием данных.</p><h2 id=4127212728-загрузка-базы-сертификатов><a class=link-body-emphasis href=#4127212728-%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%b1%d0%b0%d0%b7%d1%8b-%d1%81%d0%b5%d1%80%d1%82%d0%b8%d1%84%d0%b8%d0%ba%d0%b0%d1%82%d0%be%d0%b2>Загрузка базы сертификатов</a></h2><p>Файл <a title href=https://curl.se/docs/caextract.html target=_blank rel="noopener noreferrer nofollow">cacert.pem</a> с сайта <a title href=https://curl.se/ target=_blank rel="noopener noreferrer nofollow">curl.se</a> переодически обновляется и содержит в себе корневые сертификаты центров сертификации. Откроем терминал в RouterOS и скачаем сразу на роутер командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-text"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-b1b130a5f47504156893fa7f4e04ddf8><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>/tool fetch url=&#34;https://curl.se/ca/cacert.pem&#34; dst-path=&#34;ros.cacert.pem&#34;</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b1b130a5f47504156893fa7f4e04ddf8 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>url</code> - URL файла, который необходимо скачать.</li><li><code>dst-path</code> - название, под которым файл сохранится на роутере. Я добавляю префикс <code>ros.</code>, чтобы знать, что этот файл важен для RouterOS.</li></ul><h2 id=4127212728-импортирование-сертификатов-в-репозиторий><a class=link-body-emphasis href=#4127212728-%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d1%81%d0%b5%d1%80%d1%82%d0%b8%d1%84%d0%b8%d0%ba%d0%b0%d1%82%d0%be%d0%b2-%d0%b2-%d1%80%d0%b5%d0%bf%d0%be%d0%b7%d0%b8%d1%82%d0%be%d1%80%d0%b8%d0%b9>Импортирование сертификатов в репозиторий</a></h2><p>Теперь когда файл на роутере, нужно импортировать его содержимое в репозиторий сертификатов. Делается это следующей командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-text"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-b6d5e2ee55dc88d43c87ace2cebae510><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>/certificate import file-name=&#34;ros.cacert.pem&#34; passphrase=&#34;&#34; name=&#34;ROS&#34;</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b6d5e2ee55dc88d43c87ace2cebae510 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>file-name</code> - название файла на роутере.</li><li><code>name</code> - название, под которым сертификаты будут обозначаться в репозитории сертификатов. Здесь тоже я указываю <code>ROS</code>, чтобы знать, что сертификаты импортировались вручную. Вы можете ввести любое своё название, главное, чтобы оно для вас что-то обозначало.</li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Параметр <code>name</code> можно не указывать, тогда при импорте сертификатов, RouterOS в этот параметр автоматически подставит название файла.</p></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/router/>#router</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/mikrotik/>#mikrotik</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/routeros/>#routeros</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-19T08:56:43Z data-fn=date-local>2023/10/19 08:56:43 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Включение DNS over TLS (DoT) в OPNsense" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2022/08/badb30a9-0471-5dab-a422-85422c0ac611/ data-bs-toggle=modal data-bs-target=#modal-d332564edf73aaa0a2e5866941e0ea60><picture><source srcset='https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Включение DNS over TLS (DoT) в OPNsense" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2022/08/badb30a9-0471-5dab-a422-85422c0ac611/ data-bs-toggle=modal data-bs-target=#modal-d332564edf73aaa0a2e5866941e0ea60>Включение DNS over TLS (DoT) в OPNsense</a></h2></div></header><div class=node-body><p>Почитав несколько статей на тему DoT, я решил написать небольшую заметку по настройки OPNsense на использование этого протокола.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Включение DNS over TLS (DoT) в OPNsense" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2022/08/badb30a9-0471-5dab-a422-85422c0ac611/ data-bs-toggle=modal data-bs-target=#modal-d332564edf73aaa0a2e5866941e0ea60><img class=img-fluid src="https://images.unsplash.com/photo-1521106047354-5a5b85e819ee?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Включение DNS over TLS (DoT) в OPNsense" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2022/08/badb30a9-0471-5dab-a422-85422c0ac611/ data-bs-toggle=modal data-bs-target=#modal-d332564edf73aaa0a2e5866941e0ea60>Включение DNS over TLS (DoT) в OPNsense</a></h2></div></header><div class=node-body><p>Почитав несколько статей на тему DoT, я решил написать небольшую заметку по настройки OPNsense на использование этого протокола.</p></div></div></article></div><div class="modal fade" id=modal-d332564edf73aaa0a2e5866941e0ea60 tabindex=-1 aria-labelledby=modal-d332564edf73aaa0a2e5866941e0ea60-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-d332564edf73aaa0a2e5866941e0ea60-label><a href=/ru/articles/2022/08/badb30a9-0471-5dab-a422-85422c0ac611/>Включение DNS over TLS (DoT) в OPNsense</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Почитав несколько статей на тему DoT, я решил написать небольшую заметку по настройки OPNsense на использование этого протокола.</p><p><strong>DNS поверх TLS</strong> или <strong>DoT</strong> это протокол, при помощи которого происходит шифрование запросов и ответов к DNS через TLS. Таким образом, повышается конфиденциальность и безопасность пользователей в интернете.</p><p>Не все публичные сервера поддерживают DoT. Список наиболее предпочтительных, по моему мнению, я приведу в таблице в конце статьи. А теперь, по пунктам, я расскажу как правильно настроить OPNsense, чтобы она задействовала протокол DoT в своей работе. Для этого нужно выполнить всего несколько шагов&mldr;</p><h2 id=1008541308-настройка-opnsense><a class=link-body-emphasis href=#1008541308-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-opnsense>Настройка OPNsense</a></h2><ul><li>System / Settings / General<ul><li>Отключить параметр <strong>Do not use the local DNS service as a nameserver for this system</strong>.</li></ul></li><li>Services / DHCPv4 / [LAN]<ul><li>Удалить все записи о DNS, если они имеются.</li></ul></li><li>Services / Unbound DNS / General<ul><li>Включить сервис, поставив галочку напротив <strong>Enable</strong>.</li><li>Выбрать в параметре <strong>Network Interfaces</strong> пункт локальной сети, в данном случае, <em>LAN</em>.</li><li>Включить <strong>DNSSEC</strong>, поставив галочку напротив парамера <strong>Enable DNSSEC Support</strong>.</li><li>Остальные параметры можно выключить.</li></ul></li><li>Services / Unbound DNS / DNS over TLS<ul><li>Добавить публичные сервера DNS из списка ниже.</li></ul></li></ul><h2 id=1008541308-публичные-сервера-dns><a class=link-body-emphasis href=#1008541308-%d0%bf%d1%83%d0%b1%d0%bb%d0%b8%d1%87%d0%bd%d1%8b%d0%b5-%d1%81%d0%b5%d1%80%d0%b2%d0%b5%d1%80%d0%b0-dns>Публичные сервера DNS</a></h2><p>Ниже я привожу список публичных серверов DNS, которые поддерживают функцию DNS over TLS (DoT).</p><h3 id=1008541308-cloudflare><a class=link-body-emphasis href=#1008541308-cloudflare>Cloudflare</a></h3><table class='table table-striped table-bordered table-responsive w-50'><thead><tr><th>Server IP</th><th>Server Port</th><th>Verify CN</th></tr></thead><tbody><tr><td>1.1.1.1</td><td>853</td><td>cloudflare-dns.com</td></tr><tr><td>1.0.0.1</td><td>853</td><td>cloudflare-dns.com</td></tr><tr><td>2606:4700:4700::1111</td><td>853</td><td>cloudflare-dns.com</td></tr><tr><td>2606:4700:4700::1001</td><td>853</td><td>cloudflare-dns.com</td></tr></tbody></table><h3 id=1008541308-google><a class=link-body-emphasis href=#1008541308-google>Google</a></h3><table class='table table-striped table-bordered table-responsive w-50'><thead><tr><th>Server IP</th><th>Server Port</th><th>Verify CN</th></tr></thead><tbody><tr><td>8.8.8.8</td><td>853</td><td>dns.google</td></tr><tr><td>8.8.4.4</td><td>853</td><td>dns.google</td></tr><tr><td>2001:4860:4860::8888</td><td>853</td><td>dns.google</td></tr><tr><td>2001:4860:4860::8844</td><td>853</td><td>dns.google</td></tr></tbody></table><h3 id=1008541308-quad9><a class=link-body-emphasis href=#1008541308-quad9>Quad9</a></h3><table class='table table-striped table-bordered table-responsive w-50'><thead><tr><th>Server IP</th><th>Server Port</th><th>Verify CN</th></tr></thead><tbody><tr><td>9.9.9.9</td><td>853</td><td>dns.quad9.net</td></tr><tr><td>149.112.112.112</td><td>853</td><td>dns.quad9.net</td></tr><tr><td>2620:fe::fe</td><td>853</td><td>dns.quad9.net</td></tr><tr><td>2620:fe::9</td><td>853</td><td>dns.quad9.net</td></tr></tbody></table><h3 id=1008541308-cisco-umbrella><a class=link-body-emphasis href=#1008541308-cisco-umbrella>Cisco Umbrella</a></h3><table class='table table-striped table-bordered table-responsive w-50'><thead><tr><th>Server IP</th><th>Server Port</th><th>Verify CN</th></tr></thead><tbody><tr><td>208.67.222.222</td><td>853</td><td>dns.opendns.com</td></tr><tr><td>208.67.220.220</td><td>853</td><td>dns.opendns.com</td></tr><tr><td>2620:119:35::35</td><td>853</td><td>dns.opendns.com</td></tr><tr><td>2620:119:53::53</td><td>853</td><td>dns.opendns.com</td></tr></tbody></table><h3 id=1008541308-cleanbrowsing><a class=link-body-emphasis href=#1008541308-cleanbrowsing>CleanBrowsing</a></h3><table class='table table-striped table-bordered table-responsive w-50'><thead><tr><th>Server IP</th><th>Server Port</th><th>Verify CN</th></tr></thead><tbody><tr><td>185.228.168.9</td><td>853</td><td>security-filter-dns.cleanbrowsing.org</td></tr><tr><td>185.228.169.9</td><td>853</td><td>security-filter-dns.cleanbrowsing.org</td></tr><tr><td>2a0d:2a00:1::2</td><td>853</td><td>security-filter-dns.cleanbrowsing.org</td></tr><tr><td>2a0d:2a00:2::2</td><td>853</td><td>security-filter-dns.cleanbrowsing.org</td></tr></tbody></table><h3 id=1008541308-adguard-dns><a class=link-body-emphasis href=#1008541308-adguard-dns>AdGuard DNS</a></h3><table class='table table-striped table-bordered table-responsive w-50'><thead><tr><th>Server IP</th><th>Server Port</th><th>Verify CN</th></tr></thead><tbody><tr><td>94.140.14.14</td><td>853</td><td>dns.adguard-dns.com</td></tr><tr><td>94.140.15.15</td><td>853</td><td>dns.adguard-dns.com</td></tr><tr><td>2a10:50c0::ad1:ff</td><td>853</td><td>dns.adguard-dns.com</td></tr><tr><td>2a10:50c0::ad2:ff</td><td>853</td><td>dns.adguard-dns.com</td></tr></tbody></table></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/dns/>#dns</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/opnsense/>#opnsense</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/dot/>#dot</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2022-08-14T18:16:34Z data-fn=date-local>2022/08/14 18:16:34 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Настройка статического IP адреса" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1><picture><source srcset='https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Настройка статического IP адреса" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1>Настройка статического IP адреса</a></h2></div></header><div class=node-body><p>Рассмотрим различные способы настройки статического IP адреса в дистрибутивах Linux. Способы различаются в зависимости от пакетной базы дистрибутивов. Например, настройка статического IP в …</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Настройка статического IP адреса" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1><img class=img-fluid src="https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Настройка статического IP адреса" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1>Настройка статического IP адреса</a></h2></div></header><div class=node-body><p>Рассмотрим различные способы настройки статического IP адреса в дистрибутивах Linux. Способы различаются в зависимости от пакетной базы дистрибутивов. Например, настройка статического IP в …</p></div></div></article></div><div class="modal fade" id=modal-3bbda3955098d2ca8c2a925f4969e8f1 tabindex=-1 aria-labelledby=modal-3bbda3955098d2ca8c2a925f4969e8f1-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-3bbda3955098d2ca8c2a925f4969e8f1-label><a href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/>Настройка статического IP адреса</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Рассмотрим различные способы настройки статического IP адреса в дистрибутивах Linux. Способы различаются в зависимости от пакетной базы дистрибутивов. Например, настройка статического IP в RHEL-based дистрибутиве будет отличаться от настройки в DEB-based дистрибутиве.</p><h2 id=3395534025-подготовка><a class=link-body-emphasis href=#3395534025-%d0%bf%d0%be%d0%b4%d0%b3%d0%be%d1%82%d0%be%d0%b2%d0%ba%d0%b0>Подготовка</a></h2><p>Смотрим текущие сетевые устройства и соединения:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-398163f5ceecbc17d37076499e63eedf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-398163f5ceecbc17d37076499e63eedf><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1: lo: &lt;loopback,up,lower_up&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>  inet 127.0.0.1/8 scope host lo
</span></span><span class=line><span class=cl>2: enp1s0: &lt;broadcast,multicast,up,lower_up&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>  link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>  inet 192.168.10.123/24 brd 192.168.10.255 scope global dynamic noprefixroute enp1s0</span></span></code></pre></div></div></div></div><h2 id=3395534025-настройка-ip-в-rhel-based-дистрибутивах><a class=link-body-emphasis href=#3395534025-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-ip-%d0%b2-rhel-based-%d0%b4%d0%b8%d1%81%d1%82%d1%80%d0%b8%d0%b1%d1%83%d1%82%d0%b8%d0%b2%d0%b0%d1%85>Настройка IP в RHEL-based дистрибутивах</a></h2><p>В директории <code>/etc/sysconfig/network-scripts</code> находятся конфигурационные файлы для сетевых интерфейсов. Имя файла состоит из префикса <code>ifcfg</code> и имени интерфейса. Например, содержимое файла для интерфейса <code>enp1s0</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9d3d31310e5dd7e0940a3f5e15c0dd12 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-9d3d31310e5dd7e0940a3f5e15c0dd12><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/sysconfig/network-scripts/ifcfg-enp1s0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;Ethernet&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PROXY_METHOD</span><span class=o>=</span><span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BROWSER_ONLY</span><span class=o>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BOOTPROTO</span><span class=o>=</span><span class=s2>&#34;dhcp&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEFROUTE</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV4_FAILURE_FATAL</span><span class=o>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6INIT</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_AUTOCONF</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_DEFROUTE</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_FAILURE_FATAL</span><span class=o>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_ADDR_GEN_MODE</span><span class=o>=</span><span class=s2>&#34;stable-privacy&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>NAME</span><span class=o>=</span><span class=s2>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;&lt;DEVICE_ID&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEVICE</span><span class=o>=</span><span class=s2>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ONBOOT</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span></span></span></code></pre></div></div></div></div><p>Обратим внимание на опцию <strong>BOOTPROTO</strong>. По умолчанию, в опции <strong>BOOTPROTO</strong> прописано <code>dhcp</code>. Это означает, что сетевой интерфейс получает информацию о сети автоматически от DHCP. Сама опция <strong>BOOTPROTO</strong> может принимать следующие значения:</p><ul><li><code>none</code> – не использовать протокол.</li><li><code>bootp</code> – использование протокола <strong>bootp</strong>.</li><li><code>dhcp</code> – использование протокола <strong>dhcp</strong> (по умолчанию).</li></ul><p>Для настройки статического IP необходимо установит <strong>BOOTPROTO</strong> в <code>none</code> и дописать в конец файла опции:</p><ul><li><code>IPADDR</code> - IP адрес.</li><li><code>PREFIX</code> - маска сети.</li><li><code>GATEWAY</code> - шлюз сети.</li><li><code>DNS</code> - серверы DNS.</li></ul><p>Например:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-ini"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ddf06b77acf555ae60530af1f533be7d><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>TYPE</span><span class=o>=</span><span class=s>&#34;Ethernet&#34;</span>
</span></span><span class=line><span class=cl><span class=na>PROXY_METHOD</span><span class=o>=</span><span class=s>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=na>BROWSER_ONLY</span><span class=o>=</span><span class=s>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=na>BOOTPROTO</span><span class=o>=</span><span class=s>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DEFROUTE</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV4_FAILURE_FATAL</span><span class=o>=</span><span class=s>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6INIT</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_AUTOCONF</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_DEFROUTE</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_FAILURE_FATAL</span><span class=o>=</span><span class=s>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_ADDR_GEN_MODE</span><span class=o>=</span><span class=s>&#34;stable-privacy&#34;</span>
</span></span><span class=line><span class=cl><span class=na>NAME</span><span class=o>=</span><span class=s>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=na>UUID</span><span class=o>=</span><span class=s>&#34;&lt;DEVICE_ID&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DEVICE</span><span class=o>=</span><span class=s>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=na>ONBOOT</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPADDR</span><span class=o>=</span><span class=s>&#34;192.168.10.55&#34;</span>
</span></span><span class=line><span class=cl><span class=na>PREFIX</span><span class=o>=</span><span class=s>&#34;24&#34;</span>
</span></span><span class=line><span class=cl><span class=na>GATEWAY</span><span class=o>=</span><span class=s>&#34;192.168.10.1&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DNS1</span><span class=o>=</span><span class=s>&#34;192.168.11.1&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DNS1</span><span class=o>=</span><span class=s>&#34;192.168.12.1&#34;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ddf06b77acf555ae60530af1f533be7d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>После указания всех параметров, необходимо перезапустить интерфейс:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8d6d3f84f3dc1c43fb305c9b86eecee2 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-8d6d3f84f3dc1c43fb305c9b86eecee2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con down enp1s0 <span class=o>&amp;&amp;</span> nmcli con up enp1s0</span></span></code></pre></div></div></div></div><h2 id=3395534025-настройка-ip-при-помощи-network-manager-cli-nmcli><a class=link-body-emphasis href=#3395534025-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-ip-%d0%bf%d1%80%d0%b8-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d0%b8-network-manager-cli-nmcli>Настройка IP при помощи Network Manager CLI (nmcli)</a></h2><p>Установка IP адреса:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e8b0765e2dce1c81003cd36464f707ba role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-e8b0765e2dce1c81003cd36464f707ba><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.addresses <span class=s1>&#39;192.168.10.55/24&#39;</span></span></span></code></pre></div></div></div></div><p>Установка шлюза:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-485114c917d63e8b951586caa6a33569 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-485114c917d63e8b951586caa6a33569><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.gateway <span class=s1>&#39;192.168.10.1&#39;</span></span></span></code></pre></div></div></div></div><p>Установка DNS:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f874efec1c6875d98777d40f0f2f37ce role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-f874efec1c6875d98777d40f0f2f37ce><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.dns <span class=s1>&#39;192.168.11.1&#39;</span></span></span></code></pre></div></div></div></div><p>Установка <strong>BOOTPROTO</strong> в <code>none</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-64e3cb1d81f5cceeb4460aa4eee7a3ef role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-64e3cb1d81f5cceeb4460aa4eee7a3ef><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.method <span class=s1>&#39;manual&#39;</span></span></span></code></pre></div></div></div></div><p>Перезапуск интерфейса:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-8 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-16e0e2402b7c8cf80066e5b856c84421 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-16e0e2402b7c8cf80066e5b856c84421><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con down enp1s0 <span class=o>&amp;&amp;</span> nmcli con up enp1s0</span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/ip/>#ip</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-05-15T17:08:30Z data-fn=date-local>2021/05/15 17:08:30 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="MikroTik и CloudFlare: Динамический IP для домена" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/ data-bs-toggle=modal data-bs-target=#modal-418a73a9f8f7ce239bf092d8d5cd3fe6><picture><source srcset='https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="MikroTik и CloudFlare: Динамический IP для домена" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/ data-bs-toggle=modal data-bs-target=#modal-418a73a9f8f7ce239bf092d8d5cd3fe6>MikroTik и CloudFlare: Динамический IP для домена</a></h2></div></header><div class=node-body><p>Нашёл скрипт реализации динамической смены IP адреса из RouterOS напрямую в панели управления CloudFlare при помощи API. Где нашёл скрипт уже не помню, вроде бы на страницах официального форума …</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="MikroTik и CloudFlare: Динамический IP для домена" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/ data-bs-toggle=modal data-bs-target=#modal-418a73a9f8f7ce239bf092d8d5cd3fe6><img class=img-fluid src="https://images.unsplash.com/photo-1521542464131-cb30f7398bc6?crop=bottom&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="MikroTik и CloudFlare: Динамический IP для домена" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/ data-bs-toggle=modal data-bs-target=#modal-418a73a9f8f7ce239bf092d8d5cd3fe6>MikroTik и CloudFlare: Динамический IP для домена</a></h2></div></header><div class=node-body><p>Нашёл скрипт реализации динамической смены IP адреса из RouterOS напрямую в панели управления CloudFlare при помощи API. Где нашёл скрипт уже не помню, вроде бы на страницах официального форума …</p></div></div></article></div><div class="modal fade" id=modal-418a73a9f8f7ce239bf092d8d5cd3fe6 tabindex=-1 aria-labelledby=modal-418a73a9f8f7ce239bf092d8d5cd3fe6-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-418a73a9f8f7ce239bf092d8d5cd3fe6-label><a href=/ru/articles/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/>MikroTik и CloudFlare: Динамический IP для домена</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Нашёл скрипт реализации динамической смены IP адреса из RouterOS напрямую в панели управления CloudFlare при помощи API. Где нашёл скрипт уже не помню, вроде бы на страницах официального форума MikroTik.</p><p>Скрипт я немного переделал, удалил лишние переменные, некоторые переопределил, подправил области видимости переменных, обновил метод авторизации скрипта на серверах CloudFlare. Вроде работает.</p><p>Сам скрипт нужно настроить под себя, прописав в нём значения переменных. Некоторые значений можно узнать из панели управления доменом в CloudFlare, но для получения значения переменной <code>cfDnsID</code> необходимо выполнит немного телодвижений. Об этом ниже.</p><h2 id=916590014-работа-cloudflare-api><a class=link-body-emphasis href=#916590014-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%b0-cloudflare-api>Работа CloudFlare API</a></h2><p>Без токена - никак.</p><h3 id=916590014-создание-токена><a class=link-body-emphasis href=#916590014-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d0%b5-%d1%82%d0%be%d0%ba%d0%b5%d0%bd%d0%b0>Создание токена</a></h3><p>Для того, чтобы начать работать с CloudFlare API, нам нужно создать специальный токен:</p><ol><li>Зайти в <a title href=https://dash.cloudflare.com/profile/api-tokens target=_blank rel="noopener noreferrer nofollow">панель управления токенами</a>.</li><li>Нажать кнопку <span class="shortcode shortcode-key d-inline-block"><kbd>Create Token</kbd></span>.</li><li>На странице выбора шаблонов - выбрать шаблон <strong>Edit zone DNS</strong>.</li><li>В разделе <strong>Zone Resources</strong> можно выбрать область доступа токена к зонам (доменам). Можно указать конкретную зону (<em>Specific zone</em>) или выбрать все зоны (<em>All zones</em>).</li><li>Всё, нажимаем кнопку <span class="shortcode shortcode-key d-inline-block"><kbd>Continue to summary</kbd></span> и перемещаемся на следующую станицу&mldr;</li></ol><h3 id=916590014-проверка-токена><a class=link-body-emphasis href=#916590014-%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d0%ba%d0%b0-%d1%82%d0%be%d0%ba%d0%b5%d0%bd%d0%b0>Проверка токена</a></h3><p>По окончании создания токена, CloudFlare переместит нас на страницу проверки токена. На этой странице будут наш созданный токен (его необходимо сохранить) и команда, которой при помощи утилиты <code>curl</code> можно проверить корректность токена:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-b468ea089cdfd1084655ea028dfc782f><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X GET <span class=s2>&#34;https://api.cloudflare.com/client/v4/user/tokens/verify&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-H <span class=s2>&#34;Authorization: Bearer TOKEN&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-H <span class=s2>&#34;Content-Type:application/json&#34;</span> <span class=p>|</span> python3 -mjson.tool</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b468ea089cdfd1084655ea028dfc782f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>При выполнении, команда вернёт следующий результат:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8460b5a3086ef3856a6778d8627a9ef3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-8460b5a3086ef3856a6778d8627a9ef3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X GET <span class=s2>&#34;https://api.cloudflare.com/client/v4/user/tokens/verify&#34;</span> -H <span class=s2>&#34;Authorization: Bearer &lt;...&gt;&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=p>|</span> python3 -mjson.tool
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;id&#34;</span>: <span class=s2>&#34;&lt;...&gt;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;status&#34;</span>: <span class=s2>&#34;active&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;success&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;errors&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;messages&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;code&#34;</span>: 10000,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;This API Token is valid and active&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span>: null
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div></div><p>По сообщению &ldquo;This API Token is valid and active&rdquo; понятно, что токен корректный и работает.</p><h3 id=916590014-получение-id-ресурсной-записи-домена><a class=link-body-emphasis href=#916590014-%d0%bf%d0%be%d0%bb%d1%83%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-id-%d1%80%d0%b5%d1%81%d1%83%d1%80%d1%81%d0%bd%d0%be%d0%b9-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d0%b8-%d0%b4%d0%be%d0%bc%d0%b5%d0%bd%d0%b0>Получение ID ресурсной записи домена</a></h3><p>Когда у нас есть токен, можно полноценно работать с CloudFlare API. Нам нужно получить ID ресурсной записи домена. Получать будем следующей командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-caeaecc8307392de8555d4721dc6bf61><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X GET <span class=s2>&#34;https://api.cloudflare.com/client/v4/zones/ZONE_ID/dns_records&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-H <span class=s2>&#34;Authorization: Bearer TOKEN&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=p>|</span> python3 -mjson.tool</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-caeaecc8307392de8555d4721dc6bf61 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Обратите внимание на следующие заглушки в команде:</p><ul><li><code>ZONE_ID</code> - ID домена. Находится в панели оправления доменом на главной странице в поле <strong>Zone ID</strong>.</li><li><code>TOKEN</code> - токен для доступа к CloudFlare API.</li></ul><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Вместо этих заглушек необходимо подставить свои значения.</p></div></div></div><p>Сформировав правильную команду с корректными данными и выполнив её, команда вернёт результат в формате <strong>JSON</strong>. Результат будет содержать набор всех ресурсных записей конкретного домена. У меня это выглядит так:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cfc696cd2fd813e7460cd52c77c8d676 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-cfc696cd2fd813e7460cd52c77c8d676><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -X GET <span class=s2>&#34;https://api.cloudflare.com/client/v4/zones/&lt;...&gt;/dns_records&#34;</span> -H <span class=s2>&#34;Authorization: Bearer &lt;...&gt;&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=p>|</span> python3 -mjson.tool
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id&#34;</span>: <span class=s2>&#34;gJDSG5la4IWNOEVn6K2PHyope8Q9YhzC&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;zone_id&#34;</span>: <span class=s2>&#34;&lt;...&gt;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;zone_name&#34;</span>: <span class=s2>&#34;example.com&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;example.com&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;A&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span>: <span class=s2>&#34;192.168.10.232&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;proxiable&#34;</span>: true,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;proxied&#34;</span>: true,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ttl&#34;</span>: 1,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;locked&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;meta&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;auto_added&#34;</span>: false,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;managed_by_apps&#34;</span>: false,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;managed_by_argo_tunnel&#34;</span>: false,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;source&#34;</span>: <span class=s2>&#34;primary&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;created_on&#34;</span>: <span class=s2>&#34;2020-02-23T21:26:27.56227Z&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;modified_on&#34;</span>: <span class=s2>&#34;2020-02-23T21:26:27.56227Z&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;success&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;errors&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;messages&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result_info&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;page&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;per_page&#34;</span>: 20,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;count&#34;</span>: 7,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total_count&#34;</span>: 7,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total_pages&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div></div><p>Как видим, команда вернула нам результат с массивом <code>result</code>. В этом массиве находятся все ресурсные записи нашего домена. Каждая ресурсная запись содержит поля <code>id</code> и <code>content</code>:</p><ul><li><code>id</code> - ID ресурсной записи. Очень важное поле, как раз его значение необходимо записать в переменную <code>cfDnsID</code> скрипта.</li><li><code>content</code> - содержимое ресурсной записи.</li></ul><p>Нам необходимы только записи с типом <code>A</code>. Обычно в записях с типом <code>A</code> хранятся IP адреса серверов, к которым привязан домен. У записей с типом <code>A</code> в поле <code>content</code> находится IP адрес, который должен изменить наш MikroTik при обращении к CloudFlare API.</p><h2 id=916590014-скрипт><a class=link-body-emphasis href=#916590014-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>cf.ddns.rsc</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9093f37c4acf647c4b1d008b0d6d51f6 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=cf.ddns.rsc download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=cf.ddns.rsc target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-9093f37c4acf647c4b1d008b0d6d51f6><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Mikrotik RouterOS script for CloudFlare DDNS</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># @package    RouterOS</span>
</span></span><span class=line><span class=cl><span class=c1># @author     Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># @copyright  2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=c1># @license    MIT</span>
</span></span><span class=line><span class=cl><span class=c1># @version    0.0.1</span>
</span></span><span class=line><span class=cl><span class=c1># @link       https://lib.onl</span>
</span></span><span class=line><span class=cl><span class=c1># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RouterOS: WAN interface name.</span>
</span></span><span class=line><span class=cl>:local rosWanInterface <span class=s2>&#34;ether1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RouterOS: Enables trust chain validation from local certificate store.</span>
</span></span><span class=line><span class=cl><span class=c1># &#39;no&#39;  | Disable certificate check.</span>
</span></span><span class=line><span class=cl><span class=c1># &#39;yes&#39; | Enable certificate check.</span>
</span></span><span class=line><span class=cl>:local rosCheckCert <span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CloudFlare: API token.</span>
</span></span><span class=line><span class=cl>:local cfToken <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CloudFlare: Domain.</span>
</span></span><span class=line><span class=cl>:local cfDomain <span class=s2>&#34;example.com&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CloudFlare: Zone ID.</span>
</span></span><span class=line><span class=cl>:local cfZoneID <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CloudFlare: DNS ID.</span>
</span></span><span class=line><span class=cl>:local cfDnsID <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CloudFlare: Domain record type.</span>
</span></span><span class=line><span class=cl>:local cfRecordType <span class=s2>&#34;A&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CloudFlare: Debug mode.</span>
</span></span><span class=line><span class=cl><span class=c1># 0 | Disable debug mode.</span>
</span></span><span class=line><span class=cl><span class=c1># 1 | Enable debug mode.</span>
</span></span><span class=line><span class=cl>:local cfDebug <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c1># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c1># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IP on WAN interface.</span>
</span></span><span class=line><span class=cl>:local srcIP <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IP on CloudFlare domain.</span>
</span></span><span class=line><span class=cl>:local dstIP <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get RouterOS WAN IP.</span>
</span></span><span class=line><span class=cl>:set srcIP <span class=o>[</span>/ip address get <span class=o>[</span>/ip address find <span class=nv>interface</span><span class=o>=</span><span class=nv>$rosWanInterface</span> <span class=o>]</span> address<span class=o>]</span>
</span></span><span class=line><span class=cl>:set srcIP <span class=o>[</span>:pick <span class=nv>$srcIP</span> <span class=m>0</span> <span class=o>[</span>:find <span class=nv>$srcIP</span> <span class=s2>&#34;/&#34;</span><span class=o>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get CloudFlare domain IP.</span>
</span></span><span class=line><span class=cl>:set dstIP <span class=o>[</span>:resolve <span class=nv>$cfDomain</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Build CloudFlare API (v4).</span>
</span></span><span class=line><span class=cl>:local cfAPI <span class=s2>&#34;https://api.cloudflare.com/client/v4/zones/&#34;</span>
</span></span><span class=line><span class=cl>:set cfAPI <span class=o>(</span><span class=nv>$cfAPI</span> . <span class=s2>&#34;</span><span class=nv>$cfZoneID</span><span class=s2>/dns_records/</span><span class=nv>$cfDnsID</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>:local cfAPIHeader <span class=s2>&#34;Authorization: Bearer </span><span class=nv>$cfToken</span><span class=s2>, Content-Type: application/json&#34;</span>
</span></span><span class=line><span class=cl>:local cfAPIData <span class=s2>&#34;{\&#34;type\&#34;:\&#34;</span><span class=nv>$cfRecordType</span><span class=s2>\&#34;,\&#34;name\&#34;:\&#34;</span><span class=nv>$cfDomain</span><span class=s2>\&#34;,\&#34;content\&#34;:\&#34;</span><span class=nv>$srcIP</span><span class=s2>\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Write debug info to log.</span>
</span></span><span class=line><span class=cl>:if <span class=o>(</span><span class=nv>$cfDebug</span><span class=o>)</span> <span class=k>do</span><span class=o>={</span>
</span></span><span class=line><span class=cl>  :log info <span class=o>(</span><span class=s2>&#34;CloudFlare: Domain = </span><span class=nv>$cfDomain</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  :log info <span class=o>(</span><span class=s2>&#34;CloudFlare: Domain IP (dstIP) = </span><span class=nv>$dstIP</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  :log info <span class=o>(</span><span class=s2>&#34;CloudFlare: WAN IP (srcIP) = </span><span class=nv>$srcIP</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  :log info <span class=o>(</span><span class=s2>&#34;CloudFlare: CloudFlare API (cfAPI) = </span><span class=nv>$cfAPI</span><span class=s2>&amp;content=</span><span class=nv>$srcIP</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Compare and update CF if necessary.</span>
</span></span><span class=line><span class=cl>:if <span class=o>(</span><span class=nv>$dstIP</span> !<span class=o>=</span> <span class=nv>$srcIP</span><span class=o>)</span> <span class=k>do</span><span class=o>={</span>
</span></span><span class=line><span class=cl>  :log info <span class=o>(</span><span class=s2>&#34;CloudFlare: Updating </span><span class=nv>$cfDomain</span><span class=s2>, setting </span><span class=nv>$srcIP</span><span class=s2> = </span><span class=nv>$cfDomain</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  /tool fetch <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nv>mode</span><span class=o>=</span>https <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http-method<span class=o>=</span>put <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http-header-field<span class=o>=</span><span class=s2>&#34;</span><span class=nv>$cfAPIHeader</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http-data<span class=o>=</span><span class=s2>&#34;</span><span class=nv>$cfAPIData</span><span class=s2>&#34;</span> <span class=nv>url</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$cfAPI</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    check-certificate<span class=o>=</span><span class=nv>$rosCheckCert</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nv>output</span><span class=o>=</span>user as-value
</span></span><span class=line><span class=cl>  /ip dns cache flush
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span><span class=o>={</span>
</span></span><span class=line><span class=cl>  :log info <span class=s2>&#34;CloudFlare: No Update Needed!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div></div><h3 id=916590014-настройка><a class=link-body-emphasis href=#916590014-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0>Настройка</a></h3><p>Алгоритм настройки довольно прост:</p><ol><li>Получаем токен для работы с CloudFlare API.</li><li>При помощи специальной команды узнаём значение поля <code>id</code> ресурсной записи с типом <code>A</code>.</li><li>Это значение вписываем в переменную <code>cfDnsID</code> скрипта.</li><li>Остальные требуемые значения для переменных уже доступны без каких-либо телодвижений.</li></ol><h3 id=916590014-переменные><a class=link-body-emphasis href=#916590014-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5>Переменные</a></h3><p>Опишу переменные и что они из себя представляют:</p><ul><li><code>rosWanInterface</code> - имя интерфейса <strong>WAN</strong> в RouterOS.</li><li><code>rosCheckCert</code> - включение / отключение проверки цепочки сертификации при запросе к CloudFlare API. Для корректной работы этой функции необходимо, чтобы в репозитории сертификатов RouterOS присутствовали корневые сертификаты центров сертификации. Про импортирование сертификатов написано в заметке <span class="shortcode shortcode-uuid"><a href=/ru/articles/2023/10/cc13623b-970c-5950-867e-168f9ba9025a/>Добавление корневых сертификатов в RouterOS</a></span>.</li><li><code>cfToken</code> - токен, полученный в <a title href=https://dash.cloudflare.com/profile/api-tokens target=_blank rel="noopener noreferrer nofollow">панели управления токенами</a>.</li><li><code>cfDomain</code> - название домена, для которого необходимо динамически менять IP адрес.</li><li><code>cfZoneID</code> - ID домена. Находится в панели управления доменом на главной странице в поле <strong>Zone ID</strong>.</li><li><code>cfDnsID</code> - ID ресурсной записи домена. Для получения значения переменной, необходимо выполнить запрос к CloudFlare API.</li><li><code>cfRecordType</code> - тип ресурсной записи домена. Обычно это <code>A</code>. Менять нет необходимости.</li><li><code>cfDebug</code> - включение / отключение отображения технической информации в логе RouterOS.</li></ul><p>Рекомендую настраивать скрипт в редакторе с подсветкой синтаксиса, чтобы не ошибиться и не задеть какую-либо кавычку.</p><h3 id=916590014-установка><a class=link-body-emphasis href=#916590014-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b0>Установка</a></h3><p>После настройки скрипта, его нужно добавить в репозиторий скриптов RouterOS. Находится репозиторий в <strong>System / Scripts</strong>. При добавлении скрипта, необходимо выбрать политики <code>read</code>, <code>write</code>, <code>test</code>, <code>policy</code>.</p><h3 id=916590014-планировщик><a class=link-body-emphasis href=#916590014-%d0%bf%d0%bb%d0%b0%d0%bd%d0%b8%d1%80%d0%be%d0%b2%d1%89%d0%b8%d0%ba>Планировщик</a></h3><p>Скрипт должен переодически запускаться для проверки и синхронизации IP адресов сервера и домена. В этом поможет планировщик RouterOS. Заходим в <strong>System / Scheduler</strong> и создаём задачу с политиками <code>read</code>, <code>write</code>, <code>test</code>, <code>policy</code>. В поле <strong>On Event</strong> вписываем точное название скрипта, ранее добавленного в репозиторий RouterOS.</p><h3 id=916590014-проверка><a class=link-body-emphasis href=#916590014-%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d0%ba%d0%b0>Проверка</a></h3><p>Проверить работу скрипта можно в репозитории по адресу <strong>System / Scripts</strong>. Выделив скрипт и нажав на кнопку <span class="shortcode shortcode-key d-inline-block"><kbd>Run</kbd></span>, смотрим изменился ли IP адрес у домена в панели управления CloudFlare.</p></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/router/>#router</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/mikrotik/>#mikrotik</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/routeros/>#routeros</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/cloudflare/>#cloudflare</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2020-07-12T15:09:48Z data-fn=date-local>2020/07/12 15:09:48 UTC</time></li></ul></div></div></div></div></div></div></div></div></main><footer class="mt-auto border-top bg-light" id=site-footer><div class="section py-5 border-bottom"><div class=container><div class="row g-3"><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">О проекте</h2><div class=node-body><p>Заметки по системному администрированию и веб-разработкам.</p></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Ресурсы</h2><div class=node-body><ul><li><a title href=https://kitsune.solar/ target=_blank rel="noopener noreferrer nofollow">Kitsune Solar</a></li><li><a title href=https://uaik.github.io/ target=_blank rel="noopener noreferrer nofollow">UNIX AIK</a></li></ul></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Контакты</h2><div class=node-body><ul><li><a title href=mailto:mail@lib.onl target=_self rel>Email</a></li></ul></div></article></div></div></div></div><div class="section py-3"><div class=container><div class="row row-cols-1 row-cols-lg-2 small text-body-secondary align-items-center"><div class="col text-center text-lg-start"><ul class="list-inline mb-0"><li class=list-inline-item><div>Library Online &copy; 2023</div><div>Заметки на тему администрирования и разработки различных систем, приложений и серверов.</div></li></ul></div><div class="col text-center text-lg-end"><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=RSS><a class="btn btn-light btn-sm" href=/ru/categories/network/index.xml target=_blank aria-label=RSS><i class="fas fa-rss fa-fw"></i></a></li><li class="list-inline-item dropup" data-bs-tooltip data-bs-title=Языки><a class="dropdown-toggle btn btn-light btn-sm" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false aria-label=Языки><i class="fas fa-language fa-fw"></i></a><div class="dropdown-menu dropdown-menu-end shadow"><a class=dropdown-item href=/ru/ hreflang=ru>Русский
</a><a class=dropdown-item href=/en/ hreflang=en>English</a></div></li></ul></div></div></div></div></footer><div class="modal fade" id=search-modal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-xl"><div class=modal-content><div class=modal-header><h5 class=modal-title id=searchModalLabel>Поиск</h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class="modal-body node-body"><div class="row row-cols-1 g-3"><div class=col><div class="row g-3"><div class=col-lg><form action=https://google.com/search method=get class=d-flex target=_blank><input type=hidden name=domains value=lib.onl>
<input type=hidden name=sitesearch value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=q placeholder='Поиск Google' aria-label='Поиск Google'>
<span class=input-group-text><i class="fab fa-google fa-fw"></i></span></div></form></div><div class=col-lg><form action=https://ya.ru/search method=get class=d-flex target=_blank><input type=hidden name=site value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=text placeholder='Поиск Яндекс' aria-label='Поиск Яндекс'>
<span class=input-group-text><i class="fab fa-yandex fa-fw"></i></span></div></form></div></div></div><div class=col><form id=search-form method=get class=d-flex autocomplete=off><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input id=search-input type=search class=form-control name=q placeholder='Внутренний поиск' aria-label='Внутренний поиск'>
<span class=input-group-text><i class="fas fa-brain fa-fw"></i></span></div></form></div><div class=col><div class="list-group list-group-flush d-none overflow-auto" id=search-results></div><div id=search-help><div class="alert alert-info d-flex align-items-center overflow-hidden node-body" id=alert-2cb6923cd7c026c8d218fcfd83af69f7 role=alert><div class=flex-shrink-0><i class="fas fa-search fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Используется нечёткий поиск (приблизительное сопоставление строк).
Это метод поиска строк, которые приблизительно соответствуют поисковому шаблону.</p><p>Результаты поиска сортируются по точности совпадения с поисковым шаблоном.
Результаты поиска, наиболее точно соответствующие запросу, находятся сверху, приблизительные результаты - снизу.</p></div></div></div></div></div></div></div></div></div><script src=/js/vendor.bundle.min.js defer></script><script src=/ru/js/system.bundle.min.js defer></script><script type=application/ld+json>{"@context":"https://schema.org","@id":"https://lib.onl/#website","@type":"WebSite","description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","hasPart":[{"@context":"https://schema.org","@type":"WPHeader","cssSelector":"#site-header","headline":"headline-string"},{"@context":"https://schema.org","@type":"WPFooter","copyrightHolder":"https://lib.onl/#organization","copyrightYear":"2023","cssSelector":"#site-footer","publisher":"https://lib.onl/#organization"}],"inLanguage":[{"@type":"Language","alternateName":"ru-RU","name":"Русский"}],"keywords":["powershell","forum","ipb","ips","debian","linux","cmd","cmf","cms","vbulletin","bash","cloudflare","fedora","git","php","systemd","terminal","dhcp","find","gdm"],"mainEntityOfPage":"https://lib.onl/","name":"Library Online","publisher":"https://lib.onl/#organization","url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@id":"https://lib.onl/#organization","@type":"Organization","address":{"@type":"PostalAddress","addressCountry":"Russia","addressLocality":"Moscow","addressRegion":"Moscow Region"},"contactPoint":{"@type":"ContactPoint","contactType":"customer service","email":"mail@lib.onl","telephone":"+7 (000) 000-0000"},"description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","foundingDate":"2020","legalName":"Library Online","logo":{"@type":"ImageObject","url":"https://lib.onl/img/logo.min.svg"},"mainEntityOfPage":"https://lib.onl/","name":"Library Online","sameAs":[""],"url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"SiteNavigationElement","name":"Статьи","position":10,"url":"https://lib.onl/ru/articles/"},{"@type":"SiteNavigationElement","name":"Q\u0026A","position":20,"url":"https://lib.onl/ru/faq/"},{"@type":"SiteNavigationElement","name":"Архив","position":100,"url":"https://lib.onl/ru/archive/"},{"@type":"SiteNavigationElement","name":"О проекте","position":999,"url":"https://lib.onl/ru/about/"},{"@type":"SiteNavigationElement","name":"META","position":9999,"url":"https://lib.onl/ru/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lib.onl/ru/","name":"Главная"},"position":1},{"@type":"ListItem","item":{"@id":"https://lib.onl/ru/categories/","name":"Категории"},"position":2},{"@type":"ListItem","item":{"@id":"https://lib.onl/ru/categories/network/","name":"Сеть"},"position":3}]}</script></body></html>