<!doctype html><html class=h-100 dir=ltr lang=ru-RU prefix="og: http://ogp.me/ns#
      article: http://ogp.me/ns/article#
      profile: http://ogp.me/ns/profile#
      fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Терминал / Library Online</title>
<meta name=title content="Терминал / Library Online"><meta name=description content="Информация по работе в терминале."><meta name=keywords content="forum,powershell,ipb,ips,debian,linux,cmd,cmf,cms,vbulletin,bash,fedora,git,php,systemd,terminal,cloudflare,find,gdm,github"><link rel=preconnect href=https://fonts.googleapis.com crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link rel=preconnect href=https://gravatar.com crossorigin=anonymous><link rel=preconnect href=https://images.unsplash.com crossorigin=anonymous><link rel=preload href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href=/css/vendor.bundle.css as=style><link rel=stylesheet href=/css/vendor.bundle.css><link rel=preload href=/ru/css/system.bundle.min.css as=style><link rel=stylesheet href=/ru/css/system.bundle.min.css><link rel=icon type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel="shortcut icon" type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=apple-touch-icon sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=icon type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel="shortcut icon" type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=apple-touch-icon sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=icon type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel="shortcut icon" type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=apple-touch-icon sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=icon type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel="shortcut icon" type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=apple-touch-icon sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=icon type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel="shortcut icon" type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=apple-touch-icon sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=icon type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel="shortcut icon" type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=apple-touch-icon sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=icon type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel="shortcut icon" type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=apple-touch-icon sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=icon type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel="shortcut icon" type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=apple-touch-icon sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=icon type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel="shortcut icon" type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=apple-touch-icon sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=icon type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel="shortcut icon" type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=apple-touch-icon sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=icon type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel="shortcut icon" type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=apple-touch-icon sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=icon type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel="shortcut icon" type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=apple-touch-icon sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=icon type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel="shortcut icon" type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=apple-touch-icon sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=icon type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel="shortcut icon" type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=apple-touch-icon sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=icon type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel="shortcut icon" type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=apple-touch-icon sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=icon type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel="shortcut icon" type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=apple-touch-icon sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=icon type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel="shortcut icon" type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=apple-touch-icon sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=icon type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel="shortcut icon" type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=apple-touch-icon sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=icon type=image/svg+xml sizes=any href=https://lib.onl/favicon.svg><link rel="shortcut icon" type=image/x-icon href=https://lib.onl/favicon.ico><link rel="shortcut icon" type=image/vnd.microsoft.icon href=https://lib.onl/favicon.ico><link rel=first href=https://lib.onl/ru/categories/terminal/><link rel=last href=https://lib.onl/ru/categories/terminal/><link rel=canonical href=https://lib.onl/ru/categories/terminal/><link rel=alternate href=https://lib.onl/ hreflang=x-default><link rel=alternate href=https://lib.onl/ru/categories/terminal/ hreflang=ru><link rel=manifest type=application/manifest+json href=https://lib.onl/ru/manifest.json title="Library Online"><link rel=search type=application/opensearchdescription+xml href=https://lib.onl/ru/opensearch.xml title="Library Online"><link rel=alternate type=application/rss+xml href=https://lib.onl/ru/categories/terminal/index.xml title="Library Online"><meta name=application-name content="Library Online"><meta name=theme-color content="#f8f9fa" media="(prefers-color-scheme: light)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lib.onl/favicon-512.png"><meta name=twitter:title content="Терминал"><meta name=twitter:description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:title" content="Терминал"><meta property="og:description" content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:type" content="website"><meta property="og:url" content="https://lib.onl/ru/categories/terminal/"><meta property="og:image" content="https://lib.onl/favicon-512.png"><meta property="twitter:domain" content="lib.onl"><meta property="twitter:url" content="https://lib.onl/ru/categories/terminal/"><meta property="og:locale" content="ru_RU"><meta property="og:site_name" content="Library Online"><meta name=DC.Title content="Терминал"><meta name=DC.Subject content="Информация по работе в терминале."><meta name=DC.Description content="Информация по работе в терминале."><meta name=DC.Type content="Text"><meta name=DC.Source content="https://lib.onl/ru/categories/terminal/"><meta name=DC.Relation content="https://lib.onl/ru/categories/terminal/"><meta name=DC.Coverage content="World"><meta name=DC.Creator content="Library Online"><meta name=DC.Publisher content="Library Online"><meta name=DC.Contributor content="Library Online"><meta name=DC.Rights content="Library Online"><meta name=DC.Format content="Digital"><meta name=DC.Identifier content="https://lib.onl/ru/categories/terminal/"><meta name=DC.Language content="ru-RU"><meta name=DC.Provenance content="Library Online"><meta name=DC.RightsHolder content="Library Online"><meta name=DC.AccrualPeriodicity content="Weekly"><meta name=DC.AccrualPolicy content="Active"><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"Library Online","url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","address":{"@type":"PostalAddress","addressCountry":"","addressLocality":"","addressRegion":"","postalCode":"","streetAddress":""},"contactPoint":{"@type":"ContactPoint","contactType":"","email":"","telephone":""},"description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","foundingDate":"","legalName":"Library Online","logo":"https://lib.onl/","name":"Library Online","sameAs":[],"url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"ItemList","itemListElement":[{"@type":"SiteNavigationElement","name":"Статьи","position":10,"url":"https://lib.onl/ru/articles/"},{"@type":"SiteNavigationElement","name":"Q\u0026A","position":20,"url":"https://lib.onl/ru/qna/"},{"@type":"SiteNavigationElement","name":"Архив","position":100,"url":"https://lib.onl/ru/archive/"},{"@type":"SiteNavigationElement","name":"О проекте","position":999,"url":"https://lib.onl/ru/about/"},{"@type":"SiteNavigationElement","name":"META","position":9999,"url":"https://lib.onl/ru/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://lib.onl/ru/","name":"Главная","position":1},{"@type":"ListItem","item":"https://lib.onl/ru/categories/","name":"Категории","position":2},{"@type":"ListItem","item":"https://lib.onl/ru/categories/terminal/","name":"Терминал","position":3}]}</script></head><body class="d-flex flex-column h-100 is-node type-categories"><header><nav class="navbar navbar-expand-lg navbar-light fixed-top border-bottom shadow-sm text-lg-center bg-light"><div class=container-fluid><a class=navbar-brand href=/ru/><img src=https://lib.onl/img/logo.min.svg alt=Логотип width=30 height=24 class="d-inline-block align-text-top"><h1 class="d-inline-block h5 m-0 ms-1">Library Online</h1></a><button type=button class=navbar-toggler data-bs-toggle=collapse data-bs-target=#navTopBar aria-controls=navTopBar aria-expanded=false aria-label='Переключить навигацию'>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navTopBar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/ru/articles/><i class="fas fa-book fa-fw"></i>
<span>Статьи</span></a></li><li class=nav-item><a class=nav-link href=/ru/qna/><i class="fas fa-circle-question fa-fw"></i>
<span>Q&amp;A</span></a></li><li class=nav-item><a class=nav-link href=/ru/archive/><i class="fas fa-archive fa-fw"></i>
<span>Архив</span></a></li><li class=nav-item><a class=nav-link href=/ru/about/><i class="fas fa-info-circle fa-fw"></i>
<span>О проекте</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-list fa-fw"></i>
<span>META</span></a><div class="dropdown-menu shadow"><a class=dropdown-item href=/ru/authors/><i class="fas fa-user-circle fa-fw"></i>
<span>Авторы</span>
</a><a class="dropdown-item active" href=/ru/categories/><i class="fas fa-folder-open fa-fw"></i>
<span>Категории</span>
</a><a class=dropdown-item href=/ru/tags/><i class="fas fa-tags fa-fw"></i>
<span>Теги</span></a></div></li></ul><ul class=navbar-nav><li class=nav-item><a class="nav-link d-lg-none" href=# data-bs-toggle=modal data-bs-target=#search-modal aria-label=Поиск><i class="fas fa-search fa-fw"></i>
<span>Поиск</span>
</a><a class="nav-link d-none d-lg-block" href=# data-bs-toggle=modal data-bs-target=#search-modal data-bs-tooltip data-bs-title=Поиск aria-label=Поиск><i class="fas fa-search fa-fw"></i></a></li></ul></div></div></nav></header><main class="wrapper flex-shrink-0"><div class="section py-3"><div class=container><nav style="--bs-breadcrumb-divider:'\2f '" class=small aria-label=breadcrumb><ol class="breadcrumb bg-light p-2 rounded"><li class=breadcrumb-item><a href=/ru/ aria-label=Главная><i class="fas fa-home fa-fw"></i></a></li><li class=breadcrumb-item><a href=/ru/categories/ aria-label=Категории>Категории</a></li><li class="breadcrumb-item active">Терминал</li></ol></nav><div class="row row-cols-1 row-cols-lg-2 g-3"><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Работа с переменной среды окружения PATH" class=d-block href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d><picture><source srcset='https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Работа с переменной среды окружения PATH"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d>Работа с переменной среды окружения PATH</a></h2></div></header><div class=node-body><p>Переменная <code>Path</code> является переменной среды окружения, при помощи которой ОС Windows находит нужные приложения в терминале. Рассмотрим способы редактирования значений этой переменной.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Работа с переменной среды окружения PATH" class=d-block href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d><img class="d-block rounded" src="https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Работа с переменной среды окружения PATH"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d>Работа с переменной среды окружения PATH</a></h2></div></header><div class=node-body><p>Переменная <code>Path</code> является переменной среды окружения, при помощи которой ОС Windows находит нужные приложения в терминале. Рассмотрим способы редактирования значений этой переменной.</p></div></div></article></div><div class="modal fade" id=modal-899827897f82e6808bc8e4b6d6c02d2d tabindex=-1 aria-labelledby=modal-899827897f82e6808bc8e4b6d6c02d2d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-899827897f82e6808bc8e4b6d6c02d2d-label><a href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/>Работа с переменной среды окружения PATH</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Переменная <code>Path</code> является переменной среды окружения, при помощи которой ОС Windows находит нужные приложения в терминале. Рассмотрим способы редактирования значений этой переменной.</p><p>Проще говоря, в переменную <code>Path</code> можно добавлять пути к директориям приложений, для того чтобы при работе в терминале не прописывать полные пути к исполняемым файлам этих приложений. Например, в терминале, чтобы вызвать Git и зафиксировать изменения нужно ввести <code>C:\Apps\Git\git.exe commit -m 'bla-bla'</code>. Но если добавить значение <code>C:\Apps\Git</code> в переменную <code>Path</code>, то в терминале можно просто писать <code>git.exe commit -m 'bla-bla'</code>, больше не нужно указывать полный путь к Git&rsquo;у.</p><h2>Уровни переменной <code>Path</code></h2><p>Существует два уровня переменной <code>Path</code>:</p><ul><li>Системный - является глобальным и его значения доступны для каждого аккаунта пользователя.</li><li>Пользовательский - работает в контексте конкретного аккаунта и содержит значения только этого пользователя. Под другим аккаунтом, переменная на пользовательском уровне может содержать другие значения.</li></ul><p>В пределах аккаунта пользователя эти два уровня переменной <code>Path</code> объединяют свои значения.</p><h2>Добавление значений в переменную <code>Path</code></h2><p>Добавить свои значения в переменную <code>Path</code> можно несколькими способами:</p><ul><li>Графический интерфейс ОС.</li><li>Команда в CMD при помощи утилиты <code>setx</code>.</li><li>Команда в PowerShell.</li></ul><p>Значения в переменной <code>Path</code> разделяются символом <code>;</code>.</p><p>Так как я приверженец работы в терминале и считаю, что каждый администратор должен уметь работать с командной строкой, то привожу только два последних способа.</p><h3>Командная строка CMD</h3><p>Управление переменными среды окружения в CMD происходит при помощи утилиты <code>setx</code>.</p><h4>Системный уровень</h4><p>Чтобы добавить свои значения в переменную <code>Path</code> на системном уровне, необходимо указать ключ <code>/m</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5da16a37cff166aec1f83ba3fabcdf97 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-5da16a37cff166aec1f83ba3fabcdf97><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>setx /m Path <span class=s2>&#34;</span><span class=nv>%Path%</span><span class=s2>C:\Apps\App_01;C:\Apps\App_02&#34;</span></span></span></code></pre></div></div></div></div><div class="shortcode shortcode-alert"><div class="alert alert-danger d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-circle-radiation fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Ни в коем случае нельзя прописывать в <code>setx</code> свои значения БЕЗ вызова переменной <code>Path</code>: при такой команде утилита <code>setx</code> обнулит все существующие значения в <code>Path</code> и запишет указанные вами. А значения, добавленные программами, пропадут.</p><p>Правильная команда должны быть такой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-4ff2e249848d892c0104e34b08ce627d><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>setx /m Path <span class=s2>&#34;</span><span class=nv>%Path%</span><span class=s2>C:\MyCustomDir&#34;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4ff2e249848d892c0104e34b08ce627d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Здесь мы заранее вызываем переменную <code>Path</code> конструкцией <code>%Path%</code>, которая добавит существующие значения к вашим и всё это дело пропишется утилитой <code>setx</code> обратно в <code>Path</code>.</p></div></div></div><p>Необходимости в скрипте, который добавляет значения в переменную <code>Path</code> на системном уровне, нет. Но я всё же его написал, пусть будет.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>cmd.set.env.path.system.bat</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-273f42dea54c289eb56eef89b61e198b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=cmd.set.env.path.system.bat download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=cmd.set.env.path.system.bat target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-273f42dea54c289eb56eef89b61e198b><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting PATH variable for system.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl><span class=k>setLocal</span> EnableDelayedExpansion
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Custom PATH.</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=s2>&#34;pathArray=C:\Apps\App_01 C:\Apps\App_02 C:\Apps\App_03&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Building a system PATH variable.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=se>%%</span>p <span class=k>in</span> <span class=p>(</span> <span class=nv>%pathArray%</span> <span class=p>)</span> <span class=k>do</span> <span class=p>(</span> <span class=k>set</span> <span class=s2>&#34;pathCustom=</span><span class=se>%%</span><span class=s2>p;!pathCustom!&#34;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting a new PATH variable.</span>
</span></span><span class=line><span class=cl>setx /m Path <span class=s2>&#34;</span><span class=nv>%Path%!pathCustom!</span><span class=s2>&#34;</span></span></span></code></pre></div></div></div></div><p>В переменной <code>pathArray</code> указывается массив из путей, которые необходимо добавить в <code>Path</code> на системном уровне.</p><h4>Пользовательский уровень</h4><p>Добавить свои значения в переменную <code>Path</code> на пользовательском уровне:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cce439f2792ce7cbb9f2987ac14bda78 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-cce439f2792ce7cbb9f2987ac14bda78><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>setx Path <span class=s2>&#34;</span><span class=nv>%Path%</span><span class=s2>C:\Apps\App_01;C:\Apps\App_02&#34;</span></span></span></code></pre></div></div></div></div><p>Но есть одна особенность: так как переменная <code>Path</code> объединяет значения системного и пользовательского уровней, то при такой команде, утилита <code>setx</code> пропишет в <code>Path</code> пользовательского уровня все значения из системного. Таким образом, получится дублирование содержимого <code>Path</code> системного уровня в пользовательском. Это не критично, но можно сделать более элегантно&mldr;</p><p>Для того, чтобы обойти вышеуказанную особенность, необходимо написать скрипт, который будет при вызове переменной <code>Path</code> вырезать из неё значения системного уровня. Собственно, скрипт я написал.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>cmd.set.env.path.user.bat</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-07c04c65ee257e1c91c8507205cfd213 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=cmd.set.env.path.user.bat download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=cmd.set.env.path.user.bat target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-07c04c65ee257e1c91c8507205cfd213><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting PATH variable for user.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl><span class=k>setLocal</span> EnableDelayedExpansion
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Custom PATH.</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=s2>&#34;pathArray=C:\Apps\App_01 C:\Apps\App_02 C:\Apps\App_03&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Getting the current PATH variable.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>/f</span> <span class=s2>&#34;tokens=2,*&#34;</span> <span class=se>%%</span>a <span class=k>in</span> <span class=p>(</span> <span class=s1>&#39;reg query HKCU\Environment /v Path&#39;</span> <span class=p>)</span> <span class=k>do</span> <span class=p>(</span> <span class=k>set</span> <span class=s2>&#34;pathUser=</span><span class=se>%%</span><span class=s2>b&#34;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Building a user PATH variable.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=se>%%</span>p <span class=k>in</span> <span class=p>(</span> <span class=nv>%pathArray%</span> <span class=p>)</span> <span class=k>do</span> <span class=p>(</span> <span class=k>set</span> <span class=s2>&#34;pathCustom=</span><span class=se>%%</span><span class=s2>p;!pathCustom!&#34;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting a new PATH variable.</span>
</span></span><span class=line><span class=cl>setx Path <span class=s2>&#34;</span><span class=nv>!pathUser!!pathCustom!</span><span class=s2>&#34;</span></span></span></code></pre></div></div></div></div><p>В переменной <code>pathArray</code> указывается массив из путей, которые необходимо добавить в <code>Path</code> на пользовательском уровне. При этом, добавление значений из системного уровня не произойдёт. Наша переменная <code>Path</code> пользовательского уровня останется чистенькой и красивой.</p><h3>Терминал PowerShell</h3><p>В PowerShell для управления переменными окружения существуют методы:</p><ul><li><code>[Environment]::GetEnvironmentVariables()</code> - получение значения переменной среды окружения.</li><li><code>[Environment]::SetEnvironmentVariable()</code> - установка значения переменной среды окружения.</li></ul><h4>Системный уровень</h4><p>Для добавления значений в переменную <code>Path</code> на системном уровне, я написал небольшой скрипт.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.env.path.system.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b789e569a8bc069e041904be67e84a6b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.env.path.system.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.env.path.system.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-b789e569a8bc069e041904be67e84a6b><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         41643d28-3808-4a6f-a322-d87ed4384d5f
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Setting PATH variable for system.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script configures the PATH variable values for the system.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.system.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Set-EnvPathSystem</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Environment</span><span class=p>]::</span><span class=n>SetEnvironmentVariable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Path&#39;</span><span class=p>,</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>GetEnvironmentVariables</span><span class=p>(</span><span class=s1>&#39;Machine&#39;</span><span class=p>)).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=p>[</span><span class=no>IO.Path</span><span class=p>]::</span><span class=n>PathSeparator</span><span class=p>,</span> <span class=s1>&#39;Machine&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-EnvPathSystem</span></span></span></code></pre></div></div></div></div><p>Вызов скрипта осуществляется следующим образом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-024f69a6b6366e32de1654963626286b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-024f69a6b6366e32de1654963626286b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>set</span><span class=p>.</span><span class=py>env</span><span class=p>.</span><span class=py>path</span><span class=p>.</span><span class=py>system</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=s1>&#39;C:\Apps\App_01&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_02&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_03&#39;</span></span></span></code></pre></div></div></div></div><p>В параметре <code>-P</code> указываются значения, которые необходимо добавить в переменную <code>Path</code> системного уровня.</p><h4>Пользовательский уровень</h4><p>А здесь скрипт, который отвечает за добавление в переменную <code>Path</code> значений на пользовательском уровне.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.env.path.user.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-29cb7503b37dfaa2393432c68840f253 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.env.path.user.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.env.path.user.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-29cb7503b37dfaa2393432c68840f253><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         79f23918-308a-412c-8835-b1bb9c9193e3
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Setting PATH variable for user.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script configures the PATH variable values for the user.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.user.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Set-EnvPathUser</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Environment</span><span class=p>]::</span><span class=n>SetEnvironmentVariable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Path&#39;</span><span class=p>,</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>GetEnvironmentVariables</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>)).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=p>[</span><span class=no>IO.Path</span><span class=p>]::</span><span class=n>PathSeparator</span><span class=p>,</span> <span class=s1>&#39;User&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-EnvPathUser</span></span></span></code></pre></div></div></div></div><p>Вызов скрипта осуществляется следующим образом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6c2190d3fcb19d17af99072760c5a6fb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-6c2190d3fcb19d17af99072760c5a6fb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>set</span><span class=p>.</span><span class=py>env</span><span class=p>.</span><span class=py>path</span><span class=p>.</span><span class=py>user</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=s1>&#39;C:\Apps\App_01&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_02&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_03&#39;</span></span></span></code></pre></div></div></div></div><p>В параметре <code>-P</code> указываются значения, которые необходимо добавить в переменную <code>Path</code> пользовательского уровня.</p><h4>Общий скрипт</h4><p>Не знаю, почему я сразу не написал общий скрипт для всех уровней&mldr; Решил под завершение статьи реализовать подобную штуку.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.env.path.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-365b61345dd25f2753c6d5b42d544a89 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.env.path.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.env.path.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-365b61345dd25f2753c6d5b42d544a89><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         14efdc7d-1edd-4b40-b6d2-623288ce1659
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Setting the PATH variable.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script configures the PATH variable values.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39; -T &#39;Machine&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39; -T &#39;User&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>)][</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;Machine&#39;</span><span class=p>,</span> <span class=s1>&#39;User&#39;</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Target</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Set-EnvPath</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Environment</span><span class=p>]::</span><span class=n>SetEnvironmentVariable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Path&#39;</span><span class=p>,</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>GetEnvironmentVariables</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${Target}</span><span class=s2>&#34;</span><span class=p>)).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=p>[</span><span class=no>IO.Path</span><span class=p>]::</span><span class=n>PathSeparator</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${Target}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-EnvPath</span></span></span></code></pre></div></div></div></div><p>Вызывается скрипт обычным способом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3e6279203913fc8f39be0bddd674deee role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-3e6279203913fc8f39be0bddd674deee><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>set</span><span class=p>.</span><span class=py>env</span><span class=p>.</span><span class=py>path</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=s1>&#39;C:\Apps\App_01&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_02&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_03&#39;</span> <span class=n>-T</span> <span class=s1>&#39;User&#39;</span></span></span></code></pre></div></div></div></div><p>Но отличается от выше приведённых скриптов дополнительным параметром <code>-T</code>, который указывает уровень переменной <code>Path</code> и может принимать следующие значения:</p><ul><li><code>Machine</code> - для системного уровня.</li><li><code>User</code> - для пользовательского уровня.</li></ul></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/cmd/>#cmd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/batch/>#batch</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/path/>#path</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-28T12:27:07Z data-fn=date-local>2023/10/28 12:27:07 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Автоматическая настройка Windows Server 2022 под рабочую станцию" class=d-block href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78><picture><source srcset='https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Автоматическая настройка Windows Server 2022 под рабочую станцию"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78>Автоматическая настройка Windows Server 2022 под рабочую станцию</a></h2></div></header><div class=node-body><p>Ранее я уже публиковал инструкцию по превращению серверной ОС в ОС для рабочей станции. Но этот процесс можно автоматизировать при помощи PowerShell.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Автоматическая настройка Windows Server 2022 под рабочую станцию" class=d-block href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78><img class="d-block rounded" src="https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Автоматическая настройка Windows Server 2022 под рабочую станцию"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78>Автоматическая настройка Windows Server 2022 под рабочую станцию</a></h2></div></header><div class=node-body><p>Ранее я уже публиковал инструкцию по превращению серверной ОС в ОС для рабочей станции. Но этот процесс можно автоматизировать при помощи PowerShell.</p></div></div></article></div><div class="modal fade" id=modal-76167fb435445bcf9e0f5dbe3c74ca78 tabindex=-1 aria-labelledby=modal-76167fb435445bcf9e0f5dbe3c74ca78-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-76167fb435445bcf9e0f5dbe3c74ca78-label><a href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/>Автоматическая настройка Windows Server 2022 под рабочую станцию</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Ранее я уже публиковал инструкцию по превращению серверной ОС в ОС для рабочей станции. Но этот процесс можно автоматизировать при помощи PowerShell.</p><p>В статье <span class="shortcode shortcode-uuid"><a href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/>Windows Server 2022 для рабочей станции</a></span> рассматривалось ручная адаптация Windows Server 2022 под рабочую станцию. Я решил написать специальный скрипт, который берёт на себя часть действий. Но окончательная настройка, например, такая как редактирование GPO остаётся за пользователем.</p><h2>Автоматизация</h2><p>Рассмотрим скрипт по адаптации серверной ОС под рабочую станцию.</p><h3>Примеры</h3><p>Скрипт требует административных прав доступа, поэтому его необходимо запускать под аккаунтом администратора.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-dd1379f151b6e8d7b08874739f131dfe role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-dd1379f151b6e8d7b08874739f131dfe><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>win</span><span class=p>.</span><span class=py>srv</span><span class=p>.</span><span class=py>ws</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></div></div><h3>Алгоритм работы</h3><ul><li>Включение дополнительных компонентов Windows.</li><li>Настройка необходимых для рабочей станции служб.</li><li>Отключение <strong>IE Enhanced Security Configuration</strong> для аккаунтов администраторов и пользователей.</li><li>Переключение приоритета процессора в сторону приложений.</li><li>Настройка <strong>MMAgent</strong>.</li><li>Переключение <strong>DEP</strong> только на программы Windows и службы.</li></ul><h3>Скрипт</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.win.srv.ws.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-29ac1fe071e27b4aef315305ba2f7984 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.win.srv.ws.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.win.srv.ws.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-29ac1fe071e27b4aef315305ba2f7984><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         c050355b-ecbd-4b13-b805-3a422dc0c995
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Windows Server configuration script.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script allows you to set up Windows Server as a workstation.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.win.srv.ws.ps1
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-FeatureConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-ServiceConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-IEConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-PriorityControlConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-MMAgentConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DEPConfig</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING FEATURES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-FeatureConfig</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Wireless-Networking&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Install-WindowsFeature</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING SERVICES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-ServiceConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Name</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;Audiosrv&#39;</span><span class=p>,</span> <span class=s1>&#39;AudioEndpointBuilder&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Name</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Name</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=n>StartupType</span> <span class=p>=</span> <span class=s1>&#39;Automatic&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>Set-Service</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$WSearch</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;WSearch&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>StartupType</span> <span class=p>=</span> <span class=s1>&#39;AutomaticDelayedStart&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Set-Service</span> <span class=nv>@WSearch</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># DISABLE IE ENHANCED SECURITY CONFIGURATION (ESC).</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-IEConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}&#39;</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A8-37EF-4b3f-8CFC-4F3A74704073}&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>LiteralPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;IsInstalled&#39;</span>
</span></span><span class=line><span class=cl>      <span class=n>Value</span> <span class=p>=</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Set-ItemProperty</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Host</span> <span class=s1>&#39;IE Enhanced Security Configuration (ESC) has been disabled.&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;&#39;</span><span class=nv>${_}</span><span class=s2>&#39; not found!&#34;</span> <span class=n>-ErrorAction</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ADJUST PROCESSOR RESOURCES FOR BEST PERFORMANCE OF PROGRAMS.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-PriorityControlConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>=</span> <span class=s1>&#39;HKLM:\SYSTEM\CurrentControlSet\Control\PriorityControl&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>LiteralPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Win32PrioritySeparation&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Value</span> <span class=p>=</span> <span class=mf>38</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Set-ItemProperty</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;&#39;</span><span class=nv>${Path}</span><span class=s2>&#39; not found!&#34;</span> <span class=n>-ErrorAction</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING MMAGENT.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-MMAgentConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MemoryCompression</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>OperationAPI</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>PageCombining</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Enable-MMAgent</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING DEP.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DEPConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>cmd</span><span class=p>.</span><span class=py>exe</span> <span class=p>/</span><span class=n>c</span> <span class=s1>&#39;bcdedit.exe /set {current} nx OptIn&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/workstation/>#workstation</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/server/>#server</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-27T19:46:08Z data-fn=date-local>2023/10/27 19:46:08 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Восстановление доверительных отношений между PC и Active Directory" class=d-block href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762><picture><source srcset='https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Восстановление доверительных отношений между PC и Active Directory"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762>Восстановление доверительных отношений между PC и Active Directory</a></h2></div></header><div class=node-body><p>Рассмотрим способы решения распространённой проблемы потери доверительных отношений между рабочей станцией и доменом Active Directory. Из-за этой проблемы пользователь не может авторизоваться под своей учётной записью.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Восстановление доверительных отношений между PC и Active Directory" class=d-block href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762><img class="d-block rounded" src="https://images.unsplash.com/photo-1477383384651-442903132e79?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Восстановление доверительных отношений между PC и Active Directory"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762>Восстановление доверительных отношений между PC и Active Directory</a></h2></div></header><div class=node-body><p>Рассмотрим способы решения распространённой проблемы потери доверительных отношений между рабочей станцией и доменом Active Directory. Из-за этой проблемы пользователь не может авторизоваться под своей учётной записью.</p></div></div></article></div><div class="modal fade" id=modal-327990f6c9bdc2cf482551861c095762 tabindex=-1 aria-labelledby=modal-327990f6c9bdc2cf482551861c095762-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-327990f6c9bdc2cf482551861c095762-label><a href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/>Восстановление доверительных отношений между PC и Active Directory</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Рассмотрим способы решения распространённой проблемы потери доверительных отношений между рабочей станцией и доменом Active Directory. Из-за этой проблемы пользователь не может авторизоваться под своей учётной записью.</p><p>При попытке входа пользователя под доменной учётной записью, могут произойти следующие ошибки.</p><div class="shortcode shortcode-window"><div class="card text-bg-danger mb-3 overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-computer fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Trust relationship</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li></ul></div></div></div><div class=card-body><p>The trust relationship between this workstation and the primary domain failed.</p><p>(Не удалось восстановить доверительные отношения между рабочей станцией и доменом.)</p></div></div></div><div class="shortcode shortcode-window"><div class="card text-bg-danger mb-3 overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-computer fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Security database</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li></ul></div></div></div><div class=card-body><p>The security database on the server does not have a computer account for this workstation trust relationship.</p><p>(База данных диспетчера учетных записей на сервере не содержит записи для регистрации компьютера через доверительные отношения с этой рабочей станцией.)</p></div></div></div><p>Ошибка может возникнуть по различным факторам. Например, когда новый компьютер присоединился к домену под уже существующем именем другого компьютера, или когда виртуальная машина восстановилась с контрольной точки.</p><h2>Ручной способ</h2><p>Для того, чтобы исправить ошибку, необходимо последовательно выполнить следующие пункты:</p><ol><li>Сбросить аккаунт компьютера в Active Directory.</li><li>На проблемном компьютере зайти под локальным администратором и вывести компьютер из домена в рабочую группу.</li><li>Перезагрузить компьютер.</li><li>Вывести компьютер из рабочей группы и ввести обратно в домен.</li><li>Еще раз перезагрузить компьютер.</li></ol><h2>Автоматизация</h2><p>Как обычно, привожу скрипт по автоматизации восстановления доверительных отношений. Скрипт решит проблему быстро и без перезагрузок. Запускается под администратором.</p><h3>Параметры</h3><p>Параметр у скрипта один, это название сервера DC.</p><ul><li><code>-S</code> <code>-P_Server</code> - название сервера DC (контроллера домена). Если параметр не задан, скрипт выбирает для операции контроллер домена по умолчанию.</li></ul><h3>Примеры</h3><p>Восстановить доверительные отношения с доменом по умолчанию:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b2ee593fcb483f8369368547c429d202 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-b2ee593fcb483f8369368547c429d202><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>csc</span><span class=p>.</span><span class=py>repair</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></div></div><p>Восстановить доверительные отношения с доменом <code>DC-server.domain.com</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-bb4a13166d98b2a8f5085f93d2c9bf78 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-bb4a13166d98b2a8f5085f93d2c9bf78><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>csc</span><span class=p>.</span><span class=py>repair</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-DC</span> <span class=s1>&#39;DC-server.domain.com&#39;</span></span></span></code></pre></div></div></div></div><h3>Алгоритм работы</h3><ul><li>Запускается проверка доверительных отношений при помощи cmdlet&rsquo;а <code>Test-ComputerSecureChannel</code>.</li><li>Если проверка пройдена, скрипт завершает работу.</li><li>Если проверка не пройдена, запускается цикл восстановления доверительных отношений с контроллером домена с временным интервалом в 5 секунд.</li></ul><h3>Скрипт</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.csc.repair.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f5d1574843fded54cfe564cb9a34fd58 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.csc.repair.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.csc.repair.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-f5d1574843fded54cfe564cb9a34fd58><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         52672f5d-e2c0-467a-ae1d-c0fc9009a1eb
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Testing and repairing the secure channel between the local computer and its domain.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Verifying that the channel between the local computer and its domain is working correctly by checking the status of its trust relationships. If a connection fails, trying to restore it.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Server
</span></span></span><span class=line><span class=cl><span class=cm>  Specifies the domain controller to run the command. If this parameter is not specified, this script selects a default domain controller for the operation.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Sleep
</span></span></span><span class=line><span class=cl><span class=cm>  Sleep time (in seconds).
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.csc.repair.ps1
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.csc.repair.ps1 -DC &#39;DC-server.domain.com&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Specifies the domain controller to run the command.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DC&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Server</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Sleep time (in seconds).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Sleep</span> <span class=p>=</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-CSCRepair</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># EDITING THE REGISTRY.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-CSCRepair</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Server</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${P_Server}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Repair</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>Credential</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-Credential</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nb>Test-ComputerSecureChannel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Host</span> <span class=s1>&#39;Connection successful. Everything is fine!&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Host</span> <span class=s1>&#39;Connection failed! The secure channel between the local computer and the domain is broken. Removing and then rebuilds the channel established by the NetLogon service...&#39;</span>
</span></span><span class=line><span class=cl>      <span class=nb>Test-ComputerSecureChannel</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>      <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>until</span> <span class=p>(</span><span class=nb>Test-ComputerSecureChannel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/domain/>#domain</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ad/>#ad</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-27T09:25:25Z data-fn=date-local>2023/10/27 09:25:25 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Изменение порта RDP" class=d-block href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905><picture><source srcset='https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Изменение порта RDP"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905>Изменение порта RDP</a></h2></div></header><div class=node-body><p>По умолчанию, RDP использует порт TCP <code>3389</code>, но по каким-либо обстоятельствам приходится его менять. Рассмотрим два способа изменения порта RDP.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Изменение порта RDP" class=d-block href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905><img class="d-block rounded" src="https://images.unsplash.com/photo-1509483730228-811e47696246?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Изменение порта RDP"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905>Изменение порта RDP</a></h2></div></header><div class=node-body><p>По умолчанию, RDP использует порт TCP <code>3389</code>, но по каким-либо обстоятельствам приходится его менять. Рассмотрим два способа изменения порта RDP.</p></div></div></article></div><div class="modal fade" id=modal-37b4eb3be87fad5d3e6985a99831f905 tabindex=-1 aria-labelledby=modal-37b4eb3be87fad5d3e6985a99831f905-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-37b4eb3be87fad5d3e6985a99831f905-label><a href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/>Изменение порта RDP</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>По умолчанию, RDP использует порт TCP <code>3389</code>, но по каким-либо обстоятельствам приходится его менять. Рассмотрим два способа изменения порта RDP.</p><h2>Ручное изменение порта</h2><p>Для изменения порта RDP, нужно отредактировать реестр:</p><ol><li>Открыть редактор реестра <code>regedit.exe</code>.</li><li>Пройти по пути <code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp</code>.</li><li>Найти параметр <code>PortNumber</code>.</li><li>Ввести новый номер порта (decimal).</li><li>Перезагрузить компьютер.</li></ol><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Если включён брандмауэр, необходимо в нём разрешить подключение через новый порт RDP.</p></div></div></div><h2>Автоматизация</h2><p>Весь процесс можно автоматизировать при помощи скрипта.</p><h3>Параметры</h3><p>Скрипт имеет один единственный параметр, это номер порта.</p><ul><li><code>-P</code> <code>-P_Port</code> - номер порта RDP.</li></ul><h3>Примеры</h3><p>Запускается скрипт обычным способом. В параметре <code>-P</code> указывается новый номер порта RDP.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6a063d1a445cd9bbb07ce48fd7d8e845 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-6a063d1a445cd9bbb07ce48fd7d8e845><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>rdp</span><span class=p>.</span><span class=py>port</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=mf>50102</span></span></span></code></pre></div></div></div></div><h3>Алгоритм работы</h3><ul><li>Проверяется в реестре корректность пути и изменяется номер порта RDP. Если путь не найден, то скрипт аварийно завершает работу без дальнейших изменений.</li><li>В брандмауэр вносится два правила, которые разрешают подключение к новому порту RDP.</li><li>Если служба <code>TermService</code> (служба удаленных рабочих столов) запущена, она перезапускается, применяя новые параметры порта RDP.</li></ul><h3>Скрипт</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.rdp.port.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b76c37e2b3c902b73f1d1a473deef153 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.rdp.port.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.rdp.port.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-b76c37e2b3c902b73f1d1a473deef153><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         5d2bddd9-4eed-42f0-a0ba-7d30efcb81e2
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Changing the RDP port number.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Changing the listening port for Remote Desktop on your computer.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Port
</span></span></span><span class=line><span class=cl><span class=cm>  RDP port number.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: 3389.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.rdp.port.ps1 -P 50102
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;RDP port number.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidatePattern</span><span class=p>(</span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Port</span> <span class=p>=</span> <span class=mf>3389</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-RdpRegistry</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-RdpFirewall</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-RdpService</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># EDITING THE REGISTRY.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RdpRegistry</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>=</span> <span class=s1>&#39;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>LiteralPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;PortNumber&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Value</span> <span class=p>=</span> <span class=nv>$P_Port</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Set-ItemProperty</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;&#39;</span><span class=nv>${Path}</span><span class=s2>&#39; not found!&#34;</span> <span class=n>-ErrorAction</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># EDITING THE FIREWALL.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RdpFirewall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$TCP</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DisplayName</span> <span class=p>=</span> <span class=s1>&#39;Custom RDP Port (TCP-In)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Profile</span> <span class=p>=</span> <span class=s1>&#39;Public&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Direction</span> <span class=p>=</span> <span class=n>Inbound</span>
</span></span><span class=line><span class=cl>    <span class=n>Action</span> <span class=p>=</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl>    <span class=n>Protocol</span> <span class=p>=</span> <span class=n>TCP</span>
</span></span><span class=line><span class=cl>    <span class=n>LocalPort</span> <span class=p>=</span> <span class=nv>$P_Port</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$UDP</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DisplayName</span> <span class=p>=</span> <span class=s1>&#39;Custom RDP Port (UDP-In)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Profile</span> <span class=p>=</span> <span class=s1>&#39;Public&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Direction</span> <span class=p>=</span> <span class=n>Inbound</span>
</span></span><span class=line><span class=cl>    <span class=n>Action</span> <span class=p>=</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl>    <span class=n>Protocol</span> <span class=p>=</span> <span class=n>UDP</span>
</span></span><span class=line><span class=cl>    <span class=n>LocalPort</span> <span class=p>=</span> <span class=nv>$P_Port</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-NetFirewallRule</span> <span class=nv>@TCP</span>
</span></span><span class=line><span class=cl>  <span class=nb>New-NetFirewallRule</span> <span class=nv>@UDP</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># RESTARTING THE REMOTE DESKTOP SERVICES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RdpService</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Name</span> <span class=p>=</span> <span class=s1>&#39;TermService&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Force</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=nb>Get-Service</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span><span class=p>).</span><span class=py>Status</span> <span class=o>-eq</span> <span class=s1>&#39;Running&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Restart-Service</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Service &#39;</span><span class=nv>${Name}</span><span class=s2>&#39; not running!&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/rdp/>#rdp</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-26T23:35:50Z data-fn=date-local>2023/10/26 23:35:50 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Полезные функции" class=d-block href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d><picture><source srcset='https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Полезные функции"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d>PowerShell: Полезные функции</a></h2></div></header><div class=node-body><p>Полезные функции PowerShell, которые я пишу сам или нахожу в интернете. Очень помогает в работе и в скриптах.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Полезные функции" class=d-block href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d><img class="d-block rounded" src="https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Полезные функции"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d>PowerShell: Полезные функции</a></h2></div></header><div class=node-body><p>Полезные функции PowerShell, которые я пишу сам или нахожу в интернете. Очень помогает в работе и в скриптах.</p></div></div></article></div><div class="modal fade" id=modal-33c4a8b583ce3c25aeeb390b7fb1ab0d tabindex=-1 aria-labelledby=modal-33c4a8b583ce3c25aeeb390b7fb1ab0d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-33c4a8b583ce3c25aeeb390b7fb1ab0d-label><a href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/>PowerShell: Полезные функции</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Полезные функции PowerShell, которые я пишу сам или нахожу в интернете. Очень помогает в работе и в скриптах.</p><h2>Найти файлы старше X дней с момента создания</h2><p>Функция позволяет найти и вывести элементы старше X дней по свойству <code>CreationTime</code>.</p><h3>Параметры</h3><ul><li><code>-P</code> - путь к директории, в которой необходимо найти файлы.</li><li><code>-T</code> - время, прошедшее с момента создания файла (в секундах).</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.find.ct.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-bad66d6c3f8c7673a388066d57aa8511 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.find.ct.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.find.ct.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-bad66d6c3f8c7673a388066d57aa8511><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$Time</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Find-CreationTime</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Sort-Object</span> <span class=n>-Property</span> <span class=s1>&#39;LastAccessTime&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>CreationTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$Time</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Find-CreationTime</span></span></span></code></pre></div></div></div></div><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p><code>.AddSeconds</code> можно заменить на <code>.AddDays</code>, чтобы отсчитывать дату не в секундах, а в днях.</p></div></div></div><h2>Найти файлы старше X дней с момента изменения</h2><p>Функция позволяет найти и вывести элементы старше X дней по свойству <code>LastWriteTime</code>.</p><h3>Параметры</h3><ul><li><code>-P</code> - путь к директории, в которой необходимо найти файлы.</li><li><code>-T</code> - время, прошедшее с момента изменения файла (в секундах).</li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p><code>.AddSeconds</code> можно заменить на <code>.AddDays</code>, чтобы отсчитывать дату не в секундах, а в днях.</p></div></div></div><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.find.lwt.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-87da2158eb77176197c60663e3f45ca9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.find.lwt.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.find.lwt.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-87da2158eb77176197c60663e3f45ca9><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$Time</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Find-LastWriteTime</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Sort-Object</span> <span class=n>-Property</span> <span class=s1>&#39;LastAccessTime&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>LastWriteTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$Time</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Find-LastWriteTime</span></span></span></code></pre></div></div></div></div><h2>Создать новый элемент</h2><p>Функция позволяет создавать элементы. Ничего экстраординарного здесь нет, просто функция, укорачивающая стандартный cmdlet <code>New-Item</code>.</p><h3>Параметры</h3><ul><li><code>-T</code> - тип элемента.<ul><li><code>'D'</code> - директория.</li><li><code>'F'</code> - файл.</li></ul></li><li><code>-P</code> - путь к директории, в которой необходимо создать элемент.</li><li><code>-N</code> - название элемента.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.new.item.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ae92fbfa23077435ec313602a62d199c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.new.item.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.new.item.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-ae92fbfa23077435ec313602a62d199c><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;SilentlyContinue&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>New-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Directory&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;File&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-Item</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span> <span class=n>-ItemType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>New-Data</span></span></span></code></pre></div></div></div></div><h2>Проверить существование элемента</h2><p>Функция позволяет &ldquo;безопасно&rdquo; проверить существование элемента. Применяется параметр <code>-LiteralPath</code>, который интерпретирует путь без какой-либо обработки.</p><h3>Параметры</h3><ul><li><code>-T</code> - тип элемента.</li><li><code>-P</code> - путь к директории, в которой необходимо проверить элемент.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.test.item.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-563ae8fdd0934666328fd0acefc3f43c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.test.item.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.test.item.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-563ae8fdd0934666328fd0acefc3f43c><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Container&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Leaf&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-PathType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Test-Data</span></span></span></code></pre></div></div></div></div><h2>Проверить существование модуля</h2><p>Функция позволяет проверить существование модуля PowerShell в памяти компьютера.</p><h3>Параметры</h3><ul><li><code>-N</code> - название модуля.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.test.module.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b64de3b41103b9df09046611a97e991f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.test.module.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.test.module.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-b64de3b41103b9df09046611a97e991f><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Names</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Module</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>ForEach</span> <span class=p>(</span><span class=nv>$Name</span> <span class=k>in</span> <span class=nv>$Names</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Get-Module</span> <span class=n>-ListAvailable</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;Module &#39;</span><span class=nv>${Name}</span><span class=s2>&#39; not installed!&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Test-Module</span></span></span></code></pre></div></div></div></div><h2>Вывести сообщение в терминал</h2><p>Функция выводит информацию в терминал по типу сообщений.</p><h3>Параметры</h3><ul><li><code>-T</code> - тип сообщения.<ul><li><code>'HL'</code> - заголовок.</li><li><code>'I'</code> - информационное сообщение.</li><li><code>'W'</code> - предупреждение (warning).</li><li><code>'E'</code> - ошибка (error).</li></ul></li><li><code>-M</code> - текст сообщения.</li><li><code>-A</code> - действие, которое необходимо выполнить при выводе сообщения в терминал.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.write.msg.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-be61372ace9d6d6eb23e554a7d12a8bb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.write.msg.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.write.msg.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-be61372ace9d6d6eb23e554a7d12a8bb><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Continue&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Write-Msg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HL&#39;</span>    <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${NL}</span><span class=s2>--- </span><span class=nv>${Message}</span><span class=s2>&#34;</span><span class=p>.</span><span class=py>ToUpper</span><span class=p>()</span> <span class=n>-ForegroundColor</span> <span class=n>Blue</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I&#39;</span>     <span class=p>{</span> <span class=nb>Write-Information</span> <span class=n>-MessageData</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-InformationAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;W&#39;</span>     <span class=p>{</span> <span class=nb>Write-Warning</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-WarningAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;E&#39;</span>     <span class=p>{</span> <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Write-Msg</span></span></span></code></pre></div></div></div></div><h2>Найти свободную букву диска</h2><p>Небольшая функция, которая возвращает не занятую букву диска. Используется в <span class="shortcode shortcode-uuid"><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/>PowerShell: Стирание диска</a></span>.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.find.adl.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e933693bf6fb1b16ee1ab7495ed7d300 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.find.adl.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.find.adl.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-e933693bf6fb1b16ee1ab7495ed7d300><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Find-AvailableDriveLetter</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=mf>68</span><span class=p>.</span><span class=mf>.90</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=nv>$L</span><span class=p>=[</span><span class=no>char</span><span class=p>]</span><span class=nv>$_</span><span class=p>;</span> <span class=k>if</span> <span class=p>((</span><span class=nb>Get-PSDrive</span><span class=p>).</span><span class=py>Name</span> <span class=o>-notContains</span> <span class=nv>$L</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$L</span> <span class=p>}</span> <span class=p>})[</span><span class=mf>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div><h2>Получить размер файла</h2><p>Функция позволяет получить размер файла в различных единицах измерения.</p><h3>Параметры</h3><ul><li><code>-F</code> - название файла.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.get.filesize.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3cccaf4a809a4d4e4d04155e8e818ed1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.get.filesize.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.get.filesize.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-3cccaf4a809a4d4e4d04155e8e818ed1><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-FileSize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=py>Length</span>      <span class=c># Size in bytes.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>KB</span>  <span class=c># Size in KB.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>MB</span>  <span class=c># Size in MB.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>GB</span>  <span class=c># Size in GB.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>TB</span>  <span class=c># Size in TB.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-FileSize</span></span></span></code></pre></div></div></div></div><h2>Работа с архивами 7-Zip</h2><p>Функции по работе с архивами 7-Zip.</p><h3>Параметры</h3><ul><li><code>-F</code> - путь к файлу.</li></ul><h3>Упаковка</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.compress.7z.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-af871e1963efc732bbc60e4f719cbe2d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.compress.7z.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.compress.7z.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-af871e1963efc732bbc60e4f719cbe2d><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Compress-A7z</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\7-Zip\7z.exe&#34;</span> <span class=n>a</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=py>FullName</span> <span class=p>+</span> <span class=s1>&#39;.7z&#39;</span><span class=p>)</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Compress-A7z</span></span></span></code></pre></div></div></div></div><h3>Распаковка</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.expand.7z.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-05b9c0616ee485238c1667afd76d381f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.expand.7z.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.expand.7z.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-05b9c0616ee485238c1667afd76d381f><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Expand-A7z</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\7-Zip\7z.exe&#34;</span> <span class=n>x</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Expand-A7z</span></span></span></code></pre></div></div></div></div><h2>Работа с архивами WinRAR</h2><p>Функции по работе с архивами WinRAR.</p><h3>Параметры</h3><ul><li><code>-F</code> - путь к файлу.</li></ul><h3>Упаковка</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.compress.rar.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d64d35234511b4dbfa94c7b4df8bd658 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.compress.rar.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.compress.rar.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-d64d35234511b4dbfa94c7b4df8bd658><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Compress-RAR</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\WinRAR\Rar.exe&#34;</span> <span class=n>a</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=py>FullName</span> <span class=p>+</span> <span class=s1>&#39;.rar&#39;</span><span class=p>)</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Compress-RAR</span></span></span></code></pre></div></div></div></div><h3>Распаковка</h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.expand.rar.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-186301ef726f717de0d8bfbe83edb97a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.expand.rar.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.expand.rar.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-186301ef726f717de0d8bfbe83edb97a><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Expand-RAR</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\WinRAR\Rar.exe&#34;</span> <span class=n>x</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Expand-RAR</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-24T03:38:45Z data-fn=date-local>2023/10/24 03:38:45 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Стирание диска" class=d-block href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d><picture><source srcset='https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Стирание диска"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d>PowerShell: Стирание диска</a></h2></div></header><div class=node-body><p>Небольшой скрипт, который обнуляет HDD/SSD и создаёт файловую систему заново.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Стирание диска" class=d-block href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d><img class="d-block rounded" src="https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Стирание диска"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d>PowerShell: Стирание диска</a></h2></div></header><div class=node-body><p>Небольшой скрипт, который обнуляет HDD/SSD и создаёт файловую систему заново.</p></div></div></article></div><div class="modal fade" id=modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d tabindex=-1 aria-labelledby=modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d-label><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/>PowerShell: Стирание диска</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Небольшой скрипт, который обнуляет HDD/SSD и создаёт файловую систему заново.</p><h2>Параметры</h2><ul><li><code>-DN</code> <code>-P_DiskNumber</code> - номер диска. Можно узнать командой <code>Get-Disk</code>. Но если не ввести номер диска в параметры скрипта при запуске, скрипт сам выведет информацию и спросит номер диска. Обязательный параметр.</li><li><code>-DL</code> <code>-P_DriveLetter</code> - буква будущего тома. При создании тома, ОС должна присвоить ему букву. Обязательный параметр.</li><li><code>-FS</code> <code>-P_FileSystem</code> - файловая система. Может принимать следующие значения:<ul><li><code>'FAT'</code> - файловая система FAT.</li><li><code>'FAT32'</code> - файловая система FAT32.</li><li><code>'exFAT'</code> - файловая система exFAT.</li><li><code>'NTFS'</code> - файловая система NTFS.</li><li><code>'ReFS'</code> - новая файловая система ReFS.</li></ul></li><li><code>-FSL</code> <code>-P_FileSystemLabel</code> - метка файловой системы.</li><li><code>-S</code> <code>-P_Sleep</code> - перерыв между командами (в секундах).</li></ul><h2>Примеры</h2><p>Скрипт, запущенный без параметров, сам спросит необходимые данные:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9e11f83aadcd25db750e9a656c72bfc1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-9e11f83aadcd25db750e9a656c72bfc1><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>disk</span><span class=p>.</span><span class=py>erase</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></div></div><p>Обнулить диск <code>3</code>, новому разделу присвоить букву <code>E</code>, форматировать в <code>NTFS</code> и указать метку <code>USB-SSD</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-21f0d69d5492dfa06380ea0dc493c4ef role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-21f0d69d5492dfa06380ea0dc493c4ef><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>disk</span><span class=p>.</span><span class=py>erase</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-DN</span> <span class=mf>3</span> <span class=n>-DL</span> <span class=s1>&#39;E&#39;</span> <span class=n>-FS</span> <span class=s1>&#39;NTFS&#39;</span> <span class=n>-FSL</span> <span class=s1>&#39;USB-SSD&#39;</span></span></span></code></pre></div></div></div></div><h2>Скрипт</h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.disk.erase.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-639b493503ee711d34a7f6c487b7a83d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.disk.erase.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.disk.erase.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-639b493503ee711d34a7f6c487b7a83d><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         8d95f4d5-4d14-412c-9fa4-b75ebe79df09
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Disk erase script.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Disk cleanup followed by partition creation.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_DiskNumber
</span></span></span><span class=line><span class=cl><span class=cm>  Specifies the disk number of the disk on which to perform the clear operation. For a list of available disks, see the &#39;Get-Disk&#39; cmdlet.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_FileSystem
</span></span></span><span class=line><span class=cl><span class=cm>  Specifies the file system with which to format the volume.
</span></span></span><span class=line><span class=cl><span class=cm>  The acceptable values for this parameter are: &#39;NTFS&#39;, &#39;ReFS&#39;, &#39;exFAT&#39;, &#39;FAT32&#39; and &#39;FAT&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Sleep
</span></span></span><span class=line><span class=cl><span class=cm>  Sleep time (in seconds).
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.disk.erase.ps1 -DN 3 -DL &#39;E&#39; -FS &#39;NTFS&#39; -FSL &#39;USB-SSD&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Specify the disk number.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidatePattern</span><span class=p>(</span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DN&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_DiskNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Specify the file system to format the volume.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;FAT&#39;</span><span class=p>,</span> <span class=s1>&#39;FAT32&#39;</span><span class=p>,</span> <span class=s1>&#39;exFAT&#39;</span><span class=p>,</span> <span class=s1>&#39;NTFS&#39;</span><span class=p>,</span> <span class=s1>&#39;ReFS&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;FS&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_FileSystem</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Sleep time (in seconds).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Sleep</span> <span class=p>=</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># New line separator.</span>
</span></span><span class=line><span class=cl><span class=nv>$NL</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>NewLine</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Random number.</span>
</span></span><span class=line><span class=cl><span class=nv>$Random</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>1000</span> <span class=n>-Maximum</span> <span class=mf>9999</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Getting free drive letter and to assign to the new partition.</span>
</span></span><span class=line><span class=cl><span class=nv>$DriveLetter</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$((</span><span class=mf>68</span><span class=p>.</span><span class=mf>.90</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=nv>$L</span><span class=p>=[</span><span class=no>char</span><span class=p>]</span><span class=nv>$_</span><span class=p>;</span> <span class=k>if</span> <span class=p>((</span><span class=nb>Get-PSDrive</span><span class=p>).</span><span class=py>Name</span> <span class=o>-notContains</span> <span class=nv>$L</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$L</span> <span class=p>}</span> <span class=p>})[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Specifying a new label to use for the volume.</span>
</span></span><span class=line><span class=cl><span class=nv>$FileSystemLabel</span> <span class=p>=</span> <span class=s2>&#34;DISK_</span><span class=nv>${Random}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskList</span>        <span class=c># Showing disk list.</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_DiskNumber</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$P_DiskNumber</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Read-Host</span> <span class=n>-Prompt</span> <span class=s1>&#39;Disk number&#39;</span><span class=p>)</span> <span class=p>}</span>   <span class=c># Getting disk number.</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_FileSystem</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$P_FileSystem</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Read-Host</span> <span class=n>-Prompt</span> <span class=s1>&#39;File system&#39;</span><span class=p>)</span> <span class=p>}</span>   <span class=c># Getting file system.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskClear</span>       <span class=c># Starting clearing disk.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskInit</span>        <span class=c># Initializing disk.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskPartition</span>   <span class=c># Creating partition.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskFormat</span>      <span class=c># Formatting volume.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># DISK LIST.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskList</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s1>&#39;Disk List&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-Disk</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CLEAR DISK.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskClear</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Clear Disk&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;W&#39;</span> <span class=n>-A</span> <span class=s1>&#39;Inquire&#39;</span> <span class=n>-M</span> <span class=p>(</span><span class=s2>&#34;You specified drive number &#39;</span><span class=nv>${P_DiskNumber}</span><span class=s2>&#39;.</span><span class=nv>${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;All data will be DELETED!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Number</span> <span class=p>=</span> <span class=nv>$P_DiskNumber</span>
</span></span><span class=line><span class=cl>    <span class=n>RemoveData</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>RemoveOEM</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>Confirm</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Clear-Disk</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZE DISK.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskInit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Initialize Disk&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Number</span> <span class=p>=</span> <span class=nv>$P_DiskNumber</span>
</span></span><span class=line><span class=cl>    <span class=n>PartitionStyle</span> <span class=p>=</span> <span class=s1>&#39;GPT&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Initialize-Disk</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CREATE PARTITION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskPartition</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Create Partition&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DiskNumber</span> <span class=p>=</span> <span class=nv>$P_DiskNumber</span>
</span></span><span class=line><span class=cl>    <span class=n>DriveLetter</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${DriveLetter}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>UseMaximumSize</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-Partition</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># FORMAT DISK VOLUME.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskFormat</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Format Disk Volume (</span><span class=nv>${DriveLetter}</span><span class=s2> / </span><span class=nv>${P_FileSystem}</span><span class=s2>)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_FileSystem</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$P_FileSystem</span> <span class=p>=</span> <span class=s1>&#39;NTFS&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DriveLetter</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${DriveLetter}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>FileSystem</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${P_FileSystem}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>NewFileSystemLabel</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${FileSystemLabel}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Force</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Format-Volume</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ------------------------------------------------&lt; COMMON FUNCTIONS &gt;------------------------------------------------ #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># SYSTEM MESSAGES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Write-Msg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Continue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HL&#39;</span>    <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${NL}</span><span class=s2>--- </span><span class=nv>${Message}</span><span class=s2>&#34;</span><span class=p>.</span><span class=py>ToUpper</span><span class=p>()</span> <span class=n>-ForegroundColor</span> <span class=n>Blue</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I&#39;</span>     <span class=p>{</span> <span class=nb>Write-Information</span> <span class=n>-MessageData</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-InformationAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;W&#39;</span>     <span class=p>{</span> <span class=nb>Write-Warning</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-WarningAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;E&#39;</span>     <span class=p>{</span> <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/hdd/>#hdd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ssd/>#ssd</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-23T11:03:04Z data-fn=date-local>2023/10/23 11:03:04 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Сжатие видео при помощи FFmpeg" class=d-block href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e><picture><source srcset='https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Сжатие видео при помощи FFmpeg"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e>PowerShell: Сжатие видео при помощи FFmpeg</a></h2></div></header><div class=node-body><p>Когда то в далёкой далёкой галактике&mldr; Ко мне на работе обратились с просьбой как то уменьшить видео, записанное на камеру в формате <code>.mov</code>. Естественно, я воспользовался библиотекой FFmpeg. Но скрипт автоматизации решил написать только сейчас&mldr;</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Сжатие видео при помощи FFmpeg" class=d-block href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e><img class="d-block rounded" src="https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Сжатие видео при помощи FFmpeg"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e>PowerShell: Сжатие видео при помощи FFmpeg</a></h2></div></header><div class=node-body><p>Когда то в далёкой далёкой галактике&mldr; Ко мне на работе обратились с просьбой как то уменьшить видео, записанное на камеру в формате <code>.mov</code>. Естественно, я воспользовался библиотекой FFmpeg. Но скрипт автоматизации решил написать только сейчас&mldr;</p></div></div></article></div><div class="modal fade" id=modal-45eea9821cd138d37ad6ff1f9554ee6e tabindex=-1 aria-labelledby=modal-45eea9821cd138d37ad6ff1f9554ee6e-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-45eea9821cd138d37ad6ff1f9554ee6e-label><a href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/>PowerShell: Сжатие видео при помощи FFmpeg</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Когда то в далёкой далёкой галактике&mldr; Ко мне на работе обратились с просьбой как то уменьшить видео, записанное на камеру в формате <code>.mov</code>. Естественно, я воспользовался библиотекой FFmpeg. Но скрипт автоматизации решил написать только сейчас&mldr;</p><p>Скрипт прост как лапоть. Состоит из небольшого количества вводных параметров, большинство из которых изменять не требуется. Предназначен скрипт для быстрого пакетного конвертирования файлов видео из одного формата в другой, в основном, с целью уменьшения размера. Скрипт не предназначен для сложного редактирования видео!</p><h2>Параметры</h2><ul><li><code>-F</code> <code>-P_Files</code> - массив входящих файлов.</li><li><code>-CV</code> <code>-P_vCodec</code> - видео кодек, используемый для конвертации. По умолчанию: <code>libx265</code>. Поддерживаемые кодеки:<ul><li><code>'libx264'</code> - кодек &ldquo;H.264&rdquo;.</li><li><code>'libx265'</code> - кодек &ldquo;H.265&rdquo;.</li><li><code>'libvpx-vp9'</code> - кодек &ldquo;VP9&rdquo; (&ldquo;WebM&rdquo;).</li><li><code>'libaom-av1'</code> - кодек &ldquo;AV1&rdquo;.</li></ul></li><li><code>-CA</code> <code>-P_aCodec</code> - аудио кодек, используемый для конвертации. По умолчанию: <code>copy</code>. Поддерживаемые кодеки:<ul><li><code>'libfdk_aac'</code> - кодек &ldquo;Fraunhofer FDK AAC&rdquo;.</li><li><code>'aac'</code> - кодек &ldquo;FFmpeg AAC&rdquo;.</li><li><code>'libmp3lame'</code> - кодек &ldquo;FFmpeg MP3&rdquo;.</li></ul></li><li><code>-R</code> <code>-P_Framerate</code> - частота кадров выходящего файла (FPS). Сжатие кадров с учётом движения, где сцены движения кодируются с меньшим качеством, чем статичные сцены, что субъективно приводит к восприятию, как качественного, ибо визуально человек различает больше деталей в неподвижных объектах, чем в движущихся. Если параметр не указан, то значение берётся из входящего файла.</li><li><code>-C</code> <code>-P_CRF</code> - постоянный коэффициент потока (Constant Rate Factor). Это режим кодирования для кодеков &ldquo;H.264&rdquo; и &ldquo;H.265&rdquo; с постоянным воспринимаемым качеством, осуществляемый с помощью настройки качества (и управления скоростью). Если параметр не указан, то значение берётся по умолчанию, обычно это <code>28</code> при кодеке <code>libx265</code> и <code>23</code> при <code>libx264</code>.</li><li><code>-P</code> <code>-P_Preset</code> - пресеты. Это набор параметров, которые обеспечивают определённую скорость кодирования с степень сжатия. У каждого кодека видео свой набор пресетов. Нужно смотреть <a title href=https://trac.ffmpeg.org/wiki target=_blank rel="noopener noreferrer nofollow">документацию</a>.</li><li><code>-EXT</code> <code>-P_Extension</code> - расширение выходящих файлов.</li></ul><h2>Примеры</h2><p>Конвертировать файлы <code>file_01.mov</code>, <code>file_02.mov</code> и <code>file_03.mov</code> в формат <code>mp4</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-14da8eaffdf6967a698cf80f66b9d6ef role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-14da8eaffdf6967a698cf80f66b9d6ef><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>ffmpeg</span><span class=p>.</span><span class=py>video</span><span class=p>.</span><span class=py>compress</span><span class=p>.</span><span class=py>ps1</span> <span class=o>-F</span> <span class=s1>&#39;file_01.mov&#39;</span><span class=p>,</span> <span class=s1>&#39;file_02.mov&#39;</span><span class=p>,</span> <span class=s1>&#39;file_03.mov&#39;</span></span></span></code></pre></div></div></div></div><p>Пакетная конвертация всех файлов с расширением <code>.mov</code> в формат <code>mp4</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e072636f2ccb20c1f4aa9e797e3593b3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-e072636f2ccb20c1f4aa9e797e3593b3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>ffmpeg</span><span class=p>.</span><span class=py>video</span><span class=p>.</span><span class=py>compress</span><span class=p>.</span><span class=py>ps1</span> <span class=o>-F</span> <span class=s1>&#39;*.mov&#39;</span></span></span></code></pre></div></div></div></div><h2>Алгоритм работы</h2><p>Скрипт предназначен для быстрого пакетного преобразования файлов видео из одного формата в другой.</p><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для работы скрипта необходим файл <code>ffmpeg.exe</code>, архив которого можно скачать с сайта <a title href=https://www.gyan.dev/ffmpeg/builds/ target=_blank rel="noopener noreferrer nofollow">gyan.dev</a>, распаковать и разместить рядом с файлом скрипта или в любую дочернюю директорию. Скрипт сам найдёт файл <code>ffmpeg.exe</code> и начнёт его использовать.</p></div></div></div><h2>Скрипт</h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.ffmpeg.video.compress.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e863b8e7b6dd0876bdd67246e80500bd role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.ffmpeg.video.compress.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.ffmpeg.video.compress.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-e863b8e7b6dd0876bdd67246e80500bd><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.2
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         b95fb1ac-6878-4451-bb49-434d51d9555d
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Video compression script based on FFmpeg.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  FFmpeg is a free and open-source software project consisting of a suite of libraries and programs for handling video, audio, and other multimedia files and streams.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Files
</span></span></span><span class=line><span class=cl><span class=cm>  An array of input files.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_vCodec
</span></span></span><span class=line><span class=cl><span class=cm>  The video codec.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;libx265&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_aCodec
</span></span></span><span class=line><span class=cl><span class=cm>  The audio codec.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;copy&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Framerate
</span></span></span><span class=line><span class=cl><span class=cm>  FFmpeg can be used to change the frame rate of an existing video, such that the output frame rate is lower or higher than the input frame rate. The output duration of the video will stay the same.
</span></span></span><span class=line><span class=cl><span class=cm>  This is useful when working with, for example, high-framerate input video that needs to be temporally scaled down for devices that do not support high FPS.
</span></span></span><span class=line><span class=cl><span class=cm>  When the frame rate is changed, FFmpeg will drop or duplicate frames as necessary to achieve the targeted output frame rate.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_CRF
</span></span></span><span class=line><span class=cl><span class=cm>  Constant Rate Factor.
</span></span></span><span class=line><span class=cl><span class=cm>  Use this rate control mode if you want to keep the best quality and care less about the file size. This is the recommended rate control mode for most uses.
</span></span></span><span class=line><span class=cl><span class=cm>  This method allows the encoder to attempt to achieve a certain output quality for the whole file when output file size is of less importance. This provides maximum compression efficiency with a single pass. By adjusting the so-called quantizer for each frame, it gets the bitrate it needs to keep the requested quality level. The downside is that you can&#39;t tell it to get a specific filesize or not go over a specific size or bitrate, which means that this method is not recommended for encoding videos for streaming.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Preset
</span></span></span><span class=line><span class=cl><span class=cm>  A preset is a collection of options that will provide a certain encoding speed to compression ratio. A slower preset will provide better compression (compression is quality per filesize). This means that, for example, if you target a certain file size or constant bit rate, you will achieve better quality with a slower preset. Similarly, for constant quality encoding, you will simply save bitrate by choosing a slower preset.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Extension
</span></span></span><span class=line><span class=cl><span class=cm>  The extension of the resulting files.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;mp4&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.ffmpeg.video.compress.ps1 -F &#39;file_01.mov&#39;, &#39;file_02.mov&#39;, &#39;file_03.mov&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.ffmpeg.video.compress.ps1 -F &#39;*.mov&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>,</span> <span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;An array of input files.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$P_Files</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;The video codec.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;CV&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_vCodec</span> <span class=p>=</span> <span class=s1>&#39;libx265&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;The audio codec.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;CA&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_aCodec</span> <span class=p>=</span> <span class=s1>&#39;copy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;FFmpeg can be used to change the frame rate of an existing video, such that the output frame rate is lower or higher than the input frame rate.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;R&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Framerate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Constant Rate Factor. Use this rate control mode if you want to keep the best quality and care less about the file size.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_CRF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;A preset is a collection of options that will provide a certain encoding speed to compression ratio.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Preset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;The extension of the resulting files.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;EXT&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Extension</span> <span class=p>=</span> <span class=s1>&#39;mp4&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># New line separator.</span>
</span></span><span class=line><span class=cl><span class=nv>$NL</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>NewLine</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-CompressVideo</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># COMPRESS VIDEO.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-CompressVideo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${P_Files}</span><span class=s2>&#34;</span> <span class=o>-File</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$In</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Out</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nb>Join-Path</span> <span class=nv>$_</span><span class=p>.</span><span class=py>DirectoryName</span> <span class=nv>$_</span><span class=p>.</span><span class=n>BaseName</span><span class=p>)</span><span class=s2>.</span><span class=nv>${P_Extension}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Start-FFmpeg</span> <span class=n>-I</span> <span class=s2>&#34;</span><span class=nv>${In}</span><span class=s2>&#34;</span> <span class=n>-O</span> <span class=s2>&#34;</span><span class=nv>${Out}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ------------------------------------------------&lt; COMMON FUNCTIONS &gt;------------------------------------------------ #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># TESTING ELEMENTS.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Container&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Leaf&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-PathType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># APP: FFmpeg.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-FFmpeg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;I&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$In</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Out</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Search &#39;ffmpeg.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$FFmpegExe</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#34;</span> <span class=n>-Filter</span> <span class=s1>&#39;ffmpeg.exe&#39;</span> <span class=n>-Recurse</span> <span class=o>-File</span><span class=p>)</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-First</span> <span class=mf>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Checking the location of &#39;ffmpeg.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${FFmpegExe}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Warning</span> <span class=n>-WarningAction</span> <span class=s1>&#39;Stop&#39;</span> <span class=n>-Message</span> <span class=p>(</span><span class=s2>&#34;&#39;ffmpeg.exe&#39; not found!</span><span class=nv>${NL}${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1. Download FFmpeg from &#39;https://www.gyan.dev/ffmpeg/builds/&#39;.</span><span class=nv>${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2. Extract &#39;ffmpeg.exe&#39; into a directory &#39;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#39;.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Specifying &#39;ffmpeg.exe&#39; parameters.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-hide_banner&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-i&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${In}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-c:v&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_vCodec}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_CRF</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-crf&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_CRF}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_Preset</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-preset&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_Preset}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_Framerate</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-r&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_Framerate}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-c:a&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_aCodec}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${Out}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Running &#39;ffmpeg.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=nv>${FFmpegExe}</span><span class=s2>&#34;</span> <span class=nv>$Param</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ffmpeg/>#ffmpeg</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-22T14:06:44Z data-fn=date-local>2023/10/22 14:06:44 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Определение разрядности ОС Windows" class=d-block href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90><picture><source srcset='https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Определение разрядности ОС Windows"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90>PowerShell: Определение разрядности ОС Windows</a></h2></div></header><div class=node-body><p>Нашёл на Stack Overflow хорошую функцию по определению разрядности ОС и процесса PowerShell. Запишу, обязательно пригодится.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Определение разрядности ОС Windows" class=d-block href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90><img class="d-block rounded" src="https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Определение разрядности ОС Windows"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90>PowerShell: Определение разрядности ОС Windows</a></h2></div></header><div class=node-body><p>Нашёл на Stack Overflow хорошую функцию по определению разрядности ОС и процесса PowerShell. Запишу, обязательно пригодится.</p></div></div></article></div><div class="modal fade" id=modal-cc0003811a6de90b8d8fb55dc160ee90 tabindex=-1 aria-labelledby=modal-cc0003811a6de90b8d8fb55dc160ee90-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-cc0003811a6de90b8d8fb55dc160ee90-label><a href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/>PowerShell: Определение разрядности ОС Windows</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Нашёл на Stack Overflow хорошую функцию по определению разрядности ОС и процесса PowerShell. Запишу, обязательно пригодится.</p><h2>Разрядность ОС</h2><p>Разрядность ОС можно определить следующей функцией:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9a2850a4d9c0b2c07c4cb325a5141bbc><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-Architecture</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># What bitness does Windows use.</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>Is64BitOperatingSystem</span><span class=p>)</span> <span class=p>{</span> <span class=c># Needs &#39;.NET 4&#39;.</span>
</span></span><span class=line><span class=cl>    <span class=vm>$true</span>   <span class=p>{</span> <span class=mf>64</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=vm>$false</span>  <span class=p>{</span> <span class=mf>32</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_OperatingSystem</span><span class=p>).</span><span class=py>OSArchitecture</span> <span class=o>-replace</span> <span class=s1>&#39;\D&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># Or do any of these:</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_ComputerSystem).SystemType -replace &#39;\D&#39; -replace &#39;86&#39;, &#39;32&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_Processor).AddressWidth # This is slow...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9a2850a4d9c0b2c07c4cb325a5141bbc role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Можно записать эту функцию в файл и запустить файл в терминале, или же внедрить в крупный проект и вызывать по имени <code>Get-Architecture</code>.</p><h3>Результат</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-06236d14a6571539b2923d5bc3c7892f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-06236d14a6571539b2923d5bc3c7892f><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>arch</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl><span class=mf>64</span></span></span></code></pre></div></div></div></div><h2>Разрядность ОС и PowerShell</h2><p>Расширенная версия, которая позволяет определить разрядность ОС и процесса PowerShell, под которым выполняется функция.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-cc672ddbd362256727aa0f1dcbac6641><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-Architecture</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># What bitness does Windows use.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$windowsBitness</span> <span class=p>=</span> <span class=k>switch</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>Is64BitOperatingSystem</span><span class=p>)</span> <span class=p>{</span> <span class=c># Needs &#39;.NET 4&#39;.</span>
</span></span><span class=line><span class=cl>    <span class=vm>$true</span>   <span class=p>{</span> <span class=mf>64</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=vm>$false</span>  <span class=p>{</span> <span class=mf>32</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_OperatingSystem</span><span class=p>).</span><span class=py>OSArchitecture</span> <span class=o>-replace</span> <span class=s1>&#39;\D&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># Or do any of these:</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_ComputerSystem).SystemType -replace &#39;\D&#39; -replace &#39;86&#39;, &#39;32&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_Processor).AddressWidth # Slow...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># What bitness does this PowerShell process use.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$processBitness</span> <span class=p>=</span> <span class=p>[</span><span class=no>IntPtr</span><span class=p>]::</span><span class=n>Size</span> <span class=p>*</span> <span class=mf>8</span>
</span></span><span class=line><span class=cl>  <span class=c># Or do any of these:</span>
</span></span><span class=line><span class=cl>  <span class=c># $processBitness = $env:PROCESSOR_ARCHITECTURE -replace &#39;\D&#39; -replace &#39;86|ARM&#39;, &#39;32&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c># $processBitness = if ([Environment]::Is64BitProcess) { 64 } else { 32 }</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Return the info as object.</span>
</span></span><span class=line><span class=cl>  <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>PSObject</span> <span class=n>-Property</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;ProcessArchitecture&#39;</span> <span class=p>=</span> <span class=s2>&#34;{0} bit&#34;</span> <span class=o>-f</span> <span class=nv>$processBitness</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;WindowsArchitecture&#39;</span> <span class=p>=</span> <span class=s2>&#34;{0} bit&#34;</span> <span class=o>-f</span> <span class=nv>$windowsBitness</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cc672ddbd362256727aa0f1dcbac6641 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Можно записать эту функцию в файл и запустить файл в терминале, или же внедрить в крупный проект и вызывать по имени <code>Get-Architecture</code>.</p><h3>Результат</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-52731182b6127c94ab71943c66259537 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-52731182b6127c94ab71943c66259537><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>arch</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ProcessArchitecture</span> <span class=n>WindowsArchitecture</span>
</span></span><span class=line><span class=cl><span class=p>-------------------</span> <span class=p>-------------------</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bit</span>              <span class=mf>64</span> <span class=n>bit</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-21T17:42:05Z data-fn=date-local>2023/10/21 17:42:05 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell Vault" class=d-block href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da><picture><source srcset='https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell Vault"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da>PowerShell Vault</a></h2></div></header><div class=node-body><p>На работе в локальной сети использовалась задача, которая перемещала старые, по долгу не использовавшиеся, файлы из главного файлового хранилища в резервное. Но так как организация являлась проектной, то старые файлы могли понадобиться в любое время.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell Vault" class=d-block href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da><img class="d-block rounded" src="https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell Vault"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da>PowerShell Vault</a></h2></div></header><div class=node-body><p>На работе в локальной сети использовалась задача, которая перемещала старые, по долгу не использовавшиеся, файлы из главного файлового хранилища в резервное. Но так как организация являлась проектной, то старые файлы могли понадобиться в любое время.</p></div></div></article></div><div class="modal fade" id=modal-7211caa07067ed9fd33cc9db16b800da tabindex=-1 aria-labelledby=modal-7211caa07067ed9fd33cc9db16b800da-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-7211caa07067ed9fd33cc9db16b800da-label><a href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/>PowerShell Vault</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>На работе в локальной сети использовалась задача, которая перемещала старые, по долгу не использовавшиеся, файлы из главного файлового хранилища в резервное. Но так как организация являлась проектной, то старые файлы могли понадобиться в любое время.</p><p>Задача использовала простой скрипт с фильтрацией файлов по параметрам <em>время создания</em> и <em>время изменения</em>. Я чуть доработали скрипт и решил опубликовать его для других администраторов. Вдруг, пригодится. Только перед использованием прошу проверить скрипт в какой-нибудь песочнице.</p><div class="shortcode shortcode-alert"><div class="alert alert-danger d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-circle-radiation fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Есть вероятность, что скрипт удалит все файлы в вашем файловом хранилище, из-за того, что автор может оказаться <em>рукожопом</em>! Поэтому, перед боевой задачей, проверьте скрипт в какой-нибудь песочнице. А кто хорошо разбирается в PowerShell - автор будет благодарен за оптимизацию и корректировку скрипта.</p></div></div></div><h2>Параметры</h2><ul><li><code>-M</code> <code>-P_Mode</code> - режим работы скрипта. По умолчанию <code>'MV'</code>.<ul><li><code>'CP'</code> - копировать файлы из источника в хранилище.</li><li><code>'MV'</code> - перемещать файлы из источника в хранилище.</li><li><code>'RM'</code> - только удалять файлы из источника без копирования или перемещения куда-либо.</li></ul></li><li><code>-SRC</code> <code>-P_Source</code> - путь к директории откуда перемещать файлы. Например, <code>-SRC 'C:\Data\Source'</code>. По умолчанию: <code>${PSScriptRoot}\Source</code>.</li><li><code>-DST</code> <code>-P_Vault</code> - путь к директории куда перемещать файлы. Например, <code>-DST 'C:\Data\Vault'</code>. По умолчанию: <code>${PSScriptRoot}\Vault</code>.</li><li><code>-CT</code> <code>-P_CreationTime</code> - время создания файла в секундах. Например, <code>-CT 5270400</code>. По умолчанию: <code>5270400</code> (61 день).</li><li><code>-WT</code> <code>-P_LastWriteTime</code> - время изменения файла в секундах. Например, <code>-WT 5270400</code>. По умолчанию: <code>${P_CreationTime}</code>.</li><li><code>-FS</code> <code>-P_FileSize</code> - размер файла. Например, <code>-FS '5kb'</code> или <code>-FS '12mb'</code>. По умолчанию: <code>'0kb'</code>.</li><li><code>-E</code> <code>-P_Exclude</code> - путь к файлу с исключениями. Например, <code>-E 'C:\Data\exclude.txt'</code>. По умолчанию: <code>${PSScriptRoot}\vault.exclude.txt</code>.</li><li><code>-L</code> <code>-P_Logs</code> - путь к директории с журналами работы скрипта. Например, <code>-L 'C:\Data\Logs'</code>. По умолчанию: <code>${PSScriptRoot}\Logs</code>.</li><li><code>-RD</code> <code>-P_RemoveDirs</code> - удалять пустые каталоги.</li><li><code>-O</code> <code>-P_Overwrite</code> - перезаписать файлы в Vault.</li></ul><h2>Примеры</h2><p>Запустить перемещение файлов из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f637221f16999903587ea237af16d4ed role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-f637221f16999903587ea237af16d4ed><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span></span></span></code></pre></div></div></div></div><p>Запустить перемещение файлов с временем создания и изменения от 10 дней (<code>864000</code>) из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-20694ffc4d7da3b601347df642d4906e role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-20694ffc4d7da3b601347df642d4906e><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span> <span class=n>-CT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-WT</span> <span class=s1>&#39;864000&#39;</span></span></span></code></pre></div></div></div></div><p>Запустить перемещение файлов с временем создания и изменения от 10 дней (<code>864000</code>) и размером более 32 мегабайта (<code>32mb</code>) из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9f0165fb948016240f049da4c130a431 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-9f0165fb948016240f049da4c130a431><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span> <span class=n>-CT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-WT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-FS</span> <span class=s1>&#39;32mb&#39;</span></span></span></code></pre></div></div></div></div><p>Запустить перемещение файлов с временем создания и изменения от 10 дней (<code>864000</code>), и с перезаписью файлов с одинаковыми названиями (<code>-O</code>) из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-83f92153fb68a95295d768fdeada991b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-83f92153fb68a95295d768fdeada991b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span> <span class=n>-CT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-WT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-O</span></span></span></code></pre></div></div></div></div><p>Параметр <code>-O</code> означает, что не нужно архивировать старый файл при перемещении нового с таким же названием. Старый файл в хранилище перезапишется новым.</p><h2>Алгоритм работы</h2><p>Скрипт создаёт хранилище старых файлов. Это, своего рода, аналог резервного копирования. При перемещении файлов из источника в хранилище, скрипт обрабатывает несколько заданных параметров и фильтров. Всё настроить можно под себя. По умолчанию, скрипт перемещает файлы из источника в хранилище, и если в хранилище уже имеется старый файл с названием кау у нового перемещаемого, то старый файл архивируется с меткой <code>.[UnixTime].7z</code>.</p><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для работы скрипта необходим архиватор <strong>7-Zip</strong>, а конкретно его облегчённая версия <code>7za.exe</code> с библиотеками из <strong>7-Zip Extra</strong>. Скачать можно с <a title href=https://www.7-zip.org/download.html target=_blank rel="noopener noreferrer nofollow">официального сайта</a>. После скачивания архива, файлы <code>7za.exe</code>, <code>7za.dll</code> и <code>7zxa.dll</code> нужно разместить рядом со скриптом, или в любую дочернюю директорию. Скрипт сам найдёт путь к <code>7za.exe</code>.</p></div></div></div><h2>Скрипт</h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.vault.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-964e551712cd9b58383c6fae161a200d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.vault.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.vault.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-964e551712cd9b58383c6fae161a200d><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.4
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         8fd0ce2c-0288-4d9c-805f-703a0c659ade
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/posts/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  PowerShell &#34;Vault&#34;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script moves files to Vault based on various criteria.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Mode
</span></span></span><span class=line><span class=cl><span class=cm>  Script operation mode.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;MV&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Source
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the source. E.g.: &#39;C:\Data\Source&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\Source&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Vault
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the Vault. E.g.: &#39;C:\Data\Vault&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\Vault&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_CreationTime
</span></span></span><span class=line><span class=cl><span class=cm>  Time since file creation (in seconds). E.g.: &#39;5270400&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;5270400&#39; (61 day).
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_LastWriteTime
</span></span></span><span class=line><span class=cl><span class=cm>  Time since file modification (in seconds). E.g.: &#39;5270400&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${P_CreationTime}&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_FileSize
</span></span></span><span class=line><span class=cl><span class=cm>  File size check. E.g.: &#39;5kb&#39; / &#39;12mb&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;0kb&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Exclude
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the file with exceptions. E.g.: &#39;C:\Data\exclude.txt&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\vault.exclude.txt&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Logs
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the directory with logs. E.g.: &#39;C:\Data\Logs&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\Logs&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_RemoveDirs
</span></span></span><span class=line><span class=cl><span class=cm>  Removing empty directories.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;false&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Overwrite
</span></span></span><span class=line><span class=cl><span class=cm>  Overwrite existing files in Vault.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;false&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.vault.ps1 -SRC &#39;C:\Data&#39; -DST &#39;C:\Vault&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.vault.ps1 -SRC &#39;C:\Data&#39; -DST &#39;C:\Vault&#39; -CT &#39;864000&#39; -WT &#39;864000&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.vault.ps1 -SRC &#39;C:\Data&#39; -DST &#39;C:\Vault&#39; -CT &#39;864000&#39; -WT &#39;864000&#39; -FS &#39;32mb&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/posts/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Script operation mode. Default: &#39;MV&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;CP&#39;</span><span class=p>,</span> <span class=s1>&#39;MV&#39;</span><span class=p>,</span> <span class=s1>&#39;RM&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Mode</span> <span class=p>=</span> <span class=s1>&#39;MV&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the source. E.g.: &#39;C:\Data\Source&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;SRC&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Source</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\Source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the Vault. E.g.: &#39;C:\Data\Vault&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DST&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Vault</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\Vault&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Time since file creation (in seconds). E.g.: &#39;5270400&#39;. Default: 61 day (5270400 sec.).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;CT&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$P_CreationTime</span> <span class=p>=</span> <span class=mf>5270400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Time since file modification (in seconds). E.g.: &#39;5270400&#39;. Default: 61 day (&#39;5270400&#39; sec.).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;WT&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$P_LastWriteTime</span> <span class=p>=</span> <span class=nv>$P_CreationTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;File size check. E.g.: &#39;5kb&#39; / &#39;12mb&#39;. Default: &#39;0kb&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;FS&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_FileSize</span> <span class=p>=</span> <span class=s1>&#39;0kb&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the file with exceptions. E.g.: &#39;C:\Data\exclude.txt&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;E&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Exclude</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\vault.exclude.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the directory with logs. E.g.: &#39;C:\Data\Logs&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Logs</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\Logs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Removing empty directories.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;RD&#39;</span><span class=p>)][</span><span class=no>switch</span><span class=p>]</span><span class=nv>$P_RemoveDirs</span> <span class=p>=</span> <span class=vm>$false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Overwrite existing files in Vault.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>)][</span><span class=no>switch</span><span class=p>]</span><span class=nv>$P_Overwrite</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Timestamp.</span>
</span></span><span class=line><span class=cl><span class=nv>$TS</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nb>Get-Date</span> <span class=n>-Format</span> <span class=s1>&#39;yyyy-MM-dd.HH-mm-ss&#39;</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$UTS</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>DateTimeOffset</span><span class=p>]::</span><span class=n>Now</span><span class=p>.</span><span class=py>ToUnixTimeSeconds</span><span class=p>())</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># New line separator.</span>
</span></span><span class=line><span class=cl><span class=nv>$NL</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>NewLine</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-TestVault</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-MoveFiles</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_RemoveDirs</span><span class=p>)</span> <span class=p>{</span> <span class=nb>Start-RemoveDirs</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CREATING VAULT DIRECTORIES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-TestVault</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Dirs</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${P_Source}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_Vault}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${P_Exclude}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$Dir</span> <span class=k>in</span> <span class=nv>$Dirs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Dir}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span> <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Dir}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$File</span> <span class=k>in</span> <span class=nv>$Files</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span> <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># MOVING FILES TO VAULT.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-MoveFiles</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s1>&#39;Moving Files to Vault&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${P_Source}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span> <span class=n>-Exclude</span> <span class=p>(</span><span class=nb>Get-Content</span> <span class=s2>&#34;</span><span class=nv>${P_Exclude}</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>CreationTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_CreationTime</span><span class=p>)))</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>      <span class=o>-and</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>LastWriteTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_LastWriteTime</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>(</span><span class=nv>$_</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span> <span class=o>-ge</span> <span class=s2>&#34;</span><span class=nv>${P_FileSize}</span><span class=s2>&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$Files</span><span class=p>)</span> <span class=p>{</span> <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;Required files were not found in the &#39;</span><span class=nv>${P_Source}</span><span class=s2>&#39;!&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$File</span> <span class=p>=</span> <span class=nv>$_</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=nv>$File</span><span class=p>.</span><span class=py>FullName</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span> <span class=o>-ge</span> <span class=mf>245</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;W&#39;</span> <span class=n>-M</span> <span class=s2>&#34;Over 250 characters in path! Skip:</span><span class=nv>${NL}</span><span class=s2>&#39;</span><span class=nv>${File}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$PathSRC</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$File</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>$PathDST</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$File</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$File</span><span class=p>.</span><span class=n>DirectoryName</span><span class=p>)</span><span class=s2>&#34;</span><span class=p>).</span><span class=k>ForEach</span><span class=p>({</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Remove</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span> <span class=nv>$P_Source</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span> <span class=p>=</span> <span class=p>(${</span><span class=n>P_Vault</span><span class=p>}</span> <span class=p>|</span> <span class=nb>Join-Path</span> <span class=n>-ChildPath</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$P_Mode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;CP&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${P_Vault}</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>1</span><span class=p>])</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl>        <span class=nb>Compress-Data</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>.</span><span class=nv>${UTS}</span><span class=s2>.7z&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[CP] &#39;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39; -&gt; &#39;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Copy-Data</span> <span class=n>-S</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-D</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;MV&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${P_Vault}</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>1</span><span class=p>])</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl>        <span class=nb>Compress-Data</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>.</span><span class=nv>${UTS}</span><span class=s2>.7z&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[MV] &#39;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39; -&gt; &#39;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Move-Data</span> <span class=n>-S</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-D</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;RM&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[RM] &#39;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Remove-Data</span> <span class=n>-p</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># REMOVING EMPTY DIRECTORIES FROM SOURCE.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RemoveDirs</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s1>&#39;Removing Empty Directories&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Dirs</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${P_Source}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=n>-Directory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>CreationTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_CreationTime</span><span class=p>)))</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>        <span class=o>-and</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>LastWriteTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_LastWriteTime</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=nv>$_</span><span class=p>.</span><span class=py>FullName</span> <span class=n>-Force</span><span class=p>).</span><span class=n>Count</span><span class=p>)</span> <span class=o>-eq</span> <span class=mf>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=s1>&#39;FullName&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$Dirs</span><span class=p>)</span> <span class=p>{</span> <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;No empty directories were found in the &#39;</span><span class=nv>${P_Source}</span><span class=s2>&#39;!&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$Dirs</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nv>$Dir</span> <span class=p>=</span> <span class=nv>$_</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[RM] &#39;</span><span class=nv>${Dir}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=nb>Remove-Data</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Dir}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>while</span> <span class=p>(</span> <span class=nv>$Dirs</span><span class=p>.</span><span class=py>Count</span> <span class=o>-gt</span> <span class=mf>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ------------------------------------------------&lt; COMMON FUNCTIONS &gt;------------------------------------------------ #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># WORKING WITH ELEMENTS.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Container&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Leaf&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-PathType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>New-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;SilentlyContinue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Directory&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;File&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-Item</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span> <span class=n>-ItemType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Copy-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Src</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;D&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Dst</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Copy-Item</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Src}</span><span class=s2>&#34;</span> <span class=n>-Destination</span> <span class=s2>&#34;</span><span class=nv>${Dst}</span><span class=s2>&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Move-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Src</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;D&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Dst</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Move-Item</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Src}</span><span class=s2>&#34;</span> <span class=n>-Destination</span> <span class=s2>&#34;</span><span class=nv>${Dst}</span><span class=s2>&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Remove-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Remove-Item</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Compress-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_Overwrite</span> <span class=o>-and</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Start</span><span class=p>-</span><span class=n>7z</span> <span class=n>-T</span> <span class=s1>&#39;7z&#39;</span> <span class=n>-L</span> <span class=mf>9</span> <span class=n>-I</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-O</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># SYSTEM MESSAGES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Write-Msg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Continue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HL&#39;</span>    <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${NL}</span><span class=s2>--- </span><span class=nv>${Message}</span><span class=s2>&#34;</span><span class=p>.</span><span class=py>ToUpper</span><span class=p>()</span> <span class=n>-ForegroundColor</span> <span class=n>Blue</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I&#39;</span>     <span class=p>{</span> <span class=nb>Write-Information</span> <span class=n>-MessageData</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-InformationAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;W&#39;</span>     <span class=p>{</span> <span class=nb>Write-Warning</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-WarningAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;E&#39;</span>     <span class=p>{</span> <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># APP: 7-ZIP.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-7z</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;I&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$In</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Out</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;7z&#39;</span><span class=p>,</span> <span class=s1>&#39;BZIP2&#39;</span><span class=p>,</span> <span class=s1>&#39;GZIP&#39;</span><span class=p>,</span> <span class=s1>&#39;TAR&#39;</span><span class=p>,</span> <span class=s1>&#39;WIM&#39;</span><span class=p>,</span> <span class=s1>&#39;XZ&#39;</span><span class=p>,</span> <span class=s1>&#39;ZIP&#39;</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;7z&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateRange</span><span class=p>(</span><span class=mf>1</span><span class=p>,</span><span class=mf>9</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$Level</span> <span class=p>=</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># File list for &#39;7za.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$7z</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;7za.exe&#39;</span><span class=p>,</span> <span class=s1>&#39;7za.dll&#39;</span><span class=p>,</span> <span class=s1>&#39;7zxa.dll&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Search &#39;7za.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$7zExe</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#34;</span> <span class=n>-Filter</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$7z</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span><span class=p>)</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-First</span> <span class=mf>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Getting &#39;7za.exe&#39; directory.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$7zDir</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$7zExe</span><span class=p>.</span><span class=n>DirectoryName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Checking the location of files.</span>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$File</span> <span class=k>in</span> <span class=nv>$7z</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${7zDir}</span><span class=s2>\</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;W&#39;</span> <span class=n>-A</span> <span class=s1>&#39;Stop&#39;</span> <span class=n>-M</span> <span class=p>(</span><span class=s2>&#34;&#39;</span><span class=nv>${File}</span><span class=s2>&#39; not found!</span><span class=nv>${NL}${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;1. Download 7-Zip Extra from &#39;https://www.7-zip.org/download.html&#39;.</span><span class=nv>${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;2. Extract all the contents of the archive into a directory &#39;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#39;.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Specifying &#39;7za.exe&#39; parameters.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Params</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s2>&#34;-t</span><span class=nv>${Type}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;-mx</span><span class=nv>${Level}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${Out}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${In}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Running &#39;7za.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=nv>${7zExe}</span><span class=s2>&#34;</span> <span class=nv>$Params</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Transcript</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${P_Logs}</span><span class=s2>\</span><span class=p>$((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=n>Year</span><span class=p>)</span><span class=s2>\</span><span class=p>$((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=n>Month</span><span class=p>)</span><span class=s2>\</span><span class=nv>${TS}</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span>
</span></span><span class=line><span class=cl><span class=nb>Stop-Transcript</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-20T09:57:21Z data-fn=date-local>2023/10/20 09:57:21 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Дефрагментация в ОС Windows" class=d-block href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c><picture><source srcset='https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Дефрагментация в ОС Windows"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c>Дефрагментация в ОС Windows</a></h2></div></header><div class=node-body><p>При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация HDD.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Дефрагментация в ОС Windows" class=d-block href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c><img class="d-block rounded" src="https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Дефрагментация в ОС Windows"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c>Дефрагментация в ОС Windows</a></h2></div></header><div class=node-body><p>При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация HDD.</p></div></div></article></div><div class="modal fade" id=modal-7ee46f5afcb8efcf647b56ad0cfd905c tabindex=-1 aria-labelledby=modal-7ee46f5afcb8efcf647b56ad0cfd905c-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-7ee46f5afcb8efcf647b56ad0cfd905c-label><a href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/>Дефрагментация в ОС Windows</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация HDD.</p><h2>PowerShell</h2><p>Командлет по дефрагментации для PowerShell называется <code>Optimize-Volume</code> и может принимать следующие параметры:</p><ul><li><code>-Analyze</code> - выполнение анализа указанного тома.</li><li><code>-Defrag</code> - выполнение дефрагментации указанного тома.</li><li><code>-DriveLetter</code> - буква тома.</li><li><code>-NormalPriority</code> - выполнение процесса с нормальным приоритетом (по умолчанию приоритет пониженный).</li><li><code>-ReTrim</code> - выполнение TRIM-операции для SSD.</li></ul><p>Это наиболее востребованные параметры. Остальные параметры можно посмотреть в <a title href=https://learn.microsoft.com/en-us/powershell/module/storage/optimize-volume target=_blank rel="noopener noreferrer nofollow">официальной документации</a>.</p><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для всех команд можно добавить параметр <code>-Verbose</code>, который выводит подробную информацию о происходящем процессе.</p></div></div></div><h3>Анализ тома</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-d845364307808a9ac282c1b2dd4afc5f><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Optimize-Volume</span> <span class=n>-DriveLetter</span> <span class=n>C</span> <span class=n>-Analyze</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d845364307808a9ac282c1b2dd4afc5f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-DriveLetter C</code> - буква тома (диск C:).</li><li><code>-Analyze</code> - анализ.</li></ul><h3>Дефрагментация</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1ef66374ebac3978f0a653c926fac063><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Optimize-Volume</span> <span class=n>-DriveLetter</span> <span class=n>C</span> <span class=n>-Defrag</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1ef66374ebac3978f0a653c926fac063 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-DriveLetter C</code> - буква тома (диск C:).</li><li><code>-Defrag</code> - дефрагментация.</li></ul><h3>TRIM-операция для SSD</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-d989c65b88d18c064974096645415014><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Optimize-Volume</span> <span class=n>-DriveLetter</span> <span class=n>C</span> <span class=n>-ReTrim</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d989c65b88d18c064974096645415014 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-DriveLetter C</code> - буква тома (диск C:).</li><li><code>-ReTrim</code> - на дисках SSD запускает TRIM-операцию.</li></ul><h2>CMD Defrag</h2><p>Утилита <code>defrag.exe</code> выполняет анализ и оптимизацию томов через командную строку. Утилита может принимать следующие параметры:</p><ul><li>Тома:<ul><li><code>/c</code> - выполнение операции на всех томах.</li><li><code>/e</code> - выполнение операции на всех томах, кроме указанных.</li></ul></li><li>Операции:<ul><li><code>/a</code> - анализ указанных томов.</li><li><code>/d</code> - выполнение традиционной дефрагментации (по умолчанию). На многоуровневом томе традиционная дефрагментация выполняется только на уровне ёмкости.</li><li><code>/l</code> - выполнение TRIM-операции для SSD.</li><li><code>/o</code> - выполнение правильной оптимизации для каждого типа носителя.</li><li><code>/u</code> - отображение хода операции.</li></ul></li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для всех команд можно добавить параметр <code>/v</code>, который выводит подробную информацию о происходящем процессе.</p></div></div></div><h3>Анализ тома</h3><p>Анализ тома, с отображением хода выполнения и выводом результатов в подробном формате:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-c0c43ef1fa4c031588b5f63e8c9addb1><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag c: /u /a</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c0c43ef1fa4c031588b5f63e8c9addb1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>c:</code> - буква тома (диск <code>C:</code>).</li><li><code>/u</code> - отображение хода выполнения операции.</li><li><code>/a</code> - анализ.</li></ul><h3>Параллельная дефрагментация</h3><p>Параллельная дефрагментация томов <code>C:</code> и <code>D:</code> в фоновом режиме:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-02dae5acc3d6afec69c3ca543e1b17d0><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag c: d: /m</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-02dae5acc3d6afec69c3ca543e1b17d0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>c:</code> - буква тома (диск <code>C:</code>).</li><li><code>d:</code> - буква тома (диск <code>D:</code>).</li><li><code>/m</code> - выполнение операции с каждым томом параллельно в фоновом режиме.</li></ul><h3>Дефрагментация всех томах</h3><p>Выполнить дефрагментацию на всех локальных томах с нормальным приоритетом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-098b3923a24ae957e82eeea2cd9fb25c><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag /u /c /h</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-098b3923a24ae957e82eeea2cd9fb25c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>/u</code> - отображение хода выполнения операции.</li><li><code>/c</code> - выполнение операции на всех томах.</li><li><code>/h</code> - выполнение операции с нормальным приоритетом (по умолчанию приоритет пониженный).</li></ul><h3>TRIM-операция для SSD</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1abfc5e53425ee7dbe5507fcab4fb800><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag /u /c /l</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1abfc5e53425ee7dbe5507fcab4fb800 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>/u</code> - отображение хода выполнения операции.</li><li><code>/c</code> - выполнение операции на всех томах.</li><li><code>/l</code> или <code>/retrim</code> - на дисках SSD запускает TRIM-операцию.</li></ul></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/hdd/>#hdd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ssd/>#ssd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/cmd/>#cmd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/defrag/>#defrag</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-20T00:46:16Z data-fn=date-local>2023/10/20 00:46:16 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Создание сертификатов через OpenSSL" class=d-block href=/ru/articles/2023/10/6733cb51-62a0-5ed9-b421-8f08c4e0cb18/ data-bs-toggle=modal data-bs-target=#modal-10c1210fd18cd5807997de1b035101f3><picture><source srcset='https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Создание сертификатов через OpenSSL"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/6733cb51-62a0-5ed9-b421-8f08c4e0cb18/ data-bs-toggle=modal data-bs-target=#modal-10c1210fd18cd5807997de1b035101f3>Создание сертификатов через OpenSSL</a></h2></div></header><div class=node-body><p>OpenSSL является библиотекой по работе с криптографией, но в этой статье я затрону только часть функций этого инструмента, а именно создание само-подписанных сертификатов.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Создание сертификатов через OpenSSL" class=d-block href=/ru/articles/2023/10/6733cb51-62a0-5ed9-b421-8f08c4e0cb18/ data-bs-toggle=modal data-bs-target=#modal-10c1210fd18cd5807997de1b035101f3><img class="d-block rounded" src="https://images.unsplash.com/photo-1568057373189-8bf0cf6179e6?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Создание сертификатов через OpenSSL"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/6733cb51-62a0-5ed9-b421-8f08c4e0cb18/ data-bs-toggle=modal data-bs-target=#modal-10c1210fd18cd5807997de1b035101f3>Создание сертификатов через OpenSSL</a></h2></div></header><div class=node-body><p>OpenSSL является библиотекой по работе с криптографией, но в этой статье я затрону только часть функций этого инструмента, а именно создание само-подписанных сертификатов.</p></div></div></article></div><div class="modal fade" id=modal-10c1210fd18cd5807997de1b035101f3 tabindex=-1 aria-labelledby=modal-10c1210fd18cd5807997de1b035101f3-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-10c1210fd18cd5807997de1b035101f3-label><a href=/ru/articles/2023/10/6733cb51-62a0-5ed9-b421-8f08c4e0cb18/>Создание сертификатов через OpenSSL</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>OpenSSL является библиотекой по работе с криптографией, но в этой статье я затрону только часть функций этого инструмента, а именно создание само-подписанных сертификатов.</p><h2>Создание центра сертификации</h2><p>При помощи корневого сертификата, мы будем подписывать сертификаты клиентские. Создаём сертификат центра сертификации&mldr;</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9ea65b5d55b73c118f83e628b24880ea><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl req -x509 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -newkey ec:&lt;<span class=o>(</span> openssl ecparam -name <span class=s1>&#39;secp384r1&#39;</span> <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -nodes -days <span class=s1>&#39;3650&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -keyform <span class=s1>&#39;PEM&#39;</span> -outform <span class=s1>&#39;PEM&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -keyout <span class=s1>&#39;ca.root.key&#39;</span> -out <span class=s1>&#39;ca.root.crt&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9ea65b5d55b73c118f83e628b24880ea role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-days '3650'</code> - количество дней, по прошествии которого сертификат центра сертификации станет недействительным.</li><li><code>-keyout 'ca.root.key'</code> - название создаваемого файла с ключом центра сертификации.</li><li><code>-out 'ca.root.crt'</code> - название создаваемого файла с сертификатом центра сертификации.</li></ul><h2>Создание клиентского сертификата</h2><p>Как только будет готов корневой сертификат, можно приступать к выпуску клиентских сертификатов.</p><h3>Создание приватного ключа</h3><p>Для начала создаём приватный ключ.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-82de4b72b62c52349e9cc9bbe38e1900><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl ecparam -name <span class=s1>&#39;prime256v1&#39;</span> -genkey -noout -out <span class=s1>&#39;client.key.private.pem&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-82de4b72b62c52349e9cc9bbe38e1900 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-out 'client.key.private.pem'</code> - название создаваемого файла с клиентским приватным ключом.</li></ul><h3>Создание публичного ключа</h3><p>Создание публичного ключа будет не лишним.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-fb6682eb27651f5d328011a21bfdc75e><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl ec -in <span class=s1>&#39;client.key.private.pem&#39;</span> -pubout -out <span class=s1>&#39;client.key.public.pem&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-fb6682eb27651f5d328011a21bfdc75e role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-in 'client.key.private.pem'</code> - файл c клиентским приватным ключом.</li><li><code>-out 'client.key.public.pem'</code> - название создаваемого файла с клиентским публичным ключом.</li></ul><h3>Создание запроса на подпись сертификата</h3><p>Выполняем запрос на сертификат.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-727a29135e1369b2cac820096264e3c9><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl req -new -key <span class=s1>&#39;client.key.private.pem&#39;</span> -out <span class=s1>&#39;client.csr&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-727a29135e1369b2cac820096264e3c9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-key 'client.key.private.pem'</code> - файл с приватным ключом клиентского сертификата.</li><li><code>-out 'client.csr'</code> - название создаваемого файла с запросом на подпись клиентского сертификата.</li></ul><p>При выполнении запроса будет предложено ввести актуальные данные для будущего сертификата:</p><ul><li><code>Country Name (2 letter code)</code> - двухбуквенный код страны, в которой юридически находится ваша организация.</li><li><code>State or Province Name (full name)</code> - штат или провинция, в которой юридически находится ваша организация.</li><li><code>Locality Name (e.g., city)</code> - город, в котором юридически находится ваша организация.</li><li><code>Organization Name (e.g., company)</code> - юридически зарегистрированное название вашей организации.</li><li><code>Organizational Unit Name (e.g., section)</code> - название вашего отдела в организации (опционально).</li><li><code>Common Name (e.g., server FQDN)</code> - полное доменное имя (FQDN) (например, <a title href=https://www.example.com target=_blank rel="noopener noreferrer nofollow">www.example.com</a>).</li><li><code>Email Address</code> - ваш адрес email (опционально).</li><li><code>A challenge password</code> - пароль (опционально).</li><li><code>An optional company name</code> - необязательное название компании (опционально).</li></ul><p>Самое главное поле это <code>Common Name (e.g., server FQDN)</code> (<code>CN</code>), заполнять его необходимо очень внимательно.</p><h3>Создание и подпись сертификата</h3><p>В заключительной части остаётся только создать сам сертификат и подписать его.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-b2de733507738e7346961b4905b33392><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl x509 -req -in <span class=s1>&#39;client.csr&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -CA <span class=s1>&#39;ca.crt&#39;</span> -CAkey <span class=s1>&#39;ca.key&#39;</span> -days <span class=s1>&#39;3650&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -outform <span class=s1>&#39;PEM&#39;</span> -out <span class=s1>&#39;client.crt&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b2de733507738e7346961b4905b33392 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-in 'client.csr'</code> - файл с запросом клиентского сертификата.</li><li><code>-CA 'ca.crt'</code> - файл с сертификатом центра сертификации.</li><li><code>-CAkey 'ca.key'</code> - файл с ключом центра сертификации.</li><li><code>-days '3650'</code> - количество дней, по прошествии которого клиентский сертификат станет недействительным.</li><li><code>-out 'client.crt'</code> - название создаваемого файла с клиентским сертификатом.</li></ul><h3>Экспорт сертификата</h3><p>Для того, чтобы импортировать сертификат на клиентские устройства, его необходимо экспортировать в формат <code>P12</code>. <code>P12</code> является контейнером, в котором содержится приватный ключ сертификата и сам сертификат.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-a9447fd1df1408d3abc218620104fabb><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl pkcs12 -export <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -inkey <span class=s1>&#39;client.key.private.pem&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -in <span class=s1>&#39;client.crt&#39;</span> -out <span class=s1>&#39;client.p12&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-a9447fd1df1408d3abc218620104fabb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-inkey 'client.key.private.pem'</code> - файл с приватным клиентским ключом.</li><li><code>-in 'client.crt'</code> - файл с клиентским сертификатом.</li><li><code>-out 'client.p12'</code> - название создаваемого файла-контейнера с приватным ключом и сертификатом.</li></ul><h3>Верификация сертификата</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-16b049e543f6d3e9306365d9aef7bcdd><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl verify -CAfile <span class=s1>&#39;ca.crt&#39;</span> <span class=s1>&#39;client.crt&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-16b049e543f6d3e9306365d9aef7bcdd role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><ul><li><code>-CAfile 'ca.crt'</code> - файл с сертификатом центра сертификации.</li><li><code>'client.crt'</code> - файл с клиентским сертификатом.</li></ul><h3>Просмотр сертификата</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-cd5eac6f61dfab5e2f5ca6d1a914b8b0><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl x509 -in <span class=s1>&#39;client.crt&#39;</span> -text</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cd5eac6f61dfab5e2f5ca6d1a914b8b0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-in 'client.crt'</code> - файл с клиентским сертификатом.</li></ul><p>При выполнении команды, терминал покажет информацию со всеми основными сведениями о сертификате (пример ниже).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-8 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6f37aab640dcf7133d588a05cf79b9da role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-6f37aab640dcf7133d588a05cf79b9da><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl x509 -in <span class=s1>&#39;client.crt&#39;</span> -text
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Certificate:
</span></span><span class=line><span class=cl>    Data:
</span></span><span class=line><span class=cl>        Version: <span class=m>1</span> <span class=o>(</span>0x0<span class=o>)</span>
</span></span><span class=line><span class=cl>        Serial Number:
</span></span><span class=line><span class=cl>            49:14:b8:78:17:a1:ca:c4:6a:41:1b:23:f3:8a:8d:36:e0:9e:69:81
</span></span><span class=line><span class=cl>        Signature Algorithm: ecdsa-with-SHA256
</span></span><span class=line><span class=cl>        Issuer: <span class=nv>C</span> <span class=o>=</span> AU, <span class=nv>ST</span> <span class=o>=</span> Some-State, <span class=nv>O</span> <span class=o>=</span> Internet Widgits Pty Ltd, <span class=nv>CN</span> <span class=o>=</span> CA
</span></span><span class=line><span class=cl>        Validity
</span></span><span class=line><span class=cl>            Not Before: Oct <span class=m>18</span> 21:31:53 <span class=m>2023</span> GMT
</span></span><span class=line><span class=cl>            Not After : Oct <span class=m>15</span> 21:31:53 <span class=m>2033</span> GMT
</span></span><span class=line><span class=cl>        Subject: <span class=nv>C</span> <span class=o>=</span> AU, <span class=nv>ST</span> <span class=o>=</span> Some-State, <span class=nv>O</span> <span class=o>=</span> Internet Widgits Pty Ltd, <span class=nv>CN</span> <span class=o>=</span> CN-FQDN, <span class=nv>emailAddress</span> <span class=o>=</span> mail@example.com
</span></span><span class=line><span class=cl>        Subject Public Key Info:
</span></span><span class=line><span class=cl>            Public Key Algorithm: id-ecPublicKey
</span></span><span class=line><span class=cl>                Public-Key: <span class=o>(</span><span class=m>256</span> bit<span class=o>)</span>
</span></span><span class=line><span class=cl>                pub:
</span></span><span class=line><span class=cl>                    04:9f:22:91:cc:14:b3:75:ad:44:cc:0d:96:0d:19:
</span></span><span class=line><span class=cl>                    04:c4:20:79:fd:b7:f5:65:64:dd:65:a1:f0:b8:2d:
</span></span><span class=line><span class=cl>                    e4:02:75:62:41:03:7c:6e:2f:48:e4:11:38:dc:ed:
</span></span><span class=line><span class=cl>                    08:1f:4c:fa:5f:2f:a2:f5:5d:51:2e:8e:de:de:70:
</span></span><span class=line><span class=cl>                    33:aa:e5:3b:95
</span></span><span class=line><span class=cl>                ASN1 OID: prime256v1
</span></span><span class=line><span class=cl>                NIST CURVE: P-256
</span></span><span class=line><span class=cl>    Signature Algorithm: ecdsa-with-SHA256
</span></span><span class=line><span class=cl>         30:64:02:30:0d:ff:b1:dc:8b:a6:c6:9c:ad:65:8a:7c:01:41:
</span></span><span class=line><span class=cl>         9f:91:ca:24:4c:0b:28:5a:5c:f6:35:2a:b2:d7:58:ca:39:da:
</span></span><span class=line><span class=cl>         6c:bf:cf:8b:23:20:ce:11:45:13:61:36:e2:23:4a:e9:02:30:
</span></span><span class=line><span class=cl>         54:dc:45:ed:ef:21:58:ea:c7:b6:63:db:a2:d9:71:fe:3d:b3:
</span></span><span class=line><span class=cl>         d6:1e:15:82:7b:c8:e8:08:33:d5:2f:d5:f2:8f:3b:41:ea:53:
</span></span><span class=line><span class=cl>         1e:2d:a9:1e:9e:25:9c:fb:a7:12:f9:ec</span></span></code></pre></div></div></div></div><h3>Просмотр запроса на подпись сертификата</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-9 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-3911197688963bf68c6c06f62a678e8b><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl req -in <span class=s1>&#39;client.csr&#39;</span> -text</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3911197688963bf68c6c06f62a678e8b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-in 'client.csr'</code> - файл с запросом на подпись клиентского сертификата.</li></ul><p>Команда выдаст информацию по запросу на подпись клиентского сертификата (пример ниже).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-10 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-da90abc0ff851ba105a8914675685acf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-da90abc0ff851ba105a8914675685acf><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl req -in <span class=s1>&#39;client.csr&#39;</span> -text
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Certificate Request:
</span></span><span class=line><span class=cl>    Data:
</span></span><span class=line><span class=cl>        Version: <span class=m>1</span> <span class=o>(</span>0x0<span class=o>)</span>
</span></span><span class=line><span class=cl>        Subject: <span class=nv>C</span> <span class=o>=</span> AU, <span class=nv>ST</span> <span class=o>=</span> Some-State, <span class=nv>O</span> <span class=o>=</span> Internet Widgits Pty Ltd, <span class=nv>CN</span> <span class=o>=</span> CN-FQDN, <span class=nv>emailAddress</span> <span class=o>=</span> mail@example.com
</span></span><span class=line><span class=cl>        Subject Public Key Info:
</span></span><span class=line><span class=cl>            Public Key Algorithm: id-ecPublicKey
</span></span><span class=line><span class=cl>                Public-Key: <span class=o>(</span><span class=m>256</span> bit<span class=o>)</span>
</span></span><span class=line><span class=cl>                pub:
</span></span><span class=line><span class=cl>                    04:9f:22:91:cc:14:b3:75:ad:44:cc:0d:96:0d:19:
</span></span><span class=line><span class=cl>                    04:c4:20:79:fd:b7:f5:65:64:dd:65:a1:f0:b8:2d:
</span></span><span class=line><span class=cl>                    e4:02:75:62:41:03:7c:6e:2f:48:e4:11:38:dc:ed:
</span></span><span class=line><span class=cl>                    08:1f:4c:fa:5f:2f:a2:f5:5d:51:2e:8e:de:de:70:
</span></span><span class=line><span class=cl>                    33:aa:e5:3b:95
</span></span><span class=line><span class=cl>                ASN1 OID: prime256v1
</span></span><span class=line><span class=cl>                NIST CURVE: P-256
</span></span><span class=line><span class=cl>        Attributes:
</span></span><span class=line><span class=cl>            a0:00
</span></span><span class=line><span class=cl>        Requested Extensions:
</span></span><span class=line><span class=cl>    Signature Algorithm: ecdsa-with-SHA256
</span></span><span class=line><span class=cl>         30:45:02:20:51:9c:a0:b9:b2:61:7f:fa:64:ea:34:1f:65:15:
</span></span><span class=line><span class=cl>         37:ae:f4:89:30:47:11:89:db:c4:1b:1d:9b:82:b9:64:ea:c7:
</span></span><span class=line><span class=cl>         02:21:00:f8:00:70:4e:e6:db:99:78:cf:25:22:c0:8d:c6:b1:
</span></span><span class=line><span class=cl>         f3:f0:d8:68:3b:c2:51:21:a5:b3:fa:97:f9:85:c6:9c:49</span></span></code></pre></div></div></div></div><h2>Автоматизация</h2><p>Команд много. Поэтому я как обычно, решил всё автоматизировать и загнать в скрипт.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>openssl.ca.sh</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-14a8559df935777e2e3e2a6d6654b436 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=openssl.ca.sh download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=openssl.ca.sh target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-14a8559df935777e2e3e2a6d6654b436><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/usr/bin/bash -e
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># OpenSSL certificate generator.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># @package    Bash</span>
</span></span><span class=line><span class=cl><span class=c1># @author     Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># @copyright  2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=c1># @license    MIT</span>
</span></span><span class=line><span class=cl><span class=c1># @version    0.1.0</span>
</span></span><span class=line><span class=cl><span class=c1># @link       https://lib.onl/ru/posts/2023/10/6733cb51-62a0-5ed9-b421-8f08c4e0cb18/</span>
</span></span><span class=line><span class=cl><span class=c1># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get &#39;date&#39; command.</span>
</span></span><span class=line><span class=cl><span class=nv>date</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span> <span class=nb>command</span> -v date <span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get &#39;openssl&#39; command.</span>
</span></span><span class=line><span class=cl><span class=nv>ossl</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span> <span class=nb>command</span> -v openssl <span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get &#39;shuf&#39; command.</span>
</span></span><span class=line><span class=cl><span class=nv>shuf</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span> <span class=nb>command</span> -v shuf <span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CA key &amp; certificate names.</span>
</span></span><span class=line><span class=cl><span class=nv>ca_key</span><span class=o>=</span><span class=s1>&#39;ca.root.key&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>ca_crt</span><span class=o>=</span><span class=s1>&#39;ca.root.crt&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Specifies the number of days to make a certificate valid for.</span>
</span></span><span class=line><span class=cl><span class=c1># Default is 30 days.</span>
</span></span><span class=line><span class=cl><span class=nv>days</span><span class=o>=</span><span class=s1>&#39;3650&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Timestamp.</span>
</span></span><span class=line><span class=cl><span class=nv>ts</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$((</span> <span class=k>$(</span> <span class=si>${</span><span class=nv>date</span><span class=si>}</span> -u <span class=s1>&#39;+%s%N&#39;</span> <span class=k>)</span> <span class=o>/</span> <span class=m>1000000</span> <span class=k>))</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Suffix.</span>
</span></span><span class=line><span class=cl><span class=nv>sfx</span><span class=o>=</span><span class=k>$(</span> <span class=si>${</span><span class=nv>shuf</span><span class=si>}</span> -i <span class=s1>&#39;1000-9999&#39;</span> -n <span class=m>1</span> --random-source<span class=o>=</span><span class=s1>&#39;/dev/random&#39;</span> <span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ca<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>ec</span><span class=o>=</span><span class=s1>&#39;secp384r1&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;--- [CREATE] Certificate Authority&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> req -x509 -newkey ec:&lt;<span class=o>(</span> openssl ecparam -name <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ec</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -nodes -days <span class=s2>&#34;</span><span class=si>${</span><span class=nv>days</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -keyform <span class=s1>&#39;PEM&#39;</span> -outform <span class=s1>&#39;PEM&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -keyout <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ca_key</span><span class=si>}</span><span class=s2>&#34;</span> -out <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ca_crt</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> x509 -in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ca_crt</span><span class=si>}</span><span class=s2>&#34;</span> -text
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cert<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>ec</span><span class=o>=</span><span class=s1>&#39;prime256v1&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>key_pvt</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>.</span><span class=si>${</span><span class=nv>sfx</span><span class=si>}</span><span class=s2>.key.private.pem&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>key_pub</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>.</span><span class=si>${</span><span class=nv>sfx</span><span class=si>}</span><span class=s2>.key.public.pem&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>csr</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>.</span><span class=si>${</span><span class=nv>sfx</span><span class=si>}</span><span class=s2>.csr&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>crt</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>.</span><span class=si>${</span><span class=nv>sfx</span><span class=si>}</span><span class=s2>.crt&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>p12</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>.</span><span class=si>${</span><span class=nv>sfx</span><span class=si>}</span><span class=s2>.p12&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>srl</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>.</span><span class=si>${</span><span class=nv>sfx</span><span class=si>}</span><span class=s2>.srl&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;--- [CREATE] Client Certificate [</span><span class=si>${</span><span class=nv>ts</span><span class=si>}</span><span class=s2>]&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> ecparam -name <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ec</span><span class=si>}</span><span class=s2>&#34;</span> -genkey -noout -out <span class=s2>&#34;</span><span class=si>${</span><span class=nv>key_pvt</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> ec -in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>key_pvt</span><span class=si>}</span><span class=s2>&#34;</span> -pubout -out <span class=s2>&#34;</span><span class=si>${</span><span class=nv>key_pub</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> req -new -key <span class=s2>&#34;</span><span class=si>${</span><span class=nv>key_pvt</span><span class=si>}</span><span class=s2>&#34;</span> -out <span class=s2>&#34;</span><span class=si>${</span><span class=nv>csr</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> x509 -req -in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>csr</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -CA <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ca_crt</span><span class=si>}</span><span class=s2>&#34;</span> -CAkey <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ca_key</span><span class=si>}</span><span class=s2>&#34;</span> -days <span class=s2>&#34;</span><span class=si>${</span><span class=nv>days</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -CAcreateserial -CAserial <span class=s2>&#34;</span><span class=si>${</span><span class=nv>srl</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -outform <span class=s1>&#39;PEM&#39;</span> -out <span class=s2>&#34;</span><span class=si>${</span><span class=nv>crt</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> pkcs12 -export <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -inkey <span class=s2>&#34;</span><span class=si>${</span><span class=nv>key_pvt</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>crt</span><span class=si>}</span><span class=s2>&#34;</span> -out <span class=s2>&#34;</span><span class=si>${</span><span class=nv>p12</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> verify -CAfile <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ca_crt</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>crt</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ossl</span><span class=si>}</span> x509 -in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>crt</span><span class=si>}</span><span class=s2>&#34;</span> -text
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span></span></span></code></pre></div></div></div></div><p>Скрипт содержит две функции, вызывать которых можно по отдельности. Функция <code>ca()</code> позволяет сгенерировать ключ и сертификат центра сертификации, а функция <code>cert()</code>, соответственно, генерирует клиентские сертификаты.</p><h3>Использование</h3><ol><li>Создать ключ и сертификат центра сертификации:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-11 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ab8161fde131112c4a8ec1b3c34a836b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-ab8161fde131112c4a8ec1b3c34a836b><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash openssl.ca.sh ca</span></span></code></pre></div></div></div></div><ol start=2><li>Создать клиентские ключи и сертификаты:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-12 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-63e3db5941210a6eab5b5238f45f0adc role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-63e3db5941210a6eab5b5238f45f0adc><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash openssl.ca.sh cert</span></span></code></pre></div></div></div></div><p>Немного расскажу про алгоритм генерации сертификатов.</p><ol><li>У сертификата есть поле <code>Serial Number</code>, которое содержит серийный номер сертификата. Серийный номер сертификата это уникальный номер, выданный центром сертификации. В моём скрипте при генерации клиентского сертификата указаны опции <code>-CAcreateserial</code> и <code>-CAserial "${srl}"</code>, которые позволяют OpenSSL создавать рядом с клиентскими сертификатами файлы формата <code>.slr</code>, содержащие в себе серийные номера сгенерированных сертификатов. Таким образом можно создавать небольшую локальную базу данных выданных сертификатов.</li><li>Файл каждого клиентского сертификата генерируется с названием вида <code>[TS].[SFX].[EXE]</code>, где <code>[TS]</code> - это временная метка в микросекундах, <code>[SFX]</code> - числовой суффикс, а <code>[EXE]</code> - расширение файлов.</li></ol><p>На этом всё. Не исключаю факта присутствия ошибок или неточностей. Если что, жду предложения в электронную почту. <span class="shortcode shortcode-emoji">😄</span></p></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/openssl/>#openssl</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/bash/>#bash</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D1%8B/>#сертификаты</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-17T23:42:31Z data-fn=date-local>2023/10/17 23:42:31 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Интеграция обновлений в дистрибутив ОС MS Windows" class=d-block href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a><picture><source srcset='https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Интеграция обновлений в дистрибутив ОС MS Windows"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a>Интеграция обновлений в дистрибутив ОС MS Windows</a></h2></div></header><div class=node-body><p>Microsoft каждый месяц выпускает новые версии дистрибутивов с уже интегрированными обновлениями. Но есть редакции ОС, например LTSC, для которых Microsoft не выполняет подобные действия. Приходится делать самому&mldr;</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Интеграция обновлений в дистрибутив ОС MS Windows" class=d-block href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a><img class="d-block rounded" src="https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Интеграция обновлений в дистрибутив ОС MS Windows"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a>Интеграция обновлений в дистрибутив ОС MS Windows</a></h2></div></header><div class=node-body><p>Microsoft каждый месяц выпускает новые версии дистрибутивов с уже интегрированными обновлениями. Но есть редакции ОС, например LTSC, для которых Microsoft не выполняет подобные действия. Приходится делать самому&mldr;</p></div></div></article></div><div class="modal fade" id=modal-9ef2c2a0e4254d6074630a3f0cf4963a tabindex=-1 aria-labelledby=modal-9ef2c2a0e4254d6074630a3f0cf4963a-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-9ef2c2a0e4254d6074630a3f0cf4963a-label><a href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/>Интеграция обновлений в дистрибутив ОС MS Windows</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Microsoft каждый месяц выпускает новые версии дистрибутивов с уже интегрированными обновлениями. Но есть редакции ОС, например LTSC, для которых Microsoft не выполняет подобные действия. Приходится делать самому&mldr;</p><h2>Подготовка</h2><p>Для интеграции обновлений в дистрибутив ОС, потребуется:</p><ul><li>Дистрибутив операционной системы в файле <code>.iso</code>.</li><li>Доступ в интернет для скачивания необходимых инструментов и обновлений.</li><li>Рекомендуется <strong>SSD</strong>. Все ниже приведённые этапы требуют активной работы с файлами. Поэтому, существенное ускорение можно получить выполняя все задачи на SSD.</li></ul><h3>Структура директорий</h3><p>Для начала необходимо создать структуру директорий, которая послужит базисом для процесса интеграции обновлений:</p><ul><li><code>C:\BuildFarm</code> - корневая директория для работы.<ul><li><code>\MNT</code> - директория, в которую будет монтироваться образ WIM.</li><li><code>\UPD</code> - директория для хранения скаченных обновлений.</li><li><code>\WIM</code> - директория для хранения образа WIM.</li></ul></li></ul><h3>MS DISM</h3><p>Для интеграции обновлений потребуется инструмент <strong>Deployment Image Servicing and Management (DISM)</strong> (<code>DISM.exe</code>), который входит в комплект <a title href=https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install target=_blank rel="noopener noreferrer nofollow">Windows Assessment and Deployment Kit (Windows ADK)</a>. Обычно, DISM уже поставляется с операционной системой, но я рекомендую <a title href=https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install#other-adk-downloads target=_blank rel="noopener noreferrer nofollow">скачивать</a> последнюю версию с сайта Microsoft и устанавливать вручную.</p><p>Когда Windows ADK установлен, DISM можно найти в меню <strong>&ldquo;Пуск&rdquo;</strong> вместе с остальными программам. Запускать DISM необходимо под администратором. Все команды, приведённые ниже, должны будут выполняться только через установленный вручную DISM. Использовать DISM, поставляемый с операционной системой нет необходимости.</p><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Установленный вручную DISM можно найти в меню &ldquo;Пуск&rdquo; / Windows Kits / <strong>Среда средств развертывания и работы с образами</strong>.</p></div></div></div><h2>Интеграция обновлений</h2><p>Обновления можно скачивать с сайта-каталога <a title href=https://www.catalog.update.microsoft.com/ target=_blank rel="noopener noreferrer nofollow">Microsoft Update Catalog</a>. Я беру так называемые &ldquo;кумулятивные (накопительные) обновления&rdquo; (cumulative updates), содержащие в себе сразу множество пакетов с исправлениями и обновлениями функций. <a title href="https://www.catalog.update.microsoft.com/Search.aspx?q=cumulative%20update" target=_blank rel="noopener noreferrer nofollow">Найти</a> такие крупные обновления можно в каталоге при помощи поискового запроса <code>cumulative update</code>.</p><p>Скачиваемые обновления помещаются в директорию <code>C:\BuildFarm\UPD</code> для дальнейшей интеграции в дистрибутив ОС.</p><h3>Извлечение файла WIM из дистрибутива MS Windows</h3><p>Образ ОС находится в специальном файле <code>sources\install.wim</code>. Его необходимо извлечь при помощи программ для работы с файлами <code>.iso</code> (подойдёт <a title href=https://www.ultraiso.com target=_blank rel="noopener noreferrer nofollow">UltraISO</a> или <a title href=https://www.poweriso.com target=_blank rel="noopener noreferrer nofollow">PowerISO</a>) в директорию <code>C:\BuildFarm\WIM</code>.</p><h3>Получение информации из WIM-образа</h3><p>Файл <code>install.wim</code> может содержать несколько редакций ОС. Каждая редакция ОС имеет свой индекс. Для того, чтобы увидеть эти индексы, нужно ввести команду:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4d982b100dd18e0bf8dcd92ea083276d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-4d982b100dd18e0bf8dcd92ea083276d><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Get-ImageInfo</span> <span class=p>/</span><span class=n>ImageFile</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\WIM\install.wim&#34;</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Get-ImageInfo</code> - получить информацию о версиях операционной системы, находящихся в WIM-образ.</li><li><code>/ImageFile</code> - путь к WIM-образу.</li></ul><p>Введённая команда предоставит примерно такой выхлоп:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ee1a51970aaf3a02c252707d5f3857f6 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-ee1a51970aaf3a02c252707d5f3857f6><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Get-ImageInfo</span> <span class=p>/</span><span class=n>ImageFile</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\WIM\install.wim&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Details</span> <span class=k>for</span> <span class=n>image</span> <span class=err>:</span> <span class=n>C:</span><span class=p>\</span><span class=n>BuildFarm</span><span class=p>\</span><span class=n>WIM</span><span class=p>\</span><span class=n>install</span><span class=p>.</span><span class=py>wim</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>15</span><span class=p>,</span><span class=mf>643</span><span class=p>,</span><span class=mf>499</span><span class=p>,</span><span class=mf>526</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>14</span><span class=p>,</span><span class=mf>878</span><span class=p>,</span><span class=mf>972</span><span class=p>,</span><span class=mf>660</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>3</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>15</span><span class=p>,</span><span class=mf>643</span><span class=p>,</span><span class=mf>653</span><span class=p>,</span><span class=mf>521</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>4</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>14</span><span class=p>,</span><span class=mf>878</span><span class=p>,</span><span class=mf>878</span><span class=p>,</span><span class=mf>937</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Pro</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Pro</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>15</span><span class=p>,</span><span class=mf>658</span><span class=p>,</span><span class=mf>943</span><span class=p>,</span><span class=mf>281</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;...&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Extract</span> <span class=n>Specific</span> <span class=n>Windows</span> <span class=n>Index</span> <span class=n>from</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Multiple</span> <span class=n>Edition</span> <span class=n>ISO</span></span></span></code></pre></div></div></div></div><h3>Монтирование WIM-образа</h3><p>Индексы получены. Теперь необходимо примонтировать редакцию ОС из конкретного индекса. Выбор индекса зависит от вас: выбираете индекс той редакции ОС, которая вам необходима. Я выбрал редакцию <strong>Windows 10 Pro</strong> с индексом <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-0e7c58cc71fd8f147cfdd42d729a3056 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-0e7c58cc71fd8f147cfdd42d729a3056><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Mount-Image</span> <span class=p>/</span><span class=n>ImageFile</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\WIM\install.wim&#34;</span> <span class=p>/</span><span class=n>MountDir</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=n>index</span><span class=err>:</span><span class=mf>5</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Mount-Image</code> - команда на монтирование WIM-образа.</li><li><code>/MountDir</code> - путь к директории, в которую необходимо поместить содержимое монтируемого WIM-образа.</li><li><code>/index:5</code> - номер версии дистрибутива ОС. Номер можно узнать командой <code>/Get-ImageInfo</code>.</li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Если что-то пошло не так, размонтировать образ без сохранения можно следующей командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-8e850e8c43d9a5acfbc829d1a8cd943f><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>Dism /Unmount-Image /MountDir:<span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> /Discard</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8e850e8c43d9a5acfbc829d1a8cd943f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Проверить список примонтированных образов можно следующей командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-a7cdd6cc118f9ba964e0f602a972c6d3><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>Dism /Get-MountedImageInfo</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-a7cdd6cc118f9ba964e0f602a972c6d3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Если после размонтирования образ всё ещё остаётся подключённым к системе и является повреждённым, следующая команда можешь помочь:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-bbcbe79d08cbfc9ef26905359075212f><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>Dism /Cleanup-Mountpoints</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-bbcbe79d08cbfc9ef26905359075212f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Она удалит все ресурсы, связанные с повреждённым образом и очистит систему от &ldquo;зависших&rdquo; точек монтирования.</p></div></div></div><h3>Интеграция обновлений в WIM-образ</h3><p>После монтирования редакции ОС с конкретным индексом, можно начинать процесс интеграции обновлений:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-48d5ca7c4c7d541c34b9ebbed9fa60eb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-48d5ca7c4c7d541c34b9ebbed9fa60eb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Add-Package</span> <span class=p>/</span><span class=n>PackagePath</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\UPD&#34;</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Add-Package</code> - команда на добавление пакетов (обновлений) в WIM-образ.<ul><li><code>/PackagePath</code> - путь к директории, в которой находятся пакеты (обновления) для интеграции в WIM-образ.</li></ul></li></ul><h3>Проверка корректности интеграции обновлений (опционально)</h3><p>По окончании процесса интеграции, можно проверить корректность выполненной задачи. Команда ниже покажет список пакетов, установленных в примонтированной редакции ОС. В этом списке пакетов будут интегрированные обновления.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-2f5483d3e33245b78421e2dea40d1c4b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-2f5483d3e33245b78421e2dea40d1c4b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Get-Packages</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Get-Packages</code> - команда для получения информации о интегрированных пакетах примонтированного WIM-образа.</li></ul><h3>Очистка хранилища компонентов WIM-образ (опционально)</h3><p>Для уменьшения размера дистрибутива можно запустить процедуру удаления предыдущих версий компонентов, которые были изменены (заменены) установленными обновлениями:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c37fdac85f1e25872e01dec50f03b019 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-c37fdac85f1e25872e01dec50f03b019><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Cleanup-Image</span> <span class=p>/</span><span class=n>StartComponentCleanup</span> <span class=p>/</span><span class=n>ResetBase</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Cleanup-Image</code> - очистка и восстановление образа.<ul><li><code>/StartComponentCleanup</code> - удаляет заменённые компоненты и уменьшает размер хранилища компонентов.<ul><li><code>/ResetBase</code> - сброс базы заменяемых компонентов.</li></ul></li></ul></li></ul><h3>Проверка хранилища компонентов WIM-образа (опционально)</h3><p>Опциональный шаг перед заключительным этапом - проверить системные компоненты и файлы на повреждения:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6b6d013454a52dc82f3661962cd20ae5 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-6b6d013454a52dc82f3661962cd20ae5><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Cleanup-Image</span> <span class=p>/</span><span class=n>ScanHealth</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Cleanup-Image</code> - очистка и восстановление образа.<ul><li><code>/ScanHealth</code> - сканирование образа на наличие повреждений хранилища компонентов.</li></ul></li></ul><h3>Сохранение изменений в WIM-образе</h3><p>После выполнения всех действий, необходимо отмонтировать редакцию ОС с сохранением изменений. Делается это командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7ad131628e41b547a1c8c51daf81ff31 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-7ad131628e41b547a1c8c51daf81ff31><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Unmount-Image</span> <span class=p>/</span><span class=n>MountDir</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=n>Commit</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Unmount-Image</code> - команда для отмонтирования WIM-образа.</li><li><code>/MountDir</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Commit</code> - сохранение совершённых изменений в WIM-образе.</li></ul><p>Всё. Мы получили файл <code>install.wim</code> с интегрированными обновлениями. Теперь этот файл <code>install.wim</code> необходимо обратно упаковать в образ ISO с заменой старого.</p><h2>Автоматизация</h2><p>Я люблю автоматизировать всё по максимуму. И здесь я не упустил шанс написать небольшой скрипт с деревянной логикой, который сделает все шаги по интеграции обновлений за человека. Только вот, извлечь файл <code>install.wim</code> из ISO-образа придётся самому.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>dism.packages.cmd</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d15cae2cd1cd414f0a2b1efbd1ceedc4 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=dism.packages.cmd download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=dism.packages.cmd target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-d15cae2cd1cd414f0a2b1efbd1ceedc4><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl><span class=p>:</span><span class=c1>: Automatic integration of updates into DISM.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/posts/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_mnt</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>MNT&#34;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_upd</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>UPD&#34;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_wim</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>WIM&#34;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>f_wim</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%d_wim%</span><span class=s2>\install.wim&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Creating directories.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> <span class=k>mkdir</span> <span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>&#34;</span> <span class=k>mkdir</span> <span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_wim%</span><span class=s2>&#34;</span> <span class=k>mkdir</span> <span class=s2>&#34;</span><span class=nv>%d_wim%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Checking files.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span> <span class=k>echo</span> Please put <span class=s2>&#34;install.wim&#34;</span> file in <span class=s2>&#34;WIM&#34;</span> directory... <span class=p>&amp;&amp;</span> <span class=k>pause</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>/*.msu&#34;</span> <span class=k>echo</span> Please put <span class=s2>&#34;*.msu&#34;</span> files in <span class=s2>&#34;UPD&#34;</span> directory... <span class=p>&amp;&amp;</span> <span class=k>pause</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>echo</span> Getting Windows Image Info...
</span></span><span class=line><span class=cl>  Dism /Get-ImageInfo /ImageFile:<span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>else</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>echo</span> <span class=s2>&#34;install.wim&#34;</span> not found! <span class=p>&amp;</span> <span class=k>echo</span>.Failed with error #<span class=nv>%errorlevel%</span>.
</span></span><span class=line><span class=cl>  <span class=k>goto</span> <span class=p>:</span><span class=nl>error</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=k>/p</span> <span class=nv>index</span><span class=p>=</span><span class=s2>&#34;Enter INDEX: &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Mounting Windows image...
</span></span><span class=line><span class=cl>Dism /Mount-Image /ImageFile:<span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span> /MountDir:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /index:<span class=nv>%index%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Adding Windows packages...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Add-Package /PackagePath:<span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Getting Windows packages...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Get-Packages
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Reseting Windows image...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Cleanup-Image /StartComponentCleanup /ResetBase
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Scaning health Windows image...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Cleanup-Image /ScanHealth
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Saving Windows image...
</span></span><span class=line><span class=cl>Dism /Unmount-Image /MountDir:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Commit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>exit</span> /b 0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>error</span>
</span></span><span class=line><span class=cl><span class=k>exit</span> /b <span class=nv>%errorlevel%</span></span></span></code></pre></div></div></div></div><p>Поместить скрипт нужно в корень директории <code>BuildFarm</code> и запустить из терминала DISM. Если же возникнут какие-либо проблемы, ниже есть небольшой скрипт, который размонтирует образ и очистит систему от точек монтирования.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>dism.unmount.cmd</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-452d0d99a2df80f8ac66520f9c13e91a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=dism.unmount.cmd download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=dism.unmount.cmd target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-452d0d99a2df80f8ac66520f9c13e91a><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl><span class=p>:</span><span class=c1>: Automatic unmounting WIM images into DISM.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/posts/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_mnt</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>MNT&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Unmounting <span class=s2>&#34;install.wim&#34;</span> and discards changes that were made when image was mounted...
</span></span><span class=line><span class=cl>Dism /Unmount-Image /MountDir:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Discard
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Deleting all of resources associated with a mounted image that has been corrupted...
</span></span><span class=line><span class=cl>Dism /Cleanup-Mountpoints
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Getting information about mounted image...
</span></span><span class=line><span class=cl>Dism /Get-MountedImageInfo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>exit</span> /b 0</span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/cmd/>#cmd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/adk/>#adk</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/dism/>#dism</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F/>#интеграция</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2022-05-09T12:39:47Z data-fn=date-local>2022/05/09 12:39:47 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Настройка и использование Git" class=d-block href=/ru/articles/2021/08/c35f395f-5921-55eb-afcf-1ad812a1a9d9/ data-bs-toggle=modal data-bs-target=#modal-0110dd716708232031f205e093b615ce><picture><source srcset='https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Настройка и использование Git"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/08/c35f395f-5921-55eb-afcf-1ad812a1a9d9/ data-bs-toggle=modal data-bs-target=#modal-0110dd716708232031f205e093b615ce>Настройка и использование Git</a></h2></div></header><div class=node-body><p>В этой заметке я приведу параметры Git, которые сам использую при работе с репозиториями.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Настройка и использование Git" class=d-block href=/ru/articles/2021/08/c35f395f-5921-55eb-afcf-1ad812a1a9d9/ data-bs-toggle=modal data-bs-target=#modal-0110dd716708232031f205e093b615ce><img class="d-block rounded" src="https://images.unsplash.com/photo-1556075798-4825dfaaf498?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Настройка и использование Git"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/08/c35f395f-5921-55eb-afcf-1ad812a1a9d9/ data-bs-toggle=modal data-bs-target=#modal-0110dd716708232031f205e093b615ce>Настройка и использование Git</a></h2></div></header><div class=node-body><p>В этой заметке я приведу параметры Git, которые сам использую при работе с репозиториями.</p></div></div></article></div><div class="modal fade" id=modal-0110dd716708232031f205e093b615ce tabindex=-1 aria-labelledby=modal-0110dd716708232031f205e093b615ce-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-0110dd716708232031f205e093b615ce-label><a href=/ru/articles/2021/08/c35f395f-5921-55eb-afcf-1ad812a1a9d9/>Настройка и использование Git</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>В этой заметке я приведу параметры Git, которые сам использую при работе с репозиториями.</p><h2>Первичная настройка</h2><p>Для начала работы с Git&rsquo;ом, его необходимо хотя бы минимально настроить.</p><ol><li>Указать своё имя:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-a9b7ba23b36a3178019f553868146bbd><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git config --global user.name <span class=s2>&#34;John Doe&#34;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-a9b7ba23b36a3178019f553868146bbd role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><ol start=2><li>Указать свой адрес e-mail:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-27a922ffc19a5533a2d5c140869d200b><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git config --global user.email <span class=s2>&#34;johndoe@example.com&#34;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-27a922ffc19a5533a2d5c140869d200b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2>Настройка подписи</h2><p>Хорошим тоном будет считаться подпись каждого своего коммита.</p><ol><li>Выяснить какие ключи установлены в системе (о создании ключей я публиковал заметку <span class="shortcode shortcode-uuid"><a href=/ru/articles/2020/07/7a204545-daa8-58ce-ba35-75e732e1bcc0/>GnuPG: Создание и работа с ключами шифрования</a></span>):</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-7dbb81692c0f04f5192f3ec05319c89d><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>gpg --list-secret-keys --keyid-format<span class=o>=</span>long</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7dbb81692c0f04f5192f3ec05319c89d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><ol start=2><li>Указать Git&rsquo;у всегда подписывать каждый коммит:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ecff07c0f9ca15ba38f1a04ed418bd57><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git config --global commit.gpgsign true</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ecff07c0f9ca15ba38f1a04ed418bd57 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><ol start=3><li>Указать Git&rsquo;у идентификатор ключа для подписи коммита:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-c6ea767a4dd3412908e0f5e9e780a10e><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git config --global user.signingkey 3AA5C34371567BD2</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c6ea767a4dd3412908e0f5e9e780a10e role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2>Хранилище паролей</h2><p>Git по умолчанию не сохраняет регистрационные данные для репозиториев. Эта настройка позволяет указать Git&rsquo;у использовать для хранения регистрационных данных текстовый файл <code>~/.git-credentials</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-da9c9c2426461d81b6bb38bd7783e76b><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git config --global credential.helper store</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-da9c9c2426461d81b6bb38bd7783e76b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2>Отмена изменений</h2><p>Отмена конкретного коммита:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-c443cf00e0b50ce97b9954404d2629e3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git revert <span class=o>[</span>commit<span class=o>]</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c443cf00e0b50ce97b9954404d2629e3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Отмена 2-х коммитов подряд:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e557fa2e00d352d3b662d6971224637c><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git revert HEAD~2</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e557fa2e00d352d3b662d6971224637c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2>Модули</h2><p>Добавление модуля:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-8 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-c6bda89fc500b414ea209fd9c0b785f7><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git submodule add https://github.com/<span class=o>[</span>MODULE<span class=o>]</span> <span class=o>[</span>MODULE<span class=o>]</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c6bda89fc500b414ea209fd9c0b785f7 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Рекурсивное обновление всех модулей:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-9 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-cae8bc24b5b14aa0b368e89406d56d1b><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git submodule update --recursive --remote --merge</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cae8bc24b5b14aa0b368e89406d56d1b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Удаление модуля:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-10 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-56dbbbedb5e0000a51d0331baac2d0b9><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git submodule deinit -f <span class=o>[</span>MODULE<span class=o>]</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=o>&amp;&amp;</span> git rm -r --cached <span class=o>[</span>MODULE<span class=o>]</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=o>&amp;&amp;</span> rm -rf .git/modules/<span class=o>[</span>MODULE<span class=o>]</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=o>&amp;&amp;</span> rm -rf <span class=o>[</span>MODULE<span class=o>]</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-56dbbbedb5e0000a51d0331baac2d0b9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2>Изменение адреса репозитория</h2><p>Показать текущий адрес:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-11 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-c3af434861645d374e0e76dd88cb8929><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git remote -v</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c3af434861645d374e0e76dd88cb8929 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Установить новый адрес:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-12 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-db4cc6b08fcfac29284ffda2bac25ce5><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git remote set-url origin <span class=s1>&#39;[URL]&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-db4cc6b08fcfac29284ffda2bac25ce5 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2>Изменение описания последнего commit&rsquo;а</h2><p>Если закралась ошибка в описании изменений кода при последнем commit&rsquo;е, это описание можно изменить при помощи команды:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-13 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-6c12a150e54b2ad09cfc103a7141632a><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git commit --amend -m <span class=s1>&#39;New commit message.&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6c12a150e54b2ad09cfc103a7141632a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Далее, изменённый коммит принудительно отправить на сервер:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-14 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-bb53ecaec445124fab9aa26e05682bb4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git push --force <span class=s1>&#39;[remoteName]&#39;</span> <span class=s1>&#39;[branchName]&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-bb53ecaec445124fab9aa26e05682bb4 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="shortcode shortcode-codeblock shortcode-codeblock-15 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-2ef770fc62eef14c418ad4e6e7beaba8><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git push --force <span class=s1>&#39;origin&#39;</span> <span class=s1>&#39;main&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-2ef770fc62eef14c418ad4e6e7beaba8 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/git/>#git</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/linux/>#linux</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-08-14T15:52:38Z data-fn=date-local>2021/08/14 15:52:38 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Обновление Fedora Linux до актуальной версии" class=d-block href=/ru/articles/2021/05/0acd3f9d-07b7-52b8-9fac-b5cb1cc579e0/ data-bs-toggle=modal data-bs-target=#modal-c5d1e2429ba2760751f8d96aa231bc4d><picture><source srcset='https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Обновление Fedora Linux до актуальной версии"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/0acd3f9d-07b7-52b8-9fac-b5cb1cc579e0/ data-bs-toggle=modal data-bs-target=#modal-c5d1e2429ba2760751f8d96aa231bc4d>Обновление Fedora Linux до актуальной версии</a></h2></div></header><div class=node-body><p>Новые версии Fedora публикуются каждые 6-8 месяцев. В этой статье я опишу шаги по обновлению дистрибутива между версиями.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Обновление Fedora Linux до актуальной версии" class=d-block href=/ru/articles/2021/05/0acd3f9d-07b7-52b8-9fac-b5cb1cc579e0/ data-bs-toggle=modal data-bs-target=#modal-c5d1e2429ba2760751f8d96aa231bc4d><img class="d-block rounded" src="https://images.unsplash.com/photo-1585406666850-82f7532fdae3?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Обновление Fedora Linux до актуальной версии"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/0acd3f9d-07b7-52b8-9fac-b5cb1cc579e0/ data-bs-toggle=modal data-bs-target=#modal-c5d1e2429ba2760751f8d96aa231bc4d>Обновление Fedora Linux до актуальной версии</a></h2></div></header><div class=node-body><p>Новые версии Fedora публикуются каждые 6-8 месяцев. В этой статье я опишу шаги по обновлению дистрибутива между версиями.</p></div></div></article></div><div class="modal fade" id=modal-c5d1e2429ba2760751f8d96aa231bc4d tabindex=-1 aria-labelledby=modal-c5d1e2429ba2760751f8d96aa231bc4d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-c5d1e2429ba2760751f8d96aa231bc4d-label><a href=/ru/articles/2021/05/0acd3f9d-07b7-52b8-9fac-b5cb1cc579e0/>Обновление Fedora Linux до актуальной версии</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Новые версии Fedora публикуются каждые 6-8 месяцев. В этой статье я опишу шаги по обновлению дистрибутива между версиями.</p><ol><li>Устанавливаем плагин обновления системы:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f44b33ca4b562c879aef4d53844f38db role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-f44b33ca4b562c879aef4d53844f38db><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dnf install dnf-plugin-system-upgrade</span></span></code></pre></div></div></div></div><ol start=2><li>Скачивание актуальной версии системы:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-fa6ae78e8726c740225940cdd759a6a9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-fa6ae78e8726c740225940cdd759a6a9><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dnf system-upgrade download --releasever<span class=o>=</span><span class=m>34</span></span></span></code></pre></div></div></div></div><ul><li><code>releasever</code> - номер актуальной версии системы.</li></ul><ol start=3><li>Запуск обновления системы на актуальную версию:</li></ol><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-76685c88526dfa073f872c8dac8ae1fc role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-76685c88526dfa073f872c8dac8ae1fc><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dnf system-upgrade reboot</span></span></code></pre></div></div></div></div><p>Вот и всё. Система обновит пакетную базу и перезагрузится.</p></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/fedora/>#fedora</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/dnf/>#dnf</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/upgrade/>#upgrade</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-05-15T20:29:16Z data-fn=date-local>2021/05/15 20:29:16 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Настройка статического IP адреса" class=d-block href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1><picture><source srcset='https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Настройка статического IP адреса"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1>Настройка статического IP адреса</a></h2></div></header><div class=node-body><p>Рассмотрим различные способы настройки статического IP адреса в дистрибутивах Linux. Способы различаются в зависимости от пакетной базы дистрибутивов. Например, настройка статического IP в RHEL-based дистрибутиве будет отличаться от настройки в DEB-based дистрибутиве.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Настройка статического IP адреса" class=d-block href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1><img class="d-block rounded" src="https://images.unsplash.com/photo-1544197150-b99a580bb7a8?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Настройка статического IP адреса"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/ data-bs-toggle=modal data-bs-target=#modal-3bbda3955098d2ca8c2a925f4969e8f1>Настройка статического IP адреса</a></h2></div></header><div class=node-body><p>Рассмотрим различные способы настройки статического IP адреса в дистрибутивах Linux. Способы различаются в зависимости от пакетной базы дистрибутивов. Например, настройка статического IP в RHEL-based дистрибутиве будет отличаться от настройки в DEB-based дистрибутиве.</p></div></div></article></div><div class="modal fade" id=modal-3bbda3955098d2ca8c2a925f4969e8f1 tabindex=-1 aria-labelledby=modal-3bbda3955098d2ca8c2a925f4969e8f1-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-3bbda3955098d2ca8c2a925f4969e8f1-label><a href=/ru/articles/2021/05/ee559a6c-5cde-5166-9d2d-3ceb55878eb8/>Настройка статического IP адреса</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Рассмотрим различные способы настройки статического IP адреса в дистрибутивах Linux. Способы различаются в зависимости от пакетной базы дистрибутивов. Например, настройка статического IP в RHEL-based дистрибутиве будет отличаться от настройки в DEB-based дистрибутиве.</p><h2>Подготовка</h2><p>Смотрим текущие сетевые устройства и соединения:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ef1e9735565db6360aa43e36cf3cc881 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-ef1e9735565db6360aa43e36cf3cc881><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1: lo: &lt;loopback,up,lower_up&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>  inet 127.0.0.1/8 scope host lo
</span></span><span class=line><span class=cl>2: enp1s0: &lt;broadcast,multicast,up,lower_up&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>  link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>  inet 192.168.10.123/24 brd 192.168.10.255 scope global dynamic noprefixroute enp1s0</span></span></code></pre></div></div></div></div><h2>Настройка IP в RHEL-based дистрибутивах</h2><p>В директории <code>/etc/sysconfig/network-scripts</code> находятся конфигурационные файлы для сетевых интерфейсов. Имя файла состоит из префикса <code>ifcfg</code> и имени интерфейса. Например, содержимое файла для интерфейса <code>enp1s0</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ed876566195349ffe0f51671c2d45b85 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-ed876566195349ffe0f51671c2d45b85><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/sysconfig/network-scripts/ifcfg-enp1s0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;Ethernet&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PROXY_METHOD</span><span class=o>=</span><span class=s2>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BROWSER_ONLY</span><span class=o>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BOOTPROTO</span><span class=o>=</span><span class=s2>&#34;dhcp&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEFROUTE</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV4_FAILURE_FATAL</span><span class=o>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6INIT</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_AUTOCONF</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_DEFROUTE</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_FAILURE_FATAL</span><span class=o>=</span><span class=s2>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>IPV6_ADDR_GEN_MODE</span><span class=o>=</span><span class=s2>&#34;stable-privacy&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>NAME</span><span class=o>=</span><span class=s2>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;&lt;DEVICE_ID&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEVICE</span><span class=o>=</span><span class=s2>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ONBOOT</span><span class=o>=</span><span class=s2>&#34;yes&#34;</span></span></span></code></pre></div></div></div></div><p>Обратим внимание на опцию <strong>BOOTPROTO</strong>. По умолчанию, в опции <strong>BOOTPROTO</strong> прописано <code>dhcp</code>. Это означает, что сетевой интерфейс получает информацию о сети автоматически от DHCP. Сама опция <strong>BOOTPROTO</strong> может принимать следующие значения:</p><ul><li><code>none</code> – не использовать протокол.</li><li><code>bootp</code> – использование протокола <strong>bootp</strong>.</li><li><code>dhcp</code> – использование протокола <strong>dhcp</strong> (по умолчанию).</li></ul><p>Для настройки статического IP необходимо установит <strong>BOOTPROTO</strong> в <code>none</code> и дописать в конец файла опции:</p><ul><li><code>IPADDR</code> - IP адрес.</li><li><code>PREFIX</code> - маска сети.</li><li><code>GATEWAY</code> - шлюз сети.</li><li><code>DNS</code> - серверы DNS.</li></ul><p>Например:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-ini"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-27363534b0f956078f9aa95a717960d0><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>TYPE</span><span class=o>=</span><span class=s>&#34;Ethernet&#34;</span>
</span></span><span class=line><span class=cl><span class=na>PROXY_METHOD</span><span class=o>=</span><span class=s>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=na>BROWSER_ONLY</span><span class=o>=</span><span class=s>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=na>BOOTPROTO</span><span class=o>=</span><span class=s>&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DEFROUTE</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV4_FAILURE_FATAL</span><span class=o>=</span><span class=s>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6INIT</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_AUTOCONF</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_DEFROUTE</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_FAILURE_FATAL</span><span class=o>=</span><span class=s>&#34;no&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPV6_ADDR_GEN_MODE</span><span class=o>=</span><span class=s>&#34;stable-privacy&#34;</span>
</span></span><span class=line><span class=cl><span class=na>NAME</span><span class=o>=</span><span class=s>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=na>UUID</span><span class=o>=</span><span class=s>&#34;&lt;DEVICE_ID&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DEVICE</span><span class=o>=</span><span class=s>&#34;enp1s0&#34;</span>
</span></span><span class=line><span class=cl><span class=na>ONBOOT</span><span class=o>=</span><span class=s>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl><span class=na>IPADDR</span><span class=o>=</span><span class=s>&#34;192.168.10.55&#34;</span>
</span></span><span class=line><span class=cl><span class=na>PREFIX</span><span class=o>=</span><span class=s>&#34;24&#34;</span>
</span></span><span class=line><span class=cl><span class=na>GATEWAY</span><span class=o>=</span><span class=s>&#34;192.168.10.1&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DNS1</span><span class=o>=</span><span class=s>&#34;192.168.11.1&#34;</span>
</span></span><span class=line><span class=cl><span class=na>DNS1</span><span class=o>=</span><span class=s>&#34;192.168.12.1&#34;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-27363534b0f956078f9aa95a717960d0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>После указания всех параметров, необходимо перезапустить интерфейс:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e270c9a5b8abd218b73d322659c0e10d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-e270c9a5b8abd218b73d322659c0e10d><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con down enp1s0 <span class=o>&amp;&amp;</span> nmcli con up enp1s0</span></span></code></pre></div></div></div></div><h2>Настройка IP при помощи Network Manager CLI (nmcli)</h2><p>Установка IP адреса:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9b915be71324d82014511b02f5f2ae4f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-9b915be71324d82014511b02f5f2ae4f><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.addresses <span class=s1>&#39;192.168.10.55/24&#39;</span></span></span></code></pre></div></div></div></div><p>Установка шлюза:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-34f6fd2e17dc5c35c022181d61ff2c52 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-34f6fd2e17dc5c35c022181d61ff2c52><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.gateway <span class=s1>&#39;192.168.10.1&#39;</span></span></span></code></pre></div></div></div></div><p>Установка DNS:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-56cc7ac67e98e45577a30d8846b2f424 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-56cc7ac67e98e45577a30d8846b2f424><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.dns <span class=s1>&#39;192.168.11.1&#39;</span></span></span></code></pre></div></div></div></div><p>Установка <strong>BOOTPROTO</strong> в <code>none</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-a0d8c2c8bc6358085de6340431afe55f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-a0d8c2c8bc6358085de6340431afe55f><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con mod enp1s0 ipv4.method <span class=s1>&#39;manual&#39;</span></span></span></code></pre></div></div></div></div><p>Перезапуск интерфейса:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-8 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b0909eeaf70efa3147b5a9b8acc266b0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-b0909eeaf70efa3147b5a9b8acc266b0><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nmcli con down enp1s0 <span class=o>&amp;&amp;</span> nmcli con up enp1s0</span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/ip/>#ip</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-05-15T17:08:30Z data-fn=date-local>2021/05/15 17:08:30 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Перезагрузка и выключение Linux" class=d-block href=/ru/articles/2021/05/86db7f3a-17ce-502b-b21d-337c3bba5d58/ data-bs-toggle=modal data-bs-target=#modal-983478b7bdda568986722e518392c886><picture><source srcset='https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Перезагрузка и выключение Linux"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/86db7f3a-17ce-502b-b21d-337c3bba5d58/ data-bs-toggle=modal data-bs-target=#modal-983478b7bdda568986722e518392c886>Перезагрузка и выключение Linux</a></h2></div></header><div class=node-body><p>Нередко приходится завершать работу системы через терминал, например, когда компьютер является удалённой рабочей станцией или сервером и вся работа происходит через терминал. В этой статье я постараюсь привести информацию о командах, позволяющих удалённо завершить работу системы.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Перезагрузка и выключение Linux" class=d-block href=/ru/articles/2021/05/86db7f3a-17ce-502b-b21d-337c3bba5d58/ data-bs-toggle=modal data-bs-target=#modal-983478b7bdda568986722e518392c886><img class="d-block rounded" src="https://images.unsplash.com/photo-1611780427130-996d9882dc41?crop=top&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Перезагрузка и выключение Linux"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/86db7f3a-17ce-502b-b21d-337c3bba5d58/ data-bs-toggle=modal data-bs-target=#modal-983478b7bdda568986722e518392c886>Перезагрузка и выключение Linux</a></h2></div></header><div class=node-body><p>Нередко приходится завершать работу системы через терминал, например, когда компьютер является удалённой рабочей станцией или сервером и вся работа происходит через терминал. В этой статье я постараюсь привести информацию о командах, позволяющих удалённо завершить работу системы.</p></div></div></article></div><div class="modal fade" id=modal-983478b7bdda568986722e518392c886 tabindex=-1 aria-labelledby=modal-983478b7bdda568986722e518392c886-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-983478b7bdda568986722e518392c886-label><a href=/ru/articles/2021/05/86db7f3a-17ce-502b-b21d-337c3bba5d58/>Перезагрузка и выключение Linux</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Нередко приходится завершать работу системы через терминал, например, когда компьютер является удалённой рабочей станцией или сервером и вся работа происходит через терминал. В этой статье я постараюсь привести информацию о командах, позволяющих удалённо завершить работу системы.</p><h2>halt / poweroff / reboot</h2><p>Старые команды по управлению питанием системы. Опции у этих команд одинаковые. Отдаются команды из под пользователя <strong>root</strong>. Команда <code>halt</code> приостанавливает все функции CPU, но сам ПК остаётся включённым. Команда <code>poweroff</code> отключает питание ПК, посылая сигнал по ACPI. Команда <code>reboot</code> даёт команду системе на перезагрузку.</p><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Команда <code>halt</code> в современных ОС полностью прекращает работу системы. На системах с <strong>systemd</strong> команда <code>halt</code> является устаревшей и представляет собой символьную ссылку на утилиту <code>systemctl</code>.</p></div></div></div><p>Предпочтительнее использовать команду <code>shutdown</code>, о которой я расскажу ниже.</p><h3>Синтаксис</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-text"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-734ae363a36598b3e4292aef684f3ee1><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>halt [OPTION]
</span></span><span class=line><span class=cl>poweroff [OPTION]
</span></span><span class=line><span class=cl>reboot [OPTION]</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-734ae363a36598b3e4292aef684f3ee1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h4>Некоторые опции</h4><ul><li><code>-f</code> - принудительное выполнение команды.</li><li><code>-p</code> - сообщает команде <code>halt</code> действовать как <code>poweroff</code>.</li><li><code>-w</code> - не выполнять никакие действия, только записать в журнал <code>/var/log/wtmp</code> сообщение о завершении работы.</li></ul><h2>shutdown</h2><p>За остановку работы ПК отвечает команда <code>shutdown</code>. Она поддерживает несколько опций, через которые задаётся определённое действие. К примеру:</p><ul><li><code>-r</code> - перезагрузка.</li><li><code>-h</code> - выключение.</li><li><code>-c</code> - отмена запланированных действий на перезагрузку или выключение.</li></ul><p>Для запланированной перезагрузки ПК через 1 минуту используется опция <code>-r</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-92ca785a247c912d68e9711c37c044f0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-92ca785a247c912d68e9711c37c044f0><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shutdown -r</span></span></code></pre></div></div></div></div><p>Команда <code>shutdown</code> поддерживает указание времени, когда ПК должен быть перезагружен или выключен. К примеру, перезагрузить через 5 минут:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f33ae4b5ab662c76a8b9ab35039f0e00 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-f33ae4b5ab662c76a8b9ab35039f0e00><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shutdown -r +5</span></span></code></pre></div></div></div></div><p>Также можно указать конкретное время для перезагрузки. Например, перезагрузить ПК в 18:30:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cf8f7a1e1a85e6af54a131a2d85991b0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-cf8f7a1e1a85e6af54a131a2d85991b0><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shutdown -r 18:30</span></span></code></pre></div></div></div></div><p>Если перезагрузка или выключение уже запланированы, их можно отменить опцией <code>-c</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-40aa395cc3150d9d2d3824131d9c5b7d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-40aa395cc3150d9d2d3824131d9c5b7d><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shutdown -c</span></span></code></pre></div></div></div></div><p>Для немедленной перезагрузки ПК, вместо времени можно ввести <code>now</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-55c57b36aaffe0e3f1a05994777a0404 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-55c57b36aaffe0e3f1a05994777a0404><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shutdown -r now</span></span></code></pre></div></div></div></div><p>Чтобы выключить ПК через 1 минуту, используется опция <code>-h</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-43fba71c17e0773e0465056a7b8e921c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-43fba71c17e0773e0465056a7b8e921c><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>shutdown -h</span></span></code></pre></div></div></div></div><p>На этом всё, ничего сложного нет. <span class="shortcode shortcode-emoji">😄</span></p></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/linux/>#linux</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/terminal/>#terminal</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/halt/>#halt</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/poweroff/>#poweroff</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/reboot/>#reboot</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/shutdown/>#shutdown</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-05-12T14:20:47Z data-fn=date-local>2021/05/12 14:20:47 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Рекурсивное изменение прав доступа на файлы и директории" class=d-block href=/ru/articles/2021/05/4a3b0a31-0d3d-5a9b-8c07-7e3b4f80669e/ data-bs-toggle=modal data-bs-target=#modal-3df1b1b7de5b463a5859f297c951103f><picture><source srcset='https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Рекурсивное изменение прав доступа на файлы и директории"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/4a3b0a31-0d3d-5a9b-8c07-7e3b4f80669e/ data-bs-toggle=modal data-bs-target=#modal-3df1b1b7de5b463a5859f297c951103f>Рекурсивное изменение прав доступа на файлы и директории</a></h2></div></header><div class=node-body><p>Права доступа к файлам и директориям является неотъемлемой частью любой операционной системы. И в этой статье описаны возможности по рекурсивной настройке этих прав доступа.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Рекурсивное изменение прав доступа на файлы и директории" class=d-block href=/ru/articles/2021/05/4a3b0a31-0d3d-5a9b-8c07-7e3b4f80669e/ data-bs-toggle=modal data-bs-target=#modal-3df1b1b7de5b463a5859f297c951103f><img class="d-block rounded" src="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Рекурсивное изменение прав доступа на файлы и директории"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/4a3b0a31-0d3d-5a9b-8c07-7e3b4f80669e/ data-bs-toggle=modal data-bs-target=#modal-3df1b1b7de5b463a5859f297c951103f>Рекурсивное изменение прав доступа на файлы и директории</a></h2></div></header><div class=node-body><p>Права доступа к файлам и директориям является неотъемлемой частью любой операционной системы. И в этой статье описаны возможности по рекурсивной настройке этих прав доступа.</p></div></div></article></div><div class="modal fade" id=modal-3df1b1b7de5b463a5859f297c951103f tabindex=-1 aria-labelledby=modal-3df1b1b7de5b463a5859f297c951103f-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-3df1b1b7de5b463a5859f297c951103f-label><a href=/ru/articles/2021/05/4a3b0a31-0d3d-5a9b-8c07-7e3b4f80669e/>Рекурсивное изменение прав доступа на файлы и директории</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Права доступа к файлам и директориям является неотъемлемой частью любой операционной системы. И в этой статье описаны возможности по рекурсивной настройке этих прав доступа.</p><p>Изменение прав доступа осуществляется при помощи команды <code>chmod</code>, рекурсивное при добавлении опции <code>-R</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-669efc4f48177524d1a23ed377d6a95f><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>chmod -R MODE DIR</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-669efc4f48177524d1a23ed377d6a95f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><ul><li><code>-R</code> - рекурсивный обход директорий и файлов.</li><li><code>MODE</code> - набор прав доступа для их установки.</li><li><code>DIR</code> - файл или директория, у которых необходимо установить определённые права доступа.</li></ul><p>В итоге, команда должна выглядеть так:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-5b4e437701d0cea5063593e7087851cd><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>chmod -R <span class=m>755</span> /var/www/html</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5b4e437701d0cea5063593e7087851cd role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Но, стоит учитывать, что таким образом директории и файлы примут одинаковые права доступа. Чтобы избежать этого, можно воспользоваться командой <code>find</code>, которая отфильтрует директории и файлы друг от друга:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-81b3fb3c2e5be8cb52c90e355ea640f3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find /var/www/html -type d -exec chmod <span class=m>755</span> <span class=o>{}</span> <span class=se>\;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-81b3fb3c2e5be8cb52c90e355ea640f3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-4c304ca14d67b1ab82f412aca0e05b42><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find /var/www/html -type f -exec chmod <span class=m>644</span> <span class=o>{}</span> <span class=se>\;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4c304ca14d67b1ab82f412aca0e05b42 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Команда <code>find</code> ищет директории (<code>-type d</code>) и файлы (<code>-type f</code>) и скармливает их команде <code>chmod</code>, а та, в свою очередь, уже расставляет права доступа. При использовании <code>-exec</code>, <code>chmod</code> выполняется для каждого найденного элемента поочерёдно. Можно оптимизировать и записать с использованием <code>xargs</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-a29935a8c6e3a672d4f25158d5271c3f><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find /var/www/html -type d -print0 <span class=p>|</span> xargs -0 chmod <span class=m>755</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-a29935a8c6e3a672d4f25158d5271c3f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9f9814996e8e95c57134efcda76fedc6><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find /var/www/html -type f -print0 <span class=p>|</span> xargs -0 chmod <span class=m>644</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9f9814996e8e95c57134efcda76fedc6 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>При <code>xargs</code>, <code>chmod</code> выполняется сразу для нескольких записей одновременно, как сообщает <strong>Daniel Miessler</strong>:</p><div class="shortcode shortcode-quote"><figure><blockquote class=blockquote><p>This is where -exec breaks down and xargs shows its superiority. When you use -exec to do the work you run a separate instance of the called program for each element of input. So if find comes up with 10,000 results, you run exec 10,000 times. With xargs, you build up the input into bundles and run them through the command as few times as possible, which is often just once. When dealing with hundreds or thousands of elements this is a big win for xargs.</p></blockquote><figcaption class=blockquote-footer><cite><a href=https://danielmiessler.com/blog/linux-xargs-vs-exec/ target=_blank rel="noopener nofollow">Daniel Miessler</a></cite></figcaption></figure></div><p>Если необходимо запустить рекурсивное изменение прав доступа начиная с текущей директории, то <code>/var/www/html</code> необходимо поменять на точку:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-4593eefa5d5ae67adf7eeb386d7df21d><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find . -type d -print0 <span class=p>|</span> xargs -0 chmod <span class=m>755</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4593eefa5d5ae67adf7eeb386d7df21d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-sh"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-0a63727146b3ab68c8199e0b1b58783d><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>find . -type f -print0 <span class=p>|</span> xargs -0 chmod <span class=m>644</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-0a63727146b3ab68c8199e0b1b58783d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/linux/>#linux</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/terminal/>#terminal</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/chmod/>#chmod</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/find/>#find</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-05-09T17:15:26Z data-fn=date-local>2021/05/09 17:15:26 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Разнообразие команд ls*" class=d-block href=/ru/articles/2021/05/5ba03b8a-0505-5d80-bfad-f7a4d66f07b0/ data-bs-toggle=modal data-bs-target=#modal-bb7c3fe8a315f8b29387dd9ec5094715><picture><source srcset='https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Разнообразие команд ls*"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/5ba03b8a-0505-5d80-bfad-f7a4d66f07b0/ data-bs-toggle=modal data-bs-target=#modal-bb7c3fe8a315f8b29387dd9ec5094715>Разнообразие команд ls*</a></h2></div></header><div class=node-body><p>Команда <code>ls</code> и её разновидности позволяют вывести список директорий, файлов, устройств и различной другой информации. Я расскажу только о некоторых командах <code>ls*</code>, которые присутствуют в большинстве дистрибутивов Linux.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Разнообразие команд ls*" class=d-block href=/ru/articles/2021/05/5ba03b8a-0505-5d80-bfad-f7a4d66f07b0/ data-bs-toggle=modal data-bs-target=#modal-bb7c3fe8a315f8b29387dd9ec5094715><img class="d-block rounded" src="https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Разнообразие команд ls*"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2021/05/5ba03b8a-0505-5d80-bfad-f7a4d66f07b0/ data-bs-toggle=modal data-bs-target=#modal-bb7c3fe8a315f8b29387dd9ec5094715>Разнообразие команд ls*</a></h2></div></header><div class=node-body><p>Команда <code>ls</code> и её разновидности позволяют вывести список директорий, файлов, устройств и различной другой информации. Я расскажу только о некоторых командах <code>ls*</code>, которые присутствуют в большинстве дистрибутивов Linux.</p></div></div></article></div><div class="modal fade" id=modal-bb7c3fe8a315f8b29387dd9ec5094715 tabindex=-1 aria-labelledby=modal-bb7c3fe8a315f8b29387dd9ec5094715-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5" id=modal-bb7c3fe8a315f8b29387dd9ec5094715-label><a href=/ru/articles/2021/05/5ba03b8a-0505-5d80-bfad-f7a4d66f07b0/>Разнообразие команд ls*</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Команда <code>ls</code> и её разновидности позволяют вывести список директорий, файлов, устройств и различной другой информации. Я расскажу только о некоторых командах <code>ls*</code>, которые присутствуют в большинстве дистрибутивов Linux.</p><p>Знаю, что есть <code>lsscsi</code>, <code>lsusb</code> и т.п., которые появляются в системе с установкой дополнительных пакетов, но я подобные команды рассматривать не стал. Хотя, по возможности, статью буду дополнять.</p><h2>ls</h2><p>Команда позволяет вывести список директорий и файлов в текущем каталоге.</p><h3>Некоторые опции</h3><ul><li><code>-l</code> - использовать длинный формат отображения.</li><li><code>-S</code> - сортировать по размеру файла.</li><li><code>-t</code> - сортировать по времени модификации.</li><li><code>-a</code> - показать ВСЕ файлы, в том числе скрытые.</li><li><code>-R</code> - рекурсивное отображение директорий и файлов в них.</li><li><code>-h</code> - отображение размеров файлов в человеко-читаемом формате.</li><li><code>--hide='*.txt' -l</code> - игнорировать файлы с форматом <code>.txt</code>.</li></ul><h2>lscpu</h2><p>Отображение доступной информации об установленном процессоре.</p><h3>Некоторые опции</h3><ul><li><code>-a</code> - показать ВСЕ CPU, как включённые, так и отключённые.</li></ul><h3>Пример использования</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3f4708b20190cd4df96137c2e395093f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-3f4708b20190cd4df96137c2e395093f><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lscpu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Architecture:                    x86_64
</span></span><span class=line><span class=cl>CPU op-mode<span class=o>(</span>s<span class=o>)</span>:                  32-bit, 64-bit
</span></span><span class=line><span class=cl>Byte Order:                      Little Endian
</span></span><span class=line><span class=cl>Address sizes:                   <span class=m>39</span> bits physical, <span class=m>48</span> bits virtual
</span></span><span class=line><span class=cl>CPU<span class=o>(</span>s<span class=o>)</span>:                          <span class=m>12</span>
</span></span><span class=line><span class=cl>On-line CPU<span class=o>(</span>s<span class=o>)</span> list:             0-11
</span></span><span class=line><span class=cl>Thread<span class=o>(</span>s<span class=o>)</span> per core:              <span class=m>2</span>
</span></span><span class=line><span class=cl>Core<span class=o>(</span>s<span class=o>)</span> per socket:              <span class=m>6</span>
</span></span><span class=line><span class=cl>Socket<span class=o>(</span>s<span class=o>)</span>:                       <span class=m>1</span>
</span></span><span class=line><span class=cl>NUMA node<span class=o>(</span>s<span class=o>)</span>:                    <span class=m>1</span>
</span></span><span class=line><span class=cl>Vendor ID:                       GenuineIntel
</span></span><span class=line><span class=cl>CPU family:                      <span class=m>6</span>
</span></span><span class=line><span class=cl>Model:                           <span class=m>165</span>
</span></span><span class=line><span class=cl>Model name:                      Intel<span class=o>(</span>R<span class=o>)</span> Core<span class=o>(</span>TM<span class=o>)</span> i5-10400 CPU @ 2.90GHz
</span></span><span class=line><span class=cl>Stepping:                        <span class=m>5</span>
</span></span><span class=line><span class=cl>CPU MHz:                         2900.000
</span></span><span class=line><span class=cl>CPU max MHz:                     4300.0000
</span></span><span class=line><span class=cl>CPU min MHz:                     800.0000
</span></span><span class=line><span class=cl>BogoMIPS:                        5799.77
</span></span><span class=line><span class=cl>L1d cache:                       <span class=m>192</span> KiB
</span></span><span class=line><span class=cl>L1i cache:                       <span class=m>192</span> KiB
</span></span><span class=line><span class=cl>L2 cache:                        1.5 MiB
</span></span><span class=line><span class=cl>L3 cache:                        <span class=m>12</span> MiB</span></span></code></pre></div></div></div></div><h2>lspci</h2><p>Отображение информации по шине PCI и подключённых к ней устройствах.</p><h3>Пример использования</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-af067a3575effb83af88e07463b84c1b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-af067a3575effb83af88e07463b84c1b><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lspci
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>00:00.0 Host bridge: Intel Corporation Comet Lake-S 6c Host Bridge/DRAM Controller <span class=o>(</span>rev 05<span class=o>)</span>
</span></span><span class=line><span class=cl>00:01.0 PCI bridge: Intel Corporation 6th-10th Gen Core Processor PCIe Controller <span class=o>(</span>x16<span class=o>)</span> <span class=o>(</span>rev 05<span class=o>)</span>
</span></span><span class=line><span class=cl>00:14.0 USB controller: Intel Corporation Comet Lake USB 3.1 xHCI Host Controller
</span></span><span class=line><span class=cl>00:14.2 RAM memory: Intel Corporation Comet Lake PCH Shared SRAM
</span></span><span class=line><span class=cl>00:14.3 Network controller: Intel Corporation Comet Lake PCH CNVi WiFi
</span></span><span class=line><span class=cl>00:15.0 Serial bus controller <span class=o>[</span>0c80<span class=o>]</span>: Intel Corporation Comet Lake PCH Serial IO I2C Controller <span class=c1>#0</span>
</span></span><span class=line><span class=cl>00:15.1 Serial bus controller <span class=o>[</span>0c80<span class=o>]</span>: Intel Corporation Comet Lake PCH Serial IO I2C Controller <span class=c1>#1</span>
</span></span><span class=line><span class=cl>00:16.0 Communication controller: Intel Corporation Comet Lake HECI Controller
</span></span><span class=line><span class=cl>00:17.0 SATA controller: Intel Corporation Comet Lake SATA AHCI Controller
</span></span><span class=line><span class=cl>00:1d.0 PCI bridge: Intel Corporation Comet Lake PCI Express Root Port <span class=c1>#9 (rev f0)</span>
</span></span><span class=line><span class=cl>00:1f.0 ISA bridge: Intel Corporation Device <span class=m>0684</span>
</span></span><span class=line><span class=cl>00:1f.3 Audio device: Intel Corporation Comet Lake PCH cAVS
</span></span><span class=line><span class=cl>00:1f.4 SMBus: Intel Corporation Comet Lake PCH SMBus Controller
</span></span><span class=line><span class=cl>00:1f.5 Serial bus controller <span class=o>[</span>0c80<span class=o>]</span>: Intel Corporation Comet Lake PCH SPI Controller
</span></span><span class=line><span class=cl>00:1f.6 Ethernet controller: Intel Corporation Ethernet Connection <span class=o>(</span>11<span class=o>)</span> I219-V
</span></span><span class=line><span class=cl>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. <span class=o>[</span>AMD/ATI<span class=o>]</span> Baffin <span class=o>[</span>Radeon RX <span class=m>550</span> 640SP / RX 560/560X<span class=o>]</span> <span class=o>(</span>rev cf<span class=o>)</span>
</span></span><span class=line><span class=cl>01:00.1 Audio device: Advanced Micro Devices, Inc. <span class=o>[</span>AMD/ATI<span class=o>]</span> Baffin HDMI/DP Audio <span class=o>[</span>Radeon RX <span class=m>550</span> 640SP / RX 560/560X<span class=o>]</span></span></span></code></pre></div></div></div></div><h2>lsblk</h2><p>Отображение информации по блочным устройствам.</p><h3>Пример использования</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3d1a253fe9618399dedfb5c61b4ae2e8 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-3d1a253fe9618399dedfb5c61b4ae2e8><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsblk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
</span></span><span class=line><span class=cl>sda      8:0    <span class=m>0</span> 232.9G  <span class=m>0</span> disk
</span></span><span class=line><span class=cl>├─sda1   8:1    <span class=m>0</span>   200M  <span class=m>0</span> part /boot/efi
</span></span><span class=line><span class=cl>├─sda2   8:2    <span class=m>0</span>     4G  <span class=m>0</span> part /boot
</span></span><span class=line><span class=cl>├─sda3   8:3    <span class=m>0</span>    64G  <span class=m>0</span> part /
</span></span><span class=line><span class=cl>├─sda4   8:4    <span class=m>0</span>    32G  <span class=m>0</span> part <span class=o>[</span>SWAP<span class=o>]</span>
</span></span><span class=line><span class=cl>├─sda5   8:5    <span class=m>0</span>    16G  <span class=m>0</span> part /tmp
</span></span><span class=line><span class=cl>└─sda6   8:6    <span class=m>0</span> 116.7G  <span class=m>0</span> part /home
</span></span><span class=line><span class=cl>sdb      8:16   <span class=m>0</span> 465.8G  <span class=m>0</span> disk
</span></span><span class=line><span class=cl>└─sdb1   8:17   <span class=m>0</span> 465.8G  <span class=m>0</span> part /home/storage.01
</span></span><span class=line><span class=cl>sdc      8:32   <span class=m>1</span> 119.5G  <span class=m>0</span> disk
</span></span><span class=line><span class=cl>└─sdc1   8:33   <span class=m>1</span> 119.5G  <span class=m>0</span> part /run/media/user-0001/USB01
</span></span><span class=line><span class=cl>sdd      8:48   <span class=m>1</span>  59.8G  <span class=m>0</span> disk
</span></span><span class=line><span class=cl>├─sdd1   8:49   <span class=m>1</span>  59.7G  <span class=m>0</span> part /run/media/user-0001/Ventoy
</span></span><span class=line><span class=cl>└─sdd2   8:50   <span class=m>1</span>    32M  <span class=m>0</span> part /run/media/user-0001/VTOYEFI
</span></span><span class=line><span class=cl>zram0  252:0    <span class=m>0</span>     4G  <span class=m>0</span> disk <span class=o>[</span>SWAP<span class=o>]</span></span></span></code></pre></div></div></div></div><h2>lsmod</h2><p>Отображение модулей ядра, загруженных в системе.</p><h3>Пример использования</h3><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b11d50c05a10a1486736875ac54fe9cc role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-b11d50c05a10a1486736875ac54fe9cc><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsmod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Module                  Size  Used by
</span></span><span class=line><span class=cl>exfat                  <span class=m>81920</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>f2fs                  <span class=m>700416</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>uas                    <span class=m>32768</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>usb_storage            <span class=m>81920</span>  <span class=m>4</span> uas
</span></span><span class=line><span class=cl>snd_seq_dummy          <span class=m>16384</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>rfcomm                 <span class=m>90112</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>snd_hrtimer            <span class=m>16384</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>xt_CHECKSUM            <span class=m>16384</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>xt_MASQUERADE          <span class=m>20480</span>  <span class=m>3</span>
</span></span><span class=line><span class=cl>xt_conntrack           <span class=m>16384</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>ipt_REJECT             <span class=m>16384</span>  <span class=m>2</span>
</span></span><span class=line><span class=cl>nft_compat             <span class=m>20480</span>  <span class=m>16</span>
</span></span><span class=line><span class=cl>nf_nat_tftp            <span class=m>16384</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>nft_objref             <span class=m>16384</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>nf_conntrack_tftp      <span class=m>20480</span>  <span class=m>3</span> nf_nat_tftp
</span></span><span class=line><span class=cl>nft_counter            <span class=m>16384</span>  <span class=m>33</span>
</span></span><span class=line><span class=cl>tun                    <span class=m>57344</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>bridge                <span class=m>294912</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>stp                    <span class=m>16384</span>  <span class=m>1</span> bridge
</span></span><span class=line><span class=cl>llc                    <span class=m>16384</span>  <span class=m>2</span> bridge,stp</span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/linux/>#linux</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/terminal/>#terminal</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ls/>#ls</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2021-05-09T13:44:05Z data-fn=date-local>2021/05/09 13:44:05 UTC</time></li></ul></div></div></div></div></div></div></div></div></main><footer class="mt-auto border-top bg-light"><div class="section py-5 border-bottom"><div class=container><div class="row g-3"><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">О проекте</h2><div class=node-body><p>Заметки по системному администрированию и веб-разработкам.</p></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Ресурсы</h2><div class=node-body><ul><li><a title href=https://kitsune.solar/ target=_blank rel="noopener noreferrer nofollow">Kitsune Solar</a></li><li><a title href=https://uaik.github.io/ target=_blank rel="noopener noreferrer nofollow">UNIX AIK</a></li></ul></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Контакты</h2><div class=node-body><ul><li><a title href=mailto:mail@lib.onl target=_self rel>Email</a></li></ul></div></article></div></div></div></div><div class="section py-3"><div class=container><div class="row row-cols-1 row-cols-lg-2 small text-body-secondary align-items-center"><div class="col text-center text-lg-start"><ul class="list-inline mb-0"><li class=list-inline-item><div>Library Online &copy; 2023</div><div>Заметки на тему администрирования и разработки различных систем, приложений и серверов.</div></li></ul></div><div class="col text-center text-lg-end"><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=RSS><a class="btn btn-light btn-sm" href=/ru/categories/terminal/index.xml target=_blank aria-label=RSS><i class="fas fa-rss fa-fw"></i></a></li><li class="list-inline-item dropup" data-bs-tooltip data-bs-title=Языки><a class="dropdown-toggle btn btn-light btn-sm" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false aria-label=Языки><i class="fas fa-language fa-fw"></i></a><div class="dropdown-menu dropdown-menu-end shadow"><a class=dropdown-item href=/ru/ hreflang=ru>Русский
</a><a class=dropdown-item href=/en/ hreflang=en>English</a></div></li></ul></div></div></div></div></footer><div class="modal fade" id=search-modal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-xl"><div class=modal-content><div class=modal-header><h5 class=modal-title id=searchModalLabel>Поиск</h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class="modal-body node-body"><div class="row row-cols-1 g-3"><div class=col><div class="row g-3"><div class=col-lg><form action=https://google.com/search method=get class=d-flex target=_blank><input type=hidden name=domains value=lib.onl>
<input type=hidden name=sitesearch value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=q placeholder='Поиск Google' aria-label='Поиск Google'>
<span class=input-group-text><i class="fab fa-google fa-fw"></i></span></div></form></div><div class=col-lg><form action=https://ya.ru/search method=get class=d-flex target=_blank><input type=hidden name=site value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=text placeholder='Поиск Яндекс' aria-label='Поиск Яндекс'>
<span class=input-group-text><i class="fab fa-yandex fa-fw"></i></span></div></form></div></div></div><div class=col><form id=search-form method=get class=d-flex autocomplete=off><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input id=search-input type=search class=form-control name=q placeholder='Внутренний поиск' aria-label='Внутренний поиск'>
<span class=input-group-text><i class="fas fa-brain fa-fw"></i></span></div></form></div><div class=col><div class="list-group list-group-flush d-none overflow-auto" id=search-results></div><div id=search-help><div class="alert alert-info d-flex align-items-center overflow-hidden node-body" id=alert-9c0ceec4a94d5711138e7e0d2e1b4c38 role=alert><div class=flex-shrink-0><i class="fas fa-search fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Используется нечёткий поиск (приблизительное сопоставление строк).
Это метод поиска строк, которые приблизительно соответствуют поисковому шаблону.</p><p>Результаты поиска сортируются по точности совпадения с поисковым шаблоном.
Результаты поиска, наиболее точно соответствующие запросу, находятся сверху, приблизительные результаты - снизу.</p></div></div></div></div></div></div></div></div></div><script src=/js/vendor.bundle.min.js defer></script><script src=/ru/js/system.bundle.min.js defer></script></body></html>