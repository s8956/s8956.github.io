<!doctype html><html class=h-100 dir=ltr lang=ru-RU prefix="og: http://ogp.me/ns#
      article: http://ogp.me/ns/article#
      profile: http://ogp.me/ns/profile#
      fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>powershell / Library Online</title>
<meta name=title content="powershell / Library Online"><meta name=description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta name=keywords content="powershell,forum,ipb,ips,debian,linux,cmd,cmf,cms,vbulletin,bash,cloudflare,fedora,git,php,systemd,terminal,dhcp,find,gdm"><link rel=preconnect href=https://fonts.googleapis.com crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link rel=preconnect href=https://gravatar.com crossorigin=anonymous><link rel=preconnect href=https://images.unsplash.com crossorigin=anonymous><link rel=preload href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href=/css/vendor.bundle.css as=style><link rel=stylesheet href=/css/vendor.bundle.css><link rel=preload href=/ru/css/system.bundle.min.css as=style><link rel=stylesheet href=/ru/css/system.bundle.min.css><link rel=icon type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel="shortcut icon" type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=apple-touch-icon sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=icon type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel="shortcut icon" type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=apple-touch-icon sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=icon type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel="shortcut icon" type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=apple-touch-icon sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=icon type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel="shortcut icon" type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=apple-touch-icon sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=icon type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel="shortcut icon" type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=apple-touch-icon sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=icon type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel="shortcut icon" type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=apple-touch-icon sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=icon type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel="shortcut icon" type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=apple-touch-icon sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=icon type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel="shortcut icon" type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=apple-touch-icon sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=icon type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel="shortcut icon" type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=apple-touch-icon sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=icon type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel="shortcut icon" type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=apple-touch-icon sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=icon type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel="shortcut icon" type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=apple-touch-icon sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=icon type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel="shortcut icon" type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=apple-touch-icon sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=icon type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel="shortcut icon" type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=apple-touch-icon sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=icon type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel="shortcut icon" type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=apple-touch-icon sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=icon type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel="shortcut icon" type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=apple-touch-icon sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=icon type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel="shortcut icon" type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=apple-touch-icon sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=icon type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel="shortcut icon" type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=apple-touch-icon sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=icon type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel="shortcut icon" type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=apple-touch-icon sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=icon type=image/svg+xml sizes=any href=https://lib.onl/favicon.svg><link rel="shortcut icon" type=image/x-icon href=https://lib.onl/favicon.ico><link rel="shortcut icon" type=image/vnd.microsoft.icon href=https://lib.onl/favicon.ico><link rel=first href=https://lib.onl/ru/tags/powershell/><link rel=last href=https://lib.onl/ru/tags/powershell/><link rel=canonical href=https://lib.onl/ru/tags/powershell/><link rel=alternate href=https://lib.onl/ hreflang=x-default><link rel=alternate href=https://lib.onl/ru/tags/powershell/ hreflang=ru><link rel=manifest type=application/manifest+json href=https://lib.onl/ru/manifest.json title="Library Online"><link rel=search type=application/opensearchdescription+xml href=https://lib.onl/ru/opensearch.xml title="Library Online"><link rel=alternate type=application/rss+xml href=https://lib.onl/ru/tags/powershell/index.xml title="Library Online"><meta name=application-name content="Library Online"><meta name=theme-color content="#f8f9fa" media="(prefers-color-scheme: light)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lib.onl/favicon-512.png"><meta name=twitter:title content="powershell"><meta name=twitter:description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:title" content="powershell"><meta property="og:description" content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:type" content="website"><meta property="og:url" content="https://lib.onl/ru/tags/powershell/"><meta property="og:image" content="https://lib.onl/favicon-512.png"><meta property="twitter:domain" content="lib.onl"><meta property="twitter:url" content="https://lib.onl/ru/tags/powershell/"><meta property="og:locale" content="ru_RU"><meta property="og:site_name" content="Library Online"><meta name=DC.Title content="powershell"><meta name=DC.Subject content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta name=DC.Description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta name=DC.Type content="Text"><meta name=DC.Source content="https://lib.onl/ru/tags/powershell/"><meta name=DC.Relation content="https://lib.onl/ru/tags/powershell/"><meta name=DC.Coverage content="World"><meta name=DC.Creator content="Library Online"><meta name=DC.Publisher content="Library Online"><meta name=DC.Contributor content="Library Online"><meta name=DC.Rights content="Library Online"><meta name=DC.Format content="Digital"><meta name=DC.Identifier content="https://lib.onl/ru/tags/powershell/"><meta name=DC.Language content="ru-RU"><meta name=DC.Provenance content="Library Online"><meta name=DC.RightsHolder content="Library Online"><meta name=DC.AccrualPeriodicity content="Weekly"><meta name=DC.AccrualPolicy content="Active"></head><body class="d-flex flex-column h-100 is-node type-tags"><header id=site-header><nav class="navbar navbar-expand-lg navbar-light fixed-top border-bottom shadow-sm text-lg-center bg-light"><div class=container-fluid><a class=navbar-brand href=/ru/><img src=https://lib.onl/img/logo.min.svg alt=Логотип width=30 height=24 class="d-inline-block align-text-top"><h1 class="d-inline-block h5 m-0 ms-1">Library Online</h1></a><button type=button class=navbar-toggler data-bs-toggle=collapse data-bs-target=#navTopBar aria-controls=navTopBar aria-expanded=false aria-label='Переключить навигацию'>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navTopBar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/ru/articles/><i class="fas fa-book fa-fw"></i>
<span>Статьи</span></a></li><li class=nav-item><a class=nav-link href=/ru/faq/><i class="fas fa-circle-question fa-fw"></i>
<span>Q&amp;A</span></a></li><li class=nav-item><a class=nav-link href=/ru/archive/><i class="fas fa-archive fa-fw"></i>
<span>Архив</span></a></li><li class=nav-item><a class=nav-link href=/ru/about/><i class="fas fa-info-circle fa-fw"></i>
<span>О проекте</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-list fa-fw"></i>
<span>META</span></a><div class="dropdown-menu shadow"><a class=dropdown-item href=/ru/authors/><i class="fas fa-user-circle fa-fw"></i>
<span>Авторы</span>
</a><a class=dropdown-item href=/ru/categories/><i class="fas fa-folder-open fa-fw"></i>
<span>Категории</span>
</a><a class="dropdown-item active" href=/ru/tags/><i class="fas fa-tags fa-fw"></i>
<span>Теги</span>
</a><a class=dropdown-item href=/ru/drafts/><i class="fas fa-file-pen fa-fw"></i>
<span>Черновики</span></a></div></li></ul><ul class=navbar-nav><li class=nav-item><a class="nav-link d-lg-none" href=# data-bs-toggle=modal data-bs-target=#search-modal aria-label=Поиск><i class="fas fa-search fa-fw"></i>
<span>Поиск</span>
</a><a class="nav-link d-none d-lg-block" href=# data-bs-toggle=modal data-bs-target=#search-modal data-bs-tooltip data-bs-title=Поиск aria-label=Поиск><i class="fas fa-search fa-fw"></i></a></li></ul></div></div></nav></header><main class="wrapper flex-shrink-0" id=site-main><div class="section py-3"><div class=container><nav style="--bs-breadcrumb-divider:'\2f '" class=small aria-label=breadcrumb><ol class="breadcrumb bg-light p-2 rounded"><li class=breadcrumb-item><a href=/ru/ aria-label=Главная><i class="fas fa-home fa-fw"></i></a></li><li class=breadcrumb-item><a href=/ru/tags/ aria-label=Теги>Теги</a></li><li class="breadcrumb-item active">powershell</li></ol></nav><div class="row row-cols-1 row-cols-xl-2 g-3"><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Установка и настройка DHCP" class="d-flex align-items-center rounded overflow-hidden" href=/ru/drafts/2023/11/59becb4f-4f0d-5685-8966-632c6eff1a1f/ data-bs-toggle=modal data-bs-target=#modal-65c04e008eb5d241d098b5b28b13c9da><picture><source srcset='https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Установка и настройка DHCP" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/drafts/2023/11/59becb4f-4f0d-5685-8966-632c6eff1a1f/ data-bs-toggle=modal data-bs-target=#modal-65c04e008eb5d241d098b5b28b13c9da>Установка и настройка DHCP</a></h2></div></header><div class=node-body></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Установка и настройка DHCP" class="d-flex align-items-center rounded overflow-hidden" href=/ru/drafts/2023/11/59becb4f-4f0d-5685-8966-632c6eff1a1f/ data-bs-toggle=modal data-bs-target=#modal-65c04e008eb5d241d098b5b28b13c9da><img class=img-fluid src="https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Установка и настройка DHCP" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/drafts/2023/11/59becb4f-4f0d-5685-8966-632c6eff1a1f/ data-bs-toggle=modal data-bs-target=#modal-65c04e008eb5d241d098b5b28b13c9da>Установка и настройка DHCP</a></h2></div></header><div class=node-body></div></div></article></div><div class="modal fade" id=modal-65c04e008eb5d241d098b5b28b13c9da tabindex=-1 aria-labelledby=modal-65c04e008eb5d241d098b5b28b13c9da-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-65c04e008eb5d241d098b5b28b13c9da-label><a href=/ru/drafts/2023/11/59becb4f-4f0d-5685-8966-632c6eff1a1f/>Установка и настройка DHCP</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.dhcp.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-99356be45f85166257128978a4bcf3c1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.dhcp.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.dhcp.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-99356be45f85166257128978a4bcf3c1><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;ScopeStartRange&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>IPAddress</span><span class=p>]</span><span class=nv>$P_ScopeStartRange</span> <span class=p>=</span> <span class=mf>10.0</span><span class=p>.</span><span class=py>100</span><span class=p>.</span><span class=mf>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;ScopeEndRange&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>IPAddress</span><span class=p>]</span><span class=nv>$P_ScopeEndRange</span> <span class=p>=</span> <span class=mf>10.0</span><span class=p>.</span><span class=py>200</span><span class=p>.</span><span class=mf>254</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;ScopeMask&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>IPAddress</span><span class=p>]</span><span class=nv>$P_ScopeMask</span> <span class=p>=</span> <span class=mf>255.255</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;ScopeID&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>IPAddress</span><span class=p>]</span><span class=nv>$P_ScopeID</span> <span class=p>=</span> <span class=mf>10.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DNSServer&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>IPAddress[]</span><span class=p>]</span><span class=nv>$P_DNSServer</span> <span class=p>=</span> <span class=p>(</span><span class=mf>10.0</span><span class=p>.</span><span class=py>5</span><span class=p>.</span><span class=mf>3</span><span class=p>,</span> <span class=mf>10.0</span><span class=p>.</span><span class=py>4</span><span class=p>.</span><span class=mf>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DNSDomain&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>String</span><span class=p>]</span><span class=nv>$P_DNSDomain</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;Gateway&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>IPAddress[]</span><span class=p>]</span><span class=nv>$P_Gateway</span> <span class=p>=</span> <span class=mf>10.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>1</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvDhcpInstall</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvDhcpDatabase</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvDhcpScope</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvDhcpOptionValue</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvDhcpInDC</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvDhcpInstall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Install-WindowsFeature</span> <span class=n>-Name</span> <span class=s1>&#39;DHCP&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvDhcpDatabase</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$DhcpServerDatabase</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FileName</span> <span class=p>=</span> <span class=s1>&#39;D:\SRV\DHCP\DHCP.mdb&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>BackupPath</span> <span class=p>=</span> <span class=s1>&#39;D:\SRV\DHCP\Backup&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>BackupInterval</span> <span class=p>=</span> <span class=mf>30</span>
</span></span><span class=line><span class=cl>    <span class=n>CleanupInterval</span> <span class=p>=</span> <span class=mf>120</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Set-DhcpServerDatabase</span> <span class=nv>@DhcpServerDatabase</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvDhcpScope</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Scope99</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Main&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>StartRange</span> <span class=p>=</span> <span class=nv>$P_ScopeStartRange</span>
</span></span><span class=line><span class=cl>    <span class=n>EndRange</span> <span class=p>=</span> <span class=nv>$P_ScopeEndRange</span>
</span></span><span class=line><span class=cl>    <span class=n>SubnetMask</span> <span class=p>=</span> <span class=nv>$P_ScopeMask</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Add-DhcpServerv4Scope</span> <span class=nv>@Scope99</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvDhcpOptionValue</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$DhcpServerv4OptionValue</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ScopeId</span> <span class=p>=</span> <span class=nv>$P_ScopeID</span>
</span></span><span class=line><span class=cl>    <span class=n>DnsServer</span> <span class=p>=</span> <span class=nv>$P_DNSServer</span>
</span></span><span class=line><span class=cl>    <span class=n>DnsDomain</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${P_DNSDomain}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Router</span> <span class=p>=</span> <span class=nv>$P_Gateway</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Set-DhcpServerv4OptionValue</span> <span class=nv>@DhcpServerv4OptionValue</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvDhcpInDC</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$DhcpServerInDC</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DnsName</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${P_DnsName}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>IPAddress</span> <span class=p>=</span> <span class=nv>$P_IP</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Add-DhcpServerInDC</span> <span class=nv>@DhcpServerInDC</span>
</span></span><span class=line><span class=cl>  <span class=nb>Add-DhcpServerSecurityGroup</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/dhcp/>#dhcp</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-11-04T07:46:40Z data-fn=date-local>2023/11/04 07:46:40 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Установка и настройка Active Directory Domain Services" class="d-flex align-items-center rounded overflow-hidden" href=/ru/drafts/2023/11/67b83900-5070-5049-8760-edf0ee37e5f8/ data-bs-toggle=modal data-bs-target=#modal-757a60e793f6a2123dd87257171a68f2><picture><source srcset='https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Установка и настройка Active Directory Domain Services" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/drafts/2023/11/67b83900-5070-5049-8760-edf0ee37e5f8/ data-bs-toggle=modal data-bs-target=#modal-757a60e793f6a2123dd87257171a68f2>Установка и настройка Active Directory Domain Services</a></h2></div></header><div class=node-body></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Установка и настройка Active Directory Domain Services" class="d-flex align-items-center rounded overflow-hidden" href=/ru/drafts/2023/11/67b83900-5070-5049-8760-edf0ee37e5f8/ data-bs-toggle=modal data-bs-target=#modal-757a60e793f6a2123dd87257171a68f2><img class=img-fluid src="https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Установка и настройка Active Directory Domain Services" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/drafts/2023/11/67b83900-5070-5049-8760-edf0ee37e5f8/ data-bs-toggle=modal data-bs-target=#modal-757a60e793f6a2123dd87257171a68f2>Установка и настройка Active Directory Domain Services</a></h2></div></header><div class=node-body></div></div></article></div><div class="modal fade" id=modal-757a60e793f6a2123dd87257171a68f2 tabindex=-1 aria-labelledby=modal-757a60e793f6a2123dd87257171a68f2-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-757a60e793f6a2123dd87257171a68f2-label><a href=/ru/drafts/2023/11/67b83900-5070-5049-8760-edf0ee37e5f8/>Установка и настройка Active Directory Domain Services</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.adds.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c9574c29c427da52c02dbcfd5dc03d90 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.adds.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.adds.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-c9574c29c427da52c02dbcfd5dc03d90><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvAddsInstall</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-SrvAddsForest</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvAddsInstall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span> <span class=p>=</span> <span class=s1>&#39;AD-Domain-Services&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Install-WindowsFeature</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c>#</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-SrvAddsForest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DN&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$DomainName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DNN&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$DomainNetBiosName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DCM&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$DCMode</span> <span class=p>=</span> <span class=mf>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;SD&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$SrvDir</span> <span class=p>=</span> <span class=s1>&#39;D:\SRV\ADDS&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$PWD</span> <span class=p>=</span> <span class=nb>Read-Host</span> <span class=n>-Prompt</span> <span class=s1>&#39;Administrator password&#39;</span> <span class=n>-AsSecureString</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$ADDSForest</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DomainName</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${DomainName}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>DomainMode</span> <span class=p>=</span> <span class=nv>$DCMode</span>
</span></span><span class=line><span class=cl>    <span class=n>ForestMode</span> <span class=p>=</span> <span class=nv>$DCMode</span>
</span></span><span class=line><span class=cl>    <span class=n>DomainNetbiosName</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${DomainNetBiosName}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>DatabasePath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${SrvDir}</span><span class=s2>\NTDS&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SysvolPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${SrvDir}</span><span class=s2>\SYSVOL&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>LogPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${SrvDir}</span><span class=s2>\Logs&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>SafeModeAdministratorPassword</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PWD}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>CreateDNSDelegation</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl>    <span class=n>InstallDNS</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl>    <span class=n>NoRebootOnCompletion</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>Force</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Install-ADDSForest</span> <span class=nv>@ADDSForest</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/adds/>#adds</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-11-04T07:29:07Z data-fn=date-local>2023/11/04 07:29:07 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-faq><header><div class="node-cover mb-3"><a title="Как переименовать компьютер в PowerShell?" class="d-flex align-items-center rounded overflow-hidden" href=/ru/faq/2023/11/e153bb1d-7cea-5bd8-acce-2dbe63b26c91/ data-bs-toggle=modal data-bs-target=#modal-d78c1c301af588540f81080fd1673327><picture><source srcset='https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Как переименовать компьютер в PowerShell?" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/faq/2023/11/e153bb1d-7cea-5bd8-acce-2dbe63b26c91/ data-bs-toggle=modal data-bs-target=#modal-d78c1c301af588540f81080fd1673327>Как переименовать компьютер в PowerShell?</a></h2></div></header><div class=node-body><p>Хочу переименовать компьютер через терминал PowerShell. Как это сделать?</p></div><div class=text-end><a class="btn btn-sm btn-success d-inline-flex align-items-center" href=# role=button data-bs-toggle=modal data-bs-target=#modal-d78c1c301af588540f81080fd1673327><span class=pe-1><i class="fas fa-check fa-fw"></i></span>
<span>1 ответ</span></a></div></article></div><div class="d-none d-md-block"><article class="node-faq d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Как переименовать компьютер в PowerShell?" class="d-flex align-items-center rounded overflow-hidden" href=/ru/faq/2023/11/e153bb1d-7cea-5bd8-acce-2dbe63b26c91/ data-bs-toggle=modal data-bs-target=#modal-d78c1c301af588540f81080fd1673327><img class=img-fluid src="https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Как переименовать компьютер в PowerShell?" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><div class="d-flex flex-column h-100"><header><div class=node-title><h2 class=h5><a href=/ru/faq/2023/11/e153bb1d-7cea-5bd8-acce-2dbe63b26c91/ data-bs-toggle=modal data-bs-target=#modal-d78c1c301af588540f81080fd1673327>Как переименовать компьютер в PowerShell?</a></h2></div></header><div class=node-body><p>Хочу переименовать компьютер через терминал PowerShell. Как это сделать?</p></div><div class="mt-auto text-end"><a class="btn btn-sm btn-success d-inline-flex align-items-center" href=# role=button data-bs-toggle=modal data-bs-target=#modal-d78c1c301af588540f81080fd1673327><span class=pe-1><i class="fas fa-check fa-fw"></i></span>
<span>1 ответ</span></a></div></div></div></article></div><div class="modal fade" id=modal-d78c1c301af588540f81080fd1673327 tabindex=-1 aria-labelledby=modal-d78c1c301af588540f81080fd1673327-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-d78c1c301af588540f81080fd1673327-label><a href=/ru/faq/2023/11/e153bb1d-7cea-5bd8-acce-2dbe63b26c91/>Как переименовать компьютер в PowerShell?</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><div class="node-answer border-start border-success-subtle border-3 ps-3"><p>Переименовать компьютер можно при помощи cmdlet&rsquo;а <code>Rename-Computer</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-94760084aad7aa5f06cb1b4b47dd4602><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Rename-Computer</span> <span class=n>-NewName</span> <span class=s1>&#39;PCName01&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-94760084aad7aa5f06cb1b4b47dd4602 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>И перезагрузить компьютер:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9e3e311f42e3cb20f4b2eb3704170e0b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Restart-Computer</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9e3e311f42e3cb20f4b2eb3704170e0b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Если компьютер находится в доменной сети, необходимо указать учётные данные администратора домена:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-f7c5e30f05555876f14316f5bda926fc><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Rename-Computer</span> <span class=n>-NewName</span> <span class=s1>&#39;PCName01&#39;</span> <span class=n>-DomainCredential</span> <span class=s1>&#39;DomainName\Admin01&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f7c5e30f05555876f14316f5bda926fc role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-11-04T06:06:25Z data-fn=date-local>2023/11/04 06:06:25 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-faq><header><div class="node-cover mb-3"><a title="Как переключить PowerShell в кодировку UTF-8?" class="d-flex align-items-center rounded overflow-hidden" href=/ru/faq/2023/11/8c2e7adc-9431-5bb7-a9b6-e9397b1116b3/ data-bs-toggle=modal data-bs-target=#modal-637f18cd5c9d752e9fa2f8fd32c92fbd><picture><source srcset='https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Как переключить PowerShell в кодировку UTF-8?" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/faq/2023/11/8c2e7adc-9431-5bb7-a9b6-e9397b1116b3/ data-bs-toggle=modal data-bs-target=#modal-637f18cd5c9d752e9fa2f8fd32c92fbd>Как переключить PowerShell в кодировку UTF-8?</a></h2></div></header><div class=node-body><p>Когда запускаю скрипт на PowerShell, кодировка ломается и вместо текста появляются нечитаемые символы. Это проблем кодировки, как включить поддержку символов UTF-8?</p></div><div class=text-end><a class="btn btn-sm btn-success d-inline-flex align-items-center" href=# role=button data-bs-toggle=modal data-bs-target=#modal-637f18cd5c9d752e9fa2f8fd32c92fbd><span class=pe-1><i class="fas fa-check fa-fw"></i></span>
<span>1 ответ</span></a></div></article></div><div class="d-none d-md-block"><article class="node-faq d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Как переключить PowerShell в кодировку UTF-8?" class="d-flex align-items-center rounded overflow-hidden" href=/ru/faq/2023/11/8c2e7adc-9431-5bb7-a9b6-e9397b1116b3/ data-bs-toggle=modal data-bs-target=#modal-637f18cd5c9d752e9fa2f8fd32c92fbd><img class=img-fluid src="https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Как переключить PowerShell в кодировку UTF-8?" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><div class="d-flex flex-column h-100"><header><div class=node-title><h2 class=h5><a href=/ru/faq/2023/11/8c2e7adc-9431-5bb7-a9b6-e9397b1116b3/ data-bs-toggle=modal data-bs-target=#modal-637f18cd5c9d752e9fa2f8fd32c92fbd>Как переключить PowerShell в кодировку UTF-8?</a></h2></div></header><div class=node-body><p>Когда запускаю скрипт на PowerShell, кодировка ломается и вместо текста появляются нечитаемые …</p></div><div class="mt-auto text-end"><a class="btn btn-sm btn-success d-inline-flex align-items-center" href=# role=button data-bs-toggle=modal data-bs-target=#modal-637f18cd5c9d752e9fa2f8fd32c92fbd><span class=pe-1><i class="fas fa-check fa-fw"></i></span>
<span>1 ответ</span></a></div></div></div></article></div><div class="modal fade" id=modal-637f18cd5c9d752e9fa2f8fd32c92fbd tabindex=-1 aria-labelledby=modal-637f18cd5c9d752e9fa2f8fd32c92fbd-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-637f18cd5c9d752e9fa2f8fd32c92fbd-label><a href=/ru/faq/2023/11/8c2e7adc-9431-5bb7-a9b6-e9397b1116b3/>Как переключить PowerShell в кодировку UTF-8?</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><div class="node-answer border-start border-success-subtle border-3 ps-3"><p>Для перевода PowerShell на кодировку UTF-8 нужно выполнить следующую команду:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-097e1c6f8f4c1c5df389b7863619a46b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nv>$OutputEncoding</span> <span class=p>=</span> <span class=p>[</span><span class=no>Console</span><span class=p>]::</span><span class=n>InputEncoding</span> <span class=p>=</span> <span class=p>[</span><span class=no>Console</span><span class=p>]::</span><span class=n>OutputEncoding</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Text</span><span class=p>.</span><span class=n>UTF8Encoding</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-097e1c6f8f4c1c5df389b7863619a46b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Стоит учитывать некоторые особенности:</p><ul><li>В UNIX-системах <strong>PowerShell (Core) 7+</strong> по умолчанию использует UTF-8.</li><li>В ОС Windows шрифт в терминале должен поддерживать Unicode.</li></ul></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-11-02T20:50:36Z data-fn=date-local>2023/11/02 20:50:36 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-faq><header><div class="node-cover mb-3"><a title="Многоточие в выводе PowerShell в табличном формате. Как исправить?" class="d-flex align-items-center rounded overflow-hidden" href=/ru/faq/2023/10/edf74517-3e6e-5e1c-aa6b-8ee0335670b4/ data-bs-toggle=modal data-bs-target=#modal-89be6fc3064be79552f432ab31628dbb><picture><source srcset='https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Многоточие в выводе PowerShell в табличном формате. Как исправить?" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/faq/2023/10/edf74517-3e6e-5e1c-aa6b-8ee0335670b4/ data-bs-toggle=modal data-bs-target=#modal-89be6fc3064be79552f432ab31628dbb>Многоточие в выводе PowerShell в табличном формате. Как исправить?</a></h2></div></header><div class=node-body><p>Когда PowerShell выводит информацию в табличном формате, некоторые строки не влезают в ширину столбца и происходит обрезание контента. Как сделать так, чтобы PowerShell подстраивал ширину столбца …</p></div><div class=text-end><a class="btn btn-sm btn-success d-inline-flex align-items-center" href=# role=button data-bs-toggle=modal data-bs-target=#modal-89be6fc3064be79552f432ab31628dbb><span class=pe-1><i class="fas fa-check fa-fw"></i></span>
<span>1 ответ</span></a></div></article></div><div class="d-none d-md-block"><article class="node-faq d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Многоточие в выводе PowerShell в табличном формате. Как исправить?" class="d-flex align-items-center rounded overflow-hidden" href=/ru/faq/2023/10/edf74517-3e6e-5e1c-aa6b-8ee0335670b4/ data-bs-toggle=modal data-bs-target=#modal-89be6fc3064be79552f432ab31628dbb><img class=img-fluid src="https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Многоточие в выводе PowerShell в табличном формате. Как исправить?" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><div class="d-flex flex-column h-100"><header><div class=node-title><h2 class=h5><a href=/ru/faq/2023/10/edf74517-3e6e-5e1c-aa6b-8ee0335670b4/ data-bs-toggle=modal data-bs-target=#modal-89be6fc3064be79552f432ab31628dbb>Многоточие в выводе PowerShell в табличном формате. Как исправить?</a></h2></div></header><div class=node-body><p>Когда PowerShell выводит информацию в табличном формате, некоторые строки не влезают в ширину …</p></div><div class="mt-auto text-end"><a class="btn btn-sm btn-success d-inline-flex align-items-center" href=# role=button data-bs-toggle=modal data-bs-target=#modal-89be6fc3064be79552f432ab31628dbb><span class=pe-1><i class="fas fa-check fa-fw"></i></span>
<span>1 ответ</span></a></div></div></div></article></div><div class="modal fade" id=modal-89be6fc3064be79552f432ab31628dbb tabindex=-1 aria-labelledby=modal-89be6fc3064be79552f432ab31628dbb-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-89be6fc3064be79552f432ab31628dbb-label><a href=/ru/faq/2023/10/edf74517-3e6e-5e1c-aa6b-8ee0335670b4/>Многоточие в выводе PowerShell в табличном формате. Как исправить?</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><div class="node-answer border-start border-success-subtle border-3 ps-3"><p>При вводе команды, необходимо добавить к <code>Format-Table</code> параметр <code>-AutoSize</code>. Тогда PowerShell будет подстраивать ширину столбца под размер содержимого.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d7effda70ecbfe1497fed8ea6efb15cf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-d7effda70ecbfe1497fed8ea6efb15cf><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-Service</span> <span class=n>-DisplayName</span> <span class=s1>&#39;win*&#39;</span> <span class=p>|</span> <span class=nb>Format-Table</span> <span class=n>-AutoSize</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Status</span>  <span class=n>Name</span>                  <span class=n>DisplayName</span>
</span></span><span class=line><span class=cl><span class=p>------</span>  <span class=p>----</span>                  <span class=p>-----------</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>AudioEndpointBuilder</span>  <span class=n>Windows</span> <span class=n>Audio</span> <span class=n>Endpoint</span> <span class=n>Builder</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>Audiosrv</span>              <span class=n>Windows</span> <span class=n>Audio</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>EventLog</span>              <span class=n>Windows</span> <span class=n>Event</span> <span class=n>Log</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>FontCache</span>             <span class=n>Windows</span> <span class=n>Font</span> <span class=n>Cache</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>FrameServer</span>           <span class=n>Windows</span> <span class=n>Camera</span> <span class=n>Frame</span> <span class=n>Server</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>FrameServerMonitor</span>    <span class=n>Windows</span> <span class=n>Camera</span> <span class=n>Frame</span> <span class=n>Server</span> <span class=n>Monitor</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>icssvc</span>                <span class=n>Windows</span> <span class=n>Mobile</span> <span class=n>Hotspot</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>LicenseManager</span>        <span class=n>Windows</span> <span class=n>License</span> <span class=n>Manager</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>MixedRealityOpenXRSvc</span> <span class=n>Windows</span> <span class=n>Mixed</span> <span class=n>Reality</span> <span class=n>OpenXR</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>mpssvc</span>                <span class=n>Windows</span> <span class=n>Defender</span> <span class=n>Firewall</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>msiserver</span>             <span class=n>Windows</span> <span class=n>Installer</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>perceptionsimulation</span>  <span class=n>Windows</span> <span class=n>Perception</span> <span class=n>Simulation</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>PushToInstall</span>         <span class=n>Windows</span> <span class=n>PushToInstall</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=n>Stopped</span> <span class=n>SDRSVC</span>                <span class=n>Windows</span> <span class=n>Backup</span>
</span></span><span class=line><span class=cl><span class=n>Running</span> <span class=n>SecurityHealthService</span> <span class=n>Windows</span> <span class=n>Security</span> <span class=n>Service</span></span></span></code></pre></div></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-31T19:52:35Z data-fn=date-local>2023/10/31 19:52:35 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Работа с сетевыми интерфейсами в PowerShell" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b><picture><source srcset='https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Работа с сетевыми интерфейсами в PowerShell" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b>Работа с сетевыми интерфейсами в PowerShell</a></h2></div></header><div class=node-body><p>Разберём основные команды, которые пригодятся нам при настройке сети в ОС Windows через PowerShell.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Работа с сетевыми интерфейсами в PowerShell" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b><img class=img-fluid src="https://images.unsplash.com/photo-1597733336794-12d05021d510?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Работа с сетевыми интерфейсами в PowerShell" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/ data-bs-toggle=modal data-bs-target=#modal-f342f3f897a95eca91790f040272db0b>Работа с сетевыми интерфейсами в PowerShell</a></h2></div></header><div class=node-body><p>Разберём основные команды, которые пригодятся нам при настройке сети в ОС Windows через PowerShell.</p></div></div></article></div><div class="modal fade" id=modal-f342f3f897a95eca91790f040272db0b tabindex=-1 aria-labelledby=modal-f342f3f897a95eca91790f040272db0b-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-f342f3f897a95eca91790f040272db0b-label><a href=/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/>Работа с сетевыми интерфейсами в PowerShell</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Разберём основные команды, которые пригодятся нам при настройке сети в ОС Windows через PowerShell.</p><h2 id=1956441408-сетевые-адаптеры><a class=link-body-emphasis href=#1956441408-%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d1%8b%d0%b5-%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%d1%8b>Сетевые адаптеры</a></h2><p>Получить список сетевых адаптеров и их интерфейсов:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-408608297a1ef45ef92580343c5a0f55><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-408608297a1ef45ef92580343c5a0f55 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить список обычных и скрытых сетевых адаптеров:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-7194191908a7b6ea3c9a560cb3b0cf6f><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=err>–</span><span class=n>IncludeHidden</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7194191908a7b6ea3c9a560cb3b0cf6f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить конфигурацию по интерфейсу <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1e2f186bb3529042b86e27fe9fa39bfb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Get-NetIPConfiguration</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1e2f186bb3529042b86e27fe9fa39bfb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить детальную конфигурацию по интерфейсу <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-d1a3e7c5dc43431a72a69d4579efbd24><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Get-NetIPConfiguration</span> <span class=n>-Detailed</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d1a3e7c5dc43431a72a69d4579efbd24 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Отключить адаптер с интерфейсом <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e787554b3a5a56c3bc88792f9d9bd573><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Disable-NetAdapter</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e787554b3a5a56c3bc88792f9d9bd573 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-сетевые-профили><a class=link-body-emphasis href=#1956441408-%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d1%8b%d0%b5-%d0%bf%d1%80%d0%be%d1%84%d0%b8%d0%bb%d0%b8>Сетевые профили</a></h2><p>Вывести информацию по текущим сетевым профилям:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ad0b934d1c612b0e27de2e910fc27a1d><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetConnectionProfile</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ad0b934d1c612b0e27de2e910fc27a1d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Получить информацию только по профилю сети интерфейса <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9c8096644a123e225e93caa453ddd2cb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Get-NetConnectionProfile</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9c8096644a123e225e93caa453ddd2cb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить профиль сети интерфейса <code>5</code> на публичный (<code>Public</code>).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-88ffe6be56ce9d9fe18f4fe0fbb3a3a0><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetConnectionProfile</span> <span class=n>-NetworkCategory</span> <span class=s1>&#39;Public&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-88ffe6be56ce9d9fe18f4fe0fbb3a3a0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить профиль сети интерфейса <code>5</code> на приватный (<code>Private</code>).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-8 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-82bd6797e27980d2e3deb19fb0f5bd98><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetConnectionProfile</span> <span class=n>-NetworkCategory</span> <span class=s1>&#39;Private&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-82bd6797e27980d2e3deb19fb0f5bd98 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить профиль сети интерфейса <code>5</code> на доменный (<code>DomainAuthenticated</code>).</p><div class="shortcode shortcode-codeblock shortcode-codeblock-9 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-04e0e9797fd095e79ff7a9e97d41bc22><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetConnectionProfile</span> <span class=n>-NetworkCategory</span> <span class=s1>&#39;DomainAuthenticated&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-04e0e9797fd095e79ff7a9e97d41bc22 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-настройка-ip-адреса><a class=link-body-emphasis href=#1956441408-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-ip-%d0%b0%d0%b4%d1%80%d0%b5%d1%81%d0%b0>Настройка IP-адреса</a></h2><p>Отключить DHCP на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-10 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e98a175c9a001157d78130a376a5fc89><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetIPInterface</span> <span class=n>-Dhcp</span> <span class=s1>&#39;Disabled&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e98a175c9a001157d78130a376a5fc89 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Установить новый IP-адрес и шлюз на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-11 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-3e593e12eca09040ed563657bf85b0d3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>New-NetIPAddress</span> <span class=err>–</span><span class=n>IPAddress</span> <span class=s1>&#39;192.168.0.10&#39;</span> <span class=n>-PrefixLength</span> <span class=s1>&#39;24&#39;</span> <span class=n>-DefaultGateway</span> <span class=s1>&#39;192.168.0.1&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3e593e12eca09040ed563657bf85b0d3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Изменить IP-адрес на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-12 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-83cb8a736c1bfde6001d2c301201cfeb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetIPAddress</span> <span class=n>-IPAddress</span> <span class=s1>&#39;192.168.0.12&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-83cb8a736c1bfde6001d2c301201cfeb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Удалить IP-адрес на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-13 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e90ec039af35047a2256fda936b4791a><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Remove-NetIPAddress</span> <span class=n>-Confirm:</span><span class=vm>$false</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e90ec039af35047a2256fda936b4791a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Удаление шлюза на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-14 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-8b2880f7b23a6ccc782ca234d5b90e5b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Remove-NetRoute</span> <span class=n>-Confirm:</span><span class=vm>$false</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8b2880f7b23a6ccc782ca234d5b90e5b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-настройка-dns><a class=link-body-emphasis href=#1956441408-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-dns>Настройка DNS</a></h2><p>Установить IP-адреса серверов DNS на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-15 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-77d39e6d0ebcc90114e5cd41dc2da2c9><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-DNSClientServerAddress</span> <span class=err>–</span><span class=n>ServerAddresses</span> <span class=p>(</span><span class=s1>&#39;192.168.0.2&#39;</span><span class=p>,</span><span class=s1>&#39;192.168.1.2&#39;</span><span class=p>)</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-77d39e6d0ebcc90114e5cd41dc2da2c9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Сбросить IP-адреса серверов DNS на параметры по умолчанию на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-16 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-dd83ca4c015e81dc9bcd7c553bd8a506><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-DnsClientServerAddress</span> <span class=n>-ResetServerAddresses</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-dd83ca4c015e81dc9bcd7c553bd8a506 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Очистить кэш DNS:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-17 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-342494bb2f62a1fd1bf2f9aa557f8148><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Clear-DnsClientCache</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-342494bb2f62a1fd1bf2f9aa557f8148 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-настройка-dhcp><a class=link-body-emphasis href=#1956441408-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-dhcp>Настройка DHCP</a></h2><p>Включить DHCP на интерфейсе <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-18 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1f1089343e1554cedf7589cbae3bbc31><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Set-NetIPInterface</span> <span class=n>-Dhcp</span> <span class=s1>&#39;Enabled&#39;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1f1089343e1554cedf7589cbae3bbc31 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Перезапустить интерфейс с именем <code>Ethernet</code> для получения параметров от DHCP:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-19 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-5b43424af89de60fb2d4420ee6e48dac><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=n>-InterfaceIndex</span> <span class=mf>5</span> <span class=p>|</span> <span class=nb>Restart-NetAdapter</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5b43424af89de60fb2d4420ee6e48dac role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><h2 id=1956441408-автоматизация><a class=link-body-emphasis href=#1956441408-%d0%b0%d0%b2%d1%82%d0%be%d0%bc%d0%b0%d1%82%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f>Автоматизация</a></h2><p>Скрипт не имеет вводных параметров. Все параметры настраиваются вручную через редактирование скрипта. Далее, скрипт запускается и применяет указанные параметры.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.ip.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7eec23f6d52aebdab548dbe8dd9ae89d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.ip.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.ip.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-7eec23f6d52aebdab548dbe8dd9ae89d><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         b42524a4-c0d0-4402-951c-e97aa140698e
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/430b916d-fd5c-5d44-8c24-8b98f41e0355/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$Adapter</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># Interface index.</span>
</span></span><span class=line><span class=cl>  <span class=n>InterfaceIndex</span> <span class=p>=</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$IP</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># IP address.</span>
</span></span><span class=line><span class=cl>  <span class=n>IPAddress</span> <span class=p>=</span> <span class=s1>&#39;192.168.0.10&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c># Subnet mask.</span>
</span></span><span class=line><span class=cl>  <span class=n>PrefixLength</span> <span class=p>=</span> <span class=s1>&#39;24&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c># Gateway.</span>
</span></span><span class=line><span class=cl>  <span class=n>DefaultGateway</span> <span class=p>=</span> <span class=s1>&#39;192.168.0.1&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$DNS</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># DNS servers.</span>
</span></span><span class=line><span class=cl>  <span class=n>ServerAddresses</span> <span class=p>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;192.168.0.2&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;192.168.1.2&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>Remove-NetIPAddress</span> <span class=n>-Confirm:</span><span class=vm>$false</span>   <span class=c># Removing current IP address.</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>Remove-NetRoute</span> <span class=n>-Confirm:</span><span class=vm>$false</span>       <span class=c># Removing current gateway.</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>New-NetIPAddress</span> <span class=nv>@IP</span>                  <span class=c># Setting new IP address.</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span> <span class=nv>@Adapter</span> <span class=p>|</span> <span class=nb>Set-DNSClientServerAddress</span> <span class=nv>@DNS</span>       <span class=c># Setting new DNS servers.</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-31T17:16:31Z data-fn=date-local>2023/10/31 17:16:31 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Работа с переменной среды окружения PATH" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d><picture><source srcset='https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Работа с переменной среды окружения PATH" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d>Работа с переменной среды окружения PATH</a></h2></div></header><div class=node-body><p>Переменная <code>Path</code> является переменной среды окружения, при помощи которой ОС Windows находит нужные приложения в терминале. Рассмотрим способы редактирования значений этой переменной.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Работа с переменной среды окружения PATH" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d><img class=img-fluid src="https://images.unsplash.com/photo-1575600749331-6d13fdfe5323?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Работа с переменной среды окружения PATH" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/ data-bs-toggle=modal data-bs-target=#modal-899827897f82e6808bc8e4b6d6c02d2d>Работа с переменной среды окружения PATH</a></h2></div></header><div class=node-body><p>Переменная <code>Path</code> является переменной среды окружения, при помощи которой ОС Windows находит нужные приложения в терминале. Рассмотрим способы редактирования значений этой переменной.</p></div></div></article></div><div class="modal fade" id=modal-899827897f82e6808bc8e4b6d6c02d2d tabindex=-1 aria-labelledby=modal-899827897f82e6808bc8e4b6d6c02d2d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-899827897f82e6808bc8e4b6d6c02d2d-label><a href=/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/>Работа с переменной среды окружения PATH</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Переменная <code>Path</code> является переменной среды окружения, при помощи которой ОС Windows находит нужные приложения в терминале. Рассмотрим способы редактирования значений этой переменной.</p><p>Проще говоря, в переменную <code>Path</code> можно добавлять пути к директориям приложений, для того чтобы при работе в терминале не прописывать полные пути к исполняемым файлам этих приложений. Например, в терминале, чтобы вызвать Git и зафиксировать изменения нужно ввести <code>C:\Apps\Git\git.exe commit -m 'bla-bla'</code>. Но если добавить значение <code>C:\Apps\Git</code> в переменную <code>Path</code>, то в терминале можно просто писать <code>git.exe commit -m 'bla-bla'</code>, больше не нужно указывать полный путь к Git&rsquo;у.</p><h2 id=3528320903-уровни-переменной-path><a class=link-body-emphasis href=#3528320903-%d1%83%d1%80%d0%be%d0%b2%d0%bd%d0%b8-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d0%be%d0%b9-path>Уровни переменной <code>Path</code></a></h2><p>Существует два уровня переменной <code>Path</code>:</p><ul><li>Системный - является глобальным и его значения доступны для каждого аккаунта пользователя.</li><li>Пользовательский - работает в контексте конкретного аккаунта и содержит значения только этого пользователя. Под другим аккаунтом, переменная на пользовательском уровне может содержать другие значения.</li></ul><p>В пределах аккаунта пользователя эти два уровня переменной <code>Path</code> объединяют свои значения.</p><h2 id=3528320903-добавление-значений-в-переменную-path><a class=link-body-emphasis href=#3528320903-%d0%b4%d0%be%d0%b1%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d0%b9-%d0%b2-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%83%d1%8e-path>Добавление значений в переменную <code>Path</code></a></h2><p>Добавить свои значения в переменную <code>Path</code> можно несколькими способами:</p><ul><li>Графический интерфейс ОС.</li><li>Команда в CMD при помощи утилиты <code>setx</code>.</li><li>Команда в PowerShell.</li></ul><p>Значения в переменной <code>Path</code> разделяются символом <code>;</code>.</p><p>Так как я приверженец работы в терминале и считаю, что каждый администратор должен уметь работать с командной строкой, то привожу только два последних способа.</p><h3 id=3528320903-командная-строка-cmd><a class=link-body-emphasis href=#3528320903-%d0%ba%d0%be%d0%bc%d0%b0%d0%bd%d0%b4%d0%bd%d0%b0%d1%8f-%d1%81%d1%82%d1%80%d0%be%d0%ba%d0%b0-cmd>Командная строка CMD</a></h3><p>Управление переменными среды окружения в CMD происходит при помощи утилиты <code>setx</code>.</p><h4 id=3528320903-системный-уровень><a class=link-body-emphasis href=#3528320903-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%8b%d0%b9-%d1%83%d1%80%d0%be%d0%b2%d0%b5%d0%bd%d1%8c>Системный уровень</a></h4><p>Чтобы добавить свои значения в переменную <code>Path</code> на системном уровне, необходимо указать ключ <code>/m</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-57ffe3f59767153ce8d43964eae4cbf3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-57ffe3f59767153ce8d43964eae4cbf3><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>setx /m Path <span class=s2>&#34;</span><span class=nv>%Path%</span><span class=s2>C:\Apps\App_01;C:\Apps\App_02&#34;</span></span></span></code></pre></div></div></div></div><div class="shortcode shortcode-alert"><div class="alert alert-danger d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-circle-radiation fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Ни в коем случае нельзя прописывать в <code>setx</code> свои значения БЕЗ вызова переменной <code>Path</code>: при такой команде утилита <code>setx</code> обнулит все существующие значения в <code>Path</code> и запишет указанные вами. А значения, добавленные программами, пропадут.</p><p>Правильная команда должны быть такой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-54424eb19139a240b895c44eb0ca8a7b><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>setx /m Path <span class=s2>&#34;</span><span class=nv>%Path%</span><span class=s2>C:\MyCustomDir&#34;</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-54424eb19139a240b895c44eb0ca8a7b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Здесь мы заранее вызываем переменную <code>Path</code> конструкцией <code>%Path%</code>, которая добавит существующие значения к вашим и всё это дело пропишется утилитой <code>setx</code> обратно в <code>Path</code>.</p></div></div></div><p>Необходимости в скрипте, который добавляет значения в переменную <code>Path</code> на системном уровне, нет. Но я всё же его написал, пусть будет.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>cmd.set.env.path.system.bat</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-83af1802db8257290a49e71c47bdb8d5 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=cmd.set.env.path.system.bat download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=cmd.set.env.path.system.bat target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-83af1802db8257290a49e71c47bdb8d5><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting PATH variable for system.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl><span class=k>setLocal</span> EnableDelayedExpansion
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Custom PATH.</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=s2>&#34;pathArray=C:\Apps\App_01 C:\Apps\App_02 C:\Apps\App_03&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Building a system PATH variable.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=se>%%</span>p <span class=k>in</span> <span class=p>(</span> <span class=nv>%pathArray%</span> <span class=p>)</span> <span class=k>do</span> <span class=p>(</span> <span class=k>set</span> <span class=s2>&#34;pathCustom=</span><span class=se>%%</span><span class=s2>p;!pathCustom!&#34;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting a new PATH variable.</span>
</span></span><span class=line><span class=cl>setx /m Path <span class=s2>&#34;</span><span class=nv>%Path%!pathCustom!</span><span class=s2>&#34;</span></span></span></code></pre></div></div></div></div><p>В переменной <code>pathArray</code> указывается массив из путей, которые необходимо добавить в <code>Path</code> на системном уровне.</p><h4 id=3528320903-пользовательский-уровень><a class=link-body-emphasis href=#3528320903-%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d0%b9-%d1%83%d1%80%d0%be%d0%b2%d0%b5%d0%bd%d1%8c>Пользовательский уровень</a></h4><p>Добавить свои значения в переменную <code>Path</code> на пользовательском уровне:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-fc926993808f427fe64b194adc8d760d role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-fc926993808f427fe64b194adc8d760d><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>setx Path <span class=s2>&#34;</span><span class=nv>%Path%</span><span class=s2>C:\Apps\App_01;C:\Apps\App_02&#34;</span></span></span></code></pre></div></div></div></div><p>Но есть одна особенность: так как переменная <code>Path</code> объединяет значения системного и пользовательского уровней, то при такой команде, утилита <code>setx</code> пропишет в <code>Path</code> пользовательского уровня все значения из системного. Таким образом, получится дублирование содержимого <code>Path</code> системного уровня в пользовательском. Это не критично, но можно сделать более элегантно&mldr;</p><p>Для того, чтобы обойти вышеуказанную особенность, необходимо написать скрипт, который будет при вызове переменной <code>Path</code> вырезать из неё значения системного уровня. Собственно, скрипт я написал.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>cmd.set.env.path.user.bat</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-58a628da18b009f8e2e71a03ac39f8e0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=cmd.set.env.path.user.bat download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=cmd.set.env.path.user.bat target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-58a628da18b009f8e2e71a03ac39f8e0><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting PATH variable for user.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl><span class=k>setLocal</span> EnableDelayedExpansion
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Custom PATH.</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=s2>&#34;pathArray=C:\Apps\App_01 C:\Apps\App_02 C:\Apps\App_03&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Getting the current PATH variable.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>/f</span> <span class=s2>&#34;tokens=2,*&#34;</span> <span class=se>%%</span>a <span class=k>in</span> <span class=p>(</span> <span class=s1>&#39;reg query HKCU\Environment /v Path&#39;</span> <span class=p>)</span> <span class=k>do</span> <span class=p>(</span> <span class=k>set</span> <span class=s2>&#34;pathUser=</span><span class=se>%%</span><span class=s2>b&#34;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Building a user PATH variable.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=se>%%</span>p <span class=k>in</span> <span class=p>(</span> <span class=nv>%pathArray%</span> <span class=p>)</span> <span class=k>do</span> <span class=p>(</span> <span class=k>set</span> <span class=s2>&#34;pathCustom=</span><span class=se>%%</span><span class=s2>p;!pathCustom!&#34;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Setting a new PATH variable.</span>
</span></span><span class=line><span class=cl>setx Path <span class=s2>&#34;</span><span class=nv>!pathUser!!pathCustom!</span><span class=s2>&#34;</span></span></span></code></pre></div></div></div></div><p>В переменной <code>pathArray</code> указывается массив из путей, которые необходимо добавить в <code>Path</code> на пользовательском уровне. При этом, добавление значений из системного уровня не произойдёт. Наша переменная <code>Path</code> пользовательского уровня останется чистенькой и красивой.</p><h3 id=3528320903-терминал-powershell><a class=link-body-emphasis href=#3528320903-%d1%82%d0%b5%d1%80%d0%bc%d0%b8%d0%bd%d0%b0%d0%bb-powershell>Терминал PowerShell</a></h3><p>В PowerShell для управления переменными окружения существуют методы:</p><ul><li><code>[Environment]::GetEnvironmentVariables()</code> - получение значения переменной среды окружения.</li><li><code>[Environment]::SetEnvironmentVariable()</code> - установка значения переменной среды окружения.</li></ul><h4 id=3528320903-системный-уровень-1><a class=link-body-emphasis href=#3528320903-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%8b%d0%b9-%d1%83%d1%80%d0%be%d0%b2%d0%b5%d0%bd%d1%8c-1>Системный уровень</a></h4><p>Для добавления значений в переменную <code>Path</code> на системном уровне, я написал небольшой скрипт.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.env.path.system.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-bdfd694b6531acc8661e684d48850d8e role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.env.path.system.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.env.path.system.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-bdfd694b6531acc8661e684d48850d8e><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         41643d28-3808-4a6f-a322-d87ed4384d5f
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Setting PATH variable for system.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script configures the PATH variable values for the system.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.system.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Set-EnvPathSystem</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Environment</span><span class=p>]::</span><span class=n>SetEnvironmentVariable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Path&#39;</span><span class=p>,</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>GetEnvironmentVariables</span><span class=p>(</span><span class=s1>&#39;Machine&#39;</span><span class=p>)).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=p>[</span><span class=no>IO.Path</span><span class=p>]::</span><span class=n>PathSeparator</span><span class=p>,</span> <span class=s1>&#39;Machine&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-EnvPathSystem</span></span></span></code></pre></div></div></div></div><p>Вызов скрипта осуществляется следующим образом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f43535500e94d46f14c4da090e9ad9f6 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-f43535500e94d46f14c4da090e9ad9f6><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>set</span><span class=p>.</span><span class=py>env</span><span class=p>.</span><span class=py>path</span><span class=p>.</span><span class=py>system</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=s1>&#39;C:\Apps\App_01&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_02&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_03&#39;</span></span></span></code></pre></div></div></div></div><p>В параметре <code>-P</code> указываются значения, которые необходимо добавить в переменную <code>Path</code> системного уровня.</p><h4 id=3528320903-пользовательский-уровень-1><a class=link-body-emphasis href=#3528320903-%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d0%b9-%d1%83%d1%80%d0%be%d0%b2%d0%b5%d0%bd%d1%8c-1>Пользовательский уровень</a></h4><p>А здесь скрипт, который отвечает за добавление в переменную <code>Path</code> значений на пользовательском уровне.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.env.path.user.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4d51def3ede6476f9ef71fdaac70f0a5 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.env.path.user.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.env.path.user.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-4d51def3ede6476f9ef71fdaac70f0a5><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         79f23918-308a-412c-8835-b1bb9c9193e3
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Setting PATH variable for user.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script configures the PATH variable values for the user.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.user.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Set-EnvPathUser</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Environment</span><span class=p>]::</span><span class=n>SetEnvironmentVariable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Path&#39;</span><span class=p>,</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>GetEnvironmentVariables</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>)).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=p>[</span><span class=no>IO.Path</span><span class=p>]::</span><span class=n>PathSeparator</span><span class=p>,</span> <span class=s1>&#39;User&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-EnvPathUser</span></span></span></code></pre></div></div></div></div><p>Вызов скрипта осуществляется следующим образом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5de0a19ba06dd1d5a92ebce002332f07 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-5de0a19ba06dd1d5a92ebce002332f07><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>set</span><span class=p>.</span><span class=py>env</span><span class=p>.</span><span class=py>path</span><span class=p>.</span><span class=py>user</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=s1>&#39;C:\Apps\App_01&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_02&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_03&#39;</span></span></span></code></pre></div></div></div></div><p>В параметре <code>-P</code> указываются значения, которые необходимо добавить в переменную <code>Path</code> пользовательского уровня.</p><h4 id=3528320903-общий-скрипт><a class=link-body-emphasis href=#3528320903-%d0%be%d0%b1%d1%89%d0%b8%d0%b9-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Общий скрипт</a></h4><p>Не знаю, почему я сразу не написал общий скрипт для всех уровней&mldr; Решил под завершение статьи реализовать подобную штуку.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.set.env.path.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-819a40dca6ded52628d5084305bc6b85 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.set.env.path.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.set.env.path.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-819a40dca6ded52628d5084305bc6b85><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         14efdc7d-1edd-4b40-b6d2-623288ce1659
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Setting the PATH variable.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script configures the PATH variable values.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39; -T &#39;Machine&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.set.env.path.ps1 -P &#39;C:\Apps\App_01&#39;, &#39;C:\Apps\App_02&#39;, &#39;C:\Apps\App_03&#39; -T &#39;User&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/1f062637-3227-56d7-93e3-126d1c80f5a8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>)][</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;Machine&#39;</span><span class=p>,</span> <span class=s1>&#39;User&#39;</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Target</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Set-EnvPath</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Environment</span><span class=p>]::</span><span class=n>SetEnvironmentVariable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Path&#39;</span><span class=p>,</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>GetEnvironmentVariables</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${Target}</span><span class=s2>&#34;</span><span class=p>)).</span><span class=py>Path</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=p>[</span><span class=no>IO.Path</span><span class=p>]::</span><span class=n>PathSeparator</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${Target}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-EnvPath</span></span></span></code></pre></div></div></div></div><p>Вызывается скрипт обычным способом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-58ee45f416803b91e7dcb27a598a6b91 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-58ee45f416803b91e7dcb27a598a6b91><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>set</span><span class=p>.</span><span class=py>env</span><span class=p>.</span><span class=py>path</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=s1>&#39;C:\Apps\App_01&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_02&#39;</span><span class=p>,</span> <span class=s1>&#39;C:\Apps\App_03&#39;</span> <span class=n>-T</span> <span class=s1>&#39;User&#39;</span></span></span></code></pre></div></div></div></div><p>Но отличается от выше приведённых скриптов дополнительным параметром <code>-T</code>, который указывает уровень переменной <code>Path</code> и может принимать следующие значения:</p><ul><li><code>Machine</code> - для системного уровня.</li><li><code>User</code> - для пользовательского уровня.</li></ul></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/cmd/>#cmd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/batch/>#batch</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/path/>#path</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-28T12:27:07Z data-fn=date-local>2023/10/28 12:27:07 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Автоматическая настройка Windows Server 2022 под рабочую станцию" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78><picture><source srcset='https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Автоматическая настройка Windows Server 2022 под рабочую станцию" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78>Автоматическая настройка Windows Server 2022 под рабочую станцию</a></h2></div></header><div class=node-body><p>Ранее я уже публиковал инструкцию по превращению серверной ОС в ОС для рабочей станции. Но этот процесс можно автоматизировать при помощи PowerShell.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Автоматическая настройка Windows Server 2022 под рабочую станцию" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78><img class=img-fluid src="https://images.unsplash.com/photo-1603969409447-ba86143a03f6?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Автоматическая настройка Windows Server 2022 под рабочую станцию" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/ data-bs-toggle=modal data-bs-target=#modal-76167fb435445bcf9e0f5dbe3c74ca78>Автоматическая настройка Windows Server 2022 под рабочую станцию</a></h2></div></header><div class=node-body><p>Ранее я уже публиковал инструкцию по превращению серверной ОС в ОС для рабочей станции. Но этот процесс можно автоматизировать при помощи PowerShell.</p></div></div></article></div><div class="modal fade" id=modal-76167fb435445bcf9e0f5dbe3c74ca78 tabindex=-1 aria-labelledby=modal-76167fb435445bcf9e0f5dbe3c74ca78-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-76167fb435445bcf9e0f5dbe3c74ca78-label><a href=/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/>Автоматическая настройка Windows Server 2022 под рабочую станцию</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Ранее я уже публиковал инструкцию по превращению серверной ОС в ОС для рабочей станции. Но этот процесс можно автоматизировать при помощи PowerShell.</p><p>В статье <span class="shortcode shortcode-uuid"><a href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/>Windows Server 2022 для рабочей станции</a></span> рассматривалось ручная адаптация Windows Server 2022 под рабочую станцию. Я решил написать специальный скрипт, который берёт на себя часть действий. Но окончательная настройка, например, такая как редактирование GPO остаётся за пользователем.</p><h2 id=1157959347-автоматизация><a class=link-body-emphasis href=#1157959347-%d0%b0%d0%b2%d1%82%d0%be%d0%bc%d0%b0%d1%82%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f>Автоматизация</a></h2><p>Рассмотрим скрипт по адаптации серверной ОС под рабочую станцию.</p><h3 id=1157959347-примеры><a class=link-body-emphasis href=#1157959347-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h3><p>Скрипт требует административных прав доступа, поэтому его необходимо запускать под аккаунтом администратора.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d8a8560a40b42f6b0697bcfdfcfbaf59 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-d8a8560a40b42f6b0697bcfdfcfbaf59><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>win</span><span class=p>.</span><span class=py>srv</span><span class=p>.</span><span class=py>ws</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></div></div><h3 id=1157959347-алгоритм-работы><a class=link-body-emphasis href=#1157959347-%d0%b0%d0%bb%d0%b3%d0%be%d1%80%d0%b8%d1%82%d0%bc-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b>Алгоритм работы</a></h3><ul><li>Включение дополнительных компонентов Windows.</li><li>Настройка необходимых для рабочей станции служб.</li><li>Отключение <strong>IE Enhanced Security Configuration</strong> для аккаунтов администраторов и пользователей.</li><li>Переключение приоритета процессора в сторону приложений.</li><li>Настройка <strong>MMAgent</strong>.</li><li>Переключение <strong>DEP</strong> только на программы Windows и службы.</li></ul><h3 id=1157959347-скрипт><a class=link-body-emphasis href=#1157959347-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.win.srv.ws.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5060f4dba1e1a37eefda832f8d4dbcaf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.win.srv.ws.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.win.srv.ws.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-5060f4dba1e1a37eefda832f8d4dbcaf><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         c050355b-ecbd-4b13-b805-3a422dc0c995
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Windows Server configuration script.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script allows you to set up Windows Server as a workstation.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.win.srv.ws.ps1
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/fb64d665-3e56-5fa5-a9eb-2e2e251949d8/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-FeatureConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-ServiceConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-IEConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-PriorityControlConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-MMAgentConfig</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DEPConfig</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING FEATURES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-FeatureConfig</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Wireless-Networking&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Install-WindowsFeature</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING SERVICES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-ServiceConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Name</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;Audiosrv&#39;</span><span class=p>,</span> <span class=s1>&#39;AudioEndpointBuilder&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Name</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Name</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=n>StartupType</span> <span class=p>=</span> <span class=s1>&#39;Automatic&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>Set-Service</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$WSearch</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;WSearch&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>StartupType</span> <span class=p>=</span> <span class=s1>&#39;AutomaticDelayedStart&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Set-Service</span> <span class=nv>@WSearch</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># DISABLE IE ENHANCED SECURITY CONFIGURATION (ESC).</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-IEConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}&#39;</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A8-37EF-4b3f-8CFC-4F3A74704073}&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>LiteralPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;IsInstalled&#39;</span>
</span></span><span class=line><span class=cl>      <span class=n>Value</span> <span class=p>=</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${_}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Set-ItemProperty</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Host</span> <span class=s1>&#39;IE Enhanced Security Configuration (ESC) has been disabled.&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;&#39;</span><span class=nv>${_}</span><span class=s2>&#39; not found!&#34;</span> <span class=n>-ErrorAction</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ADJUST PROCESSOR RESOURCES FOR BEST PERFORMANCE OF PROGRAMS.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-PriorityControlConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>=</span> <span class=s1>&#39;HKLM:\SYSTEM\CurrentControlSet\Control\PriorityControl&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>LiteralPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Win32PrioritySeparation&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Value</span> <span class=p>=</span> <span class=mf>38</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Set-ItemProperty</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;&#39;</span><span class=nv>${Path}</span><span class=s2>&#39; not found!&#34;</span> <span class=n>-ErrorAction</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING MMAGENT.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-MMAgentConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MemoryCompression</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>OperationAPI</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>PageCombining</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Enable-MMAgent</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURING DEP.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DEPConfig</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>cmd</span><span class=p>.</span><span class=py>exe</span> <span class=p>/</span><span class=n>c</span> <span class=s1>&#39;bcdedit.exe /set {current} nx OptIn&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/workstation/>#workstation</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/server/>#server</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-27T19:46:08Z data-fn=date-local>2023/10/27 19:46:08 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Восстановление доверительных отношений между PC и Active Directory" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762><picture><source srcset='https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Восстановление доверительных отношений между PC и Active Directory" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762>Восстановление доверительных отношений между PC и Active Directory</a></h2></div></header><div class=node-body><p>Рассмотрим способы решения распространённой проблемы потери доверительных отношений между рабочей станцией и доменом Active Directory. Из-за этой проблемы пользователь не может авторизоваться под …</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Восстановление доверительных отношений между PC и Active Directory" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762><img class=img-fluid src="https://images.unsplash.com/photo-1551730459-92db2a308d6a?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Восстановление доверительных отношений между PC и Active Directory" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/ data-bs-toggle=modal data-bs-target=#modal-327990f6c9bdc2cf482551861c095762>Восстановление доверительных отношений между PC и Active Directory</a></h2></div></header><div class=node-body><p>Рассмотрим способы решения распространённой проблемы потери доверительных отношений между рабочей станцией и доменом Active Directory. Из-за этой проблемы пользователь не может авторизоваться под …</p></div></div></article></div><div class="modal fade" id=modal-327990f6c9bdc2cf482551861c095762 tabindex=-1 aria-labelledby=modal-327990f6c9bdc2cf482551861c095762-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-327990f6c9bdc2cf482551861c095762-label><a href=/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/>Восстановление доверительных отношений между PC и Active Directory</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Рассмотрим способы решения распространённой проблемы потери доверительных отношений между рабочей станцией и доменом Active Directory. Из-за этой проблемы пользователь не может авторизоваться под своей учётной записью.</p><p>При попытке входа пользователя под доменной учётной записью, могут произойти следующие ошибки.</p><div class="shortcode shortcode-window"><div class="card text-bg-danger mb-3 overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-computer fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Trust relationship</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li></ul></div></div></div><div class=card-body><p>The trust relationship between this workstation and the primary domain failed.</p><p>(Не удалось восстановить доверительные отношения между рабочей станцией и доменом.)</p></div></div></div><div class="shortcode shortcode-window"><div class="card text-bg-danger mb-3 overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-computer fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Security database</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li><li class=list-inline-item><i class="fas fa-circle fa-fw"></i></li></ul></div></div></div><div class=card-body><p>The security database on the server does not have a computer account for this workstation trust relationship.</p><p>(База данных диспетчера учетных записей на сервере не содержит записи для регистрации компьютера через доверительные отношения с этой рабочей станцией.)</p></div></div></div><p>Ошибка может возникнуть по различным факторам. Например, когда новый компьютер присоединился к домену под уже существующем именем другого компьютера, или когда виртуальная машина восстановилась с контрольной точки.</p><h2 id=3175280859-ручной-способ><a class=link-body-emphasis href=#3175280859-%d1%80%d1%83%d1%87%d0%bd%d0%be%d0%b9-%d1%81%d0%bf%d0%be%d1%81%d0%be%d0%b1>Ручной способ</a></h2><p>Для того, чтобы исправить ошибку, необходимо последовательно выполнить следующие пункты:</p><ol><li>Сбросить аккаунт компьютера в Active Directory.</li><li>На проблемном компьютере зайти под локальным администратором и вывести компьютер из домена в рабочую группу.</li><li>Перезагрузить компьютер.</li><li>Вывести компьютер из рабочей группы и ввести обратно в домен.</li><li>Еще раз перезагрузить компьютер.</li></ol><h2 id=3175280859-автоматизация><a class=link-body-emphasis href=#3175280859-%d0%b0%d0%b2%d1%82%d0%be%d0%bc%d0%b0%d1%82%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f>Автоматизация</a></h2><p>Как обычно, привожу скрипт по автоматизации восстановления доверительных отношений. Скрипт решит проблему быстро и без перезагрузок. Запускается под администратором.</p><h3 id=3175280859-параметры><a class=link-body-emphasis href=#3175280859-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b>Параметры</a></h3><p>Параметр у скрипта один, это название сервера DC.</p><ul><li><code>-S</code> <code>-P_Server</code> - название сервера DC (контроллера домена). Если параметр не задан, скрипт выбирает для операции контроллер домена по умолчанию.</li></ul><h3 id=3175280859-примеры><a class=link-body-emphasis href=#3175280859-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h3><p>Восстановить доверительные отношения с доменом по умолчанию:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-430a44627c7a769685785d8ba02de840 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-430a44627c7a769685785d8ba02de840><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>csc</span><span class=p>.</span><span class=py>repair</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></div></div><p>Восстановить доверительные отношения с доменом <code>DC-server.domain.com</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-2b034ae8549c5c1ff38c36bc357f800c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-2b034ae8549c5c1ff38c36bc357f800c><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>csc</span><span class=p>.</span><span class=py>repair</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-DC</span> <span class=s1>&#39;DC-server.domain.com&#39;</span></span></span></code></pre></div></div></div></div><h3 id=3175280859-алгоритм-работы><a class=link-body-emphasis href=#3175280859-%d0%b0%d0%bb%d0%b3%d0%be%d1%80%d0%b8%d1%82%d0%bc-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b>Алгоритм работы</a></h3><ul><li>Запускается проверка доверительных отношений при помощи cmdlet&rsquo;а <code>Test-ComputerSecureChannel</code>.</li><li>Если проверка пройдена, скрипт завершает работу.</li><li>Если проверка не пройдена, запускается цикл восстановления доверительных отношений с контроллером домена с временным интервалом в 5 секунд.</li></ul><h3 id=3175280859-скрипт><a class=link-body-emphasis href=#3175280859-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.csc.repair.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9691acf97cf639c1c65e243acc2e7360 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.csc.repair.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.csc.repair.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-9691acf97cf639c1c65e243acc2e7360><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         52672f5d-e2c0-467a-ae1d-c0fc9009a1eb
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Testing and repairing the secure channel between the local computer and its domain.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Verifying that the channel between the local computer and its domain is working correctly by checking the status of its trust relationships. If a connection fails, trying to restore it.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Server
</span></span></span><span class=line><span class=cl><span class=cm>  Specifies the domain controller to run the command. If this parameter is not specified, this script selects a default domain controller for the operation.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Sleep
</span></span></span><span class=line><span class=cl><span class=cm>  Sleep time (in seconds).
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.csc.repair.ps1
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.csc.repair.ps1 -DC &#39;DC-server.domain.com&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/38fc94dd-8d37-5f9e-b556-676304976a9f/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Specifies the domain controller to run the command.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DC&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Server</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Sleep time (in seconds).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Sleep</span> <span class=p>=</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-CSCRepair</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># EDITING THE REGISTRY.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-CSCRepair</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Server</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${P_Server}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Repair</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>Credential</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-Credential</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nb>Test-ComputerSecureChannel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Host</span> <span class=s1>&#39;Connection successful. Everything is fine!&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Host</span> <span class=s1>&#39;Connection failed! The secure channel between the local computer and the domain is broken. Removing and then rebuilds the channel established by the NetLogon service...&#39;</span>
</span></span><span class=line><span class=cl>      <span class=nb>Test-ComputerSecureChannel</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>      <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>until</span> <span class=p>(</span><span class=nb>Test-ComputerSecureChannel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/domain/>#domain</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ad/>#ad</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-27T09:25:25Z data-fn=date-local>2023/10/27 09:25:25 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Изменение порта RDP" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905><picture><source srcset='https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Изменение порта RDP" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905>Изменение порта RDP</a></h2></div></header><div class=node-body><p>По умолчанию, RDP использует порт TCP <code>3389</code>, но по каким-либо обстоятельствам приходится его менять. Рассмотрим два способа изменения порта RDP.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Изменение порта RDP" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905><img class=img-fluid src="https://images.unsplash.com/photo-1509483730228-811e47696246?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Изменение порта RDP" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/ data-bs-toggle=modal data-bs-target=#modal-37b4eb3be87fad5d3e6985a99831f905>Изменение порта RDP</a></h2></div></header><div class=node-body><p>По умолчанию, RDP использует порт TCP <code>3389</code>, но по каким-либо обстоятельствам приходится его менять. Рассмотрим два способа изменения порта RDP.</p></div></div></article></div><div class="modal fade" id=modal-37b4eb3be87fad5d3e6985a99831f905 tabindex=-1 aria-labelledby=modal-37b4eb3be87fad5d3e6985a99831f905-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-37b4eb3be87fad5d3e6985a99831f905-label><a href=/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/>Изменение порта RDP</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>По умолчанию, RDP использует порт TCP <code>3389</code>, но по каким-либо обстоятельствам приходится его менять. Рассмотрим два способа изменения порта RDP.</p><h2 id=2734814666-ручное-изменение-порта><a class=link-body-emphasis href=#2734814666-%d1%80%d1%83%d1%87%d0%bd%d0%be%d0%b5-%d0%b8%d0%b7%d0%bc%d0%b5%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bf%d0%be%d1%80%d1%82%d0%b0>Ручное изменение порта</a></h2><p>Для изменения порта RDP, нужно отредактировать реестр:</p><ol><li>Открыть редактор реестра <code>regedit.exe</code>.</li><li>Пройти по пути <code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp</code>.</li><li>Найти параметр <code>PortNumber</code>.</li><li>Ввести новый номер порта (decimal).</li><li>Перезагрузить компьютер.</li></ol><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Если включён брандмауэр, необходимо в нём разрешить подключение через новый порт RDP.</p></div></div></div><h2 id=2734814666-автоматизация><a class=link-body-emphasis href=#2734814666-%d0%b0%d0%b2%d1%82%d0%be%d0%bc%d0%b0%d1%82%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f>Автоматизация</a></h2><p>Весь процесс можно автоматизировать при помощи скрипта.</p><h3 id=2734814666-параметры><a class=link-body-emphasis href=#2734814666-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b>Параметры</a></h3><p>Скрипт имеет один единственный параметр, это номер порта.</p><ul><li><code>-P</code> <code>-P_Port</code> - номер порта RDP.</li></ul><h3 id=2734814666-примеры><a class=link-body-emphasis href=#2734814666-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h3><p>Запускается скрипт обычным способом. В параметре <code>-P</code> указывается новый номер порта RDP.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-28eb7dee18082b219f3bf9d889070fec role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-28eb7dee18082b219f3bf9d889070fec><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>rdp</span><span class=p>.</span><span class=py>port</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-P</span> <span class=mf>50102</span></span></span></code></pre></div></div></div></div><h3 id=2734814666-алгоритм-работы><a class=link-body-emphasis href=#2734814666-%d0%b0%d0%bb%d0%b3%d0%be%d1%80%d0%b8%d1%82%d0%bc-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b>Алгоритм работы</a></h3><ul><li>Проверяется в реестре корректность пути и изменяется номер порта RDP. Если путь не найден, то скрипт аварийно завершает работу без дальнейших изменений.</li><li>В брандмауэр вносится два правила, которые разрешают подключение к новому порту RDP.</li><li>Если служба <code>TermService</code> (служба удаленных рабочих столов) запущена, она перезапускается, применяя новые параметры порта RDP.</li></ul><h3 id=2734814666-скрипт><a class=link-body-emphasis href=#2734814666-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.rdp.port.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-138b6b9e987d597cc5d0f476f1685619 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.rdp.port.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.rdp.port.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-138b6b9e987d597cc5d0f476f1685619><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         5d2bddd9-4eed-42f0-a0ba-7d30efcb81e2
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Changing the RDP port number.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Changing the listening port for Remote Desktop on your computer.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Port
</span></span></span><span class=line><span class=cl><span class=cm>  RDP port number.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: 3389.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.rdp.port.ps1 -P 50102
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/616da78a-eb16-575a-9119-65f0c0c7baee/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;RDP port number.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidatePattern</span><span class=p>(</span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Port</span> <span class=p>=</span> <span class=mf>3389</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-RdpRegistry</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-RdpFirewall</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-RdpService</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># EDITING THE REGISTRY.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RdpRegistry</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Path</span> <span class=p>=</span> <span class=s1>&#39;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>LiteralPath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;PortNumber&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Value</span> <span class=p>=</span> <span class=nv>$P_Port</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Set-ItemProperty</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;&#39;</span><span class=nv>${Path}</span><span class=s2>&#39; not found!&#34;</span> <span class=n>-ErrorAction</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># EDITING THE FIREWALL.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RdpFirewall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$TCP</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DisplayName</span> <span class=p>=</span> <span class=s1>&#39;Custom RDP Port (TCP-In)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Profile</span> <span class=p>=</span> <span class=s1>&#39;Public&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Direction</span> <span class=p>=</span> <span class=n>Inbound</span>
</span></span><span class=line><span class=cl>    <span class=n>Action</span> <span class=p>=</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl>    <span class=n>Protocol</span> <span class=p>=</span> <span class=n>TCP</span>
</span></span><span class=line><span class=cl>    <span class=n>LocalPort</span> <span class=p>=</span> <span class=nv>$P_Port</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$UDP</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DisplayName</span> <span class=p>=</span> <span class=s1>&#39;Custom RDP Port (UDP-In)&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Profile</span> <span class=p>=</span> <span class=s1>&#39;Public&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>Direction</span> <span class=p>=</span> <span class=n>Inbound</span>
</span></span><span class=line><span class=cl>    <span class=n>Action</span> <span class=p>=</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl>    <span class=n>Protocol</span> <span class=p>=</span> <span class=n>UDP</span>
</span></span><span class=line><span class=cl>    <span class=n>LocalPort</span> <span class=p>=</span> <span class=nv>$P_Port</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-NetFirewallRule</span> <span class=nv>@TCP</span>
</span></span><span class=line><span class=cl>  <span class=nb>New-NetFirewallRule</span> <span class=nv>@UDP</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># RESTARTING THE REMOTE DESKTOP SERVICES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RdpService</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Name</span> <span class=p>=</span> <span class=s1>&#39;TermService&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Name</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Force</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=nb>Get-Service</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span><span class=p>).</span><span class=py>Status</span> <span class=o>-eq</span> <span class=s1>&#39;Running&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Restart-Service</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Service &#39;</span><span class=nv>${Name}</span><span class=s2>&#39; not running!&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/rdp/>#rdp</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-26T23:35:50Z data-fn=date-local>2023/10/26 23:35:50 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Полезные функции" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d><picture><source srcset='https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Полезные функции" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d>PowerShell: Полезные функции</a></h2></div></header><div class=node-body><p>Полезные функции PowerShell, которые я пишу сам или нахожу в интернете. Очень помогает в работе и в скриптах.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Полезные функции" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d><img class=img-fluid src="https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Полезные функции" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/ data-bs-toggle=modal data-bs-target=#modal-33c4a8b583ce3c25aeeb390b7fb1ab0d>PowerShell: Полезные функции</a></h2></div></header><div class=node-body><p>Полезные функции PowerShell, которые я пишу сам или нахожу в интернете. Очень помогает в работе и в скриптах.</p></div></div></article></div><div class="modal fade" id=modal-33c4a8b583ce3c25aeeb390b7fb1ab0d tabindex=-1 aria-labelledby=modal-33c4a8b583ce3c25aeeb390b7fb1ab0d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-33c4a8b583ce3c25aeeb390b7fb1ab0d-label><a href=/ru/articles/2023/10/c6e32349-8fc2-53f9-9a42-790878a64076/>PowerShell: Полезные функции</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Полезные функции PowerShell, которые я пишу сам или нахожу в интернете. Очень помогает в работе и в скриптах.</p><h2 id=1588418457-найти-файлы-старше-x-дней-с-момента-создания><a class=link-body-emphasis href=#1588418457-%d0%bd%d0%b0%d0%b9%d1%82%d0%b8-%d1%84%d0%b0%d0%b9%d0%bb%d1%8b-%d1%81%d1%82%d0%b0%d1%80%d1%88%d0%b5-x-%d0%b4%d0%bd%d0%b5%d0%b9-%d1%81-%d0%bc%d0%be%d0%bc%d0%b5%d0%bd%d1%82%d0%b0-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8f>Найти файлы старше X дней с момента создания</a></h2><p>Функция позволяет найти и вывести элементы старше X дней по свойству <code>CreationTime</code>.</p><h3 id=1588418457-параметры><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b>Параметры</a></h3><ul><li><code>-P</code> - путь к директории, в которой необходимо найти файлы.</li><li><code>-T</code> - время, прошедшее с момента создания файла (в секундах).</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.find.ct.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-dae6b46f0c70bac8882bf2c428d30f27 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.find.ct.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.find.ct.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-dae6b46f0c70bac8882bf2c428d30f27><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$Time</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Find-CreationTime</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Sort-Object</span> <span class=n>-Property</span> <span class=s1>&#39;LastAccessTime&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>CreationTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$Time</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Find-CreationTime</span></span></span></code></pre></div></div></div></div><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p><code>.AddSeconds</code> можно заменить на <code>.AddDays</code>, чтобы отсчитывать дату не в секундах, а в днях.</p></div></div></div><h2 id=1588418457-найти-файлы-старше-x-дней-с-момента-изменения><a class=link-body-emphasis href=#1588418457-%d0%bd%d0%b0%d0%b9%d1%82%d0%b8-%d1%84%d0%b0%d0%b9%d0%bb%d1%8b-%d1%81%d1%82%d0%b0%d1%80%d1%88%d0%b5-x-%d0%b4%d0%bd%d0%b5%d0%b9-%d1%81-%d0%bc%d0%be%d0%bc%d0%b5%d0%bd%d1%82%d0%b0-%d0%b8%d0%b7%d0%bc%d0%b5%d0%bd%d0%b5%d0%bd%d0%b8%d1%8f>Найти файлы старше X дней с момента изменения</a></h2><p>Функция позволяет найти и вывести элементы старше X дней по свойству <code>LastWriteTime</code>.</p><h3 id=1588418457-параметры-1><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-1>Параметры</a></h3><ul><li><code>-P</code> - путь к директории, в которой необходимо найти файлы.</li><li><code>-T</code> - время, прошедшее с момента изменения файла (в секундах).</li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p><code>.AddSeconds</code> можно заменить на <code>.AddDays</code>, чтобы отсчитывать дату не в секундах, а в днях.</p></div></div></div><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.find.lwt.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c781f3d12342322179c4eeb824542e31 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.find.lwt.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.find.lwt.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-c781f3d12342322179c4eeb824542e31><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$Time</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Find-LastWriteTime</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Sort-Object</span> <span class=n>-Property</span> <span class=s1>&#39;LastAccessTime&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>LastWriteTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$Time</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Find-LastWriteTime</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-создать-новый-элемент><a class=link-body-emphasis href=#1588418457-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d1%82%d1%8c-%d0%bd%d0%be%d0%b2%d1%8b%d0%b9-%d1%8d%d0%bb%d0%b5%d0%bc%d0%b5%d0%bd%d1%82>Создать новый элемент</a></h2><p>Функция позволяет создавать элементы. Ничего экстраординарного здесь нет, просто функция, укорачивающая стандартный cmdlet <code>New-Item</code>.</p><h3 id=1588418457-параметры-2><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-2>Параметры</a></h3><ul><li><code>-T</code> - тип элемента.<ul><li><code>'D'</code> - директория.</li><li><code>'F'</code> - файл.</li></ul></li><li><code>-P</code> - путь к директории, в которой необходимо создать элемент.</li><li><code>-N</code> - название элемента.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.new.item.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-65a7ac553e6805ad3e478ebb156328d8 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.new.item.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.new.item.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-65a7ac553e6805ad3e478ebb156328d8><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;SilentlyContinue&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>New-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Directory&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;File&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-Item</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span> <span class=n>-ItemType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>New-Data</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-проверить-существование-элемента><a class=link-body-emphasis href=#1588418457-%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d0%b8%d1%82%d1%8c-%d1%81%d1%83%d1%89%d0%b5%d1%81%d1%82%d0%b2%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d1%8d%d0%bb%d0%b5%d0%bc%d0%b5%d0%bd%d1%82%d0%b0>Проверить существование элемента</a></h2><p>Функция позволяет &ldquo;безопасно&rdquo; проверить существование элемента. Применяется параметр <code>-LiteralPath</code>, который интерпретирует путь без какой-либо обработки.</p><h3 id=1588418457-параметры-3><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-3>Параметры</a></h3><ul><li><code>-T</code> - тип элемента.</li><li><code>-P</code> - путь к директории, в которой необходимо проверить элемент.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.test.item.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8f1dc62b4aaf270683c5f7f668c9c700 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.test.item.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.test.item.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-8f1dc62b4aaf270683c5f7f668c9c700><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Container&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Leaf&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-PathType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Test-Data</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-проверить-существование-модуля><a class=link-body-emphasis href=#1588418457-%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d0%b8%d1%82%d1%8c-%d1%81%d1%83%d1%89%d0%b5%d1%81%d1%82%d0%b2%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d1%8f>Проверить существование модуля</a></h2><p>Функция позволяет проверить существование модуля PowerShell в памяти компьютера.</p><h3 id=1588418457-параметры-4><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-4>Параметры</a></h3><ul><li><code>-N</code> - название модуля.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.test.module.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-23f54b30785d1c64673d359993a91a32 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.test.module.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.test.module.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-23f54b30785d1c64673d359993a91a32><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$Names</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Stop&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Module</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>ForEach</span> <span class=p>(</span><span class=nv>$Name</span> <span class=k>in</span> <span class=nv>$Names</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Get-Module</span> <span class=n>-ListAvailable</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;Module &#39;</span><span class=nv>${Name}</span><span class=s2>&#39; not installed!&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Test-Module</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-вывести-сообщение-в-терминал><a class=link-body-emphasis href=#1588418457-%d0%b2%d1%8b%d0%b2%d0%b5%d1%81%d1%82%d0%b8-%d1%81%d0%be%d0%be%d0%b1%d1%89%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b2-%d1%82%d0%b5%d1%80%d0%bc%d0%b8%d0%bd%d0%b0%d0%bb>Вывести сообщение в терминал</a></h2><p>Функция выводит информацию в терминал по типу сообщений.</p><h3 id=1588418457-параметры-5><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-5>Параметры</a></h3><ul><li><code>-T</code> - тип сообщения.<ul><li><code>'HL'</code> - заголовок.</li><li><code>'I'</code> - информационное сообщение.</li><li><code>'W'</code> - предупреждение (warning).</li><li><code>'E'</code> - ошибка (error).</li></ul></li><li><code>-M</code> - текст сообщения.</li><li><code>-A</code> - действие, которое необходимо выполнить при выводе сообщения в терминал.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.write.msg.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-239445cdf4d1729b61a4dc096a0c091b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.write.msg.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.write.msg.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-239445cdf4d1729b61a4dc096a0c091b><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Continue&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Write-Msg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HL&#39;</span>    <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${NL}</span><span class=s2>--- </span><span class=nv>${Message}</span><span class=s2>&#34;</span><span class=p>.</span><span class=py>ToUpper</span><span class=p>()</span> <span class=n>-ForegroundColor</span> <span class=n>Blue</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I&#39;</span>     <span class=p>{</span> <span class=nb>Write-Information</span> <span class=n>-MessageData</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-InformationAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;W&#39;</span>     <span class=p>{</span> <span class=nb>Write-Warning</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-WarningAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;E&#39;</span>     <span class=p>{</span> <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Write-Msg</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-найти-свободную-букву-диска><a class=link-body-emphasis href=#1588418457-%d0%bd%d0%b0%d0%b9%d1%82%d0%b8-%d1%81%d0%b2%d0%be%d0%b1%d0%be%d0%b4%d0%bd%d1%83%d1%8e-%d0%b1%d1%83%d0%ba%d0%b2%d1%83-%d0%b4%d0%b8%d1%81%d0%ba%d0%b0>Найти свободную букву диска</a></h2><p>Небольшая функция, которая возвращает не занятую букву диска. Используется в <span class="shortcode shortcode-uuid"><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/>PowerShell: Стирание диска</a></span>.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.find.adl.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ac2c8eab56481e76017fd92144ed5af7 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.find.adl.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.find.adl.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-ac2c8eab56481e76017fd92144ed5af7><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Find-AvailableDriveLetter</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=mf>68</span><span class=p>.</span><span class=mf>.90</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=nv>$L</span><span class=p>=[</span><span class=no>char</span><span class=p>]</span><span class=nv>$_</span><span class=p>;</span> <span class=k>if</span> <span class=p>((</span><span class=nb>Get-PSDrive</span><span class=p>).</span><span class=py>Name</span> <span class=o>-notContains</span> <span class=nv>$L</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$L</span> <span class=p>}</span> <span class=p>})[</span><span class=mf>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-получить-размер-файла><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%be%d0%bb%d1%83%d1%87%d0%b8%d1%82%d1%8c-%d1%80%d0%b0%d0%b7%d0%bc%d0%b5%d1%80-%d1%84%d0%b0%d0%b9%d0%bb%d0%b0>Получить размер файла</a></h2><p>Функция позволяет получить размер файла в различных единицах измерения.</p><h3 id=1588418457-параметры-6><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-6>Параметры</a></h3><ul><li><code>-F</code> - название файла.</li></ul><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.get.filesize.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-45c67aaed2945e61684af5ed9ecd15ab role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.get.filesize.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.get.filesize.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-45c67aaed2945e61684af5ed9ecd15ab><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-FileSize</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=py>Length</span>      <span class=c># Size in bytes.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>KB</span>  <span class=c># Size in KB.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>MB</span>  <span class=c># Size in MB.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>GB</span>  <span class=c># Size in GB.</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>Get-Item</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>).</span><span class=n>Length</span><span class=p>/</span><span class=mf>1</span><span class=p>TB</span>  <span class=c># Size in TB.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-FileSize</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-работа-с-архивами-7-zip><a class=link-body-emphasis href=#1588418457-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%b0-%d1%81-%d0%b0%d1%80%d1%85%d0%b8%d0%b2%d0%b0%d0%bc%d0%b8-7-zip>Работа с архивами 7-Zip</a></h2><p>Функции по работе с архивами 7-Zip.</p><h3 id=1588418457-параметры-7><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-7>Параметры</a></h3><ul><li><code>-F</code> - путь к файлу.</li></ul><h3 id=1588418457-упаковка><a class=link-body-emphasis href=#1588418457-%d1%83%d0%bf%d0%b0%d0%ba%d0%be%d0%b2%d0%ba%d0%b0>Упаковка</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.compress.7z.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-13e959457ea0df489720ce7702e549d3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.compress.7z.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.compress.7z.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-13e959457ea0df489720ce7702e549d3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Compress-A7z</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\7-Zip\7z.exe&#34;</span> <span class=n>a</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=py>FullName</span> <span class=p>+</span> <span class=s1>&#39;.7z&#39;</span><span class=p>)</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Compress-A7z</span></span></span></code></pre></div></div></div></div><h3 id=1588418457-распаковка><a class=link-body-emphasis href=#1588418457-%d1%80%d0%b0%d1%81%d0%bf%d0%b0%d0%ba%d0%be%d0%b2%d0%ba%d0%b0>Распаковка</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.expand.7z.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-4bc67b79680dbafb466beca11f2f2f78 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.expand.7z.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.expand.7z.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-4bc67b79680dbafb466beca11f2f2f78><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Expand-A7z</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\7-Zip\7z.exe&#34;</span> <span class=n>x</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Expand-A7z</span></span></span></code></pre></div></div></div></div><h2 id=1588418457-работа-с-архивами-winrar><a class=link-body-emphasis href=#1588418457-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%b0-%d1%81-%d0%b0%d1%80%d1%85%d0%b8%d0%b2%d0%b0%d0%bc%d0%b8-winrar>Работа с архивами WinRAR</a></h2><p>Функции по работе с архивами WinRAR.</p><h3 id=1588418457-параметры-8><a class=link-body-emphasis href=#1588418457-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b-8>Параметры</a></h3><ul><li><code>-F</code> - путь к файлу.</li></ul><h3 id=1588418457-упаковка-1><a class=link-body-emphasis href=#1588418457-%d1%83%d0%bf%d0%b0%d0%ba%d0%be%d0%b2%d0%ba%d0%b0-1>Упаковка</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.compress.rar.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-bde9dbda21f058b512ce502bb5d8fbdf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.compress.rar.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.compress.rar.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-bde9dbda21f058b512ce502bb5d8fbdf><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Compress-RAR</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\WinRAR\Rar.exe&#34;</span> <span class=n>a</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=py>FullName</span> <span class=p>+</span> <span class=s1>&#39;.rar&#39;</span><span class=p>)</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Compress-RAR</span></span></span></code></pre></div></div></div></div><h3 id=1588418457-распаковка-1><a class=link-body-emphasis href=#1588418457-%d1%80%d0%b0%d1%81%d0%bf%d0%b0%d0%ba%d0%be%d0%b2%d0%ba%d0%b0-1>Распаковка</a></h3><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.expand.rar.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-acd3940bea3467e63c2be44a5b47a971 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.expand.rar.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.expand.rar.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-acd3940bea3467e63c2be44a5b47a971><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$File</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Expand-RAR</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Env:ProgramFiles</span><span class=p>)</span><span class=s2>\WinRAR\Rar.exe&#34;</span> <span class=n>x</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Expand-RAR</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-24T03:38:45Z data-fn=date-local>2023/10/24 03:38:45 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Стирание диска" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d><picture><source srcset='https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Стирание диска" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d>PowerShell: Стирание диска</a></h2></div></header><div class=node-body><p>Небольшой скрипт, который обнуляет HDD/SSD и создаёт файловую систему заново.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Стирание диска" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d><img class=img-fluid src="https://images.unsplash.com/photo-1646226343350-1ee5021e342a?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Стирание диска" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/ data-bs-toggle=modal data-bs-target=#modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d>PowerShell: Стирание диска</a></h2></div></header><div class=node-body><p>Небольшой скрипт, который обнуляет HDD/SSD и создаёт файловую систему заново.</p></div></div></article></div><div class="modal fade" id=modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d tabindex=-1 aria-labelledby=modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-ee8e7f2d0f11fcf70b2ca33ea3f0e80d-label><a href=/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/>PowerShell: Стирание диска</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Небольшой скрипт, который обнуляет HDD/SSD и создаёт файловую систему заново.</p><h2 id=3721749307-параметры><a class=link-body-emphasis href=#3721749307-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b>Параметры</a></h2><ul><li><code>-DN</code> <code>-P_DiskNumber</code> - номер диска. Можно узнать командой <code>Get-Disk</code>. Но если не ввести номер диска в параметры скрипта при запуске, скрипт сам выведет информацию и спросит номер диска. Обязательный параметр.</li><li><code>-DL</code> <code>-P_DriveLetter</code> - буква будущего тома. При создании тома, ОС должна присвоить ему букву. Обязательный параметр.</li><li><code>-FS</code> <code>-P_FileSystem</code> - файловая система. Может принимать следующие значения:<ul><li><code>'FAT'</code> - файловая система FAT.</li><li><code>'FAT32'</code> - файловая система FAT32.</li><li><code>'exFAT'</code> - файловая система exFAT.</li><li><code>'NTFS'</code> - файловая система NTFS.</li><li><code>'ReFS'</code> - новая файловая система ReFS.</li></ul></li><li><code>-FSL</code> <code>-P_FileSystemLabel</code> - метка файловой системы.</li><li><code>-S</code> <code>-P_Sleep</code> - перерыв между командами (в секундах).</li></ul><h2 id=3721749307-примеры><a class=link-body-emphasis href=#3721749307-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h2><p>Скрипт, запущенный без параметров, сам спросит необходимые данные:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c583fc6e27f0de9d81135fac48b58e8b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-c583fc6e27f0de9d81135fac48b58e8b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>disk</span><span class=p>.</span><span class=py>erase</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></div></div><p>Обнулить диск <code>3</code>, новому разделу присвоить букву <code>E</code>, форматировать в <code>NTFS</code> и указать метку <code>USB-SSD</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-42eb672dea9a5cb167e028609afbd5a9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-42eb672dea9a5cb167e028609afbd5a9><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>disk</span><span class=p>.</span><span class=py>erase</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-DN</span> <span class=mf>3</span> <span class=n>-DL</span> <span class=s1>&#39;E&#39;</span> <span class=n>-FS</span> <span class=s1>&#39;NTFS&#39;</span> <span class=n>-FSL</span> <span class=s1>&#39;USB-SSD&#39;</span></span></span></code></pre></div></div></div></div><h2 id=3721749307-скрипт><a class=link-body-emphasis href=#3721749307-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.disk.erase.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cd847016201873c4905e266b081757f1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.disk.erase.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.disk.erase.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-cd847016201873c4905e266b081757f1><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.0
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         8d95f4d5-4d14-412c-9fa4-b75ebe79df09
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-RunAsAdministrator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Disk erase script.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Disk cleanup followed by partition creation.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_DiskNumber
</span></span></span><span class=line><span class=cl><span class=cm>  Specifies the disk number of the disk on which to perform the clear operation. For a list of available disks, see the &#39;Get-Disk&#39; cmdlet.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_FileSystem
</span></span></span><span class=line><span class=cl><span class=cm>  Specifies the file system with which to format the volume.
</span></span></span><span class=line><span class=cl><span class=cm>  The acceptable values for this parameter are: &#39;NTFS&#39;, &#39;ReFS&#39;, &#39;exFAT&#39;, &#39;FAT32&#39; and &#39;FAT&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Sleep
</span></span></span><span class=line><span class=cl><span class=cm>  Sleep time (in seconds).
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.disk.erase.ps1 -DN 3 -DL &#39;E&#39; -FS &#39;NTFS&#39; -FSL &#39;USB-SSD&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/52d75b90-0637-5ba6-91d6-b1bff40e1d67/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Specify the disk number.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidatePattern</span><span class=p>(</span><span class=s1>&#39;^[0-9]+$&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DN&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_DiskNumber</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Specify the file system to format the volume.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;FAT&#39;</span><span class=p>,</span> <span class=s1>&#39;FAT32&#39;</span><span class=p>,</span> <span class=s1>&#39;exFAT&#39;</span><span class=p>,</span> <span class=s1>&#39;NTFS&#39;</span><span class=p>,</span> <span class=s1>&#39;ReFS&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;FS&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_FileSystem</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Sleep time (in seconds).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Sleep</span> <span class=p>=</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># New line separator.</span>
</span></span><span class=line><span class=cl><span class=nv>$NL</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>NewLine</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Random number.</span>
</span></span><span class=line><span class=cl><span class=nv>$Random</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>1000</span> <span class=n>-Maximum</span> <span class=mf>9999</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Getting free drive letter and to assign to the new partition.</span>
</span></span><span class=line><span class=cl><span class=nv>$DriveLetter</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$((</span><span class=mf>68</span><span class=p>.</span><span class=mf>.90</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=nv>$L</span><span class=p>=[</span><span class=no>char</span><span class=p>]</span><span class=nv>$_</span><span class=p>;</span> <span class=k>if</span> <span class=p>((</span><span class=nb>Get-PSDrive</span><span class=p>).</span><span class=py>Name</span> <span class=o>-notContains</span> <span class=nv>$L</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$L</span> <span class=p>}</span> <span class=p>})[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Specifying a new label to use for the volume.</span>
</span></span><span class=line><span class=cl><span class=nv>$FileSystemLabel</span> <span class=p>=</span> <span class=s2>&#34;DISK_</span><span class=nv>${Random}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskList</span>        <span class=c># Showing disk list.</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_DiskNumber</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$P_DiskNumber</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Read-Host</span> <span class=n>-Prompt</span> <span class=s1>&#39;Disk number&#39;</span><span class=p>)</span> <span class=p>}</span>   <span class=c># Getting disk number.</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_FileSystem</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$P_FileSystem</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Read-Host</span> <span class=n>-Prompt</span> <span class=s1>&#39;File system&#39;</span><span class=p>)</span> <span class=p>}</span>   <span class=c># Getting file system.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskClear</span>       <span class=c># Starting clearing disk.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskInit</span>        <span class=c># Initializing disk.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskPartition</span>   <span class=c># Creating partition.</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-DPDiskFormat</span>      <span class=c># Formatting volume.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># DISK LIST.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskList</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s1>&#39;Disk List&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nb>Get-Disk</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CLEAR DISK.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskClear</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Clear Disk&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;W&#39;</span> <span class=n>-A</span> <span class=s1>&#39;Inquire&#39;</span> <span class=n>-M</span> <span class=p>(</span><span class=s2>&#34;You specified drive number &#39;</span><span class=nv>${P_DiskNumber}</span><span class=s2>&#39;.</span><span class=nv>${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;All data will be DELETED!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Number</span> <span class=p>=</span> <span class=nv>$P_DiskNumber</span>
</span></span><span class=line><span class=cl>    <span class=n>RemoveData</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>RemoveOEM</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>    <span class=n>Confirm</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Clear-Disk</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZE DISK.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskInit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Initialize Disk&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Number</span> <span class=p>=</span> <span class=nv>$P_DiskNumber</span>
</span></span><span class=line><span class=cl>    <span class=n>PartitionStyle</span> <span class=p>=</span> <span class=s1>&#39;GPT&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Initialize-Disk</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CREATE PARTITION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskPartition</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Create Partition&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DiskNumber</span> <span class=p>=</span> <span class=nv>$P_DiskNumber</span>
</span></span><span class=line><span class=cl>    <span class=n>DriveLetter</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${DriveLetter}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>UseMaximumSize</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-Partition</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># FORMAT DISK VOLUME.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-DPDiskFormat</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s2>&#34;[DISK #</span><span class=nv>${P_DiskNumber}</span><span class=s2>] Format Disk Volume (</span><span class=nv>${DriveLetter}</span><span class=s2> / </span><span class=nv>${P_FileSystem}</span><span class=s2>)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_FileSystem</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$P_FileSystem</span> <span class=p>=</span> <span class=s1>&#39;NTFS&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DriveLetter</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${DriveLetter}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>FileSystem</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${P_FileSystem}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>NewFileSystemLabel</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${FileSystemLabel}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Force</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Format-Volume</span> <span class=nv>@Param</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-Sleep</span> <span class=n>-s</span> <span class=nv>$P_Sleep</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ------------------------------------------------&lt; COMMON FUNCTIONS &gt;------------------------------------------------ #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># SYSTEM MESSAGES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Write-Msg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Continue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HL&#39;</span>    <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${NL}</span><span class=s2>--- </span><span class=nv>${Message}</span><span class=s2>&#34;</span><span class=p>.</span><span class=py>ToUpper</span><span class=p>()</span> <span class=n>-ForegroundColor</span> <span class=n>Blue</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I&#39;</span>     <span class=p>{</span> <span class=nb>Write-Information</span> <span class=n>-MessageData</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-InformationAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;W&#39;</span>     <span class=p>{</span> <span class=nb>Write-Warning</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-WarningAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;E&#39;</span>     <span class=p>{</span> <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/hdd/>#hdd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ssd/>#ssd</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-23T11:03:04Z data-fn=date-local>2023/10/23 11:03:04 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Сжатие видео при помощи FFmpeg" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e><picture><source srcset='https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Сжатие видео при помощи FFmpeg" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e>PowerShell: Сжатие видео при помощи FFmpeg</a></h2></div></header><div class=node-body><p>Когда то в далёкой далёкой галактике&mldr; Ко мне на работе обратились с просьбой как то уменьшить видео, записанное на камеру в формате <code>.mov</code>. Естественно, я воспользовался библиотекой FFmpeg. Но …</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Сжатие видео при помощи FFmpeg" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e><img class=img-fluid src="https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Сжатие видео при помощи FFmpeg" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/ data-bs-toggle=modal data-bs-target=#modal-45eea9821cd138d37ad6ff1f9554ee6e>PowerShell: Сжатие видео при помощи FFmpeg</a></h2></div></header><div class=node-body><p>Когда то в далёкой далёкой галактике&mldr; Ко мне на работе обратились с просьбой как то уменьшить видео, записанное на камеру в формате <code>.mov</code>. Естественно, я воспользовался библиотекой FFmpeg. Но …</p></div></div></article></div><div class="modal fade" id=modal-45eea9821cd138d37ad6ff1f9554ee6e tabindex=-1 aria-labelledby=modal-45eea9821cd138d37ad6ff1f9554ee6e-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-45eea9821cd138d37ad6ff1f9554ee6e-label><a href=/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/>PowerShell: Сжатие видео при помощи FFmpeg</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Когда то в далёкой далёкой галактике&mldr; Ко мне на работе обратились с просьбой как то уменьшить видео, записанное на камеру в формате <code>.mov</code>. Естественно, я воспользовался библиотекой FFmpeg. Но скрипт автоматизации решил написать только сейчас&mldr;</p><p>Скрипт прост как лапоть. Состоит из небольшого количества вводных параметров, большинство из которых изменять не требуется. Предназначен скрипт для быстрого пакетного конвертирования файлов видео из одного формата в другой, в основном, с целью уменьшения размера. Скрипт не предназначен для сложного редактирования видео!</p><h2 id=770310385-параметры><a class=link-body-emphasis href=#770310385-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b>Параметры</a></h2><ul><li><code>-F</code> <code>-P_Files</code> - массив входящих файлов.</li><li><code>-CV</code> <code>-P_vCodec</code> - видео кодек, используемый для конвертации. По умолчанию: <code>libx265</code>. Поддерживаемые кодеки:<ul><li><code>'libx264'</code> - кодек &ldquo;H.264&rdquo;.</li><li><code>'libx265'</code> - кодек &ldquo;H.265&rdquo;.</li><li><code>'libvpx-vp9'</code> - кодек &ldquo;VP9&rdquo; (&ldquo;WebM&rdquo;).</li><li><code>'libaom-av1'</code> - кодек &ldquo;AV1&rdquo;.</li></ul></li><li><code>-CA</code> <code>-P_aCodec</code> - аудио кодек, используемый для конвертации. По умолчанию: <code>copy</code>. Поддерживаемые кодеки:<ul><li><code>'libfdk_aac'</code> - кодек &ldquo;Fraunhofer FDK AAC&rdquo;.</li><li><code>'aac'</code> - кодек &ldquo;FFmpeg AAC&rdquo;.</li><li><code>'libmp3lame'</code> - кодек &ldquo;FFmpeg MP3&rdquo;.</li></ul></li><li><code>-R</code> <code>-P_Framerate</code> - частота кадров выходящего файла (FPS). Сжатие кадров с учётом движения, где сцены движения кодируются с меньшим качеством, чем статичные сцены, что субъективно приводит к восприятию, как качественного, ибо визуально человек различает больше деталей в неподвижных объектах, чем в движущихся. Если параметр не указан, то значение берётся из входящего файла.</li><li><code>-C</code> <code>-P_CRF</code> - постоянный коэффициент потока (Constant Rate Factor). Это режим кодирования для кодеков &ldquo;H.264&rdquo; и &ldquo;H.265&rdquo; с постоянным воспринимаемым качеством, осуществляемый с помощью настройки качества (и управления скоростью). Если параметр не указан, то значение берётся по умолчанию, обычно это <code>28</code> при кодеке <code>libx265</code> и <code>23</code> при <code>libx264</code>.</li><li><code>-P</code> <code>-P_Preset</code> - пресеты. Это набор параметров, которые обеспечивают определённую скорость кодирования с степень сжатия. У каждого кодека видео свой набор пресетов. Нужно смотреть <a title href=https://trac.ffmpeg.org/wiki target=_blank rel="noopener noreferrer nofollow">документацию</a>.</li><li><code>-EXT</code> <code>-P_Extension</code> - расширение выходящих файлов.</li></ul><h2 id=770310385-примеры><a class=link-body-emphasis href=#770310385-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h2><p>Конвертировать файлы <code>file_01.mov</code>, <code>file_02.mov</code> и <code>file_03.mov</code> в формат <code>mp4</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-86d7244a53f08f829b865ae3b3cbfdaf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-86d7244a53f08f829b865ae3b3cbfdaf><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>ffmpeg</span><span class=p>.</span><span class=py>video</span><span class=p>.</span><span class=py>compress</span><span class=p>.</span><span class=py>ps1</span> <span class=o>-F</span> <span class=s1>&#39;file_01.mov&#39;</span><span class=p>,</span> <span class=s1>&#39;file_02.mov&#39;</span><span class=p>,</span> <span class=s1>&#39;file_03.mov&#39;</span></span></span></code></pre></div></div></div></div><p>Пакетная конвертация всех файлов с расширением <code>.mov</code> в формат <code>mp4</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9b69a37a653eb71283232e53aff0cdb0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-9b69a37a653eb71283232e53aff0cdb0><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>ffmpeg</span><span class=p>.</span><span class=py>video</span><span class=p>.</span><span class=py>compress</span><span class=p>.</span><span class=py>ps1</span> <span class=o>-F</span> <span class=s1>&#39;*.mov&#39;</span></span></span></code></pre></div></div></div></div><h2 id=770310385-алгоритм-работы><a class=link-body-emphasis href=#770310385-%d0%b0%d0%bb%d0%b3%d0%be%d1%80%d0%b8%d1%82%d0%bc-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b>Алгоритм работы</a></h2><p>Скрипт предназначен для быстрого пакетного преобразования файлов видео из одного формата в другой.</p><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для работы скрипта необходим файл <code>ffmpeg.exe</code>, архив которого можно скачать с сайта <a title href=https://www.gyan.dev/ffmpeg/builds/ target=_blank rel="noopener noreferrer nofollow">gyan.dev</a>, распаковать и разместить рядом с файлом скрипта или в любую дочернюю директорию. Скрипт сам найдёт файл <code>ffmpeg.exe</code> и начнёт его использовать.</p></div></div></div><h2 id=770310385-скрипт><a class=link-body-emphasis href=#770310385-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.ffmpeg.video.compress.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1a7854dbd1c5bc01ebf9cc37f816ce49 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.ffmpeg.video.compress.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.ffmpeg.video.compress.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-1a7854dbd1c5bc01ebf9cc37f816ce49><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.2
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         b95fb1ac-6878-4451-bb49-434d51d9555d
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  Video compression script based on FFmpeg.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  FFmpeg is a free and open-source software project consisting of a suite of libraries and programs for handling video, audio, and other multimedia files and streams.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Files
</span></span></span><span class=line><span class=cl><span class=cm>  An array of input files.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_vCodec
</span></span></span><span class=line><span class=cl><span class=cm>  The video codec.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;libx265&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_aCodec
</span></span></span><span class=line><span class=cl><span class=cm>  The audio codec.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;copy&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Framerate
</span></span></span><span class=line><span class=cl><span class=cm>  FFmpeg can be used to change the frame rate of an existing video, such that the output frame rate is lower or higher than the input frame rate. The output duration of the video will stay the same.
</span></span></span><span class=line><span class=cl><span class=cm>  This is useful when working with, for example, high-framerate input video that needs to be temporally scaled down for devices that do not support high FPS.
</span></span></span><span class=line><span class=cl><span class=cm>  When the frame rate is changed, FFmpeg will drop or duplicate frames as necessary to achieve the targeted output frame rate.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_CRF
</span></span></span><span class=line><span class=cl><span class=cm>  Constant Rate Factor.
</span></span></span><span class=line><span class=cl><span class=cm>  Use this rate control mode if you want to keep the best quality and care less about the file size. This is the recommended rate control mode for most uses.
</span></span></span><span class=line><span class=cl><span class=cm>  This method allows the encoder to attempt to achieve a certain output quality for the whole file when output file size is of less importance. This provides maximum compression efficiency with a single pass. By adjusting the so-called quantizer for each frame, it gets the bitrate it needs to keep the requested quality level. The downside is that you can&#39;t tell it to get a specific filesize or not go over a specific size or bitrate, which means that this method is not recommended for encoding videos for streaming.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Preset
</span></span></span><span class=line><span class=cl><span class=cm>  A preset is a collection of options that will provide a certain encoding speed to compression ratio. A slower preset will provide better compression (compression is quality per filesize). This means that, for example, if you target a certain file size or constant bit rate, you will achieve better quality with a slower preset. Similarly, for constant quality encoding, you will simply save bitrate by choosing a slower preset.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Extension
</span></span></span><span class=line><span class=cl><span class=cm>  The extension of the resulting files.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;mp4&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.ffmpeg.video.compress.ps1 -F &#39;file_01.mov&#39;, &#39;file_02.mov&#39;, &#39;file_03.mov&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.ffmpeg.video.compress.ps1 -F &#39;*.mov&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/2a73410a-6611-570c-9ab4-dc8cc8998146/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>,</span> <span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;An array of input files.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;F&#39;</span><span class=p>)][</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$P_Files</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;The video codec.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;CV&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_vCodec</span> <span class=p>=</span> <span class=s1>&#39;libx265&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;The audio codec.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;CA&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_aCodec</span> <span class=p>=</span> <span class=s1>&#39;copy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;FFmpeg can be used to change the frame rate of an existing video, such that the output frame rate is lower or higher than the input frame rate.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;R&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_Framerate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Constant Rate Factor. Use this rate control mode if you want to keep the best quality and care less about the file size.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$P_CRF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;A preset is a collection of options that will provide a certain encoding speed to compression ratio.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Preset</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;The extension of the resulting files.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;EXT&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Extension</span> <span class=p>=</span> <span class=s1>&#39;mp4&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># New line separator.</span>
</span></span><span class=line><span class=cl><span class=nv>$NL</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>NewLine</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-CompressVideo</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># COMPRESS VIDEO.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-CompressVideo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-ChildItem</span> <span class=s2>&#34;</span><span class=nv>${P_Files}</span><span class=s2>&#34;</span> <span class=o>-File</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$In</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Out</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nb>Join-Path</span> <span class=nv>$_</span><span class=p>.</span><span class=py>DirectoryName</span> <span class=nv>$_</span><span class=p>.</span><span class=n>BaseName</span><span class=p>)</span><span class=s2>.</span><span class=nv>${P_Extension}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Start-FFmpeg</span> <span class=n>-I</span> <span class=s2>&#34;</span><span class=nv>${In}</span><span class=s2>&#34;</span> <span class=n>-O</span> <span class=s2>&#34;</span><span class=nv>${Out}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ------------------------------------------------&lt; COMMON FUNCTIONS &gt;------------------------------------------------ #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># TESTING ELEMENTS.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Container&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Leaf&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-PathType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># APP: FFmpeg.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-FFmpeg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;I&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$In</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Out</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Search &#39;ffmpeg.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$FFmpegExe</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#34;</span> <span class=n>-Filter</span> <span class=s1>&#39;ffmpeg.exe&#39;</span> <span class=n>-Recurse</span> <span class=o>-File</span><span class=p>)</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-First</span> <span class=mf>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Checking the location of &#39;ffmpeg.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${FFmpegExe}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Warning</span> <span class=n>-WarningAction</span> <span class=s1>&#39;Stop&#39;</span> <span class=n>-Message</span> <span class=p>(</span><span class=s2>&#34;&#39;ffmpeg.exe&#39; not found!</span><span class=nv>${NL}${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1. Download FFmpeg from &#39;https://www.gyan.dev/ffmpeg/builds/&#39;.</span><span class=nv>${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2. Extract &#39;ffmpeg.exe&#39; into a directory &#39;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#39;.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Specifying &#39;ffmpeg.exe&#39; parameters.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-hide_banner&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-i&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${In}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-c:v&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_vCodec}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_CRF</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-crf&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_CRF}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_Preset</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-preset&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_Preset}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_Framerate</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-r&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_Framerate}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;-c:a&#39;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_aCodec}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Param</span> <span class=p>+=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${Out}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Running &#39;ffmpeg.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=nv>${FFmpegExe}</span><span class=s2>&#34;</span> <span class=nv>$Param</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ffmpeg/>#ffmpeg</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-22T14:06:44Z data-fn=date-local>2023/10/22 14:06:44 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell: Определение разрядности ОС Windows" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90><picture><source srcset='https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell: Определение разрядности ОС Windows" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90>PowerShell: Определение разрядности ОС Windows</a></h2></div></header><div class=node-body><p>Нашёл на Stack Overflow хорошую функцию по определению разрядности ОС и процесса PowerShell. Запишу, обязательно пригодится.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell: Определение разрядности ОС Windows" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90><img class=img-fluid src="https://images.unsplash.com/photo-1642176849879-92f85770f212?crop=bottom&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell: Определение разрядности ОС Windows" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/ data-bs-toggle=modal data-bs-target=#modal-cc0003811a6de90b8d8fb55dc160ee90>PowerShell: Определение разрядности ОС Windows</a></h2></div></header><div class=node-body><p>Нашёл на Stack Overflow хорошую функцию по определению разрядности ОС и процесса PowerShell. Запишу, обязательно пригодится.</p></div></div></article></div><div class="modal fade" id=modal-cc0003811a6de90b8d8fb55dc160ee90 tabindex=-1 aria-labelledby=modal-cc0003811a6de90b8d8fb55dc160ee90-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-cc0003811a6de90b8d8fb55dc160ee90-label><a href=/ru/articles/2023/10/0028821e-c96c-5014-a1dd-8963c161b170/>PowerShell: Определение разрядности ОС Windows</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Нашёл на Stack Overflow хорошую функцию по определению разрядности ОС и процесса PowerShell. Запишу, обязательно пригодится.</p><h2 id=3313365835-разрядность-ос><a class=link-body-emphasis href=#3313365835-%d1%80%d0%b0%d0%b7%d1%80%d1%8f%d0%b4%d0%bd%d0%be%d1%81%d1%82%d1%8c-%d0%be%d1%81>Разрядность ОС</a></h2><p>Разрядность ОС можно определить следующей функцией:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-d7c7e2ca5663df20c6382a0abe04bd6a><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-Architecture</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># What bitness does Windows use.</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>Is64BitOperatingSystem</span><span class=p>)</span> <span class=p>{</span> <span class=c># Needs &#39;.NET 4&#39;.</span>
</span></span><span class=line><span class=cl>    <span class=vm>$true</span>   <span class=p>{</span> <span class=mf>64</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=vm>$false</span>  <span class=p>{</span> <span class=mf>32</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_OperatingSystem</span><span class=p>).</span><span class=py>OSArchitecture</span> <span class=o>-replace</span> <span class=s1>&#39;\D&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># Or do any of these:</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_ComputerSystem).SystemType -replace &#39;\D&#39; -replace &#39;86&#39;, &#39;32&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_Processor).AddressWidth # This is slow...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d7c7e2ca5663df20c6382a0abe04bd6a role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Можно записать эту функцию в файл и запустить файл в терминале, или же внедрить в крупный проект и вызывать по имени <code>Get-Architecture</code>.</p><h3 id=3313365835-результат><a class=link-body-emphasis href=#3313365835-%d1%80%d0%b5%d0%b7%d1%83%d0%bb%d1%8c%d1%82%d0%b0%d1%82>Результат</a></h3><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-21077217e3c67fb601bfba36b25b3fc3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-21077217e3c67fb601bfba36b25b3fc3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>arch</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl><span class=mf>64</span></span></span></code></pre></div></div></div></div><h2 id=3313365835-разрядность-ос-и-powershell><a class=link-body-emphasis href=#3313365835-%d1%80%d0%b0%d0%b7%d1%80%d1%8f%d0%b4%d0%bd%d0%be%d1%81%d1%82%d1%8c-%d0%be%d1%81-%d0%b8-powershell>Разрядность ОС и PowerShell</a></h2><p>Расширенная версия, которая позволяет определить разрядность ОС и процесса PowerShell, под которым выполняется функция.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-9f9bab5b7cd53aa25ce994f5fd8edea9><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-Architecture</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c># What bitness does Windows use.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$windowsBitness</span> <span class=p>=</span> <span class=k>switch</span> <span class=p>([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>Is64BitOperatingSystem</span><span class=p>)</span> <span class=p>{</span> <span class=c># Needs &#39;.NET 4&#39;.</span>
</span></span><span class=line><span class=cl>    <span class=vm>$true</span>   <span class=p>{</span> <span class=mf>64</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=vm>$false</span>  <span class=p>{</span> <span class=mf>32</span><span class=p>;</span> <span class=k>break</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_OperatingSystem</span><span class=p>).</span><span class=py>OSArchitecture</span> <span class=o>-replace</span> <span class=s1>&#39;\D&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># Or do any of these:</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_ComputerSystem).SystemType -replace &#39;\D&#39; -replace &#39;86&#39;, &#39;32&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c># (Get-WmiObject -Class Win32_Processor).AddressWidth # Slow...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># What bitness does this PowerShell process use.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$processBitness</span> <span class=p>=</span> <span class=p>[</span><span class=no>IntPtr</span><span class=p>]::</span><span class=n>Size</span> <span class=p>*</span> <span class=mf>8</span>
</span></span><span class=line><span class=cl>  <span class=c># Or do any of these:</span>
</span></span><span class=line><span class=cl>  <span class=c># $processBitness = $env:PROCESSOR_ARCHITECTURE -replace &#39;\D&#39; -replace &#39;86|ARM&#39;, &#39;32&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c># $processBitness = if ([Environment]::Is64BitProcess) { 64 } else { 32 }</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Return the info as object.</span>
</span></span><span class=line><span class=cl>  <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>PSObject</span> <span class=n>-Property</span> <span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;ProcessArchitecture&#39;</span> <span class=p>=</span> <span class=s2>&#34;{0} bit&#34;</span> <span class=o>-f</span> <span class=nv>$processBitness</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;WindowsArchitecture&#39;</span> <span class=p>=</span> <span class=s2>&#34;{0} bit&#34;</span> <span class=o>-f</span> <span class=nv>$windowsBitness</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-9f9bab5b7cd53aa25ce994f5fd8edea9 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Можно записать эту функцию в файл и запустить файл в терминале, или же внедрить в крупный проект и вызывать по имени <code>Get-Architecture</code>.</p><h3 id=3313365835-результат-1><a class=link-body-emphasis href=#3313365835-%d1%80%d0%b5%d0%b7%d1%83%d0%bb%d1%8c%d1%82%d0%b0%d1%82-1>Результат</a></h3><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-fbd2aa8d137e1bba4877d9b111cd0bbb role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-fbd2aa8d137e1bba4877d9b111cd0bbb><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>arch</span><span class=p>.</span><span class=py>ps1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ProcessArchitecture</span> <span class=n>WindowsArchitecture</span>
</span></span><span class=line><span class=cl><span class=p>-------------------</span> <span class=p>-------------------</span>
</span></span><span class=line><span class=cl><span class=mf>64</span> <span class=n>bit</span>              <span class=mf>64</span> <span class=n>bit</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-21T17:42:05Z data-fn=date-local>2023/10/21 17:42:05 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="PowerShell Vault" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da><picture><source srcset='https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="PowerShell Vault" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da>PowerShell Vault</a></h2></div></header><div class=node-body><p>На работе в локальной сети использовалась задача, которая перемещала старые, по долгу не использовавшиеся, файлы из главного файлового хранилища в резервное. Но так как организация являлась …</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="PowerShell Vault" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da><img class=img-fluid src="https://images.unsplash.com/photo-1609358905581-e5381612486e?crop=left&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="PowerShell Vault" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/ data-bs-toggle=modal data-bs-target=#modal-7211caa07067ed9fd33cc9db16b800da>PowerShell Vault</a></h2></div></header><div class=node-body><p>На работе в локальной сети использовалась задача, которая перемещала старые, по долгу не использовавшиеся, файлы из главного файлового хранилища в резервное. Но так как организация являлась …</p></div></div></article></div><div class="modal fade" id=modal-7211caa07067ed9fd33cc9db16b800da tabindex=-1 aria-labelledby=modal-7211caa07067ed9fd33cc9db16b800da-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-7211caa07067ed9fd33cc9db16b800da-label><a href=/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/>PowerShell Vault</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>На работе в локальной сети использовалась задача, которая перемещала старые, по долгу не использовавшиеся, файлы из главного файлового хранилища в резервное. Но так как организация являлась проектной, то старые файлы могли понадобиться в любое время.</p><p>Задача использовала простой скрипт с фильтрацией файлов по параметрам <em>время создания</em> и <em>время изменения</em>. Я чуть доработали скрипт и решил опубликовать его для других администраторов. Вдруг, пригодится. Только перед использованием прошу проверить скрипт в какой-нибудь песочнице.</p><div class="shortcode shortcode-alert"><div class="alert alert-danger d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-circle-radiation fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Есть вероятность, что скрипт удалит все файлы в вашем файловом хранилище, из-за того, что автор может оказаться <em>рукожопом</em>! Поэтому, перед боевой задачей, проверьте скрипт в какой-нибудь песочнице. А кто хорошо разбирается в PowerShell - автор будет благодарен за оптимизацию и корректировку скрипта.</p></div></div></div><h2 id=3557522200-параметры><a class=link-body-emphasis href=#3557522200-%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%d1%8b>Параметры</a></h2><ul><li><code>-M</code> <code>-P_Mode</code> - режим работы скрипта. По умолчанию <code>'MV'</code>.<ul><li><code>'CP'</code> - копировать файлы из источника в хранилище.</li><li><code>'MV'</code> - перемещать файлы из источника в хранилище.</li><li><code>'RM'</code> - только удалять файлы из источника без копирования или перемещения куда-либо.</li></ul></li><li><code>-SRC</code> <code>-P_Source</code> - путь к директории откуда перемещать файлы. Например, <code>-SRC 'C:\Data\Source'</code>. По умолчанию: <code>${PSScriptRoot}\Source</code>.</li><li><code>-DST</code> <code>-P_Vault</code> - путь к директории куда перемещать файлы. Например, <code>-DST 'C:\Data\Vault'</code>. По умолчанию: <code>${PSScriptRoot}\Vault</code>.</li><li><code>-CT</code> <code>-P_CreationTime</code> - время создания файла в секундах. Например, <code>-CT 5270400</code>. По умолчанию: <code>5270400</code> (61 день).</li><li><code>-WT</code> <code>-P_LastWriteTime</code> - время изменения файла в секундах. Например, <code>-WT 5270400</code>. По умолчанию: <code>${P_CreationTime}</code>.</li><li><code>-FS</code> <code>-P_FileSize</code> - размер файла. Например, <code>-FS '5kb'</code> или <code>-FS '12mb'</code>. По умолчанию: <code>'0kb'</code>.</li><li><code>-E</code> <code>-P_Exclude</code> - путь к файлу с исключениями. Например, <code>-E 'C:\Data\exclude.txt'</code>. По умолчанию: <code>${PSScriptRoot}\vault.exclude.txt</code>.</li><li><code>-L</code> <code>-P_Logs</code> - путь к директории с журналами работы скрипта. Например, <code>-L 'C:\Data\Logs'</code>. По умолчанию: <code>${PSScriptRoot}\Logs</code>.</li><li><code>-RD</code> <code>-P_RemoveDirs</code> - удалять пустые каталоги.</li><li><code>-O</code> <code>-P_Overwrite</code> - перезаписать файлы в Vault.</li></ul><h2 id=3557522200-примеры><a class=link-body-emphasis href=#3557522200-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b>Примеры</a></h2><p>Запустить перемещение файлов из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-3134af87f294c4f0294ae0a2af702bcf role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-3134af87f294c4f0294ae0a2af702bcf><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span></span></span></code></pre></div></div></div></div><p>Запустить перемещение файлов с временем создания и изменения от 10 дней (<code>864000</code>) из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-71f6e1f931c4115e8c8f4ac2f6d14255 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-71f6e1f931c4115e8c8f4ac2f6d14255><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span> <span class=n>-CT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-WT</span> <span class=s1>&#39;864000&#39;</span></span></span></code></pre></div></div></div></div><p>Запустить перемещение файлов с временем создания и изменения от 10 дней (<code>864000</code>) и размером более 32 мегабайта (<code>32mb</code>) из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b5897ea78811ccb4499915eb89bc5748 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-b5897ea78811ccb4499915eb89bc5748><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span> <span class=n>-CT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-WT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-FS</span> <span class=s1>&#39;32mb&#39;</span></span></span></code></pre></div></div></div></div><p>Запустить перемещение файлов с временем создания и изменения от 10 дней (<code>864000</code>), и с перезаписью файлов с одинаковыми названиями (<code>-O</code>) из <code>Source</code> в <code>Vault</code> с сохранением структуры директорий:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5d73cbda931cdb1c5b550fbc4f0bd1ed role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-5d73cbda931cdb1c5b550fbc4f0bd1ed><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>pwsh</span><span class=p>.</span><span class=py>vault</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-SRC</span> <span class=s1>&#39;C:\Data\Source&#39;</span> <span class=n>-DST</span> <span class=s1>&#39;C:\Data\Vault&#39;</span> <span class=n>-CT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-WT</span> <span class=s1>&#39;864000&#39;</span> <span class=n>-O</span></span></span></code></pre></div></div></div></div><p>Параметр <code>-O</code> означает, что не нужно архивировать старый файл при перемещении нового с таким же названием. Старый файл в хранилище перезапишется новым.</p><h2 id=3557522200-алгоритм-работы><a class=link-body-emphasis href=#3557522200-%d0%b0%d0%bb%d0%b3%d0%be%d1%80%d0%b8%d1%82%d0%bc-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b>Алгоритм работы</a></h2><p>Скрипт создаёт хранилище старых файлов. Это, своего рода, аналог резервного копирования. При перемещении файлов из источника в хранилище, скрипт обрабатывает несколько заданных параметров и фильтров. Всё настроить можно под себя. По умолчанию, скрипт перемещает файлы из источника в хранилище, и если в хранилище уже имеется старый файл с названием кау у нового перемещаемого, то старый файл архивируется с меткой <code>.[UnixTime].7z</code>.</p><div class="shortcode shortcode-alert"><div class="alert alert-warning d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-exclamation-triangle fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для работы скрипта необходим архиватор <strong>7-Zip</strong>, а конкретно его облегчённая версия <code>7za.exe</code> с библиотеками из <strong>7-Zip Extra</strong>. Скачать можно с <a title href=https://www.7-zip.org/download.html target=_blank rel="noopener noreferrer nofollow">официального сайта</a>. После скачивания архива, файлы <code>7za.exe</code>, <code>7za.dll</code> и <code>7zxa.dll</code> нужно разместить рядом со скриптом, или в любую дочернюю директорию. Скрипт сам найдёт путь к <code>7za.exe</code>.</p></div></div></div><h2 id=3557522200-скрипт><a class=link-body-emphasis href=#3557522200-%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82>Скрипт</a></h2><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>pwsh.vault.ps1</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-f7dd59586bc57aa2b2beb7f73d52fd87 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=pwsh.vault.ps1 download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=pwsh.vault.ps1 target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-f7dd59586bc57aa2b2beb7f73d52fd87><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=cm>&lt;#PSScriptInfo
</span></span></span><span class=line><span class=cl><span class=cm>  .VERSION      0.1.4
</span></span></span><span class=line><span class=cl><span class=cm>  .GUID         8fd0ce2c-0288-4d9c-805f-703a0c659ade
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOR       Kitsune Solar
</span></span></span><span class=line><span class=cl><span class=cm>  .AUTHOREMAIL  mail@kitsune.solar
</span></span></span><span class=line><span class=cl><span class=cm>  .COMPANYNAME  iHub TO
</span></span></span><span class=line><span class=cl><span class=cm>  .COPYRIGHT    2023 iHub TO. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=cm>  .LICENSEURI   https://choosealicense.com/licenses/mit/
</span></span></span><span class=line><span class=cl><span class=cm>  .PROJECTURI   https://lib.onl/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#</span><span class=k>Requires</span><span class=w> </span><span class=kd>-Version</span><span class=na> 7.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>&lt;#
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>SYNOPSIS</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  PowerShell &#34;Vault&#34;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>DESCRIPTION</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  The script moves files to Vault based on various criteria.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Mode
</span></span></span><span class=line><span class=cl><span class=cm>  Script operation mode.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;MV&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Source
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the source. E.g.: &#39;C:\Data\Source&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\Source&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Vault
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the Vault. E.g.: &#39;C:\Data\Vault&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\Vault&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_CreationTime
</span></span></span><span class=line><span class=cl><span class=cm>  Time since file creation (in seconds). E.g.: &#39;5270400&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;5270400&#39; (61 day).
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_LastWriteTime
</span></span></span><span class=line><span class=cl><span class=cm>  Time since file modification (in seconds). E.g.: &#39;5270400&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${P_CreationTime}&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_FileSize
</span></span></span><span class=line><span class=cl><span class=cm>  File size check. E.g.: &#39;5kb&#39; / &#39;12mb&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;0kb&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Exclude
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the file with exceptions. E.g.: &#39;C:\Data\exclude.txt&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\vault.exclude.txt&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Logs
</span></span></span><span class=line><span class=cl><span class=cm>  Path to the directory with logs. E.g.: &#39;C:\Data\Logs&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;${PSScriptRoot}\Logs&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_RemoveDirs
</span></span></span><span class=line><span class=cl><span class=cm>  Removing empty directories.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;false&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .PARAMETER P_Overwrite
</span></span></span><span class=line><span class=cl><span class=cm>  Overwrite existing files in Vault.
</span></span></span><span class=line><span class=cl><span class=cm>  Default: &#39;false&#39;.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.vault.ps1 -SRC &#39;C:\Data&#39; -DST &#39;C:\Vault&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.vault.ps1 -SRC &#39;C:\Data&#39; -DST &#39;C:\Vault&#39; -CT &#39;864000&#39; -WT &#39;864000&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>EXAMPLE</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .\pwsh.vault.ps1 -SRC &#39;C:\Data&#39; -DST &#39;C:\Vault&#39; -CT &#39;864000&#39; -WT &#39;864000&#39; -FS &#39;32mb&#39;
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  .</span><span class=sd>LINK</span><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>  https://lib.onl/ru/articles/2023/10/4c7aba7c-f5a6-589a-9975-fdb16f2e2862/
</span></span></span><span class=line><span class=cl><span class=cm>#&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>Param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Script operation mode. Default: &#39;MV&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;CP&#39;</span><span class=p>,</span> <span class=s1>&#39;MV&#39;</span><span class=p>,</span> <span class=s1>&#39;RM&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Mode</span> <span class=p>=</span> <span class=s1>&#39;MV&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the source. E.g.: &#39;C:\Data\Source&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;SRC&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Source</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\Source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the Vault. E.g.: &#39;C:\Data\Vault&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;DST&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Vault</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\Vault&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Time since file creation (in seconds). E.g.: &#39;5270400&#39;. Default: 61 day (5270400 sec.).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;CT&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$P_CreationTime</span> <span class=p>=</span> <span class=mf>5270400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Time since file modification (in seconds). E.g.: &#39;5270400&#39;. Default: 61 day (&#39;5270400&#39; sec.).&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;WT&#39;</span><span class=p>)][</span><span class=no>long</span><span class=p>]</span><span class=nv>$P_LastWriteTime</span> <span class=p>=</span> <span class=nv>$P_CreationTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;File size check. E.g.: &#39;5kb&#39; / &#39;12mb&#39;. Default: &#39;0kb&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;FS&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_FileSize</span> <span class=p>=</span> <span class=s1>&#39;0kb&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the file with exceptions. E.g.: &#39;C:\Data\exclude.txt&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;E&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Exclude</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\vault.exclude.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Path to the directory with logs. E.g.: &#39;C:\Data\Logs&#39;.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$P_Logs</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>\Logs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Removing empty directories.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;RD&#39;</span><span class=p>)][</span><span class=no>switch</span><span class=p>]</span><span class=nv>$P_RemoveDirs</span> <span class=p>=</span> <span class=vm>$false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>HelpMessage</span><span class=p>=</span><span class=s2>&#34;Overwrite existing files in Vault.&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>)][</span><span class=no>switch</span><span class=p>]</span><span class=nv>$P_Overwrite</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CONFIGURATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Timestamp.</span>
</span></span><span class=line><span class=cl><span class=nv>$TS</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nb>Get-Date</span> <span class=n>-Format</span> <span class=s1>&#39;yyyy-MM-dd.HH-mm-ss&#39;</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$UTS</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>DateTimeOffset</span><span class=p>]::</span><span class=n>Now</span><span class=p>.</span><span class=py>ToUnixTimeSeconds</span><span class=p>())</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># New line separator.</span>
</span></span><span class=line><span class=cl><span class=nv>$NL</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$([</span><span class=no>Environment</span><span class=p>]::</span><span class=n>NewLine</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># INITIALIZATION.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-Script</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-TestVault</span>
</span></span><span class=line><span class=cl>  <span class=nb>Start-MoveFiles</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$P_RemoveDirs</span><span class=p>)</span> <span class=p>{</span> <span class=nb>Start-RemoveDirs</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># CREATING VAULT DIRECTORIES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-TestVault</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Dirs</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${P_Source}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${P_Vault}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=nv>${P_Exclude}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$Dir</span> <span class=k>in</span> <span class=nv>$Dirs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Dir}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span> <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Dir}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$File</span> <span class=k>in</span> <span class=nv>$Files</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span> <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${File}</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># MOVING FILES TO VAULT.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-MoveFiles</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s1>&#39;Moving Files to Vault&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${P_Source}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span> <span class=n>-Exclude</span> <span class=p>(</span><span class=nb>Get-Content</span> <span class=s2>&#34;</span><span class=nv>${P_Exclude}</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>CreationTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_CreationTime</span><span class=p>)))</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>      <span class=o>-and</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>LastWriteTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_LastWriteTime</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>(</span><span class=nv>$_</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span> <span class=o>-ge</span> <span class=s2>&#34;</span><span class=nv>${P_FileSize}</span><span class=s2>&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$Files</span><span class=p>)</span> <span class=p>{</span> <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;Required files were not found in the &#39;</span><span class=nv>${P_Source}</span><span class=s2>&#39;!&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>$Files</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$File</span> <span class=p>=</span> <span class=nv>$_</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=nv>$File</span><span class=p>.</span><span class=py>FullName</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span> <span class=o>-ge</span> <span class=mf>245</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;W&#39;</span> <span class=n>-M</span> <span class=s2>&#34;Over 250 characters in path! Skip:</span><span class=nv>${NL}</span><span class=s2>&#39;</span><span class=nv>${File}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$PathSRC</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$File</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>$PathDST</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$File</span><span class=p>.</span><span class=n>FullName</span><span class=p>)</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$File</span><span class=p>.</span><span class=n>DirectoryName</span><span class=p>)</span><span class=s2>&#34;</span><span class=p>).</span><span class=k>ForEach</span><span class=p>({</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Remove</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span> <span class=nv>$P_Source</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span> <span class=p>=</span> <span class=p>(${</span><span class=n>P_Vault</span><span class=p>}</span> <span class=p>|</span> <span class=nb>Join-Path</span> <span class=n>-ChildPath</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$P_Mode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;CP&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${P_Vault}</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>1</span><span class=p>])</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl>        <span class=nb>Compress-Data</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>.</span><span class=nv>${UTS}</span><span class=s2>.7z&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[CP] &#39;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39; -&gt; &#39;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Copy-Data</span> <span class=n>-S</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-D</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;MV&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>New-Data</span> <span class=n>-T</span> <span class=s1>&#39;D&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${P_Vault}</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>1</span><span class=p>])</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl>        <span class=nb>Compress-Data</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-N</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>.</span><span class=nv>${UTS}</span><span class=s2>.7z&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[MV] &#39;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39; -&gt; &#39;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Move-Data</span> <span class=n>-S</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-D</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathDST</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;RM&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[RM] &#39;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Remove-Data</span> <span class=n>-p</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$PathSRC</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># REMOVING EMPTY DIRECTORIES FROM SOURCE.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-RemoveDirs</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;HL&#39;</span> <span class=n>-M</span> <span class=s1>&#39;Removing Empty Directories&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Dirs</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${P_Source}</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=n>-Directory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>CreationTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_CreationTime</span><span class=p>)))</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>        <span class=o>-and</span> <span class=p>((</span><span class=nv>$_</span><span class=p>.</span><span class=n>LastWriteTime</span><span class=p>)</span> <span class=o>-lt</span> <span class=p>((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddSeconds</span><span class=p>(-</span><span class=nv>$P_LastWriteTime</span><span class=p>)))</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=nv>$_</span><span class=p>.</span><span class=py>FullName</span> <span class=n>-Force</span><span class=p>).</span><span class=n>Count</span><span class=p>)</span> <span class=o>-eq</span> <span class=mf>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=s1>&#39;FullName&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$Dirs</span><span class=p>)</span> <span class=p>{</span> <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;No empty directories were found in the &#39;</span><span class=nv>${P_Source}</span><span class=s2>&#39;!&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$Dirs</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nv>$Dir</span> <span class=p>=</span> <span class=nv>$_</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Msg</span> <span class=n>-M</span> <span class=s2>&#34;[RM] &#39;</span><span class=nv>${Dir}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=nb>Remove-Data</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Dir}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>while</span> <span class=p>(</span> <span class=nv>$Dirs</span><span class=p>.</span><span class=py>Count</span> <span class=o>-gt</span> <span class=mf>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># ------------------------------------------------&lt; COMMON FUNCTIONS &gt;------------------------------------------------ #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># WORKING WITH ELEMENTS.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Test-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Container&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Leaf&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Test-Path</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-PathType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>New-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;SilentlyContinue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;D&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;Directory&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;F&#39;</span> <span class=p>{</span> <span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;File&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>New-Item</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Name</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span> <span class=n>-ItemType</span> <span class=s2>&#34;</span><span class=nv>${Type}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Copy-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Src</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;D&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Dst</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Copy-Item</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Src}</span><span class=s2>&#34;</span> <span class=n>-Destination</span> <span class=s2>&#34;</span><span class=nv>${Dst}</span><span class=s2>&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Move-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;S&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Src</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;D&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Dst</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Move-Item</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Src}</span><span class=s2>&#34;</span> <span class=n>-Destination</span> <span class=s2>&#34;</span><span class=nv>${Dst}</span><span class=s2>&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Remove-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Remove-Item</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Compress-Data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;P&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;N&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$P_Overwrite</span> <span class=o>-and</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Start</span><span class=p>-</span><span class=n>7z</span> <span class=n>-T</span> <span class=s1>&#39;7z&#39;</span> <span class=n>-L</span> <span class=mf>9</span> <span class=n>-I</span> <span class=s2>&#34;</span><span class=nv>${Path}</span><span class=s2>&#34;</span> <span class=n>-O</span> <span class=s2>&#34;</span><span class=nv>${Name}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># SYSTEM MESSAGES.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Write-Msg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Action</span> <span class=p>=</span> <span class=s1>&#39;Continue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nv>$Type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HL&#39;</span>    <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${NL}</span><span class=s2>--- </span><span class=nv>${Message}</span><span class=s2>&#34;</span><span class=p>.</span><span class=py>ToUpper</span><span class=p>()</span> <span class=n>-ForegroundColor</span> <span class=n>Blue</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;I&#39;</span>     <span class=p>{</span> <span class=nb>Write-Information</span> <span class=n>-MessageData</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-InformationAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;W&#39;</span>     <span class=p>{</span> <span class=nb>Write-Warning</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-WarningAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;E&#39;</span>     <span class=p>{</span> <span class=nb>Write-Error</span> <span class=n>-Message</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=n>-ErrorAction</span> <span class=s2>&#34;</span><span class=nv>${Action}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=p>{</span> <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=nv>${Message}</span><span class=s2>&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># APP: 7-ZIP.</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Start-7z</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;I&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$In</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;O&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Out</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;7z&#39;</span><span class=p>,</span> <span class=s1>&#39;BZIP2&#39;</span><span class=p>,</span> <span class=s1>&#39;GZIP&#39;</span><span class=p>,</span> <span class=s1>&#39;TAR&#39;</span><span class=p>,</span> <span class=s1>&#39;WIM&#39;</span><span class=p>,</span> <span class=s1>&#39;XZ&#39;</span><span class=p>,</span> <span class=s1>&#39;ZIP&#39;</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)][</span><span class=no>string</span><span class=p>]</span><span class=nv>$Type</span> <span class=p>=</span> <span class=s1>&#39;7z&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateRange</span><span class=p>(</span><span class=mf>1</span><span class=p>,</span><span class=mf>9</span><span class=p>)][</span><span class=nb>Alias</span><span class=p>(</span><span class=s1>&#39;L&#39;</span><span class=p>)][</span><span class=no>int</span><span class=p>]</span><span class=nv>$Level</span> <span class=p>=</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># File list for &#39;7za.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$7z</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;7za.exe&#39;</span><span class=p>,</span> <span class=s1>&#39;7za.dll&#39;</span><span class=p>,</span> <span class=s1>&#39;7zxa.dll&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Search &#39;7za.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$7zExe</span> <span class=p>=</span> <span class=p>((</span><span class=nb>Get-ChildItem</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#34;</span> <span class=n>-Filter</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$7z</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=s2>&#34;</span> <span class=n>-Recurse</span> <span class=o>-File</span><span class=p>)</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-First</span> <span class=mf>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Getting &#39;7za.exe&#39; directory.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$7zDir</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$7zExe</span><span class=p>.</span><span class=n>DirectoryName</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Checking the location of files.</span>
</span></span><span class=line><span class=cl>  <span class=k>foreach</span> <span class=p>(</span><span class=nv>$File</span> <span class=k>in</span> <span class=nv>$7z</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Data</span> <span class=n>-T</span> <span class=s1>&#39;F&#39;</span> <span class=n>-P</span> <span class=s2>&#34;</span><span class=nv>${7zDir}</span><span class=s2>\</span><span class=nv>${File}</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>Write-Msg</span> <span class=n>-T</span> <span class=s1>&#39;W&#39;</span> <span class=n>-A</span> <span class=s1>&#39;Stop&#39;</span> <span class=n>-M</span> <span class=p>(</span><span class=s2>&#34;&#39;</span><span class=nv>${File}</span><span class=s2>&#39; not found!</span><span class=nv>${NL}${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;1. Download 7-Zip Extra from &#39;https://www.7-zip.org/download.html&#39;.</span><span class=nv>${NL}</span><span class=s2>&#34;</span> <span class=p>+</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;2. Extract all the contents of the archive into a directory &#39;</span><span class=nv>${PSScriptRoot}</span><span class=s2>&#39;.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Specifying &#39;7za.exe&#39; parameters.</span>
</span></span><span class=line><span class=cl>  <span class=nv>$Params</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s2>&#34;-t</span><span class=nv>${Type}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;-mx</span><span class=nv>${Level}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${Out}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=nv>${In}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c># Running &#39;7za.exe&#39;.</span>
</span></span><span class=line><span class=cl>  <span class=p>&amp;</span> <span class=s2>&#34;</span><span class=nv>${7zExe}</span><span class=s2>&#34;</span> <span class=nv>$Params</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------&lt; RUNNING SCRIPT &gt;------------------------------------------------- #</span>
</span></span><span class=line><span class=cl><span class=c># -------------------------------------------------------------------------------------------------------------------- #</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Start-Transcript</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>${P_Logs}</span><span class=s2>\</span><span class=p>$((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=n>Year</span><span class=p>)</span><span class=s2>\</span><span class=p>$((</span><span class=nb>Get-Date</span><span class=p>).</span><span class=n>Month</span><span class=p>)</span><span class=s2>\</span><span class=nv>${TS}</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Start-Script</span>
</span></span><span class=line><span class=cl><span class=nb>Stop-Transcript</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-20T09:57:21Z data-fn=date-local>2023/10/20 09:57:21 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Дефрагментация в ОС Windows" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c><picture><source srcset='https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Дефрагментация в ОС Windows" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c>Дефрагментация в ОС Windows</a></h2></div></header><div class=node-body><p>При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация HDD.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Дефрагментация в ОС Windows" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c><img class=img-fluid src="https://images.unsplash.com/photo-1591913139332-f8172ef511da?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Дефрагментация в ОС Windows" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/ data-bs-toggle=modal data-bs-target=#modal-7ee46f5afcb8efcf647b56ad0cfd905c>Дефрагментация в ОС Windows</a></h2></div></header><div class=node-body><p>При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация HDD.</p></div></div></article></div><div class="modal fade" id=modal-7ee46f5afcb8efcf647b56ad0cfd905c tabindex=-1 aria-labelledby=modal-7ee46f5afcb8efcf647b56ad0cfd905c-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-7ee46f5afcb8efcf647b56ad0cfd905c-label><a href=/ru/articles/2023/10/eb39e3f7-b194-53d4-8bad-01edf9fdac47/>Дефрагментация в ОС Windows</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>При работе с оборудованием, мне приходится сталкиваться с довольно старыми устройствами, их их работу нужно как-нибудь оптимизировать. Одним из вариантов оптимизации является дефрагментация HDD.</p><h2 id=2761221296-powershell><a class=link-body-emphasis href=#2761221296-powershell>PowerShell</a></h2><p>Командлет по дефрагментации для PowerShell называется <code>Optimize-Volume</code> и может принимать следующие параметры:</p><ul><li><code>-Analyze</code> - выполнение анализа указанного тома.</li><li><code>-Defrag</code> - выполнение дефрагментации указанного тома.</li><li><code>-DriveLetter</code> - буква тома.</li><li><code>-NormalPriority</code> - выполнение процесса с нормальным приоритетом (по умолчанию приоритет пониженный).</li><li><code>-ReTrim</code> - выполнение TRIM-операции для SSD.</li></ul><p>Это наиболее востребованные параметры. Остальные параметры можно посмотреть в <a title href=https://learn.microsoft.com/en-us/powershell/module/storage/optimize-volume target=_blank rel="noopener noreferrer nofollow">официальной документации</a>.</p><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для всех команд можно добавить параметр <code>-Verbose</code>, который выводит подробную информацию о происходящем процессе.</p></div></div></div><h3 id=2761221296-анализ-тома><a class=link-body-emphasis href=#2761221296-%d0%b0%d0%bd%d0%b0%d0%bb%d0%b8%d0%b7-%d1%82%d0%be%d0%bc%d0%b0>Анализ тома</a></h3><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-aa32236776fc468cd5af3f89a902c406><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Optimize-Volume</span> <span class=n>-DriveLetter</span> <span class=n>C</span> <span class=n>-Analyze</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-aa32236776fc468cd5af3f89a902c406 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-DriveLetter C</code> - буква тома (диск C:).</li><li><code>-Analyze</code> - анализ.</li></ul><h3 id=2761221296-дефрагментация><a class=link-body-emphasis href=#2761221296-%d0%b4%d0%b5%d1%84%d1%80%d0%b0%d0%b3%d0%bc%d0%b5%d0%bd%d1%82%d0%b0%d1%86%d0%b8%d1%8f>Дефрагментация</a></h3><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-1dc0daf38c8b4b83a795950f20ebbc62><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Optimize-Volume</span> <span class=n>-DriveLetter</span> <span class=n>C</span> <span class=n>-Defrag</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1dc0daf38c8b4b83a795950f20ebbc62 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-DriveLetter C</code> - буква тома (диск C:).</li><li><code>-Defrag</code> - дефрагментация.</li></ul><h3 id=2761221296-trim-операция-для-ssd><a class=link-body-emphasis href=#2761221296-trim-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d1%8f-%d0%b4%d0%bb%d1%8f-ssd>TRIM-операция для SSD</a></h3><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-5efc08bd6ff0c0535b20aee4e77aa1ff><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Optimize-Volume</span> <span class=n>-DriveLetter</span> <span class=n>C</span> <span class=n>-ReTrim</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-5efc08bd6ff0c0535b20aee4e77aa1ff role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>-DriveLetter C</code> - буква тома (диск C:).</li><li><code>-ReTrim</code> - на дисках SSD запускает TRIM-операцию.</li></ul><h2 id=2761221296-cmd-defrag><a class=link-body-emphasis href=#2761221296-cmd-defrag>CMD Defrag</a></h2><p>Утилита <code>defrag.exe</code> выполняет анализ и оптимизацию томов через командную строку. Утилита может принимать следующие параметры:</p><ul><li>Тома:<ul><li><code>/c</code> - выполнение операции на всех томах.</li><li><code>/e</code> - выполнение операции на всех томах, кроме указанных.</li></ul></li><li>Операции:<ul><li><code>/a</code> - анализ указанных томов.</li><li><code>/d</code> - выполнение традиционной дефрагментации (по умолчанию). На многоуровневом томе традиционная дефрагментация выполняется только на уровне ёмкости.</li><li><code>/l</code> - выполнение TRIM-операции для SSD.</li><li><code>/o</code> - выполнение правильной оптимизации для каждого типа носителя.</li><li><code>/u</code> - отображение хода операции.</li></ul></li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Для всех команд можно добавить параметр <code>/v</code>, который выводит подробную информацию о происходящем процессе.</p></div></div></div><h3 id=2761221296-анализ-тома-1><a class=link-body-emphasis href=#2761221296-%d0%b0%d0%bd%d0%b0%d0%bb%d0%b8%d0%b7-%d1%82%d0%be%d0%bc%d0%b0-1>Анализ тома</a></h3><p>Анализ тома, с отображением хода выполнения и выводом результатов в подробном формате:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-e8261cf3c17546d719f3bffc6539671c><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag c: /u /a</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e8261cf3c17546d719f3bffc6539671c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>c:</code> - буква тома (диск <code>C:</code>).</li><li><code>/u</code> - отображение хода выполнения операции.</li><li><code>/a</code> - анализ.</li></ul><h3 id=2761221296-параллельная-дефрагментация><a class=link-body-emphasis href=#2761221296-%d0%bf%d0%b0%d1%80%d0%b0%d0%bb%d0%bb%d0%b5%d0%bb%d1%8c%d0%bd%d0%b0%d1%8f-%d0%b4%d0%b5%d1%84%d1%80%d0%b0%d0%b3%d0%bc%d0%b5%d0%bd%d1%82%d0%b0%d1%86%d0%b8%d1%8f>Параллельная дефрагментация</a></h3><p>Параллельная дефрагментация томов <code>C:</code> и <code>D:</code> в фоновом режиме:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-984cf187427bcca93cf318c5679f8a7c><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag c: d: /m</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-984cf187427bcca93cf318c5679f8a7c role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>c:</code> - буква тома (диск <code>C:</code>).</li><li><code>d:</code> - буква тома (диск <code>D:</code>).</li><li><code>/m</code> - выполнение операции с каждым томом параллельно в фоновом режиме.</li></ul><h3 id=2761221296-дефрагментация-всех-томах><a class=link-body-emphasis href=#2761221296-%d0%b4%d0%b5%d1%84%d1%80%d0%b0%d0%b3%d0%bc%d0%b5%d0%bd%d1%82%d0%b0%d1%86%d0%b8%d1%8f-%d0%b2%d1%81%d0%b5%d1%85-%d1%82%d0%be%d0%bc%d0%b0%d1%85>Дефрагментация всех томах</a></h3><p>Выполнить дефрагментацию на всех локальных томах с нормальным приоритетом:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-6bce8afe84cf04393ed485e98845d04f><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag /u /c /h</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-6bce8afe84cf04393ed485e98845d04f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>/u</code> - отображение хода выполнения операции.</li><li><code>/c</code> - выполнение операции на всех томах.</li><li><code>/h</code> - выполнение операции с нормальным приоритетом (по умолчанию приоритет пониженный).</li></ul><h3 id=2761221296-trim-операция-для-ssd-1><a class=link-body-emphasis href=#2761221296-trim-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d1%8f-%d0%b4%d0%bb%d1%8f-ssd-1>TRIM-операция для SSD</a></h3><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-cmd"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-a2ae5c28b64a35e8d67b990cd87ceca3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>defrag /u /c /l</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-a2ae5c28b64a35e8d67b990cd87ceca3 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Где:</p><ul><li><code>/u</code> - отображение хода выполнения операции.</li><li><code>/c</code> - выполнение операции на всех томах.</li><li><code>/l</code> или <code>/retrim</code> - на дисках SSD запускает TRIM-операцию.</li></ul></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/hdd/>#hdd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/ssd/>#ssd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/cmd/>#cmd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/defrag/>#defrag</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-20T00:46:16Z data-fn=date-local>2023/10/20 00:46:16 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Установка сертификата НУЦ Минцифры" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/75075788-9308-56b7-b531-2008cb35f7d0/ data-bs-toggle=modal data-bs-target=#modal-48ce8efb340887e56667dabda91b66a6><picture><source srcset='https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Установка сертификата НУЦ Минцифры" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/75075788-9308-56b7-b531-2008cb35f7d0/ data-bs-toggle=modal data-bs-target=#modal-48ce8efb340887e56667dabda91b66a6>Установка сертификата НУЦ Минцифры</a></h2></div></header><div class=node-body><p>Рассказываю о нескольких способах установки сертификатов от НУЦ Минцифры. Установка производится в ОС MS Windows и Linux.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Установка сертификата НУЦ Минцифры" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2023/10/75075788-9308-56b7-b531-2008cb35f7d0/ data-bs-toggle=modal data-bs-target=#modal-48ce8efb340887e56667dabda91b66a6><img class=img-fluid src="https://images.unsplash.com/photo-1570610159825-ec5d3823660c?crop=edges&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Установка сертификата НУЦ Минцифры" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2023/10/75075788-9308-56b7-b531-2008cb35f7d0/ data-bs-toggle=modal data-bs-target=#modal-48ce8efb340887e56667dabda91b66a6>Установка сертификата НУЦ Минцифры</a></h2></div></header><div class=node-body><p>Рассказываю о нескольких способах установки сертификатов от НУЦ Минцифры. Установка производится в ОС MS Windows и Linux.</p></div></div></article></div><div class="modal fade" id=modal-48ce8efb340887e56667dabda91b66a6 tabindex=-1 aria-labelledby=modal-48ce8efb340887e56667dabda91b66a6-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-48ce8efb340887e56667dabda91b66a6-label><a href=/ru/articles/2023/10/75075788-9308-56b7-b531-2008cb35f7d0/>Установка сертификата НУЦ Минцифры</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Рассказываю о нескольких способах установки сертификатов от НУЦ Минцифры. Установка производится в ОС MS Windows и Linux.</p><h2 id=4022241939-ms-windows><a class=link-body-emphasis href=#4022241939-ms-windows>MS Windows</a></h2><h3 id=4022241939-установка-корневого-сертификата><a class=link-body-emphasis href=#4022241939-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b0-%d0%ba%d0%be%d1%80%d0%bd%d0%b5%d0%b2%d0%be%d0%b3%d0%be-%d1%81%d0%b5%d1%80%d1%82%d0%b8%d1%84%d0%b8%d0%ba%d0%b0%d1%82%d0%b0>Установка корневого сертификата</a></h3><ul><li><a title href=https://gu-st.ru/content/Other/doc/russian_trusted_root_ca.cer target=_blank rel="noopener noreferrer nofollow">Скачать</a> корневой сертификат.</li><li>Открыть скаченный файл <code>russian_trusted_root_ca.cer</code> и нажать кнопку <span class="shortcode shortcode-key d-inline-block"><kbd>Установить сертификат...</kbd></span>.</li><li>В <strong>Мастере импорта сертификатов</strong> выбрать <em>Текущий пользователь</em>.<ul><li>Выбрать <em>Поместить все сертификаты в следующее хранилище</em>.</li><li>Нажать <span class="shortcode shortcode-key d-inline-block"><kbd>Обзор</kbd></span> и выбрать <em>Доверенные корневые центры сертификации</em>.</li><li>В окне <strong>Завершение мастера импорта сертификатов</strong> нажать <span class="shortcode shortcode-key d-inline-block"><kbd>Готово</kbd></span>.</li></ul></li></ul><h3 id=4022241939-установка-выпускающего-сертификата><a class=link-body-emphasis href=#4022241939-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b0-%d0%b2%d1%8b%d0%bf%d1%83%d1%81%d0%ba%d0%b0%d1%8e%d1%89%d0%b5%d0%b3%d0%be-%d1%81%d0%b5%d1%80%d1%82%d0%b8%d1%84%d0%b8%d0%ba%d0%b0%d1%82%d0%b0>Установка выпускающего сертификата</a></h3><ul><li><a title href=https://gu-st.ru/content/Other/doc/russian_trusted_sub_ca.cer target=_blank rel="noopener noreferrer nofollow">Скачать</a> выпускающий сертификат.</li><li>Открыть скаченный файл <code>russian_trusted_sub_ca.cer</code> и нажать кнопку <span class="shortcode shortcode-key d-inline-block"><kbd>Установить сертификат...</kbd></span>.</li><li>В <strong>Мастере импорта сертификатов</strong> выбрать <em>Текущий пользователь</em>.<ul><li>Выбрать <em>Автоматически выбрать хранилище на основе типа сертификата</em>.</li><li>В окне <strong>Завершение мастера импорта сертификатов</strong> нажать <span class="shortcode shortcode-key d-inline-block"><kbd>Готово</kbd></span>.</li></ul></li></ul><h3 id=4022241939-powershell><a class=link-body-emphasis href=#4022241939-powershell>PowerShell</a></h3><p>При помощи PowerShell можно установить сертификат одной строчкой, состоящей из нескольких команд:</p><ul><li><code>Invoke-WebRequest</code> - скачивает файл с внешнего веб-ресурса.</li><li><code>Import-Certificate</code> - импортирует сертификат в указанное хранилище.</li><li><code>${DIR}</code> - переменная, определяющая директорию <code>Downloads</code> (<code>Загрузки</code>) для текущего пользователя.</li></ul><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-79005cb353f11d1dd6cdc211fc9afe37 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-79005cb353f11d1dd6cdc211fc9afe37><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>${</span><span class=n>CERT_ROOT</span><span class=p>}</span> <span class=p>=</span> <span class=s1>&#39;russian_trusted_root_ca.cer&#39;</span><span class=p>;</span> <span class=p>${</span><span class=n>CERT_SUB</span><span class=p>}</span> <span class=p>=</span> <span class=s1>&#39;russian_trusted_sub_ca.cer&#39;</span><span class=p>;</span> <span class=p>${</span><span class=n>DIR</span><span class=p>}</span> <span class=p>=</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>-ComObject</span> <span class=n>Shell</span><span class=p>.</span><span class=n>Application</span><span class=p>).</span><span class=py>NameSpace</span><span class=p>(</span><span class=s1>&#39;shell:Downloads&#39;</span><span class=p>).</span><span class=py>Self</span><span class=p>.</span><span class=n>Path</span><span class=p>;</span> <span class=nb>Invoke-WebRequest</span> <span class=s2>&#34;https://gu-st.ru/content/Other/doc/</span><span class=nv>${CERT_ROOT}</span><span class=s2>&#34;</span> <span class=n>-OutFile</span> <span class=s2>&#34;</span><span class=nv>${DIR}</span><span class=s2>\</span><span class=nv>${CERT_ROOT}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>Import-Certificate</span> <span class=n>-FilePath</span> <span class=s2>&#34;</span><span class=nv>${DIR}</span><span class=s2>\</span><span class=nv>${CERT_ROOT}</span><span class=s2>&#34;</span> <span class=n>-CertStoreLocation</span> <span class=s1>&#39;Cert:\CurrentUser\Root&#39;</span><span class=p>;</span> <span class=nb>Invoke-WebRequest</span> <span class=s2>&#34;https://gu-st.ru/content/Other/doc/</span><span class=nv>${CERT_SUB}</span><span class=s2>&#34;</span> <span class=n>-OutFile</span> <span class=s2>&#34;</span><span class=nv>${DIR}</span><span class=s2>\</span><span class=nv>${CERT_SUB}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>Import-Certificate</span> <span class=n>-FilePath</span> <span class=s2>&#34;</span><span class=nv>${DIR}</span><span class=s2>\</span><span class=nv>${CERT_SUB}</span><span class=s2>&#34;</span> <span class=n>-CertStoreLocation</span> <span class=s1>&#39;Cert:\CurrentUser\CA&#39;</span><span class=p>;</span></span></span></code></pre></div></div></div></div><h2 id=4022241939-linux><a class=link-body-emphasis href=#4022241939-linux>Linux</a></h2><p>Для Linux можно воспользоваться пакетом сертификатов в формате <code>.PEM</code> от <strong>MacOS</strong>. Положительным моментом подобного пакета является то, что PEM содержит в себе сразу два сертификата: корневой и выпускающий.</p><h3 id=4022241939-установка-корневого-и-выпускающего-сертификатов><a class=link-body-emphasis href=#4022241939-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b0-%d0%ba%d0%be%d1%80%d0%bd%d0%b5%d0%b2%d0%be%d0%b3%d0%be-%d0%b8-%d0%b2%d1%8b%d0%bf%d1%83%d1%81%d0%ba%d0%b0%d1%8e%d1%89%d0%b5%d0%b3%d0%be-%d1%81%d0%b5%d1%80%d1%82%d0%b8%d1%84%d0%b8%d0%ba%d0%b0%d1%82%d0%be%d0%b2>Установка корневого и выпускающего сертификатов</a></h3><ul><li><a title href=https://gu-st.ru/content/Other/doc/russiantrustedca.pem target=_blank rel="noopener noreferrer nofollow">Скачать</a> файл с корневым и выпускающим сертификатами.</li><li>Добавить скаченный файл <code>russiantrustedca.pem</code> в хранилище доверенных сертификатов в зависимости от дистрибутива Linux.<ul><li>DEB-based: <code>/usr/local/share/ca-certificates/</code>.</li><li>RHEL-based: <code>/etc/pki/ca-trust/source/anchors/</code>.</li><li>Arch Linux: <code>/etc/ca-certificates/trust-source/anchors/</code>.</li></ul></li><li>Обновить хранилище сертификатов следующими командами.<ul><li>DEB-based: <code>update-ca-certificates --fresh</code>.</li><li>RHEL-based: <code>update-ca-trust force-enable</code> и <code>update-ca-trust extract</code>.</li></ul></li></ul><h3 id=4022241939-bash><a class=link-body-emphasis href=#4022241939-bash>Bash</a></h3><p>Установить сертификат можно одной командой. Команды вводится от пользователя <code>root</code>. Как выше приводилось, для DEB-based и RHEL-based дистрибутивов, пути хранилища сертификатов различаются. Поэтому, я привожу две команды под каждые версии дистрибутивов.</p><h4 id=4022241939-deb-based-дистрибутивы><a class=link-body-emphasis href=#4022241939-deb-based-%d0%b4%d0%b8%d1%81%d1%82%d1%80%d0%b8%d0%b1%d1%83%d1%82%d0%b8%d0%b2%d1%8b>DEB-based дистрибутивы</a></h4><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-0f8f084b91ebed88b8d0d94b8c1e39ac role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-0f8f084b91ebed88b8d0d94b8c1e39ac><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>CERT</span><span class=o>=</span><span class=s1>&#39;russiantrustedca.pem&#39;</span><span class=p>;</span> curl -o <span class=s2>&#34;/usr/local/share/ca-certificates/</span><span class=si>${</span><span class=nv>CERT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;https://gu-st.ru/content/Other/doc/</span><span class=si>${</span><span class=nv>CERT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> update-ca-certificates --fresh<span class=p>;</span></span></span></code></pre></div></div></div></div><h4 id=4022241939-rhel-based-дистрибутивы><a class=link-body-emphasis href=#4022241939-rhel-based-%d0%b4%d0%b8%d1%81%d1%82%d1%80%d0%b8%d0%b1%d1%83%d1%82%d0%b8%d0%b2%d1%8b>RHEL-based дистрибутивы</a></h4><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-617e7366b05c6d6d659336d2f9e781ad role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-617e7366b05c6d6d659336d2f9e781ad><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>CERT</span><span class=o>=</span><span class=s1>&#39;russiantrustedca.pem&#39;</span><span class=p>;</span> curl -o <span class=s2>&#34;/etc/pki/ca-trust/source/anchors/</span><span class=si>${</span><span class=nv>CERT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;https://gu-st.ru/content/Other/doc/</span><span class=si>${</span><span class=nv>CERT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> update-ca-trust force-enable <span class=o>&amp;&amp;</span> update-ca-trust extract<span class=p>;</span></span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/linux/>#linux</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/bash/>#bash</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/%D0%BC%D0%B8%D0%BD%D1%86%D0%B8%D1%84%D1%80%D1%8B/>#минцифры</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D1%8B/>#сертификаты</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2023-10-06T11:42:15Z data-fn=date-local>2023/10/06 11:42:15 UTC</time></li></ul></div></div></div></div></div><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Windows Server 2022 для рабочей станции" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/ data-bs-toggle=modal data-bs-target=#modal-d6fa8290d3e527df35b48f953c939c27><picture><source srcset='https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class=img-fluid src="https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Windows Server 2022 для рабочей станции" loading=lazy></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/ data-bs-toggle=modal data-bs-target=#modal-d6fa8290d3e527df35b48f953c939c27>Windows Server 2022 для рабочей станции</a></h2></div></header><div class=node-body><p>В этой небольшой заметке я расскажу, как перенастроить серверную версию ОС Windows для работы на обычном стационарном ПК.</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Windows Server 2022 для рабочей станции" class="d-flex align-items-center rounded overflow-hidden" href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/ data-bs-toggle=modal data-bs-target=#modal-d6fa8290d3e527df35b48f953c939c27><img class=img-fluid src="https://images.unsplash.com/photo-1640086940714-65501b9214f2?crop=center&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Windows Server 2022 для рабочей станции" loading=lazy></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/ data-bs-toggle=modal data-bs-target=#modal-d6fa8290d3e527df35b48f953c939c27>Windows Server 2022 для рабочей станции</a></h2></div></header><div class=node-body><p>В этой небольшой заметке я расскажу, как перенастроить серверную версию ОС Windows для работы на обычном стационарном ПК.</p></div></div></article></div><div class="modal fade" id=modal-d6fa8290d3e527df35b48f953c939c27 tabindex=-1 aria-labelledby=modal-d6fa8290d3e527df35b48f953c939c27-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-d6fa8290d3e527df35b48f953c939c27-label><a href=/ru/articles/2022/05/36058650-3f35-5ed5-9565-0aa7d8800c28/>Windows Server 2022 для рабочей станции</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>В этой небольшой заметке я расскажу, как перенастроить серверную версию ОС Windows для работы на обычном стационарном ПК.</p><h2 id=3587861891-настройка-служб><a class=link-body-emphasis href=#3587861891-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-%d1%81%d0%bb%d1%83%d0%b6%d0%b1>Настройка служб</a></h2><p>На сервере нет необходимости использовать поисковые механизмы и вывод звука, поэтому они отключены. Но на рабочей станции эти параметры необходимы. Для включения звука и поискового механизма, необходимо настроить запуск соответствующих служб.</p><ul><li>Services<ul><li>Windows Audio<ul><li>Startup type<ul><li>Automatic</li></ul></li></ul></li><li>Windows Audio Endpoint<ul><li>Startup type<ul><li>Automatic</li></ul></li></ul></li><li>Windows Search<ul><li>Startup type<ul><li>Automatic (Delayed Start)</li></ul></li></ul></li></ul></li></ul><h2 id=3587861891-отключение-shutdown-event-tracker><a class=link-body-emphasis href=#3587861891-%d0%be%d1%82%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-shutdown-event-tracker>Отключение Shutdown Event Tracker</a></h2><p>Сервер должен работать бесперебойно. Любое отключение сервера, по хорошему, должно записываться в специальный журнал. Но так как у нас рабочая станция, записывать каждые перезагрузку или выключение нет необходимости. Включаем службы.</p><ul><li>Local Group Policy<ul><li>Computer Configuration / Administrative Templates / System<ul><li>Display Shutdown Event Tracker<ul><li>Disabled</li></ul></li></ul></li></ul></li></ul><h2 id=3587861891-отключение-строгой-системы-безопасности-ie><a class=link-body-emphasis href=#3587861891-%d0%be%d1%82%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-%d1%81%d1%82%d1%80%d0%be%d0%b3%d0%be%d0%b9-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b-%d0%b1%d0%b5%d0%b7%d0%be%d0%bf%d0%b0%d1%81%d0%bd%d0%be%d1%81%d1%82%d0%b8-ie>Отключение строгой системы безопасности IE</a></h2><p>Сервер использует строгие параметры системы безопасности IE. Но на рабочей станции в этих параметрах нет необходимости и они будут только мешать. Отключаем их.</p><ul><li>Server Manager / Local Server<ul><li>IE Enhanced Security Configuration<ul><li>Off</li></ul></li></ul></li></ul><h2 id=3587861891-оптимизация-производительности-для-приложений><a class=link-body-emphasis href=#3587861891-%d0%be%d0%bf%d1%82%d0%b8%d0%bc%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f-%d0%bf%d1%80%d0%be%d0%b8%d0%b7%d0%b2%d0%be%d0%b4%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d0%be%d1%81%d1%82%d0%b8-%d0%b4%d0%bb%d1%8f-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b9>Оптимизация производительности для приложений</a></h2><p>По умолчанию, на сервере оптимизация включена для фоновых служб. На рабочей станции необходима оптимизация для программ. Включаем оптимизацию для программ.</p><ul><li>System / Advanced System Settings / Advanced / Performance / Advanced<ul><li>Adjust for best performance of<ul><li>Programs</li></ul></li></ul></li></ul><h2 id=3587861891-отключение-dep><a class=link-body-emphasis href=#3587861891-%d0%be%d1%82%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-dep>Отключение DEP</a></h2><p>По умолчанию, <a title href=https://docs.microsoft.com/en-us/windows/win32/memory/data-execution-prevention target=_blank rel="noopener noreferrer nofollow">Data Execution Prevention (DEP)</a> включена абсолютно для всех программ и сервисов. Такая излишняя защита на рабочей станции не нужна. Поэтому, переключаем выполнение DEP только для программ и сервисов самой ОС Windows.</p><ul><li>System / Advanced System Settings / Advanced / Performance / Data Execution Prevention<ul><li>Turn on DEP for essential Windows programs and services only</li></ul></li></ul><h2 id=3587861891-включение-memory-compression-operation-api-и-pagecombining><a class=link-body-emphasis href=#3587861891-%d0%b2%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-memory-compression-operation-api-%d0%b8-pagecombining>Включение Memory Compression, Operation API и PageCombining</a></h2><p>В ОС Windows для обычных компьютеров включены Memory Compression, Operation API и PageCombining. Поэтому, перенастраиваем серверную версию ОС на такую же конфигурацию. Для этого запускаем PowerShell от имени Администратора и выполняем команду:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-powershell"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-68d9cd1744751b14e06efbb362fd8a0b><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Enable-MMAgent</span> <span class=n>-MemoryCompression</span> <span class=n>-OperationAPI</span> <span class=n>-PageCombining</span></span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-68d9cd1744751b14e06efbb362fd8a0b role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/server/>#server</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/powershell/>#powershell</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-success" data-bs-tooltip data-bs-title='Уровень сложности: Простой'><i class="far fa-face-smile fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2022-05-09T11:53:26Z data-fn=date-local>2022/05/09 11:53:26 UTC</time></li></ul></div></div></div></div></div></div></div></div></main><footer class="mt-auto border-top bg-light" id=site-footer><div class="section py-5 border-bottom"><div class=container><div class="row g-3"><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">О проекте</h2><div class=node-body><p>Заметки по системному администрированию и веб-разработкам.</p></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Ресурсы</h2><div class=node-body><ul><li><a title href=https://kitsune.solar/ target=_blank rel="noopener noreferrer nofollow">Kitsune Solar</a></li><li><a title href=https://uaik.github.io/ target=_blank rel="noopener noreferrer nofollow">UNIX AIK</a></li></ul></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Контакты</h2><div class=node-body><ul><li><a title href=mailto:mail@lib.onl target=_self rel>Email</a></li></ul></div></article></div></div></div></div><div class="section py-3"><div class=container><div class="row row-cols-1 row-cols-lg-2 small text-body-secondary align-items-center"><div class="col text-center text-lg-start"><ul class="list-inline mb-0"><li class=list-inline-item><div>Library Online &copy; 2023</div><div>Заметки на тему администрирования и разработки различных систем, приложений и серверов.</div></li></ul></div><div class="col text-center text-lg-end"><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=RSS><a class="btn btn-light btn-sm" href=/ru/tags/powershell/index.xml target=_blank aria-label=RSS><i class="fas fa-rss fa-fw"></i></a></li><li class="list-inline-item dropup" data-bs-tooltip data-bs-title=Языки><a class="dropdown-toggle btn btn-light btn-sm" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false aria-label=Языки><i class="fas fa-language fa-fw"></i></a><div class="dropdown-menu dropdown-menu-end shadow"><a class=dropdown-item href=/ru/ hreflang=ru>Русский
</a><a class=dropdown-item href=/en/ hreflang=en>English</a></div></li></ul></div></div></div></div></footer><div class="modal fade" id=search-modal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-xl"><div class=modal-content><div class=modal-header><h5 class=modal-title id=searchModalLabel>Поиск</h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class="modal-body node-body"><div class="row row-cols-1 g-3"><div class=col><div class="row g-3"><div class=col-lg><form action=https://google.com/search method=get class=d-flex target=_blank><input type=hidden name=domains value=lib.onl>
<input type=hidden name=sitesearch value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=q placeholder='Поиск Google' aria-label='Поиск Google'>
<span class=input-group-text><i class="fab fa-google fa-fw"></i></span></div></form></div><div class=col-lg><form action=https://ya.ru/search method=get class=d-flex target=_blank><input type=hidden name=site value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=text placeholder='Поиск Яндекс' aria-label='Поиск Яндекс'>
<span class=input-group-text><i class="fab fa-yandex fa-fw"></i></span></div></form></div></div></div><div class=col><form id=search-form method=get class=d-flex autocomplete=off><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input id=search-input type=search class=form-control name=q placeholder='Внутренний поиск' aria-label='Внутренний поиск'>
<span class=input-group-text><i class="fas fa-brain fa-fw"></i></span></div></form></div><div class=col><div class="list-group list-group-flush d-none overflow-auto" id=search-results></div><div id=search-help><div class="alert alert-info d-flex align-items-center overflow-hidden node-body" id=alert-de015fea82f6631c9abd6d2c1704055f role=alert><div class=flex-shrink-0><i class="fas fa-search fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Используется нечёткий поиск (приблизительное сопоставление строк).
Это метод поиска строк, которые приблизительно соответствуют поисковому шаблону.</p><p>Результаты поиска сортируются по точности совпадения с поисковым шаблоном.
Результаты поиска, наиболее точно соответствующие запросу, находятся сверху, приблизительные результаты - снизу.</p></div></div></div></div></div></div></div></div></div><script src=/js/vendor.bundle.min.js defer></script><script src=/ru/js/system.bundle.min.js defer></script><script type=application/ld+json>{"@context":"https://schema.org","@id":"https://lib.onl/#website","@type":"WebSite","description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","hasPart":[{"@context":"https://schema.org","@type":"WPHeader","cssSelector":"#site-header","headline":"headline-string"},{"@context":"https://schema.org","@type":"WPFooter","copyrightHolder":"https://lib.onl/#organization","copyrightYear":"2023","cssSelector":"#site-footer","publisher":"https://lib.onl/#organization"}],"inLanguage":[{"@type":"Language","alternateName":"ru-RU","name":"Русский"}],"keywords":["powershell","forum","ipb","ips","debian","linux","cmd","cmf","cms","vbulletin","bash","cloudflare","fedora","git","php","systemd","terminal","dhcp","find","gdm"],"mainEntityOfPage":"https://lib.onl/","name":"Library Online","publisher":"https://lib.onl/#organization","url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@id":"https://lib.onl/#organization","@type":"Organization","address":{"@type":"PostalAddress","addressCountry":"Russia","addressLocality":"Moscow","addressRegion":"Moscow Region"},"contactPoint":{"@type":"ContactPoint","contactType":"customer service","email":"mail@lib.onl","telephone":"+7 (000) 000-0000"},"description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","foundingDate":"2020","legalName":"Library Online","logo":{"@type":"ImageObject","url":"https://lib.onl/img/logo.min.svg"},"mainEntityOfPage":"https://lib.onl/","name":"Library Online","sameAs":[""],"url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"SiteNavigationElement","name":"Статьи","position":10,"url":"https://lib.onl/ru/articles/"},{"@type":"SiteNavigationElement","name":"Q\u0026A","position":20,"url":"https://lib.onl/ru/faq/"},{"@type":"SiteNavigationElement","name":"Архив","position":100,"url":"https://lib.onl/ru/archive/"},{"@type":"SiteNavigationElement","name":"О проекте","position":999,"url":"https://lib.onl/ru/about/"},{"@type":"SiteNavigationElement","name":"META","position":9999,"url":"https://lib.onl/ru/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lib.onl/ru/","name":"Главная"},"position":1},{"@type":"ListItem","item":{"@id":"https://lib.onl/ru/tags/","name":"Теги"},"position":2},{"@type":"ListItem","item":{"@id":"https://lib.onl/ru/tags/powershell/","name":"powershell"},"position":3}]}</script></body></html>