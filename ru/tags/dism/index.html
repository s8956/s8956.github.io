<!doctype html><html class=h-100 dir=ltr lang=ru-RU prefix="og: http://ogp.me/ns#
      article: http://ogp.me/ns/article#
      profile: http://ogp.me/ns/profile#
      fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>dism / Library Online</title>
<meta name=title content="dism / Library Online"><meta name=description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta name=keywords content="forum,powershell,ipb,ips,debian,linux,cmd,cmf,cms,vbulletin,bash,fedora,git,php,systemd,terminal,cloudflare,find,gdm,github"><link rel=preconnect href=https://fonts.googleapis.com crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link rel=preconnect href=https://gravatar.com crossorigin=anonymous><link rel=preconnect href=https://images.unsplash.com crossorigin=anonymous><link rel=preload href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous as=style onload='this.rel="stylesheet"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" crossorigin=anonymous></noscript><link rel=preload href=/css/vendor.bundle.css as=style><link rel=stylesheet href=/css/vendor.bundle.css><link rel=preload href=/ru/css/system.bundle.min.css as=style><link rel=stylesheet href=/ru/css/system.bundle.min.css><link rel=icon type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel="shortcut icon" type=image/png sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=apple-touch-icon sizes=16x16 href=https://lib.onl/favicon-16.png><link rel=icon type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel="shortcut icon" type=image/png sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=apple-touch-icon sizes=24x24 href=https://lib.onl/favicon-24.png><link rel=icon type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel="shortcut icon" type=image/png sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=apple-touch-icon sizes=32x32 href=https://lib.onl/favicon-32.png><link rel=icon type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel="shortcut icon" type=image/png sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=apple-touch-icon sizes=48x48 href=https://lib.onl/favicon-48.png><link rel=icon type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel="shortcut icon" type=image/png sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=apple-touch-icon sizes=64x64 href=https://lib.onl/favicon-64.png><link rel=icon type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel="shortcut icon" type=image/png sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=apple-touch-icon sizes=72x72 href=https://lib.onl/favicon-72.png><link rel=icon type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel="shortcut icon" type=image/png sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=apple-touch-icon sizes=80x80 href=https://lib.onl/favicon-80.png><link rel=icon type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel="shortcut icon" type=image/png sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=apple-touch-icon sizes=96x96 href=https://lib.onl/favicon-96.png><link rel=icon type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel="shortcut icon" type=image/png sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=apple-touch-icon sizes=128x128 href=https://lib.onl/favicon-128.png><link rel=icon type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel="shortcut icon" type=image/png sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=apple-touch-icon sizes=144x144 href=https://lib.onl/favicon-144.png><link rel=icon type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel="shortcut icon" type=image/png sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=apple-touch-icon sizes=152x152 href=https://lib.onl/favicon-152.png><link rel=icon type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel="shortcut icon" type=image/png sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=apple-touch-icon sizes=167x167 href=https://lib.onl/favicon-167.png><link rel=icon type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel="shortcut icon" type=image/png sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=apple-touch-icon sizes=180x180 href=https://lib.onl/favicon-180.png><link rel=icon type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel="shortcut icon" type=image/png sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=apple-touch-icon sizes=192x192 href=https://lib.onl/favicon-192.png><link rel=icon type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel="shortcut icon" type=image/png sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=apple-touch-icon sizes=196x196 href=https://lib.onl/favicon-196.png><link rel=icon type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel="shortcut icon" type=image/png sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=apple-touch-icon sizes=256x256 href=https://lib.onl/favicon-256.png><link rel=icon type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel="shortcut icon" type=image/png sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=apple-touch-icon sizes=300x300 href=https://lib.onl/favicon-300.png><link rel=icon type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel="shortcut icon" type=image/png sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=apple-touch-icon sizes=512x512 href=https://lib.onl/favicon-512.png><link rel=icon type=image/svg+xml sizes=any href=https://lib.onl/favicon.svg><link rel="shortcut icon" type=image/x-icon href=https://lib.onl/favicon.ico><link rel="shortcut icon" type=image/vnd.microsoft.icon href=https://lib.onl/favicon.ico><link rel=first href=https://lib.onl/ru/tags/dism/><link rel=last href=https://lib.onl/ru/tags/dism/><link rel=canonical href=https://lib.onl/ru/tags/dism/><link rel=alternate href=https://lib.onl/ hreflang=x-default><link rel=alternate href=https://lib.onl/ru/tags/dism/ hreflang=ru><link rel=manifest type=application/manifest+json href=https://lib.onl/ru/manifest.json title="Library Online"><link rel=search type=application/opensearchdescription+xml href=https://lib.onl/ru/opensearch.xml title="Library Online"><link rel=alternate type=application/rss+xml href=https://lib.onl/ru/tags/dism/index.xml title="Library Online"><meta name=application-name content="Library Online"><meta name=theme-color content="#f8f9fa" media="(prefers-color-scheme: light)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lib.onl/favicon-512.png"><meta name=twitter:title content="dism"><meta name=twitter:description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:title" content="dism"><meta property="og:description" content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta property="og:type" content="website"><meta property="og:url" content="https://lib.onl/ru/tags/dism/"><meta property="og:image" content="https://lib.onl/favicon-512.png"><meta property="twitter:domain" content="lib.onl"><meta property="twitter:url" content="https://lib.onl/ru/tags/dism/"><meta property="og:locale" content="ru_RU"><meta property="og:site_name" content="Library Online"><meta name=DC.Title content="dism"><meta name=DC.Subject content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta name=DC.Description content="Заметки на тему администрирования и разработки различных систем, приложений и серверов."><meta name=DC.Type content="Text"><meta name=DC.Source content="https://lib.onl/ru/tags/dism/"><meta name=DC.Relation content="https://lib.onl/ru/tags/dism/"><meta name=DC.Coverage content="World"><meta name=DC.Creator content="Library Online"><meta name=DC.Publisher content="Library Online"><meta name=DC.Contributor content="Library Online"><meta name=DC.Rights content="Library Online"><meta name=DC.Format content="Digital"><meta name=DC.Identifier content="https://lib.onl/ru/tags/dism/"><meta name=DC.Language content="ru-RU"><meta name=DC.Provenance content="Library Online"><meta name=DC.RightsHolder content="Library Online"><meta name=DC.AccrualPeriodicity content="Weekly"><meta name=DC.AccrualPolicy content="Active"><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"Library Online","url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","address":{"@type":"PostalAddress","addressCountry":"","addressLocality":"","addressRegion":"","postalCode":"","streetAddress":""},"contactPoint":{"@type":"ContactPoint","contactType":"","email":"","telephone":""},"description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","foundingDate":"","legalName":"Library Online","logo":"https://lib.onl/","name":"Library Online","sameAs":[],"url":"https://lib.onl/"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"ItemList","itemListElement":[{"@type":"SiteNavigationElement","name":"Статьи","position":10,"url":"https://lib.onl/ru/articles/"},{"@type":"SiteNavigationElement","name":"Q\u0026A","position":20,"url":"https://lib.onl/ru/qna/"},{"@type":"SiteNavigationElement","name":"Архив","position":100,"url":"https://lib.onl/ru/archive/"},{"@type":"SiteNavigationElement","name":"О проекте","position":999,"url":"https://lib.onl/ru/about/"},{"@type":"SiteNavigationElement","name":"META","position":9999,"url":"https://lib.onl/ru/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://lib.onl/ru/","name":"Главная","position":1},{"@type":"ListItem","item":"https://lib.onl/ru/tags/","name":"Теги","position":2},{"@type":"ListItem","item":"https://lib.onl/ru/tags/dism/","name":"dism","position":3}]}</script></head><body class="d-flex flex-column h-100 is-node type-tags"><header><nav class="navbar navbar-expand-lg navbar-light fixed-top border-bottom shadow-sm text-lg-center bg-light"><div class=container-fluid><a class=navbar-brand href=/ru/><img src=https://lib.onl/img/logo.min.svg alt=Логотип width=30 height=24 class="d-inline-block align-text-top"><h1 class="d-inline-block h5 m-0 ms-1">Library Online</h1></a><button type=button class=navbar-toggler data-bs-toggle=collapse data-bs-target=#navTopBar aria-controls=navTopBar aria-expanded=false aria-label='Переключить навигацию'>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navTopBar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/ru/articles/><i class="fas fa-book fa-fw"></i>
<span>Статьи</span></a></li><li class=nav-item><a class=nav-link href=/ru/qna/><i class="fas fa-circle-question fa-fw"></i>
<span>Q&amp;A</span></a></li><li class=nav-item><a class=nav-link href=/ru/archive/><i class="fas fa-archive fa-fw"></i>
<span>Архив</span></a></li><li class=nav-item><a class=nav-link href=/ru/about/><i class="fas fa-info-circle fa-fw"></i>
<span>О проекте</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-list fa-fw"></i>
<span>META</span></a><div class="dropdown-menu shadow"><a class=dropdown-item href=/ru/authors/><i class="fas fa-user-circle fa-fw"></i>
<span>Авторы</span>
</a><a class=dropdown-item href=/ru/categories/><i class="fas fa-folder-open fa-fw"></i>
<span>Категории</span>
</a><a class="dropdown-item active" href=/ru/tags/><i class="fas fa-tags fa-fw"></i>
<span>Теги</span></a></div></li></ul><ul class=navbar-nav><li class=nav-item><a class="nav-link d-lg-none" href=# data-bs-toggle=modal data-bs-target=#search-modal aria-label=Поиск><i class="fas fa-search fa-fw"></i>
<span>Поиск</span>
</a><a class="nav-link d-none d-lg-block" href=# data-bs-toggle=modal data-bs-target=#search-modal data-bs-tooltip data-bs-title=Поиск aria-label=Поиск><i class="fas fa-search fa-fw"></i></a></li></ul></div></div></nav></header><main class="wrapper flex-shrink-0"><div class="section py-3"><div class=container><nav style="--bs-breadcrumb-divider:'\2f '" class=small aria-label=breadcrumb><ol class="breadcrumb bg-light p-2 rounded"><li class=breadcrumb-item><a href=/ru/ aria-label=Главная><i class="fas fa-home fa-fw"></i></a></li><li class=breadcrumb-item><a href=/ru/tags/ aria-label=Теги>Теги</a></li><li class="breadcrumb-item active">dism</li></ol></nav><div class="row row-cols-1 row-cols-lg-2 g-3"><div class=col><div class="d-sm-block d-md-none"><article class=node-articles><header><div class="node-cover mb-3"><a title="Интеграция обновлений в дистрибутив ОС MS Windows" class=d-block href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a><picture><source srcset='https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=640&amp;h=360&amp;fit=crop&amp;auto=compress,format 640w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=768&amp;h=432&amp;fit=crop&amp;auto=compress,format 768w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1024&amp;h=576&amp;fit=crop&amp;auto=compress,format 1024w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1280&amp;h=720&amp;fit=crop&amp;auto=compress,format 1280w,https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format 1600w' sizes="(min-width: 576px) 100vw"><img class="d-block w-100 h-100 rounded" src="https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=1600&amp;h=900&amp;fit=crop&amp;auto=compress,format" width=1600 height=900 alt="Интеграция обновлений в дистрибутив ОС MS Windows"></picture></a></div><div class=node-title><h2 class=h5><a href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a>Интеграция обновлений в дистрибутив ОС MS Windows</a></h2></div></header><div class=node-body><p>Microsoft каждый месяц выпускает новые версии дистрибутивов с уже интегрированными обновлениями. Но есть редакции ОС, например LTSC, для которых Microsoft не выполняет подобные действия. Приходится делать самому&mldr;</p></div></article></div><div class="d-none d-md-block"><article class="node-articles d-flex overflow-hidden"><div class="flex-shrink-0 me-3"><div class=node-cover><a title="Интеграция обновлений в дистрибутив ОС MS Windows" class=d-block href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a><img class="d-block rounded" src="https://images.unsplash.com/photo-1620843002805-05a08cb72f57?crop=entropy&amp;w=160&amp;h=160&amp;fit=crop&amp;auto=compress,format" width=160 height=160 alt="Интеграция обновлений в дистрибутив ОС MS Windows"></a></div></div><div class="flex-grow-1 overflow-hidden"><header><div class=node-title><h2 class=h5><a href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/ data-bs-toggle=modal data-bs-target=#modal-9ef2c2a0e4254d6074630a3f0cf4963a>Интеграция обновлений в дистрибутив ОС MS Windows</a></h2></div></header><div class=node-body><p>Microsoft каждый месяц выпускает новые версии дистрибутивов с уже интегрированными обновлениями. Но есть редакции ОС, например LTSC, для которых Microsoft не выполняет подобные действия. Приходится делать самому&mldr;</p></div></div></article></div><div class="modal fade" id=modal-9ef2c2a0e4254d6074630a3f0cf4963a tabindex=-1 aria-labelledby=modal-9ef2c2a0e4254d6074630a3f0cf4963a-label aria-hidden=true><div class="modal-dialog modal-fullscreen"><div class=modal-content><div class=modal-header><h2 class="modal-title fs-5 text-truncate" id=modal-9ef2c2a0e4254d6074630a3f0cf4963a-label><a href=/ru/articles/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/>Интеграция обновлений в дистрибутив ОС MS Windows</a></h2><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class=modal-body><div class=node-body><p>Microsoft каждый месяц выпускает новые версии дистрибутивов с уже интегрированными обновлениями. Но есть редакции ОС, например LTSC, для которых Microsoft не выполняет подобные действия. Приходится делать самому&mldr;</p><h2>Подготовка</h2><p>Для интеграции обновлений в дистрибутив ОС, потребуется:</p><ul><li>Дистрибутив операционной системы в файле <code>.iso</code>.</li><li>Доступ в интернет для скачивания необходимых инструментов и обновлений.</li><li>Рекомендуется <strong>SSD</strong>. Все ниже приведённые этапы требуют активной работы с файлами. Поэтому, существенное ускорение можно получить выполняя все задачи на SSD.</li></ul><h3>Структура директорий</h3><p>Для начала необходимо создать структуру директорий, которая послужит базисом для процесса интеграции обновлений:</p><ul><li><code>C:\BuildFarm</code> - корневая директория для работы.<ul><li><code>\MNT</code> - директория, в которую будет монтироваться образ WIM.</li><li><code>\UPD</code> - директория для хранения скаченных обновлений.</li><li><code>\WIM</code> - директория для хранения образа WIM.</li></ul></li></ul><h3>MS DISM</h3><p>Для интеграции обновлений потребуется инструмент <strong>Deployment Image Servicing and Management (DISM)</strong> (<code>DISM.exe</code>), который входит в комплект <a title href=https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install target=_blank rel="noopener noreferrer nofollow">Windows Assessment and Deployment Kit (Windows ADK)</a>. Обычно, DISM уже поставляется с операционной системой, но я рекомендую <a title href=https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install#other-adk-downloads target=_blank rel="noopener noreferrer nofollow">скачивать</a> последнюю версию с сайта Microsoft и устанавливать вручную.</p><p>Когда Windows ADK установлен, DISM можно найти в меню <strong>&ldquo;Пуск&rdquo;</strong> вместе с остальными программам. Запускать DISM необходимо под администратором. Все команды, приведённые ниже, должны будут выполняться только через установленный вручную DISM. Использовать DISM, поставляемый с операционной системой нет необходимости.</p><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Установленный вручную DISM можно найти в меню &ldquo;Пуск&rdquo; / Windows Kits / <strong>Среда средств развертывания и работы с образами</strong>.</p></div></div></div><h2>Интеграция обновлений</h2><p>Обновления можно скачивать с сайта-каталога <a title href=https://www.catalog.update.microsoft.com/ target=_blank rel="noopener noreferrer nofollow">Microsoft Update Catalog</a>. Я беру так называемые &ldquo;кумулятивные (накопительные) обновления&rdquo; (cumulative updates), содержащие в себе сразу множество пакетов с исправлениями и обновлениями функций. <a title href="https://www.catalog.update.microsoft.com/Search.aspx?q=cumulative%20update" target=_blank rel="noopener noreferrer nofollow">Найти</a> такие крупные обновления можно в каталоге при помощи поискового запроса <code>cumulative update</code>.</p><p>Скачиваемые обновления помещаются в директорию <code>C:\BuildFarm\UPD</code> для дальнейшей интеграции в дистрибутив ОС.</p><h3>Извлечение файла WIM из дистрибутива MS Windows</h3><p>Образ ОС находится в специальном файле <code>sources\install.wim</code>. Его необходимо извлечь при помощи программ для работы с файлами <code>.iso</code> (подойдёт <a title href=https://www.ultraiso.com target=_blank rel="noopener noreferrer nofollow">UltraISO</a> или <a title href=https://www.poweriso.com target=_blank rel="noopener noreferrer nofollow">PowerISO</a>) в директорию <code>C:\BuildFarm\WIM</code>.</p><h3>Получение информации из WIM-образа</h3><p>Файл <code>install.wim</code> может содержать несколько редакций ОС. Каждая редакция ОС имеет свой индекс. Для того, чтобы увидеть эти индексы, нужно ввести команду:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b382388cfcb700f958cd2909c842e767 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-b382388cfcb700f958cd2909c842e767><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Get-ImageInfo</span> <span class=p>/</span><span class=n>ImageFile</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\WIM\install.wim&#34;</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Get-ImageInfo</code> - получить информацию о версиях операционной системы, находящихся в WIM-образ.</li><li><code>/ImageFile</code> - путь к WIM-образу.</li></ul><p>Введённая команда предоставит примерно такой выхлоп:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-7cccb576a273b25899a7f8153ab84a50 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-7cccb576a273b25899a7f8153ab84a50><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Get-ImageInfo</span> <span class=p>/</span><span class=n>ImageFile</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\WIM\install.wim&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Details</span> <span class=k>for</span> <span class=n>image</span> <span class=err>:</span> <span class=n>C:</span><span class=p>\</span><span class=n>BuildFarm</span><span class=p>\</span><span class=n>WIM</span><span class=p>\</span><span class=n>install</span><span class=p>.</span><span class=py>wim</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>15</span><span class=p>,</span><span class=mf>643</span><span class=p>,</span><span class=mf>499</span><span class=p>,</span><span class=mf>526</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Education</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>14</span><span class=p>,</span><span class=mf>878</span><span class=p>,</span><span class=mf>972</span><span class=p>,</span><span class=mf>660</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>3</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>15</span><span class=p>,</span><span class=mf>643</span><span class=p>,</span><span class=mf>653</span><span class=p>,</span><span class=mf>521</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>4</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Enterprise</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>14</span><span class=p>,</span><span class=mf>878</span><span class=p>,</span><span class=mf>878</span><span class=p>,</span><span class=mf>937</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Index</span> <span class=err>:</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl><span class=n>Name</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Pro</span>
</span></span><span class=line><span class=cl><span class=n>Description</span> <span class=err>:</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Pro</span>
</span></span><span class=line><span class=cl><span class=n>Size</span> <span class=err>:</span> <span class=mf>15</span><span class=p>,</span><span class=mf>658</span><span class=p>,</span><span class=mf>943</span><span class=p>,</span><span class=mf>281</span> <span class=n>bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;...&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Extract</span> <span class=n>Specific</span> <span class=n>Windows</span> <span class=n>Index</span> <span class=n>from</span> <span class=n>Windows</span> <span class=mf>10</span> <span class=n>Multiple</span> <span class=n>Edition</span> <span class=n>ISO</span></span></span></code></pre></div></div></div></div><h3>Монтирование WIM-образа</h3><p>Индексы получены. Теперь необходимо примонтировать редакцию ОС из конкретного индекса. Выбор индекса зависит от вас: выбираете индекс той редакции ОС, которая вам необходима. Я выбрал редакцию <strong>Windows 10 Pro</strong> с индексом <code>5</code>:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-cbc5cf68f790ef9ed1b82baf748982ed role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-cbc5cf68f790ef9ed1b82baf748982ed><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Mount-Image</span> <span class=p>/</span><span class=n>ImageFile</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\WIM\install.wim&#34;</span> <span class=p>/</span><span class=n>MountDir</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=n>index</span><span class=err>:</span><span class=mf>5</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Mount-Image</code> - команда на монтирование WIM-образа.</li><li><code>/MountDir</code> - путь к директории, в которую необходимо поместить содержимое монтируемого WIM-образа.</li><li><code>/index:5</code> - номер версии дистрибутива ОС. Номер можно узнать командой <code>/Get-ImageInfo</code>.</li></ul><div class="shortcode shortcode-alert"><div class="alert alert-success d-flex overflow-hidden" role=alert><div class="flex-shrink-0 align-self-center"><i class="fas fa-lightbulb fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Если что-то пошло не так, размонтировать образ без сохранения можно следующей командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-0 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-b217d6f5b416bebe05999f603646de18><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>Dism /Unmount-Image /MountDir:<span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> /Discard</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-b217d6f5b416bebe05999f603646de18 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Проверить список примонтированных образов можно следующей командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-1 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-ee0f1ea4e233247e9144b9148e3da166><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>Dism /Get-MountedImageInfo</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-ee0f1ea4e233247e9144b9148e3da166 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Если после размонтирования образ всё ещё остаётся подключённым к системе и является повреждённым, следующая команда можешь помочь:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-2 shortcode-codeblock-batch"><div class="d-flex mb-3 overflow-hidden"><div class="flex-grow-1 rounded overflow-hidden" id=clipboard-8455e188fda97da34f90e0d651d659d0><div class=highlight><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>Dism /Cleanup-Mountpoints</span></span></code></pre></div></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-8455e188fda97da34f90e0d651d659d0 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><p>Она удалит все ресурсы, связанные с повреждённым образом и очистит систему от &ldquo;зависших&rdquo; точек монтирования.</p></div></div></div><h3>Интеграция обновлений в WIM-образ</h3><p>После монтирования редакции ОС с конкретным индексом, можно начинать процесс интеграции обновлений:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-3 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-1837d5b150b8d54e03eb559121ec2548 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-1837d5b150b8d54e03eb559121ec2548><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Add-Package</span> <span class=p>/</span><span class=n>PackagePath</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\UPD&#34;</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Add-Package</code> - команда на добавление пакетов (обновлений) в WIM-образ.<ul><li><code>/PackagePath</code> - путь к директории, в которой находятся пакеты (обновления) для интеграции в WIM-образ.</li></ul></li></ul><h3>Проверка корректности интеграции обновлений (опционально)</h3><p>По окончании процесса интеграции, можно проверить корректность выполненной задачи. Команда ниже покажет список пакетов, установленных в примонтированной редакции ОС. В этом списке пакетов будут интегрированные обновления.</p><div class="shortcode shortcode-codeblock shortcode-codeblock-4 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-d440e0c236b431789d811fac33c206b6 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-d440e0c236b431789d811fac33c206b6><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Get-Packages</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Get-Packages</code> - команда для получения информации о интегрированных пакетах примонтированного WIM-образа.</li></ul><h3>Очистка хранилища компонентов WIM-образ (опционально)</h3><p>Для уменьшения размера дистрибутива можно запустить процедуру удаления предыдущих версий компонентов, которые были изменены (заменены) установленными обновлениями:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-5 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-c5fbf78f6f335f573f726792cdcff0bd role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-c5fbf78f6f335f573f726792cdcff0bd><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Cleanup-Image</span> <span class=p>/</span><span class=n>StartComponentCleanup</span> <span class=p>/</span><span class=n>ResetBase</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Cleanup-Image</code> - очистка и восстановление образа.<ul><li><code>/StartComponentCleanup</code> - удаляет заменённые компоненты и уменьшает размер хранилища компонентов.<ul><li><code>/ResetBase</code> - сброс базы заменяемых компонентов.</li></ul></li></ul></li></ul><h3>Проверка хранилища компонентов WIM-образа (опционально)</h3><p>Опциональный шаг перед заключительным этапом - проверить системные компоненты и файлы на повреждения:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-6 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-e7851fe8cd2d174cbaa53186d61999b2 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-e7851fe8cd2d174cbaa53186d61999b2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=n>Image</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=nb>Cleanup-Image</span> <span class=p>/</span><span class=n>ScanHealth</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Image</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Cleanup-Image</code> - очистка и восстановление образа.<ul><li><code>/ScanHealth</code> - сканирование образа на наличие повреждений хранилища компонентов.</li></ul></li></ul><h3>Сохранение изменений в WIM-образе</h3><p>После выполнения всех действий, необходимо отмонтировать редакцию ОС с сохранением изменений. Делается это командой:</p><div class="shortcode shortcode-codeblock shortcode-codeblock-7 shortcode-codeblock-terminal
shortcode-codeblock-terminal-windows
shortcode-codeblock-terminal-windows-root"><div class="card mb-3 overflow-hidden" data-bs-theme=dark><div class=card-header><div class="d-flex align-items-center"><div class="flex-shrink-0 text-danger"><i class="fas fa-terminal fa-fw"></i></div><div class="flex-grow-1 mx-2"><h5 class=mb-0>Терминал</h5></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-48fc4acdb0f8d694e57d1b750cc014c1 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li></ul></div></div></div><div class="card-body p-0" id=clipboard-48fc4acdb0f8d694e57d1b750cc014c1><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Dism</span> <span class=p>/</span><span class=nb>Unmount-Image</span> <span class=p>/</span><span class=n>MountDir</span><span class=err>:</span><span class=s2>&#34;C:\BuildFarm\MNT&#34;</span> <span class=p>/</span><span class=n>Commit</span></span></span></code></pre></div></div></div></div><p>Где:</p><ul><li><code>/Unmount-Image</code> - команда для отмонтирования WIM-образа.</li><li><code>/MountDir</code> - путь к директории, в которой находится содержимое примонтированного WIM-образа.</li><li><code>/Commit</code> - сохранение совершённых изменений в WIM-образе.</li></ul><p>Всё. Мы получили файл <code>install.wim</code> с интегрированными обновлениями. Теперь этот файл <code>install.wim</code> необходимо обратно упаковать в образ ISO с заменой старого.</p><h2>Автоматизация</h2><p>Я люблю автоматизировать всё по максимуму. И здесь я не упустил шанс написать небольшой скрипт с деревянной логикой, который сделает все шаги по интеграции обновлений за человека. Только вот, извлечь файл <code>install.wim</code> из ISO-образа придётся самому.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>dism.packages.cmd</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-094318346a63d892d5e0686a3e12cbf4 role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=dism.packages.cmd download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=dism.packages.cmd target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-094318346a63d892d5e0686a3e12cbf4><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl><span class=p>:</span><span class=c1>: Automatic integration of updates into DISM.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/posts/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_mnt</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>MNT&#34;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_upd</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>UPD&#34;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_wim</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>WIM&#34;</span>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>f_wim</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%d_wim%</span><span class=s2>\install.wim&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Creating directories.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> <span class=k>mkdir</span> <span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>&#34;</span> <span class=k>mkdir</span> <span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_wim%</span><span class=s2>&#34;</span> <span class=k>mkdir</span> <span class=s2>&#34;</span><span class=nv>%d_wim%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: Checking files.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span> <span class=k>echo</span> Please put <span class=s2>&#34;install.wim&#34;</span> file in <span class=s2>&#34;WIM&#34;</span> directory... <span class=p>&amp;&amp;</span> <span class=k>pause</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>not</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>/*.msu&#34;</span> <span class=k>echo</span> Please put <span class=s2>&#34;*.msu&#34;</span> files in <span class=s2>&#34;UPD&#34;</span> directory... <span class=p>&amp;&amp;</span> <span class=k>pause</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=k>exist</span> <span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>echo</span> Getting Windows Image Info...
</span></span><span class=line><span class=cl>  Dism /Get-ImageInfo /ImageFile:<span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>else</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>echo</span> <span class=s2>&#34;install.wim&#34;</span> not found! <span class=p>&amp;</span> <span class=k>echo</span>.Failed with error #<span class=nv>%errorlevel%</span>.
</span></span><span class=line><span class=cl>  <span class=k>goto</span> <span class=p>:</span><span class=nl>error</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=k>/p</span> <span class=nv>index</span><span class=p>=</span><span class=s2>&#34;Enter INDEX: &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Mounting Windows image...
</span></span><span class=line><span class=cl>Dism /Mount-Image /ImageFile:<span class=s2>&#34;</span><span class=nv>%f_wim%</span><span class=s2>&#34;</span> /MountDir:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /index:<span class=nv>%index%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Adding Windows packages...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Add-Package /PackagePath:<span class=s2>&#34;</span><span class=nv>%d_upd%</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Getting Windows packages...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Get-Packages
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Reseting Windows image...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Cleanup-Image /StartComponentCleanup /ResetBase
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Scaning health Windows image...
</span></span><span class=line><span class=cl>Dism /Image:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Cleanup-Image /ScanHealth
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Saving Windows image...
</span></span><span class=line><span class=cl>Dism /Unmount-Image /MountDir:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Commit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>exit</span> /b 0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>error</span>
</span></span><span class=line><span class=cl><span class=k>exit</span> /b <span class=nv>%errorlevel%</span></span></span></code></pre></div></div></div></div><p>Поместить скрипт нужно в корень директории <code>BuildFarm</code> и запустить из терминала DISM. Если же возникнут какие-либо проблемы, ниже есть небольшой скрипт, который размонтирует образ и очистит систему от точек монтирования.</p><div class="shortcode shortcode-file mb-3"><div class="card overflow-hidden"><div class=card-header><div class="d-flex align-items-center"><div class=flex-shrink-0><i class="far fa-file-code fa-fw"></i></div><div class="flex-grow-1 mx-2"><code>dism.unmount.cmd</code></div><div class=flex-shrink-0><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=Копировать><a class=text-body href=# data-fn="clipboard preventDefault" data-clipboard-target=#clipboard-43af6aa6c27e3396a5753d08f6d2089f role=button aria-label=Копировать><i class="fas fa-copy fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Скачать><a class=text-body href=dism.unmount.cmd download role=button aria-label=Скачать><i class="fas fa-download fa-fw"></i></a></li><li class=list-inline-item data-bs-tooltip data-bs-title=Открыть><a class=text-body href=dism.unmount.cmd target=_blank role=button aria-label=Открыть><i class="fas fa-arrow-up-right-from-square fa-fw"></i></a></li></ul></div></div></div><div class=card-body id=clipboard-43af6aa6c27e3396a5753d08f6d2089f><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl><span class=p>:</span><span class=c1>: Automatic unmounting WIM images into DISM.</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>:</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @package   CMD</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @author    Kitsune Solar &lt;mail@kitsune.solar&gt;</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @copyright 2023 iHub TO</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @license   MIT</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @version   0.1.0</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: @link      https://lib.onl/ru/posts/2022/05/862226e6-cbb1-58f8-bc8e-0cfef747f475/</span>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: ------------------------------------------------------------------------------------------------------------------ ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>d_mnt</span><span class=p>=</span><span class=s2>&#34;</span><span class=nv>%~dp0</span><span class=s2>MNT&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Unmounting <span class=s2>&#34;install.wim&#34;</span> and discards changes that were made when image was mounted...
</span></span><span class=line><span class=cl>Dism /Unmount-Image /MountDir:<span class=s2>&#34;</span><span class=nv>%d_mnt%</span><span class=s2>&#34;</span> /Discard
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Deleting all of resources associated with a mounted image that has been corrupted...
</span></span><span class=line><span class=cl>Dism /Cleanup-Mountpoints
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> Getting information about mounted image...
</span></span><span class=line><span class=cl>Dism /Get-MountedImageInfo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>exit</span> /b 0</span></span></code></pre></div></div></div></div></div></div><div class=modal-footer><ul class="list-inline text-center text-body-secondary small"><li class=list-inline-item><a href=https://lib.onl/ru/tags/cmd/>#cmd</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/adk/>#adk</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/dism/>#dism</a></li><li class=list-inline-item><a href=https://lib.onl/ru/tags/%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F/>#интеграция</a></li><li class=list-inline-item>&bull;</li><li class="list-inline-item text-warning" data-bs-tooltip data-bs-title='Уровень сложности: Средний'><i class="far fa-face-meh fa-fw"></i></li><li class=list-inline-item>&bull;</li><li class=list-inline-item><time datetime=2022-05-09T12:39:47Z data-fn=date-local>2022/05/09 12:39:47 UTC</time></li></ul></div></div></div></div></div></div></div></div></main><footer class="mt-auto border-top bg-light"><div class="section py-5 border-bottom"><div class=container><div class="row g-3"><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">О проекте</h2><div class=node-body><p>Заметки по системному администрированию и веб-разработкам.</p></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Ресурсы</h2><div class=node-body><ul><li><a title href=https://kitsune.solar/ target=_blank rel="noopener noreferrer nofollow">Kitsune Solar</a></li><li><a title href=https://uaik.github.io/ target=_blank rel="noopener noreferrer nofollow">UNIX AIK</a></li></ul></div></article></div><div class=col-lg><article><h2 class="h5 border-bottom pb-1 mb-3">Контакты</h2><div class=node-body><ul><li><a title href=mailto:mail@lib.onl target=_self rel>Email</a></li></ul></div></article></div></div></div></div><div class="section py-3"><div class=container><div class="row row-cols-1 row-cols-lg-2 small text-body-secondary align-items-center"><div class="col text-center text-lg-start"><ul class="list-inline mb-0"><li class=list-inline-item><div>Library Online &copy; 2023</div><div>Заметки на тему администрирования и разработки различных систем, приложений и серверов.</div></li></ul></div><div class="col text-center text-lg-end"><ul class="list-inline mb-0"><li class=list-inline-item data-bs-tooltip data-bs-title=RSS><a class="btn btn-light btn-sm" href=/ru/tags/dism/index.xml target=_blank aria-label=RSS><i class="fas fa-rss fa-fw"></i></a></li><li class="list-inline-item dropup" data-bs-tooltip data-bs-title=Языки><a class="dropdown-toggle btn btn-light btn-sm" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false aria-label=Языки><i class="fas fa-language fa-fw"></i></a><div class="dropdown-menu dropdown-menu-end shadow"><a class=dropdown-item href=/ru/ hreflang=ru>Русский
</a><a class=dropdown-item href=/en/ hreflang=en>English</a></div></li></ul></div></div></div></div></footer><div class="modal fade" id=search-modal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-xl"><div class=modal-content><div class=modal-header><h5 class=modal-title id=searchModalLabel>Поиск</h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Закрыть></button></div><div class="modal-body node-body"><div class="row row-cols-1 g-3"><div class=col><div class="row g-3"><div class=col-lg><form action=https://google.com/search method=get class=d-flex target=_blank><input type=hidden name=domains value=lib.onl>
<input type=hidden name=sitesearch value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=q placeholder='Поиск Google' aria-label='Поиск Google'>
<span class=input-group-text><i class="fab fa-google fa-fw"></i></span></div></form></div><div class=col-lg><form action=https://ya.ru/search method=get class=d-flex target=_blank><input type=hidden name=site value=lib.onl><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input type=search class=form-control name=text placeholder='Поиск Яндекс' aria-label='Поиск Яндекс'>
<span class=input-group-text><i class="fab fa-yandex fa-fw"></i></span></div></form></div></div></div><div class=col><form id=search-form method=get class=d-flex autocomplete=off><div class=input-group><span class=input-group-text><i class="fas fa-search fa-fw"></i></span>
<input id=search-input type=search class=form-control name=q placeholder='Внутренний поиск' aria-label='Внутренний поиск'>
<span class=input-group-text><i class="fas fa-brain fa-fw"></i></span></div></form></div><div class=col><div class="list-group list-group-flush d-none overflow-auto" id=search-results></div><div id=search-help><div class="alert alert-info d-flex align-items-center overflow-hidden node-body" id=alert-2186cb30cf4cd473ab0d6d61836e5f9e role=alert><div class=flex-shrink-0><i class="fas fa-search fa-fw fa-2x"></i></div><div class="flex-grow-1 ms-3 overflow-hidden"><p>Используется нечёткий поиск (приблизительное сопоставление строк).
Это метод поиска строк, которые приблизительно соответствуют поисковому шаблону.</p><p>Результаты поиска сортируются по точности совпадения с поисковым шаблоном.
Результаты поиска, наиболее точно соответствующие запросу, находятся сверху, приблизительные результаты - снизу.</p></div></div></div></div></div></div></div></div></div><script src=/js/vendor.bundle.min.js defer></script><script src=/ru/js/system.bundle.min.js defer></script></body></html>