<?xml version="1.0" encoding="UTF-8" standalone="yes"?><rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:yandex="http://news.yandex.ru" xmlns:turbo="http://turbo.yandex.ru"><channel><title>router / Library Online</title><link>https://lib.onl/ru/tags/router/</link><description>Заметки на тему администрирования и разработки различных систем, приложений и серверов.</description><language>ru-RU</language><sy:updatePeriod>weekly</sy:updatePeriod><sy:updateFrequency>1</sy:updateFrequency><image><link>https://lib.onl/ru/tags/router/</link><url>https://lib.onl/favicon-128.png</url><width>128</width><height>128</height><title>router / Library Online</title><description>Заметки на тему администрирования и разработки различных систем, приложений и серверов.</description></image><lastBuildDate>Sun, 12 Jul 2020 15:09:48 +0000</lastBuildDate><atom:link href="https://lib.onl/ru/tags/router/index.xml" rel="self" type="application/rss+xml"/><item turbo="true"><turbo:extendedHtml>true</turbo:extendedHtml><title>MikroTik и Cloudflare: Динамический IP для домена</title><link>https://lib.onl/ru/posts/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/</link><dc:creator>Kitsune Solar</dc:creator><guid isPermaLink="true">https://lib.onl/ru/posts/2020/07/ff2ae66e-8e14-5c4a-baa6-0cd2e59f6517/</guid><description>Когда то на просторах интернета нашёл скрипт реализации динамической смены IP из MikroTik напрямую в панели управления Cloudflare при помощи API. Сам скрипт я немного подкорректировал и опубликовал в MikroTik Marketplace. Где нашёл скрипт уже не помню, вроде бы на страницах официального форума MikroTik. Привожу описание скрипта и переменных.</description><media:content medium="image" url="https://images.unsplash.com/photo-1521542464131-cb30f7398bc6" width="1600" height="900"/><content:encoded><![CDATA[<p>Когда то на просторах интернета нашёл скрипт реализации динамической смены IP из MikroTik напрямую в панели управления Cloudflare при помощи API. Сам скрипт я немного подкорректировал и опубликовал в <a title="" href="https://github.com/marketplace-mikrotik/mikrotik-ext-cloudflare" target="_blank" rel="noopener noreferrer nofollow">MikroTik Marketplace</a>. Где нашёл скрипт уже не помню, вроде бы на страницах официального форума MikroTik. Привожу описание скрипта и переменных.</p>
<p>Сам скрипт нужно настроить под себя, прописав в нём значения переменных. Значения переменных я указал в <a title="" href="https://github.com/marketplace-mikrotik/mikrotik-ext-cloudflare/blob/main/README.md" target="_blank" rel="noopener noreferrer nofollow">README</a> на GitHub’е. Большинство значений можно узнать из панели управления доменом в Cloudflare, но для получения значения переменной <code>cfDNSID</code> необходимо выполнит немного телодвижений.</p>
<p>Для начала в терминале Linux выполнить следующую команду:</p>








  <div class="shortcode shortcode-codeblock shortcode-codeblock-sh">
    <div class="d-flex mb-3 overflow-hidden">
      <div class="flex-grow-1 rounded overflow-hidden" id="clipboard-d26650d22ea8f58cb4435a83c8701112"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -X GET <span class="s2">&#34;https://api.cloudflare.com/client/v4/zones/API_ZONE_ID/dns_records&#34;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Email: USER_EMAIL&#34;</span>                                                     <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Key: USER_TOKEN&#34;</span>                                                       <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="p">|</span> python -mjson.tool</span></span></code></pre></div></div>
      <div class="flex-shrink-0">
        <ul class="list-inline mb-0">
          <li class="list-inline-item" data-bs-tooltip data-bs-title='Копировать'>
            <a class="text-body" href="#"
               data-fn="clipboard preventDefault" data-clipboard-target="#clipboard-d26650d22ea8f58cb4435a83c8701112"
               role="button" aria-label='Копировать'>
              <i class="fas fa-copy fa-fw"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>


<p>&hellip;соответственно, подставив собственные значения, например (значения фальшивые):</p>








  <div class="shortcode shortcode-codeblock shortcode-codeblock-sh">
    <div class="d-flex mb-3 overflow-hidden">
      <div class="flex-grow-1 rounded overflow-hidden" id="clipboard-60a5fa3feb488f657c0baa1dbd3c66a0"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -X GET <span class="s2">&#34;https://api.cloudflare.com/client/v4/zones/Q7dslfag51U2B3jRpmbxMInDTCoSFYyH/dns_records&#34;</span>   <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Email: user@cloudflare.com&#34;</span>                                                                  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Key: CcDXmj5lzd9Na3Wi2fQLPvAJIuwUrxF1VnMyS&#34;</span>                                                  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="p">|</span> python -mjson.tool</span></span></code></pre></div></div>
      <div class="flex-shrink-0">
        <ul class="list-inline mb-0">
          <li class="list-inline-item" data-bs-tooltip data-bs-title='Копировать'>
            <a class="text-body" href="#"
               data-fn="clipboard preventDefault" data-clipboard-target="#clipboard-60a5fa3feb488f657c0baa1dbd3c66a0"
               role="button" aria-label='Копировать'>
              <i class="fas fa-copy fa-fw"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>


<p>Команды вернёт результат в формате JSON, к примеру (результаты фальшивые):</p>






<div class="shortcode shortcode-codeblock shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux">
  <div class="card mb-3 overflow-hidden" data-bs-theme="dark">
    <div class="card-header">
      <div class="d-flex align-items-center">
        <div class="flex-shrink-0 ">
          <i class="fas fa-terminal fa-fw"></i>
        </div>
        <div class="flex-grow-1 mx-2">
          <h5 class="mb-0">Терминал</h5>
        </div>
        <div class="flex-shrink-0">
          <ul class="list-inline mb-0">
            <li class="list-inline-item" data-bs-tooltip data-bs-title='Копировать'>
              <a class="text-body" href="#"
                 data-fn="clipboard preventDefault" data-clipboard-target="#clipboard-41f09fb343508fb2eb0fbbb13f96e9e2"
                 role="button" aria-label='Копировать'>
                <i class="fas fa-copy fa-fw"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="card-body p-0" id="clipboard-41f09fb343508fb2eb0fbbb13f96e9e2"><pre tabindex="0"><code class="language-terminal" data-lang="terminal">curl -X GET &#34;https://api.cloudflare.com/client/v4/zones/Q7dslfag51U2B3jRpmbxMInDTCoSFYyH/dns_records&#34; -H &#34;X-Auth-Email: user@cloudflare.com&#34; -H &#34;X-Auth-Key: CcDXmj5lzd9Na3Wi2fQLPvAJIuwUrxF1VnMyS&#34; -H &#34;Content-Type: application/json&#34; | python -mjson.tool
{
    &#34;result&#34;: [
        {
            &#34;id&#34;: &#34;gJDSG5la4IWNOEVn6K2PHyope8Q9YhzC&#34;,
            &#34;zone_id&#34;: &#34;Q7dslfag51U2B3jRpmbxMInDTCoSFYyH&#34;,
            &#34;zone_name&#34;: &#34;example.com&#34;,
            &#34;name&#34;: &#34;example.com&#34;,
            &#34;type&#34;: &#34;A&#34;,
            &#34;content&#34;: &#34;192.168.10.232&#34;,
            &#34;proxiable&#34;: true,
            &#34;proxied&#34;: true,
            &#34;ttl&#34;: 1,
            &#34;locked&#34;: false,
            &#34;meta&#34;: {
                &#34;auto_added&#34;: false,
                &#34;managed_by_apps&#34;: false,
                &#34;managed_by_argo_tunnel&#34;: false,
                &#34;source&#34;: &#34;primary&#34;
            },
            &#34;created_on&#34;: &#34;2020-02-23T21:26:27.56227Z&#34;,
            &#34;modified_on&#34;: &#34;2020-02-23T21:26:27.56227Z&#34;
        }
    ],
    &#34;success&#34;: true,
    &#34;errors&#34;: [],
    &#34;messages&#34;: [],
    &#34;result_info&#34;: {
        &#34;page&#34;: 1,
        &#34;per_page&#34;: 20,
        &#34;count&#34;: 7,
        &#34;total_count&#34;: 7,
        &#34;total_pages&#34;: 1
    }
}</code></pre></div>
  </div>
</div>
<p>Смотрим поле <code>id</code> и значение этого поля вставляем в переменную <code>cfDNSID</code>.</p>
<p>На этом всё. Не забываем выдать скрипту необходимые права в панели MikroTik, а также прописать автоматический запуск скрипта через <strong>Scheduler</strong>.</p>]]></content:encoded><turbo:source/><turbo:topic>MikroTik и Cloudflare: Динамический IP для домена</turbo:topic><turbo:content><![CDATA[<p>Когда то на просторах интернета нашёл скрипт реализации динамической смены IP из MikroTik напрямую в панели управления Cloudflare при помощи API. Сам скрипт я немного подкорректировал и опубликовал в <a title="" href="https://github.com/marketplace-mikrotik/mikrotik-ext-cloudflare" target="_blank" rel="noopener noreferrer nofollow">MikroTik Marketplace</a>. Где нашёл скрипт уже не помню, вроде бы на страницах официального форума MikroTik. Привожу описание скрипта и переменных.</p>
<p>Сам скрипт нужно настроить под себя, прописав в нём значения переменных. Значения переменных я указал в <a title="" href="https://github.com/marketplace-mikrotik/mikrotik-ext-cloudflare/blob/main/README.md" target="_blank" rel="noopener noreferrer nofollow">README</a> на GitHub’е. Большинство значений можно узнать из панели управления доменом в Cloudflare, но для получения значения переменной <code>cfDNSID</code> необходимо выполнит немного телодвижений.</p>
<p>Для начала в терминале Linux выполнить следующую команду:</p>








  <div class="shortcode shortcode-codeblock shortcode-codeblock-sh">
    <div class="d-flex mb-3 overflow-hidden">
      <div class="flex-grow-1 rounded overflow-hidden" id="clipboard-d26650d22ea8f58cb4435a83c8701112"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -X GET <span class="s2">&#34;https://api.cloudflare.com/client/v4/zones/API_ZONE_ID/dns_records&#34;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Email: USER_EMAIL&#34;</span>                                                     <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Key: USER_TOKEN&#34;</span>                                                       <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="p">|</span> python -mjson.tool</span></span></code></pre></div></div>
      <div class="flex-shrink-0">
        <ul class="list-inline mb-0">
          <li class="list-inline-item" data-bs-tooltip data-bs-title='Копировать'>
            <a class="text-body" href="#"
               data-fn="clipboard preventDefault" data-clipboard-target="#clipboard-d26650d22ea8f58cb4435a83c8701112"
               role="button" aria-label='Копировать'>
              <i class="fas fa-copy fa-fw"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>


<p>&hellip;соответственно, подставив собственные значения, например (значения фальшивые):</p>








  <div class="shortcode shortcode-codeblock shortcode-codeblock-sh">
    <div class="d-flex mb-3 overflow-hidden">
      <div class="flex-grow-1 rounded overflow-hidden" id="clipboard-60a5fa3feb488f657c0baa1dbd3c66a0"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -X GET <span class="s2">&#34;https://api.cloudflare.com/client/v4/zones/Q7dslfag51U2B3jRpmbxMInDTCoSFYyH/dns_records&#34;</span>   <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Email: user@cloudflare.com&#34;</span>                                                                  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;X-Auth-Key: CcDXmj5lzd9Na3Wi2fQLPvAJIuwUrxF1VnMyS&#34;</span>                                                  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-H <span class="s2">&#34;Content-Type: application/json&#34;</span> <span class="p">|</span> python -mjson.tool</span></span></code></pre></div></div>
      <div class="flex-shrink-0">
        <ul class="list-inline mb-0">
          <li class="list-inline-item" data-bs-tooltip data-bs-title='Копировать'>
            <a class="text-body" href="#"
               data-fn="clipboard preventDefault" data-clipboard-target="#clipboard-60a5fa3feb488f657c0baa1dbd3c66a0"
               role="button" aria-label='Копировать'>
              <i class="fas fa-copy fa-fw"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>


<p>Команды вернёт результат в формате JSON, к примеру (результаты фальшивые):</p>






<div class="shortcode shortcode-codeblock shortcode-codeblock-terminal
shortcode-codeblock-terminal-linux
shortcode-codeblock-terminal-linux">
  <div class="card mb-3 overflow-hidden" data-bs-theme="dark">
    <div class="card-header">
      <div class="d-flex align-items-center">
        <div class="flex-shrink-0 ">
          <i class="fas fa-terminal fa-fw"></i>
        </div>
        <div class="flex-grow-1 mx-2">
          <h5 class="mb-0">Терминал</h5>
        </div>
        <div class="flex-shrink-0">
          <ul class="list-inline mb-0">
            <li class="list-inline-item" data-bs-tooltip data-bs-title='Копировать'>
              <a class="text-body" href="#"
                 data-fn="clipboard preventDefault" data-clipboard-target="#clipboard-41f09fb343508fb2eb0fbbb13f96e9e2"
                 role="button" aria-label='Копировать'>
                <i class="fas fa-copy fa-fw"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="card-body p-0" id="clipboard-41f09fb343508fb2eb0fbbb13f96e9e2"><pre tabindex="0"><code class="language-terminal" data-lang="terminal">curl -X GET &#34;https://api.cloudflare.com/client/v4/zones/Q7dslfag51U2B3jRpmbxMInDTCoSFYyH/dns_records&#34; -H &#34;X-Auth-Email: user@cloudflare.com&#34; -H &#34;X-Auth-Key: CcDXmj5lzd9Na3Wi2fQLPvAJIuwUrxF1VnMyS&#34; -H &#34;Content-Type: application/json&#34; | python -mjson.tool
{
    &#34;result&#34;: [
        {
            &#34;id&#34;: &#34;gJDSG5la4IWNOEVn6K2PHyope8Q9YhzC&#34;,
            &#34;zone_id&#34;: &#34;Q7dslfag51U2B3jRpmbxMInDTCoSFYyH&#34;,
            &#34;zone_name&#34;: &#34;example.com&#34;,
            &#34;name&#34;: &#34;example.com&#34;,
            &#34;type&#34;: &#34;A&#34;,
            &#34;content&#34;: &#34;192.168.10.232&#34;,
            &#34;proxiable&#34;: true,
            &#34;proxied&#34;: true,
            &#34;ttl&#34;: 1,
            &#34;locked&#34;: false,
            &#34;meta&#34;: {
                &#34;auto_added&#34;: false,
                &#34;managed_by_apps&#34;: false,
                &#34;managed_by_argo_tunnel&#34;: false,
                &#34;source&#34;: &#34;primary&#34;
            },
            &#34;created_on&#34;: &#34;2020-02-23T21:26:27.56227Z&#34;,
            &#34;modified_on&#34;: &#34;2020-02-23T21:26:27.56227Z&#34;
        }
    ],
    &#34;success&#34;: true,
    &#34;errors&#34;: [],
    &#34;messages&#34;: [],
    &#34;result_info&#34;: {
        &#34;page&#34;: 1,
        &#34;per_page&#34;: 20,
        &#34;count&#34;: 7,
        &#34;total_count&#34;: 7,
        &#34;total_pages&#34;: 1
    }
}</code></pre></div>
  </div>
</div>
<p>Смотрим поле <code>id</code> и значение этого поля вставляем в переменную <code>cfDNSID</code>.</p>
<p>На этом всё. Не забываем выдать скрипту необходимые права в панели MikroTik, а также прописать автоматический запуск скрипта через <strong>Scheduler</strong>.</p>]]></turbo:content><pubDate>Sun, 12 Jul 2020 15:09:48 +0000</pubDate><category>Сеть</category></item></channel></rss>