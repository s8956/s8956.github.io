{"data":[{"page":{"authors":["KitsuneSolar"],"categories":["Dev"],"content":"В одной компании стояла задача сделать файловый архив-помойку для хранения и пересылки документации в сторонние организации. я накидал на PHP самописный интерфейс для загрузки файлов, а на bash\u0026rsquo;е сделал скрипт автоматического удаления устаревших файлов. Небольшая заметка об этом скрипте.\nСкрипт для удаления устаревших файлов очень прост, написан на bash\u0026rsquo;е и основывается на утилите find. Утилита find имеет опцию -mtime, при помощи которого можно сделать выборку файлов по времени изменения:\nfind \u0026quot;/home/user\u0026quot; -type f -mtime +3 Здесь мы говорим утилите find, что необходимо найти и показать файлы, у которых с даты последнего изменения прошло более 3 дней. Если необходимо вывести файлы, дата изменения которых будет менее 3 дней, то ставим отрицательное значение -3.\nДалее, конструируем конвейер, и при помощи xargs указываем команду удаления rm -f:\nfind \u0026quot;/home/user\u0026quot; -type f -mtime +3 -print0 | xargs -0 rm -f Сам скрипт провожу ниже.\nСкрипт #!/usr/bin/bash # name: delete-files.sh days=\u0026quot;${1}\u0026quot; dir=\u0026quot;${2}\u0026quot; find \u0026quot;${dir}\u0026quot; -type f -mtime +${days} -print0 | xargs -0 rm -f exit 0 В скрипте я вынес некоторые значения в переменные для удобной перенастройки. Вызывается скрипт следующем образом:\nuser@localhost ~ % delete-files.sh \u0026quot;3\u0026quot; \u0026quot;/path/to/storage\u0026quot; Где:\n3 - количество дней, прошедших с момента последнего изменения файла. /path/to/storage - путь к файловому хранилищу, в котором необходимо удалять устаревшие файлы. Автоматический запуск по расписанию Осталось добавить выполнение скрипта по cron\u0026rsquo;у. Я указал время 23:59, когда нагрузка на файловое хранилище минимальна:\n# Check \u0026amp; remove old files in 23:59 every day. 59 23 * * * [username] /usr/bin/bash /path/to/delete-files.sh \u0026quot;3\u0026quot; \u0026quot;/path/to/storage\u0026quot; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ","date":{"created":"2021-08-19T15:03:46Z","modified":"2021-08-19T15:03:46Z","published":"2021-08-19T15:03:46Z"},"description":"В одной компании стояла задача сделать файловый архив-помойку для хранения и пересылки документации в сторонние организации. я накидал на PHP самописный интерфейс для загрузки файлов, а на bash\u0026rsquo;е сделал скрипт автоматического удаления устаревших файлов. Небольшая заметка об этом скрипте.","images":["https://images.unsplash.com/flagged/photo-1578728890856-8bbf3883aa6d"],"meta":{"fid":"6b90a50ac58ae7c0b5ad23a669941f0b","licenses":["cc-by-sa-4.0"],"read_time":2,"sha1":"70890ce919a677a46754203d257fed309d504965","type":"posts","uuid":"ca744dce-e607-52e6-9952-8ae04e052a5b","word_count":248},"name":"Скрипт автоматического удаления устаревших файлов","tags":["bash","find"],"url":"https://lib.onl/ru/posts/2021/08/ca744dce-e607-52e6-9952-8ae04e052a5b/"},"site":{"description":"Заметки на тему администрирования и разработки различных систем, приложений и серверов.","name":"Library Online","url":"https://lib.onl/"}}]}